import{aG as Le,ck as v,cl as j,gv as Km,co as _e,b0 as I,ca as Te,P as V,cn as B,cp as O,aH as T,h as Vs,V as $,ew as q,cV as x,gw as Xi,X as k,Y as _,aQ as G,aB as Bt,gx as Re,gy as It,gz as li,ad as L,Q as tn,ag as de,gA as zm,bR as Lo,av as _s,gB as $m,gC as qm,gD as jm,eW as Ym,gE as Tl,d9 as Mi,_ as E,e as h,ak as si,k as le,f as N,cB as pe,dq as ot,m as Kt,p as yn,bl as W,gF as Zm,eh as Dp,fL as Ie,y as M,f9 as Jm,gG as Xm,gH as Qm,dB as Se,gI as ew,gr as aa,gJ as tw,bn as Ee,fK as sn,cA as da,am as c,fE as so,fJ as on,aR as Be,e_ as Al,fp as oo,dh as Tp,eX as xl,da as iw,db as sw,fn as bd,dA as Ft,dc as $e,gK as Ap,cx as w,dv as lr,gL as hr,df as Ve,gM as ow,de as J,fy as Un,dw as wt,dg as se,dm as Ph,dn as Lh,eV as xp,fb as Rp,gN as nw,dW as no,gO as rw,eZ as ur,gP as Vp,aj as Qe,ds as zt,dt as bt,i as We,dG as ee,fF as Ki,gQ as pr,g9 as Es,gR as aw,gS as dw,gT as cw,gU as kp,F as Kn,dV as Et,gV as Zs,gW as Pp,u as gt,gX as lw,gY as hw,fj as ro,gZ as Lp,g_ as Mp,g$ as Op,h0 as Np,h1 as Bp,h2 as Fp,e1 as xe,h3 as uw,q as X,fk as pw,fh as gw,h4 as ks,h5 as fw,h6 as mw,h7 as ww,h8 as za,h9 as gr,ha as Gp,hb as vw,hc as yw,hd as Wp,he as Hp,hf as Up,hg as fr,d8 as Js,hh as Mh,hi as bw,d4 as bi,dz as Kp,hj as Xs,hk as ji,hl as ls,hm as Cw,hn as Sw,ho as Cd,hp as Go,fg as Sd,c1 as zp,hq as _w,et as mt,gb as Ew,hr as Iw,hs as Dw,ht as Tw,hu as Aw,J as Oh,hv as $p,hw as xw,hx as fs,hy as Rw,hz as Vw,C as kw,E as Is,hA as he,dx as Pw,c as Y,d as qe,hB as qp,c7 as ae,hC as _d,hD as jp,hE as Nh,hF as Lw,H as Bs,G as Oe,z as ts,hG as Qs,hH as ft,hI as zi,dL as Rl,dy as Mw,hJ as zn,hK as Ow,hL as tr,hM as Nw,aS as ao,hN as Bw,b6 as Fw,hO as Gw,x as Yp,hP as vo,hQ as Vl,hR as kl,hS as Ww,au as co,dR as is,hT as Hw,hU as Uw,hV as Bh,hW as $a,hX as Pl,e8 as Fh,e3 as Kw,f8 as zw,hY as $w,dJ as ss,eH as qw,hZ as jw,h_ as Yw,ef as Ds,d0 as S,ce as A,f5 as Ed,f6 as Id,dY as Ll,j as bn,dZ as Zw,f0 as Jw,ee as mr,h$ as yo,i0 as Xw,i1 as Ml,i2 as Ol,i3 as Nl,i4 as Bl,i5 as it,i6 as Zp,U as K,c4 as vi,bW as ye,i7 as Qw,i8 as Ei,i9 as Fl,ia as xo,a as Q,K as Cn,ib as ev,ic as Gh,id as st,ie as U,ig as Wh,ih as Lt,ii as vt,ij as ui,aI as fe,ik as qa,il as tv,im as Ot,io as ja,ip as Hh,iq as Sn,ir as iv,is as ir,it as Uh,R as be,iu as Nt,iv as sv,iw as ov,ix as nv,iy as rv,bt as hi,cw as ve,iz as Oi,iA as av,ch as kt,l as et,iB as Ts,iC as dv,iD as ht,iE as cv,iF as lv,iG as hv,iH as uv,iI as pv,iJ as Dd,iK as Wo,iL as Ho,iM as ze,iN as Ge,iO as Ya,iP as Kh,iQ as gv,iR as fv,B as Td,iS as zh,c5 as $h,b3 as _n,iT as Zt,iU as qh,iV as wr,s as je,iW as mv,iX as wv,iY as vv,iZ as Gl,i_ as Jp,i$ as Wl,j0 as Hl,al as Ul,an as yv,bP as Kl,j1 as Xp,j2 as Ct,j3 as Qp,j4 as eg,j5 as ut,ep as ca,j6 as la,j7 as sr,b$ as bv,j8 as Cv,bo as Ks,j9 as Sv,ja as _v,jb as Ev,jc as Uo,jd as Iv,je as Dv,jf as jh,jg as Yh,jh as Zh,ji as Tv,jj as Av,jk as xv,cs as zl,jl as $l,jm as Rv,jn as Vv,jo as Za,jp as kv,jq as Pv,go as Lv,jr as Mv,js as Jh,jt as Mo,ju as Ov,jv as Nv,jw as Xh,jx as ne,jy as tg,jz as ql,jA as ha,jB as ua,aM as es,cz as Bv,jC as Fv,jD as ig,af as Ko,jE as Gv,jF as Wv,jG as Hv,jH as Uv,jI as Kv,jJ as zv,eP as Qh,aD as Qt,jK as $v,jL as Vt,jM as qv,jN as jv,jO as sg,jP as og,jQ as Ps,jR as ei,jS as ng,jT as Yv,aN as jl,di as rg,jU as Zv,jV as Jv,jW as Xv,dl as eu,jX as ag,jY as Qv,d6 as En,cS as ti,e5 as ey,e4 as dg,jZ as ty,j_ as iy,dj as nn,j$ as sy,at as $i,cN as Ro,cO as tu,cP as oy,k0 as cg,eS as rn,k1 as iu,dI as Ke,k2 as ny,cR as vr,I as lg,k3 as ry,k4 as su,n as hg,k5 as ay,gp as pa,k6 as ou,k7 as nu,k8 as ru,k9 as dy,ka as cy,dU as ug,dT as au,kb as du,kc as pg,gt as ly,cj as Ls,kd as zo,dr as St,ke as os,kf as hy,c9 as uy,ek as yr,dk as cu,kg as Ja,eQ as gg,kh as py,ki as lu,kj as hu,cu as Ne,ev as gy,w as ds,kk as fy,kl as my,km as wy,kn as Ad,ko as uu,kp as vy,kq as fg,kr as pu,ks as yy,kt as by,ku as Cy,kv as Sy,en as _y,kw as Xa,kx as Ey,ky as Iy,kz as Dy,c8 as Ty,kA as or,kB as Ay,cy as b,b4 as br,kC as Ni,kD as xy,kE as mg,kF as ga,kG as fa,kH as Yl,kI as gu,kJ as Ry,kK as Bi,kL as Vy,kM as ma,ac as me,kN as xd,kO as ky,kP as wa,kQ as bo,kR as Py,ay as Ly,kS as wg,ex as My,kT as Oy,kU as pt,kV as Ny,kW as By,kX as Gt,kY as Cr,kZ as Fy,k_ as Gy,bT as Co,k$ as Wy,l0 as Hy,ai as In,l1 as Uy,l2 as fu,l3 as mu,l4 as Sr,bH as Vi,l5 as lo,l6 as Oo,l7 as Ky,l8 as va,l9 as ya,la as ba,lb as zy,lc as $y,ld as vg,le as Ca,lf as qy,lg as yg,lh as ge,aE as Ci,aF as Si,cd as Ae,li as bg,lj as Cg,lk as Sg,ll as Je,lm as _g,ln as Eg,lo as Ig,lp as Dg,lq as Tg,lr as Ag,ls as xg,lt as Rg,lu as Vg,lv as Dn,lw as kg,lx as Pg,ly as xt,lz as Lg,lA as Sa,lB as Mg,lC as So,aX as Zl,aY as Jl,lD as _i,lE as an,lF as _r,lG as Qa,lH as Og,lI as Xe,lJ as ed,cW as te,c_ as re,lK as Xl,lL as oi,lM as ni,lN as dt,lO as jy,lP as Yy,lQ as Ql,lR as Tn,lS as An,lT as xn,lU as Ng,lV as Zy,lW as Jy,lX as Xy,cm as Bg,lY as Fg,lZ as Qy,l_ as _a,l$ as td,m0 as id,m1 as Gg,m2 as eb,m3 as tb,m4 as ib,m5 as sb,cr as Wg,m6 as ob,aC as Ea,fW as nb,m7 as Hg,m8 as rb,bx as ab,m9 as Rd,ma as wu,mb as pi,mc as vu,md as eh,me as db,mf as cb,mg as lb,mh as Ug,bQ as Ia,fN as yu,gl as hb,mi as Vd,mj as ub,mk as pb,ml as gb,mm as fb,mn as bu,mo as mb,mp as wb,d2 as Kg,mq as Fe,mr as De,ms as Li,mt as ms,mu as vb,mv as nt,mw as ws,mx as yb,my as Er,mz as th,mA as rt,mB as $n,mC as bb,mD as Cb,mE as Sb,mF as sd,mG as As,mH as zg,d5 as kd,mI as eo,bS as vs,mJ as _b,mK as Eb,mL as Ib,mM as Db,mN as Tb,cq as ih,mO as zs,mP as sh,mQ as od,mR as Cu,mS as Di,mT as qn,mU as Ii,mV as Pd,mW as Ab,mX as Su,mY as $o,mZ as $g,m_ as qg,m$ as xb,n0 as Rb,n1 as jg,n2 as Vb,n3 as kb,n4 as _u,ar as Eu,ge as Iu,gh as Yg,n5 as nd,n6 as Du,n7 as Rn,n8 as Fi,n9 as Pb,na as Lb,nb as Mb,nc as Ob,nd as oh,ne as Zg,nf as Ld,ng as Nb,nh as $s,ni as Bb,cf as Fb,nj as Gb,nk as Jt,nl as Tu,nm as Wb,nn as Au,no as Hb,np as rd,nq as Ub,nr as Kb,ns as zb,nt as $b,nu as qb,nv as jb,nw as Yb,nx as Jg,ny as Zb,nz as Xg,nA as Ti,nB as Jb,nC as xu,nD as cs,nE as Ru,nF as Xb,nG as Vu,nH as ku,nI as Qb,nJ as eC,nK as Qg,nL as ef,nM as nh,nN as tf,nO as No,bU as tC,nP as iC,nQ as sC,nR as Pu,nS as oC,nT as nC,nU as Lu,nV as rC,nW as aC,nX as sf,nY as Mu,nZ as of,n_ as Ou,n$ as nf,o0 as Nu,o1 as Md,o2 as Od,o3 as dC,o4 as cC,o5 as lC,o6 as hC,o7 as uC,o8 as pC,o9 as gC,oa as fC,ob as mC,oc as wC,od as rf,oe as af,of as vC,og as yC,oh as bC,oi as CC,oj as SC,ok as _C,ol as EC,om as IC,on as DC,oo as TC,op as AC,oq as xC,or as RC,os as VC,ot as kC,ou as PC,ov as LC,ow as MC,ox as OC,oy as NC,oz as BC,oA as FC,oB as GC,oC as WC,oD as HC,oE as UC,oF as KC,oG as zC,oH as $C,oI as qC,oJ as jC,oK as YC,oL as ZC,oM as JC,oN as XC,oO as QC,oP as eS,oQ as tS,oR as iS,oS as sS,oT as oS,oU as nS,oV as rS,oW as aS,oX as dS,oY as cS,oZ as lS,o_ as hS,o$ as uS,p0 as pS,p1 as gS,p2 as fS,p3 as mS,p4 as wS,p5 as vS,p6 as yS,p7 as bS,p8 as CS,p9 as SS,pa as _S,pb as ES,pc as IS,pd as DS,pe as TS,pf as AS,pg as xS,ph as RS,pi as VS,pj as kS,pk as PS,pl as df,pm as cf,pn as lf,po as hf,pp as uf,pq as pf,pr as gf,ps as ff,pt as LS,pu as MS,pv as OS,pw as NS,px as BS,py as FS,pz as GS,pA as WS,pB as HS,pC as US,pD as KS,pE as zS,pF as $S,pG as mf,pH as qS,pI as wf,pJ as _o,pK as vf,pL as yf,pM as Da,pN as Vn,pO as Ta,pP as kn,pQ as jS,pR as bf,pS as ri,pT as YS,pU as ZS,pV as Cf,pW as JS,pX as XS,pY as QS,pZ as e_,p_ as t_,p$ as i_,q0 as s_,q1 as o_,q2 as n_,q3 as r_,q4 as Eo,q5 as a_,q6 as Sf,q7 as Pn,q8 as _f,q9 as Ef,qa as Aa,qb as rh,qc as Ln,qd as If,qe as Df,qf as d_,qg as Tf,qh as Io,qi as Af,qj as xa,qk as xf,ql as Rf,qm as Mn,qn as Vf,qo as kf,qp as Pf,qq as c_,qr as l_,qs as h_,qt as Lf,qu as u_,qv as Ra,qw as xs,qx as p_,qy as g_,qz as f_,qA as m_,qB as w_,qC as v_,qD as y_,qE as Mf,qF as b_,qG as C_,qH as S_,qI as __,qJ as E_,qK as ho,qL as ah,qM as I_,t as D_,qN as Of,qO as dn,qP as ad,qQ as Vo,gf as T_,qR as Bu,qS as A_,qT as x_,fO as R_,fV as fi,gn as Fu,qU as Gu,qV as Nf,qW as V_,qX as Rs,qY as k_,qZ as P_,aA as qo,q_ as Wu,q$ as L_,r0 as tt,r1 as Ce,a7 as ii,aP as mi,r2 as Va,eU as M_,r3 as Hu,r4 as Uu,r5 as O_,a6 as nr,r6 as N_,r7 as B_,r8 as Bf,r9 as F_,ra as Tt,rb as dh,rc as ch,rd as ka,re as lh,rf as G_,rg as W_,rh as jn,ri as ki,rj as Ri,rk as H_,rl as Ku,f_ as U_,ao as K_,rm as z_,rn as hs,ro as zu,rp as $_,rq as Nd,rr as dd,rs as $u,rt as Yn,a3 as q_,ru as j_,rv as Y_,rw as qu,rx as Ff,ry as Gf,rz as Zn,rA as Z_,rB as J_,rC as X_,rD as Q_,rE as eE,rF as tE,rG as iE,rH as Wf,rI as Hf,rJ as Uf,rK as Ir,rL as sE,rM as ju,rN as oE,rO as qs,rP as cd,rQ as nE,rR as Dr,rS as rE,rT as aE,rU as ue,rV as Do,rW as Pa,rX as hh,rY as dE,rZ as cE,r_ as Kf,r$ as lE,s0 as Yu,s1 as Qi,s2 as hE,s3 as uE,s4 as Jn,s5 as jo,s6 as pE,s7 as zf,s8 as $f,s9 as gE,ez as Zu,sa as fE,eB as mE,eC as wE,sb as vE,eR as yE,sc as Bd,sd as Fd,se as Gd,sf as bE,sg as CE,sh as SE,si as _E,sj as Tr,sk as qf,sl as Ju,sm as EE,fu as IE,sn as DE,ft as TE,so as AE,sp as jf,sq as xE,sr as RE,ss as VE,st as kE,su as PE,sv as LE,sw as ME,sx as OE,sy as NE,sz as Xn,fG as BE,S as uh}from"./index-pxunSOBF.js";import{f as Yf,T as FE}from"./editor.contribution._autosave-COkyG6K_.js";import{I as GE}from"./workbenchThemeService.service-DYBHZJRz.js";const Zf=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Le(Zf);v(class extends j{constructor(){super({id:"workbench.action.closeSidebar",title:I(3454,"Close Primary Side Bar"),category:_e.View,f1:true,precondition:Km})}run(a){a.get(Te).setPartHidden(true,V.SIDEBAR_PART)}});class WE extends j{constructor(){super({id:"workbench.action.focusSideBar",title:I(3455,"Focus into Primary Side Bar"),category:_e.View,f1:true,keybinding:{weight:B.WorkbenchContrib,when:null,primary:O.CtrlCmd|T.Digit0}})}async run(e){const t=e.get(Te);const i=e.get(Vs);if(!t.isVisible(V.SIDEBAR_PART)){t.setPartHidden(false,V.SIDEBAR_PART)}const s=i.getActivePaneComposite($.Sidebar);s?.focus()}}v(WE);const Jf=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Le(Jf);const HE={separatorBorder:Bt.transparent};function gi(a){return a===q.VERTICAL?q.HORIZONTAL:q.VERTICAL}class UE{constructor(e){this.isLayoutEnabled=e}}function KE(a,e){if(e===q.HORIZONTAL){return{left:a.start,right:a.end,top:a.orthogonalStart,bottom:a.orthogonalEnd}}else{return{top:a.start,bottom:a.end,left:a.orthogonalStart,right:a.orthogonalEnd}}}function zE(a,e){if(e===q.HORIZONTAL){return{start:a.left,end:a.right,orthogonalStart:a.top,orthogonalEnd:a.bottom}}else{return{start:a.top,end:a.bottom,orthogonalStart:a.left,orthogonalEnd:a.right}}}function jt(a,e){if(Math.abs(a)>e){throw new Error("Invalid index")}return zm(a,e+1)}class we{get size(){return this._size}get orthogonalSize(){return this._orthogonalSize}get absoluteOffset(){return this._absoluteOffset}get absoluteOrthogonalOffset(){return this._absoluteOrthogonalOffset}get styles(){return this._styles}get width(){return this.orientation===q.HORIZONTAL?this.size:this.orthogonalSize}get height(){return this.orientation===q.HORIZONTAL?this.orthogonalSize:this.size}get top(){return this.orientation===q.HORIZONTAL?this._absoluteOffset:this._absoluteOrthogonalOffset}get left(){return this.orientation===q.HORIZONTAL?this._absoluteOrthogonalOffset:this._absoluteOffset}get minimumSize(){return this.children.length===0?0:Math.max(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.minimumOrthogonalSize:0))}get maximumSize(){return Math.min(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.maximumOrthogonalSize:Number.POSITIVE_INFINITY))}get priority(){if(this.children.length===0){return li.Normal}const e=this.children.map(t=>typeof t.priority==="undefined"?li.Normal:t.priority);if(e.some(t=>t===li.High)){return li.High}else if(e.some(t=>t===li.Low)){return li.Low}return li.Normal}get proportionalLayout(){if(this.children.length===0){return true}return this.children.every(e=>e.proportionalLayout)}get minimumOrthogonalSize(){return this.splitview.minimumSize}get maximumOrthogonalSize(){return this.splitview.maximumSize}get minimumWidth(){return this.orientation===q.HORIZONTAL?this.minimumOrthogonalSize:this.minimumSize}get minimumHeight(){return this.orientation===q.HORIZONTAL?this.minimumSize:this.minimumOrthogonalSize}get maximumWidth(){return this.orientation===q.HORIZONTAL?this.maximumOrthogonalSize:this.maximumSize}get maximumHeight(){return this.orientation===q.HORIZONTAL?this.maximumSize:this.maximumOrthogonalSize}get boundarySashes(){return this._boundarySashes}set boundarySashes(e){if(this._boundarySashes.start===e.start&&this._boundarySashes.end===e.end&&this._boundarySashes.orthogonalStart===e.orthogonalStart&&this._boundarySashes.orthogonalEnd===e.orthogonalEnd){return}this._boundarySashes=e;this.splitview.orthogonalStartSash=e.orthogonalStart;this.splitview.orthogonalEndSash=e.orthogonalEnd;for(let t=0;t<this.children.length;t++){const i=this.children[t];const s=t===0;const o=t===this.children.length-1;i.boundarySashes={start:e.orthogonalStart,end:e.orthogonalEnd,orthogonalStart:s?e.start:i.boundarySashes.orthogonalStart,orthogonalEnd:o?e.end:i.boundarySashes.orthogonalEnd}}}get edgeSnapping(){return this._edgeSnapping}set edgeSnapping(e){if(this._edgeSnapping===e){return}this._edgeSnapping=e;for(const t of this.children){if(t instanceof we){t.edgeSnapping=e}}this.updateSplitviewEdgeSnappingEnablement()}constructor(e,t,i,s,o=0,n=0,r=false,d){this.orientation=e;this.layoutController=t;this.splitviewProportionalLayout=s;this.children=[];this._absoluteOffset=0;this._absoluteOrthogonalOffset=0;this.absoluteOrthogonalSize=0;this._onDidChange=new _;this.onDidChange=this._onDidChange.event;this._onDidVisibilityChange=new _;this.onDidVisibilityChange=this._onDidVisibilityChange.event;this.childrenVisibilityChangeDisposable=new L;this._onDidScroll=new _;this.onDidScrollDisposable=k.None;this.onDidScroll=this._onDidScroll.event;this.childrenChangeDisposable=k.None;this._onDidSashReset=new _;this.onDidSashReset=this._onDidSashReset.event;this.splitviewSashResetDisposable=k.None;this.childrenSashResetDisposable=k.None;this._boundarySashes={};this._edgeSnapping=false;this._styles=i;this._size=o;this._orthogonalSize=n;this.element=G(".monaco-grid-branch-node");if(!d){this.splitview=new tn(this.element,{orientation:e,styles:i,proportionalLayout:s});this.splitview.layout(o,{orthogonalSize:n,absoluteOffset:0,absoluteOrthogonalOffset:0,absoluteSize:o,absoluteOrthogonalSize:n})}else{const u={views:d.map(f=>{return{view:f.node,size:f.node.size,visible:f.visible!==false}}),size:this.orthogonalSize};const p={proportionalLayout:s,orientation:e,styles:i};this.children=d.map(f=>f.node);this.splitview=new tn(this.element,{...p,descriptor:u});this.children.forEach((f,g)=>{const m=g===0;const y=g===this.children.length;f.boundarySashes={start:this.boundarySashes.orthogonalStart,end:this.boundarySashes.orthogonalEnd,orthogonalStart:m?this.boundarySashes.start:this.splitview.sashes[g-1],orthogonalEnd:y?this.boundarySashes.end:this.splitview.sashes[g]}})}const l=x.map(this.splitview.onDidSashReset,u=>[u]);this.splitviewSashResetDisposable=l(this._onDidSashReset.fire,this._onDidSashReset);this.updateChildrenEvents()}style(e){this._styles=e;this.splitview.style(e);for(const t of this.children){if(t instanceof we){t.style(e)}}}layout(e,t,i){if(!this.layoutController.isLayoutEnabled){return}if(typeof i==="undefined"){throw new Error("Invalid state")}this._size=i.orthogonalSize;this._orthogonalSize=e;this._absoluteOffset=i.absoluteOffset+t;this._absoluteOrthogonalOffset=i.absoluteOrthogonalOffset;this.absoluteOrthogonalSize=i.absoluteOrthogonalSize;this.splitview.layout(i.orthogonalSize,{orthogonalSize:e,absoluteOffset:this._absoluteOrthogonalOffset,absoluteOrthogonalOffset:this._absoluteOffset,absoluteSize:i.absoluteOrthogonalSize,absoluteOrthogonalSize:i.absoluteSize});this.updateSplitviewEdgeSnappingEnablement()}setVisible(e){for(const t of this.children){t.setVisible(e)}}addChild(e,t,i,s){i=jt(i,this.children.length);this.splitview.addView(e,t,i,s);this.children.splice(i,0,e);this.updateBoundarySashes();this.onDidChildrenChange()}removeChild(e,t){e=jt(e,this.children.length);const i=this.splitview.removeView(e,t);this.children.splice(e,1);this.updateBoundarySashes();this.onDidChildrenChange();return i}removeAllChildren(){const e=this.splitview.removeAllViews();this.children.splice(0,this.children.length);this.updateBoundarySashes();this.onDidChildrenChange();return e}moveChild(e,t){e=jt(e,this.children.length);t=jt(t,this.children.length);if(e===t){return}if(e<t){t-=1}this.splitview.moveView(e,t);this.children.splice(t,0,this.children.splice(e,1)[0]);this.updateBoundarySashes();this.onDidChildrenChange()}swapChildren(e,t){e=jt(e,this.children.length);t=jt(t,this.children.length);if(e===t){return}this.splitview.swapViews(e,t);[this.children[e].boundarySashes,this.children[t].boundarySashes]=[this.children[e].boundarySashes,this.children[t].boundarySashes];[this.children[e],this.children[t]]=[this.children[t],this.children[e]];this.onDidChildrenChange()}resizeChild(e,t){e=jt(e,this.children.length);this.splitview.resizeView(e,t)}isChildExpanded(e){return this.splitview.isViewExpanded(e)}distributeViewSizes(e=false){this.splitview.distributeViewSizes();if(e){for(const t of this.children){if(t instanceof we){t.distributeViewSizes(true)}}}}getChildSize(e){e=jt(e,this.children.length);return this.splitview.getViewSize(e)}isChildVisible(e){e=jt(e,this.children.length);return this.splitview.isViewVisible(e)}setChildVisible(e,t){e=jt(e,this.children.length);if(this.splitview.isViewVisible(e)===t){return}const i=this.splitview.contentSize===0;this.splitview.setViewVisible(e,t);const s=this.splitview.contentSize===0;if(t&&i||!t&&s){this._onDidVisibilityChange.fire(t)}}getChildCachedVisibleSize(e){e=jt(e,this.children.length);return this.splitview.getViewCachedVisibleSize(e)}updateBoundarySashes(){for(let e=0;e<this.children.length;e++){this.children[e].boundarySashes={start:this.boundarySashes.orthogonalStart,end:this.boundarySashes.orthogonalEnd,orthogonalStart:e===0?this.boundarySashes.start:this.splitview.sashes[e-1],orthogonalEnd:e===this.children.length-1?this.boundarySashes.end:this.splitview.sashes[e]}}}onDidChildrenChange(){this.updateChildrenEvents();this._onDidChange.fire(void 0)}updateChildrenEvents(){const e=x.map(x.any(...this.children.map(s=>s.onDidChange)),()=>void 0);this.childrenChangeDisposable.dispose();this.childrenChangeDisposable=e(this._onDidChange.fire,this._onDidChange);const t=x.any(...this.children.map((s,o)=>x.map(s.onDidSashReset,n=>[o,...n])));this.childrenSashResetDisposable.dispose();this.childrenSashResetDisposable=t(this._onDidSashReset.fire,this._onDidSashReset);const i=x.any(x.signal(this.splitview.onDidScroll),...this.children.map(s=>s.onDidScroll));this.onDidScrollDisposable.dispose();this.onDidScrollDisposable=i(this._onDidScroll.fire,this._onDidScroll);this.childrenVisibilityChangeDisposable.clear();this.children.forEach((s,o)=>{if(s instanceof we){this.childrenVisibilityChangeDisposable.add(s.onDidVisibilityChange(n=>{this.setChildVisible(o,n)}))}})}trySet2x2(e){if(this.children.length!==2||e.children.length!==2){return k.None}if(this.getChildSize(0)!==e.getChildSize(0)){return k.None}const[t,i]=this.children;const[s,o]=e.children;if(!(t instanceof Me)||!(i instanceof Me)){return k.None}if(!(s instanceof Me)||!(o instanceof Me)){return k.None}if(this.orientation===q.VERTICAL){i.linkedWidthNode=s.linkedHeightNode=t;t.linkedWidthNode=o.linkedHeightNode=i;o.linkedWidthNode=t.linkedHeightNode=s;s.linkedWidthNode=i.linkedHeightNode=o}else{s.linkedWidthNode=i.linkedHeightNode=t;o.linkedWidthNode=t.linkedHeightNode=i;t.linkedWidthNode=o.linkedHeightNode=s;i.linkedWidthNode=s.linkedHeightNode=o}const n=this.splitview.sashes[0];const r=e.splitview.sashes[0];n.linkedSash=r;r.linkedSash=n;this._onDidChange.fire(void 0);e._onDidChange.fire(void 0);return de(()=>{n.linkedSash=r.linkedSash=void 0;t.linkedHeightNode=t.linkedWidthNode=void 0;i.linkedHeightNode=i.linkedWidthNode=void 0;s.linkedHeightNode=s.linkedWidthNode=void 0;o.linkedHeightNode=o.linkedWidthNode=void 0})}updateSplitviewEdgeSnappingEnablement(){this.splitview.startSnappingEnabled=this._edgeSnapping||this._absoluteOrthogonalOffset>0;this.splitview.endSnappingEnabled=this._edgeSnapping||this._absoluteOrthogonalOffset+this._size<this.absoluteOrthogonalSize}dispose(){for(const e of this.children){e.dispose()}this._onDidChange.dispose();this._onDidSashReset.dispose();this._onDidVisibilityChange.dispose();this.childrenVisibilityChangeDisposable.dispose();this.splitviewSashResetDisposable.dispose();this.childrenSashResetDisposable.dispose();this.childrenChangeDisposable.dispose();this.onDidScrollDisposable.dispose();this.splitview.dispose()}}function $E(a){const[e,t]=x.split(a.onDidChange,Lo);return x.any(t,x.map(x.latch(x.map(e,i=>[a.minimumWidth,a.maximumWidth,a.minimumHeight,a.maximumHeight]),_s),i=>void 0))}class Me{get size(){return this._size}get orthogonalSize(){return this._orthogonalSize}get linkedWidthNode(){return this._linkedWidthNode}set linkedWidthNode(e){this._onDidLinkedWidthNodeChange.input=e?e._onDidViewChange:x.None;this._linkedWidthNode=e;this._onDidSetLinkedNode.fire(void 0)}get linkedHeightNode(){return this._linkedHeightNode}set linkedHeightNode(e){this._onDidLinkedHeightNodeChange.input=e?e._onDidViewChange:x.None;this._linkedHeightNode=e;this._onDidSetLinkedNode.fire(void 0)}constructor(e,t,i,s,o=0){this.view=e;this.orientation=t;this.layoutController=i;this._size=0;this.absoluteOffset=0;this.absoluteOrthogonalOffset=0;this.onDidScroll=x.None;this.onDidSashReset=x.None;this._onDidLinkedWidthNodeChange=new Xi;this._linkedWidthNode=void 0;this._onDidLinkedHeightNodeChange=new Xi;this._linkedHeightNode=void 0;this._onDidSetLinkedNode=new _;this.disposables=new L;this._boundarySashes={};this.cachedWidth=0;this.cachedHeight=0;this.cachedTop=0;this.cachedLeft=0;this._orthogonalSize=s;this._size=o;const n=$E(e);this._onDidViewChange=x.map(n,r=>r&&(this.orientation===q.VERTICAL?r.width:r.height),this.disposables);this.onDidChange=x.any(this._onDidViewChange,this._onDidSetLinkedNode.event,this._onDidLinkedWidthNodeChange.event,this._onDidLinkedHeightNodeChange.event)}get width(){return this.orientation===q.HORIZONTAL?this.orthogonalSize:this.size}get height(){return this.orientation===q.HORIZONTAL?this.size:this.orthogonalSize}get top(){return this.orientation===q.HORIZONTAL?this.absoluteOffset:this.absoluteOrthogonalOffset}get left(){return this.orientation===q.HORIZONTAL?this.absoluteOrthogonalOffset:this.absoluteOffset}get element(){return this.view.element}get minimumWidth(){return this.linkedWidthNode?Math.max(this.linkedWidthNode.view.minimumWidth,this.view.minimumWidth):this.view.minimumWidth}get maximumWidth(){return this.linkedWidthNode?Math.min(this.linkedWidthNode.view.maximumWidth,this.view.maximumWidth):this.view.maximumWidth}get minimumHeight(){return this.linkedHeightNode?Math.max(this.linkedHeightNode.view.minimumHeight,this.view.minimumHeight):this.view.minimumHeight}get maximumHeight(){return this.linkedHeightNode?Math.min(this.linkedHeightNode.view.maximumHeight,this.view.maximumHeight):this.view.maximumHeight}get minimumSize(){return this.orientation===q.HORIZONTAL?this.minimumHeight:this.minimumWidth}get maximumSize(){return this.orientation===q.HORIZONTAL?this.maximumHeight:this.maximumWidth}get priority(){return this.view.priority}get proportionalLayout(){return this.view.proportionalLayout??true}get snap(){return this.view.snap}get minimumOrthogonalSize(){return this.orientation===q.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maximumOrthogonalSize(){return this.orientation===q.HORIZONTAL?this.maximumWidth:this.maximumHeight}get boundarySashes(){return this._boundarySashes}set boundarySashes(e){this._boundarySashes=e;this.view.setBoundarySashes?.(KE(e,this.orientation))}layout(e,t,i){if(!this.layoutController.isLayoutEnabled){return}if(typeof i==="undefined"){throw new Error("Invalid state")}this._size=e;this._orthogonalSize=i.orthogonalSize;this.absoluteOffset=i.absoluteOffset+t;this.absoluteOrthogonalOffset=i.absoluteOrthogonalOffset;this._layout(this.width,this.height,this.top,this.left)}_layout(e,t,i,s){if(this.cachedWidth===e&&this.cachedHeight===t&&this.cachedTop===i&&this.cachedLeft===s){return}this.cachedWidth=e;this.cachedHeight=t;this.cachedTop=i;this.cachedLeft=s;this.view.layout(e,t,i,s)}setVisible(e){this.view.setVisible?.(e)}dispose(){this.disposables.dispose()}}function Xf(a,e,t){if(a instanceof we){const i=new we(gi(a.orientation),a.layoutController,a.styles,a.splitviewProportionalLayout,e,t,a.edgeSnapping);let s=0;for(let o=a.children.length-1;o>=0;o--){const n=a.children[o];const r=n instanceof we?n.orthogonalSize:n.size;let d=a.size===0?0:Math.round(e*r/a.size);s+=d;if(o===0){d+=e-s}i.addChild(Xf(n,t,d),d,0,true)}a.dispose();return i}else{const i=new Me(a.view,gi(a.orientation),a.layoutController,t);a.dispose();return i}}class to{get root(){return this._root}set root(e){const t=this._root;if(t){t.element.remove();t.dispose()}this._root=e;this.element.appendChild(e.element);this.onDidSashResetRelay.input=e.onDidSashReset;this._onDidChange.input=x.map(e.onDidChange,()=>void 0);this._onDidScroll.input=e.onDidScroll}get width(){return this.root.width}get height(){return this.root.height}get minimumWidth(){return this.root.minimumWidth}get minimumHeight(){return this.root.minimumHeight}get maximumWidth(){return this.root.maximumHeight}get maximumHeight(){return this.root.maximumHeight}get orientation(){return this._root.orientation}get boundarySashes(){return this._boundarySashes}set orientation(e){if(this._root.orientation===e){return}const{size:t,orthogonalSize:i,absoluteOffset:s,absoluteOrthogonalOffset:o}=this._root;this.root=Xf(this._root,i,t);this.root.layout(t,0,{orthogonalSize:i,absoluteOffset:o,absoluteOrthogonalOffset:s,absoluteSize:t,absoluteOrthogonalSize:i});this.boundarySashes=this.boundarySashes}set boundarySashes(e){this._boundarySashes=e;this.root.boundarySashes=zE(e,this.orientation)}set edgeSnapping(e){this.root.edgeSnapping=e}constructor(e={}){this.onDidSashResetRelay=new Xi;this._onDidScroll=new Xi;this._onDidChange=new Xi;this._boundarySashes={};this.disposable2x2=k.None;this.onDidSashReset=this.onDidSashResetRelay.event;this.onDidScroll=this._onDidScroll.event;this.onDidChange=this._onDidChange.event;this.maximizedNode=void 0;this._onDidChangeViewMaximized=new _;this.onDidChangeViewMaximized=this._onDidChangeViewMaximized.event;this.element=G(".monaco-grid-view");this.styles=e.styles||HE;this.proportionalLayout=typeof e.proportionalLayout!=="undefined"?!!e.proportionalLayout:true;this.layoutController=new UE(false);this.root=new we(q.VERTICAL,this.layoutController,this.styles,this.proportionalLayout)}style(e){this.styles=e;this.root.style(e)}layout(e,t,i=0,s=0){this.layoutController.isLayoutEnabled=true;const[o,n,r,d]=this.root.orientation===q.HORIZONTAL?[t,e,i,s]:[e,t,s,i];this.root.layout(o,0,{orthogonalSize:n,absoluteOffset:r,absoluteOrthogonalOffset:d,absoluteSize:o,absoluteOrthogonalSize:n})}addView(e,t,i){if(this.hasMaximizedView()){this.exitMaximizedView()}this.disposable2x2.dispose();this.disposable2x2=k.None;const[s,o]=Re(i);const[n,r]=this.getNode(s);if(r instanceof we){const d=new Me(e,gi(r.orientation),this.layoutController,r.orthogonalSize);try{r.addChild(d,t,o)}catch(l){d.dispose();throw l}}else{const[,d]=Re(n);const[,l]=Re(s);let u=0;const p=d.getChildCachedVisibleSize(l);if(typeof p==="number"){u=It.Invisible(p)}const f=d.removeChild(l);f.dispose();const g=new we(r.orientation,r.layoutController,this.styles,this.proportionalLayout,r.size,r.orthogonalSize,d.edgeSnapping);d.addChild(g,r.size,l);const m=new Me(r.view,d.orientation,this.layoutController,r.size);g.addChild(m,u,0);if(typeof t!=="number"&&t.type==="split"){t=It.Split(0)}const y=new Me(e,d.orientation,this.layoutController,r.size);g.addChild(y,t,o)}this.trySet2x2()}removeView(e,t){if(this.hasMaximizedView()){this.exitMaximizedView()}this.disposable2x2.dispose();this.disposable2x2=k.None;const[i,s]=Re(e);const[o,n]=this.getNode(i);if(!(n instanceof we)){throw new Error("Invalid location")}const r=n.children[s];if(!(r instanceof Me)){throw new Error("Invalid location")}n.removeChild(s,t);r.dispose();if(n.children.length===0){throw new Error("Invalid grid state")}if(n.children.length>1){this.trySet2x2();return r.view}if(o.length===0){const g=n.children[0];if(g instanceof Me){return r.view}n.removeChild(0);n.dispose();this.root=g;this.boundarySashes=this.boundarySashes;this.trySet2x2();return r.view}const[,d]=Re(o);const[,l]=Re(i);const u=n.isChildVisible(0);const p=n.removeChild(0);const f=d.children.map((g,m)=>d.getChildSize(m));d.removeChild(l,t);n.dispose();if(p instanceof we){f.splice(l,1,...p.children.map(m=>m.size));const g=p.removeAllChildren();for(let m=0;m<g.length;m++){d.addChild(g[m],g[m].size,l+m)}}else{const g=new Me(p.view,gi(p.orientation),this.layoutController,p.size);const m=u?p.orthogonalSize:It.Invisible(p.orthogonalSize);d.addChild(g,m,l)}p.dispose();for(let g=0;g<f.length;g++){d.resizeChild(g,f[g])}this.trySet2x2();return r.view}moveView(e,t,i){if(this.hasMaximizedView()){this.exitMaximizedView()}const[,s]=this.getNode(e);if(!(s instanceof we)){throw new Error("Invalid location")}s.moveChild(t,i);this.trySet2x2()}swapViews(e,t){if(this.hasMaximizedView()){this.exitMaximizedView()}const[i,s]=Re(e);const[,o]=this.getNode(i);if(!(o instanceof we)){throw new Error("Invalid from location")}const n=o.getChildSize(s);const r=o.children[s];if(!(r instanceof Me)){throw new Error("Invalid from location")}const[d,l]=Re(t);const[,u]=this.getNode(d);if(!(u instanceof we)){throw new Error("Invalid to location")}const p=u.getChildSize(l);const f=u.children[l];if(!(f instanceof Me)){throw new Error("Invalid to location")}if(o===u){o.swapChildren(s,l)}else{o.removeChild(s);u.removeChild(l);o.addChild(f,n,s);u.addChild(r,p,l)}this.trySet2x2()}resizeView(e,t){if(this.hasMaximizedView()){this.exitMaximizedView()}const[i,s]=Re(e);const[o,n]=this.getNode(i);if(!(n instanceof we)){throw new Error("Invalid location")}if(!t.width&&!t.height){return}const[r,d]=n.orientation===q.HORIZONTAL?[t.width,t.height]:[t.height,t.width];if(typeof d==="number"&&o.length>0){const[,l]=Re(o);const[,u]=Re(i);l.resizeChild(u,d)}if(typeof r==="number"){n.resizeChild(s,r)}this.trySet2x2()}getViewSize(e){if(!e){return{width:this.root.width,height:this.root.height}}const[,t]=this.getNode(e);return{width:t.width,height:t.height}}getViewCachedVisibleSize(e){const[t,i]=Re(e);const[,s]=this.getNode(t);if(!(s instanceof we)){throw new Error("Invalid location")}return s.getChildCachedVisibleSize(i)}expandView(e){if(this.hasMaximizedView()){this.exitMaximizedView()}const[t,i]=this.getNode(e);if(!(i instanceof Me)){throw new Error("Invalid location")}for(let s=0;s<t.length;s++){t[s].resizeChild(e[s],Number.POSITIVE_INFINITY)}}isViewExpanded(e){if(this.hasMaximizedView()){return false}const[t,i]=this.getNode(e);if(!(i instanceof Me)){throw new Error("Invalid location")}for(let s=0;s<t.length;s++){if(!t[s].isChildExpanded(e[s])){return false}}return true}maximizeView(e){const[,t]=this.getNode(e);if(!(t instanceof Me)){throw new Error("Location is not a LeafNode")}if(this.maximizedNode===t){return}if(this.hasMaximizedView()){this.exitMaximizedView()}function i(s,o){for(let n=0;n<s.children.length;n++){const r=s.children[n];if(r instanceof Me){if(r!==o){s.setChildVisible(n,false)}}else{i(r,o)}}}i(this.root,t);this.maximizedNode=t;this._onDidChangeViewMaximized.fire(true)}exitMaximizedView(){if(!this.maximizedNode){return}this.maximizedNode=void 0;function e(t){for(let i=t.children.length-1;i>=0;i--){const s=t.children[i];if(s instanceof Me){t.setChildVisible(i,true)}else{e(s)}}}e(this.root);this._onDidChangeViewMaximized.fire(false)}hasMaximizedView(){return this.maximizedNode!==void 0}isViewMaximized(e){const[,t]=this.getNode(e);if(!(t instanceof Me)){throw new Error("Location is not a LeafNode")}return t===this.maximizedNode}distributeViewSizes(e){if(this.hasMaximizedView()){this.exitMaximizedView()}if(!e){this.root.distributeViewSizes(true);return}const[,t]=this.getNode(e);if(!(t instanceof we)){throw new Error("Invalid location")}t.distributeViewSizes();this.trySet2x2()}isViewVisible(e){const[t,i]=Re(e);const[,s]=this.getNode(t);if(!(s instanceof we)){throw new Error("Invalid from location")}return s.isChildVisible(i)}setViewVisible(e,t){if(this.hasMaximizedView()){this.exitMaximizedView();return}const[i,s]=Re(e);const[,o]=this.getNode(i);if(!(o instanceof we)){throw new Error("Invalid from location")}o.setChildVisible(s,t)}getView(e){const t=e?this.getNode(e)[1]:this._root;return this._getViews(t,this.orientation)}static deserialize(e,t,i={}){if(typeof e.orientation!=="number"){throw new Error("Invalid JSON: 'orientation' property must be a number.")}else if(typeof e.width!=="number"){throw new Error("Invalid JSON: 'width' property must be a number.")}else if(typeof e.height!=="number"){throw new Error("Invalid JSON: 'height' property must be a number.")}else if(e.root?.type!=="branch"){throw new Error("Invalid JSON: 'root' property must have 'type' value of branch.")}const s=e.orientation;const o=e.height;const n=new to(i);n._deserialize(e.root,s,t,o);return n}_deserialize(e,t,i,s){this.root=this._deserializeNode(e,t,i,s)}_deserializeNode(e,t,i,s){let o;if(e.type==="branch"){const n=e.data;const r=n.map(d=>{return{node:this._deserializeNode(d,gi(t),i,e.size),visible:d.visible}});o=new we(t,this.layoutController,this.styles,this.proportionalLayout,e.size,s,void 0,r)}else{o=new Me(i.fromJSON(e.data),t,this.layoutController,s,e.size);if(e.maximized&&!this.maximizedNode){this.maximizedNode=o;this._onDidChangeViewMaximized.fire(true)}}return o}_getViews(e,t,i){const s={top:e.top,left:e.left,width:e.width,height:e.height};if(e instanceof Me){return{view:e.view,box:s,cachedVisibleSize:i,maximized:this.maximizedNode===e}}const o=[];for(let n=0;n<e.children.length;n++){const r=e.children[n];const d=e.getChildCachedVisibleSize(n);o.push(this._getViews(r,gi(t),d))}return{children:o,box:s}}getNode(e,t=this.root,i=[]){if(e.length===0){return[i,t]}if(!(t instanceof we)){throw new Error("Invalid location")}const[s,...o]=e;if(s<0||s>=t.children.length){throw new Error("Invalid location")}const n=t.children[s];i.push(t);return this.getNode(o,n,i)}trySet2x2(){this.disposable2x2.dispose();this.disposable2x2=k.None;if(this.root.children.length!==2){return}const[e,t]=this.root.children;if(!(e instanceof we)||!(t instanceof we)){return}this.disposable2x2=e.trySet2x2(t)}getViewMap(e,t){if(!t){t=this.root}if(t instanceof we){t.children.forEach(i=>this.getViewMap(e,i))}else{e.set(t.view,t.element)}}dispose(){this.onDidSashResetRelay.dispose();this.root.dispose();this.element.remove()}}Le(Jf);var oe;(function(a){a[a["Up"]=0]="Up";a[a["Down"]=1]="Down";a[a["Left"]=2]="Left";a[a["Right"]=3]="Right"})(oe||(oe={}));function qE(a){switch(a){case oe.Up:return oe.Down;case oe.Down:return oe.Up;case oe.Left:return oe.Right;case oe.Right:return oe.Left}}function ys(a){return!!a.children}function Qf(a,e){if(e.length===0){return a}if(!ys(a)){throw new Error("Invalid location")}const[t,...i]=e;return Qf(a.children[t],i)}function jE(a,e){return!(a.start>=e.end||e.start>=a.end)}function em(a,e){const t=ph(e);const i=e===oe.Up?a.top:e===oe.Right?a.left+a.width:e===oe.Down?a.top+a.height:a.left;const s={start:t===q.HORIZONTAL?a.top:a.left,end:t===q.HORIZONTAL?a.top+a.height:a.left+a.width};return{offset:i,range:s}}function YE(a,e,t){const i=[];function s(o,n,r){if(ys(o)){for(const d of o.children){s(d,n,r)}}else{const{offset:d,range:l}=em(o.box,n);if(d===r.offset&&jE(l,r.range)){i.push(o)}}}s(a,e,t);return i}function Wd(a,e){return e.length%2===0?gi(a):a}function ph(a){return a===oe.Up||a===oe.Down?q.VERTICAL:q.HORIZONTAL}function Xu(a,e,t){const i=Wd(a,e);const s=ph(t);if(i===s){let[o,n]=Re(e);if(t===oe.Right||t===oe.Down){n+=1}return[...o,n]}else{const o=t===oe.Right||t===oe.Down?1:0;return[...e,o]}}function ZE(a){const e=a.parentElement;if(!e){throw new Error("Invalid grid element")}let t=e.firstElementChild;let i=0;while(t!==a&&t!==e.lastElementChild&&t){t=t.nextElementSibling;i++}return i}function tm(a){const e=a.parentElement;if(!e){throw new Error("Invalid grid element")}if(/\bmonaco-grid-view\b/.test(e.className)){return[]}const t=ZE(e);const i=e.parentElement.parentElement.parentElement.parentElement;return[...tm(i),t]}var io;(function(a){a.Distribute={type:"distribute"};a.Split={type:"split"};a.Auto={type:"auto"};function e(t){return{type:"invisible",cachedVisibleSize:t}}a.Invisible=e})(io||(io={}));class JE extends k{get orientation(){return this.gridview.orientation}set orientation(e){this.gridview.orientation=e}get width(){return this.gridview.width}get height(){return this.gridview.height}get minimumWidth(){return this.gridview.minimumWidth}get minimumHeight(){return this.gridview.minimumHeight}get maximumWidth(){return this.gridview.maximumWidth}get maximumHeight(){return this.gridview.maximumHeight}get boundarySashes(){return this.gridview.boundarySashes}set boundarySashes(e){this.gridview.boundarySashes=e}set edgeSnapping(e){this.gridview.edgeSnapping=e}get element(){return this.gridview.element}constructor(e,t={}){super();this.views=new Map;this.didLayout=false;if(e instanceof to){this.gridview=e;this.gridview.getViewMap(this.views)}else{this.gridview=new to(t)}this._register(this.gridview);this._register(this.gridview.onDidSashReset(this.onDidSashReset,this));if(!(e instanceof to)){this._addView(e,0,[0])}this.onDidChange=this.gridview.onDidChange;this.onDidScroll=this.gridview.onDidScroll;this.onDidChangeViewMaximized=this.gridview.onDidChangeViewMaximized}style(e){this.gridview.style(e)}layout(e,t,i=0,s=0){this.gridview.layout(e,t,i,s);this.didLayout=true}addView(e,t,i,s){if(this.views.has(e)){throw new Error("Can't add same view twice")}const o=ph(s);if(this.views.size===1&&this.orientation!==o){this.orientation=o}const n=this.getViewLocation(i);const r=Xu(this.gridview.orientation,n,s);let d;if(typeof t==="number"){d=t}else if(t.type==="split"){const[,l]=Re(n);d=It.Split(l)}else if(t.type==="distribute"){d=It.Distribute}else if(t.type==="auto"){const[,l]=Re(n);d=It.Auto(l)}else{d=t}this._addView(e,d,r)}addViewAt(e,t,i){if(this.views.has(e)){throw new Error("Can't add same view twice")}let s;if(typeof t==="number"){s=t}else if(t.type==="distribute"){s=It.Distribute}else{s=t}this._addView(e,s,i)}_addView(e,t,i){this.views.set(e,e.element);this.gridview.addView(e,t,i)}removeView(e,t){if(this.views.size===1){throw new Error("Can't remove last view")}const i=this.getViewLocation(e);let s;if(t?.type==="distribute"){s=It.Distribute}else if(t?.type==="auto"){const o=i[i.length-1];s=It.Auto(o===0?1:o-1)}this.gridview.removeView(i,s);this.views.delete(e)}moveView(e,t,i,s){const o=this.getViewLocation(e);const[n,r]=Re(o);const d=this.getViewLocation(i);const l=Xu(this.gridview.orientation,d,s);const[u,p]=Re(l);if(_s(n,u)){this.gridview.moveView(n,r,p)}else{this.removeView(e,typeof t==="number"?void 0:t);this.addView(e,t,i,s)}}moveViewTo(e,t){const i=this.getViewLocation(e);const[s,o]=Re(i);const[n,r]=Re(t);if(_s(s,n)){this.gridview.moveView(s,o,r)}else{const d=this.getViewSize(e);const l=Wd(this.gridview.orientation,i);const u=this.getViewCachedVisibleSize(e);const p=typeof u==="undefined"?l===q.HORIZONTAL?d.width:d.height:io.Invisible(u);this.removeView(e);this.addViewAt(e,p,t)}}swapViews(e,t){const i=this.getViewLocation(e);const s=this.getViewLocation(t);return this.gridview.swapViews(i,s)}resizeView(e,t){const i=this.getViewLocation(e);return this.gridview.resizeView(i,t)}isViewExpanded(e){const t=this.getViewLocation(e);return this.gridview.isViewExpanded(t)}isViewMaximized(e){const t=this.getViewLocation(e);return this.gridview.isViewMaximized(t)}hasMaximizedView(){return this.gridview.hasMaximizedView()}getViewSize(e){if(!e){return this.gridview.getViewSize()}const t=this.getViewLocation(e);return this.gridview.getViewSize(t)}getViewCachedVisibleSize(e){const t=this.getViewLocation(e);return this.gridview.getViewCachedVisibleSize(t)}maximizeView(e){if(this.views.size<2){throw new Error("At least two views are required to maximize a view")}const t=this.getViewLocation(e);this.gridview.maximizeView(t)}exitMaximizedView(){this.gridview.exitMaximizedView()}expandView(e){const t=this.getViewLocation(e);this.gridview.expandView(t)}distributeViewSizes(){this.gridview.distributeViewSizes()}isViewVisible(e){const t=this.getViewLocation(e);return this.gridview.isViewVisible(t)}setViewVisible(e,t){const i=this.getViewLocation(e);this.gridview.setViewVisible(i,t)}getViews(){return this.gridview.getView()}getNeighborViews(e,t,i=false){if(!this.didLayout){throw new Error("Can't call getNeighborViews before first layout")}const s=this.getViewLocation(e);const o=this.getViews();const n=Qf(o,s);let r=em(n.box,t);if(i){if(t===oe.Up&&n.box.top===0){r={offset:o.box.top+o.box.height,range:r.range}}else if(t===oe.Right&&n.box.left+n.box.width===o.box.width){r={offset:0,range:r.range}}else if(t===oe.Down&&n.box.top+n.box.height===o.box.height){r={offset:0,range:r.range}}else if(t===oe.Left&&n.box.left===0){r={offset:o.box.left+o.box.width,range:r.range}}}return YE(o,qE(t),r).map(d=>d.view)}getViewLocation(e){const t=this.views.get(e);if(!t){throw new Error("View not found")}return tm(t)}onDidSashReset(e){const t=o=>{const n=this.gridview.getView(o);if(ys(n)){return false}const r=Wd(this.orientation,o);const d=r===q.HORIZONTAL?n.view.preferredWidth:n.view.preferredHeight;if(typeof d!=="number"){return false}const l=r===q.HORIZONTAL?{width:Math.round(d)}:{height:Math.round(d)};this.gridview.resizeView(o,l);return true};if(t(e)){return}const[i,s]=Re(e);if(t([...i,s+1])){return}this.gridview.distributeViewSizes(i)}}class Ji extends JE{constructor(){super(...arguments);this.initialLayoutContext=true}static serializeNode(e,t){const i=t===q.VERTICAL?e.box.width:e.box.height;if(!ys(e)){const o={type:"leaf",data:e.view.toJSON(),size:i};if(typeof e.cachedVisibleSize==="number"){o.size=e.cachedVisibleSize;o.visible=false}else if(e.maximized){o.maximized=true}return o}const s=e.children.map(o=>Ji.serializeNode(o,gi(t)));if(s.some(o=>o.visible!==false)){return{type:"branch",data:s,size:i}}return{type:"branch",data:s,size:i,visible:false}}static deserialize(e,t,i={}){if(typeof e.orientation!=="number"){throw new Error("Invalid JSON: 'orientation' property must be a number.")}else if(typeof e.width!=="number"){throw new Error("Invalid JSON: 'width' property must be a number.")}else if(typeof e.height!=="number"){throw new Error("Invalid JSON: 'height' property must be a number.")}const s=to.deserialize(e,t,i);const o=new Ji(s,i);return o}static from(e,t={}){return Ji.deserialize(rm(e),{fromJSON:i=>i},t)}serialize(){return{root:Ji.serializeNode(this.getViews(),this.orientation),orientation:this.orientation,width:this.width,height:this.height}}layout(e,t,i=0,s=0){super.layout(e,t,i,s);if(this.initialLayoutContext){this.initialLayoutContext=false;this.gridview.trySet2x2()}}}function im(a){return!!a.groups}function sm(a,e){if(!e&&a.groups&&a.groups.length<=1){a.groups=void 0}if(!im(a)){return}let t=0;let i=0;for(const r of a.groups){sm(r,false);if(r.size){t+=r.size;i++}}const s=i>0?t:1;const o=a.groups.length-i;const n=s/o;for(const r of a.groups){if(!r.size){r.size=n}}}function om(a){if(im(a)){return{type:"branch",data:a.groups.map(e=>om(e)),size:a.size}}else{return{type:"leaf",data:a.data,size:a.size}}}function nm(a,e){if(a.type==="branch"){const t=a.data.map(i=>nm(i,gi(e)));if(e===q.VERTICAL){const i=a.size||(t.length===0?void 0:Math.max(...t.map(o=>o.width||0)));const s=t.length===0?void 0:t.reduce((o,n)=>o+(n.height||0),0);return{width:i,height:s}}else{const i=t.length===0?void 0:t.reduce((o,n)=>o+(n.width||0),0);const s=a.size||(t.length===0?void 0:Math.max(...t.map(o=>o.height||0)));return{width:i,height:s}}}else{const t=e===q.VERTICAL?a.size:void 0;const i=e===q.VERTICAL?void 0:a.size;return{width:t,height:i}}}function rm(a){sm(a,true);const e=om(a);const{width:t,height:i}=nm(e,a.orientation);return{root:e,orientation:a.orientation,width:t||1,height:i||1}}const XE=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let Hd=class LA extends qm{constructor(e,t,i,s,o,n,r,d){super(e,t,o,i);this.storageService=i;this.instantiationService=s;this.contextMenuService=n;this.extensionService=r;this.contextService=d}create(e){super.create(e);this.viewPaneContainer=this._register(this.createViewPaneContainer(e));this._register(this.viewPaneContainer.onTitleAreaUpdate(()=>this.updateTitleArea()));this.viewPaneContainer.create(e)}setVisible(e){super.setVisible(e);this.viewPaneContainer?.setVisible(e)}layout(e){this.viewPaneContainer?.layout(e)}setBoundarySashes(e){this.viewPaneContainer?.setBoundarySashes(e)}getOptimalWidth(){return this.viewPaneContainer?.getOptimalWidth()??0}openView(e,t){return this.viewPaneContainer?.openView(e,t)}getViewPaneContainer(){return this.viewPaneContainer}getActionsContext(){return this.getViewPaneContainer()?.getActionsContext()}getContextMenuActions(){return this.viewPaneContainer?.menuActions?.getContextMenuActions()??[]}getMenuIds(){const e=[];if(this.viewPaneContainer?.menuActions){e.push(this.viewPaneContainer.menuActions.menuId);if(this.viewPaneContainer.isViewMergedWithContainer()){e.push(this.viewPaneContainer.panes[0].menuActions.menuId)}}return e}getActions(){const e=[];if(this.viewPaneContainer?.menuActions){e.push(...this.viewPaneContainer.menuActions.getPrimaryActions());if(this.viewPaneContainer.isViewMergedWithContainer()){const t=this.viewPaneContainer.panes[0];if(t.shouldShowFilterInHeader()){e.push(jm)}e.push(...t.menuActions.getPrimaryActions())}}return e}getSecondaryActions(){if(!this.viewPaneContainer?.menuActions){return[]}const e=this.viewPaneContainer.isViewMergedWithContainer()?this.viewPaneContainer.panes[0].menuActions.getSecondaryActions():[];let t=this.viewPaneContainer.menuActions.getSecondaryActions();const i=t.findIndex(s=>s instanceof Ym&&s.item.submenu===Tl);if(i!==-1){const s=t[i];if(s.actions.some(({enabled:o})=>o)){if(t.length===1&&e.length===0){t=s.actions.slice()}else if(i!==0){t=[s,...t.slice(0,i),...t.slice(i+1)]}}else{t.splice(i,1)}}if(t.length&&e.length){return[...t,new Mi,...e]}return t.length?t:e}getActionViewItem(e,t){return this.viewPaneContainer?.getActionViewItem(e,t)}getTitle(){return this.viewPaneContainer?.getTitle()??""}focus(){super.focus();this.viewPaneContainer?.focus()}};Hd=E([h(1,si),h(2,le),h(3,N),h(4,pe),h(5,ot),h(6,Kt),h(7,yn)],Hd);class gh extends $m{static create(e,t,i,s,o,n,r){return new gh(e,t,i,s,o,n,r)}constructor(e,t,i,s,o,n,r){super(e,t,i,s,o,n);this.iconUrl=r}}const wi={Viewlets:"workbench.contributions.viewlets",Panels:"workbench.contributions.panels",Auxiliary:"workbench.contributions.auxiliary"};class fh extends Zm{registerPaneComposite(e){super.registerComposite(e)}deregisterPaneComposite(e){super.deregisterComposite(e)}getPaneComposite(e){return this.getComposite(e)}getPaneComposites(){return this.getComposites()}}W.add(wi.Viewlets,new fh);W.add(wi.Panels,new fh);W.add(wi.Auxiliary,new fh);const QE=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Le(QE);class eI extends Dp{constructor(e,t,i,s,o,n,r,d,l,u,p,f,g,m,y,C,D){super(C,D,d,t,s);this.notificationService=e;this.storageService=t;this.contextMenuService=i;this.keybindingService=o;this.hoverService=n;this.instantiationService=r;this.registry=l;this.activeCompositeSettingsKey=u;this.defaultCompositeId=p;this.nameForTelemetry=f;this.compositeCSSClass=g;this.titleForegroundColor=m;this.titleBorderColor=y;this.onDidCompositeOpen=this._register(new _);this.onDidCompositeClose=this._register(new _);this.mapCompositeToCompositeContainer=new Map;this.mapActionsBindingToComposite=new Map;this.instantiatedCompositeItems=new Map;this.actionsListener=this._register(new Ie);this.lastActiveCompositeId=t.get(u,M.WORKSPACE,this.defaultCompositeId);this.toolbarHoverDelegate=this._register(Jm())}openComposite(e,t){if(this.activeComposite?.getId()===e){if(t){this.activeComposite.focus()}return this.activeComposite}if(!this.element){return}return this.doOpenComposite(e,t)}doOpenComposite(e,t=false){const i=Xm.nextId();this.currentCompositeOpenToken=i;if(this.activeComposite){this.hideActiveComposite()}this.updateTitle(e);const s=this.createComposite(e,true);if(this.currentCompositeOpenToken!==i||this.activeComposite&&this.activeComposite.getId()!==s.getId()){return void 0}if(this.activeComposite?.getId()===s.getId()){if(t){s.focus()}this.onDidCompositeOpen.fire({composite:s,focus:t});return s}this.showComposite(s);if(t){s.focus()}if(s){this.onDidCompositeOpen.fire({composite:s,focus:t})}return s}createComposite(e,t){const i=this.instantiatedCompositeItems.get(e);if(i){return i.composite}const s=this.registry.getComposite(e);if(s){const o=this;const n=new Qm(Se(this.progressBar),new class extends ew{constructor(){super(s.id,!!t);this._register(o.onDidCompositeOpen.event(u=>this.onScopeOpened(u.composite.getId())));this._register(o.onDidCompositeClose.event(u=>this.onScopeClosed(u.getId())))}});const r=this._register(this.instantiationService.createChild(new aa([tw,n])));const d=s.instantiate(r);const l=new L;this.instantiatedCompositeItems.set(e,{composite:d,disposable:l,progress:n});l.add(d.onTitleAreaUpdate(()=>this.onTitleAreaUpdate(d.getId()),this));l.add(r);return d}throw new Error(`Unable to find composite with id ${e}`)}showComposite(e){this.activeComposite=e;const t=this.activeComposite.getId();if(t!==this.defaultCompositeId){this.storageService.store(this.activeCompositeSettingsKey,t,M.WORKSPACE,Ee.MACHINE)}else{this.storageService.remove(this.activeCompositeSettingsKey,M.WORKSPACE)}this.lastActiveCompositeId=this.activeComposite.getId();let i=this.mapCompositeToCompositeContainer.get(e.getId());if(!i){i=G(".composite");i.classList.add(...this.compositeCSSClass.split(" "));i.id=e.getId();e.create(i);e.updateStyles();this.mapCompositeToCompositeContainer.set(e.getId(),i)}if(!this.activeComposite||e.getId()!==this.activeComposite.getId()){return void 0}const s=this.getContentArea();s?.appendChild(i);sn(i);const o=Se(this.toolBar);o.actionRunner=e.getActionRunner();const n=this.registry.getComposite(e.getId());if(n&&n.name!==e.getTitle()){this.updateTitle(e.getId(),e.getTitle())}let r=this.mapActionsBindingToComposite.get(e.getId());if(!r){r=this.collectCompositeActions(e);this.mapActionsBindingToComposite.set(e.getId(),r)}r();this.actionsListener.value=o.actionRunner.onDidRun(d=>{if(d.error&&!da(d.error)){this.notificationService.error(d.error)}});e.setVisible(true);if(!this.activeComposite||e.getId()!==this.activeComposite.getId()){return}if(this.contentAreaSize){e.layout(this.contentAreaSize)}if(this.boundarySashes){e.setBoundarySashes(this.boundarySashes)}}onTitleAreaUpdate(e){const t=this.instantiatedCompositeItems.get(e);if(t){this.updateTitle(e,t.composite.getTitle())}if(this.activeComposite?.getId()===e){const i=this.collectCompositeActions(this.activeComposite);this.mapActionsBindingToComposite.set(this.activeComposite.getId(),i);i()}else{this.mapActionsBindingToComposite.delete(e)}}updateTitle(e,t){const i=this.registry.getComposite(e);if(!i||!this.titleLabel){return}if(!t){t=i.name}const s=this.keybindingService.lookupKeybinding(e);this.titleLabel.updateTitle(e,t,s?.getLabel()??void 0);const o=Se(this.toolBar);o.setAriaLabel(c(2875,"{0} actions",t))}collectCompositeActions(e){const t=e?.getMenuIds();const i=e?.getActions().slice(0)||[];const s=e?.getSecondaryActions().slice(0)||[];const o=Se(this.toolBar);o.context=this.actionsContextProvider();return()=>o.setActions(so(i),so(s),t)}getActiveComposite(){return this.activeComposite}getLastActiveCompositeId(){return this.lastActiveCompositeId}hideActiveComposite(){if(!this.activeComposite){return void 0}const e=this.activeComposite;this.activeComposite=void 0;const t=this.mapCompositeToCompositeContainer.get(e.getId());e.setVisible(false);if(t){t.remove();on(t)}this.progressBar?.stop().hide();if(this.toolBar){this.collectCompositeActions()()}this.onDidCompositeClose.fire(e);return e}createTitleArea(e){const t=Be(e,G(".composite"));t.classList.add("title");this.titleLabel=this.createTitleLabel(t);const i=Be(t,G(".title-actions"));this.toolBar=this._register(this.instantiationService.createInstance(Al,i,{actionViewItemProvider:(s,o)=>this.actionViewItemProvider(s,o),orientation:oo.HORIZONTAL,getKeyBinding:s=>this.keybindingService.lookupKeybinding(s.id),anchorAlignmentProvider:()=>this.getTitleAreaDropDownAnchorAlignment(),toggleMenuTitle:c(2876,"Views and More Actions..."),telemetrySource:this.nameForTelemetry,hoverDelegate:this.toolbarHoverDelegate}));this.collectCompositeActions()();return t}createTitleLabel(e){const t=Be(e,G(".title-label"));const i=Be(t,G("h2"));this.titleLabelElement=i;const s=this._register(this.hoverService.setupManagedHover(Tp("mouse"),i,""));const o=this;return{updateTitle:(n,r,d)=>{if(!this.activeComposite||this.activeComposite.getId()===n){i.innerText=r;s.update(d?c(2877,"{0} ({1})",r,d):r)}},updateStyles:()=>{i.style.color=o.titleForegroundColor?o.getColor(o.titleForegroundColor)||"":"";const n=o.titleBorderColor?o.getColor(o.titleBorderColor):void 0;e.style.borderBottom=n?`1px solid ${n}`:""}}}createHeaderArea(){return G(".composite")}createFooterArea(){return G(".composite")}updateStyles(){super.updateStyles();const e=Se(this.titleLabel);e.updateStyles()}actionViewItemProvider(e,t){if(this.activeComposite){return this.activeComposite.getActionViewItem(e,t)}return xl(this.instantiationService,e,t)}actionsContextProvider(){if(this.activeComposite){return this.activeComposite.getActionsContext()}return null}createContentArea(e){const t=Be(e,G(".content"));this.progressBar=this._register(new iw(t,sw));this.progressBar.hide();return t}getProgressIndicator(e){const t=this.instantiatedCompositeItems.get(e);return t?t.progress:void 0}getTitleAreaDropDownAnchorAlignment(){return bd.RIGHT}layout(e,t,i,s){super.layout(e,t,i,s);this.contentAreaSize=Ft.lift(super.layoutContents(e,t).contentSize);this.activeComposite?.layout(this.contentAreaSize)}setBoundarySashes(e){this.boundarySashes=e;this.activeComposite?.setBoundarySashes(e)}removeComposite(e){if(this.activeComposite?.getId()===e){return false}this.mapCompositeToCompositeContainer.delete(e);this.mapActionsBindingToComposite.delete(e);const t=this.instantiatedCompositeItems.get(e);if(t){t.composite.dispose();$e(t.disposable);this.instantiatedCompositeItems.delete(e)}return true}dispose(){this.mapCompositeToCompositeContainer.clear();this.mapActionsBindingToComposite.clear();this.instantiatedCompositeItems.forEach(e=>{e.composite.dispose();$e(e.disposable)});this.instantiatedCompositeItems.clear();super.dispose()}}var Ud;Le(XE);var ce;(function(a){a[a["TOP"]=0]="TOP";a[a["TITLE"]=1]="TITLE";a[a["BOTTOM"]=2]="BOTTOM"})(ce||(ce={}));let cn=class MA extends eI{static{Ud=this}static{this.MIN_COMPOSITE_BAR_WIDTH=50}get snap(){return this.layoutService.isVisible(this.partId)||!!this.paneCompositeBar.value?.getVisiblePaneCompositeIds().length}get onDidPaneCompositeOpen(){return x.map(this.onDidCompositeOpen.event,e=>e.composite)}constructor(e,t,i,s,o,n,r,d,l,u,p,f,g,m,y,C,D,F,P,R,z){let H=$.Sidebar;let Z=wi.Viewlets;let ie=w.SidebarTitle;if(e===V.PANEL_PART){H=$.Panel;Z=wi.Panels;ie=w.PanelTitle}else if(e===V.AUXILIARYBAR_PART){H=$.AuxiliaryBar;Z=wi.Auxiliary;ie=w.AuxiliaryBarTitle}super(u,p,f,g,m,y,C,D,W.as(Z),i,F.getDefaultViewContainer(H)?.id||"",n,r,d,l,e,t);this.partId=e;this.activePaneContextKey=s;this.paneFocusContextKey=o;this.viewDescriptorService=F;this.contextKeyService=P;this.extensionService=R;this.menuService=z;this.onDidPaneCompositeClose=this.onDidCompositeClose.event;this.headerFooterCompositeBarDispoables=this._register(new L);this.paneCompositeBar=this._register(new Ie);this.compositeBarPosition=void 0;this.blockOpening=void 0;this.location=H;this.globalActions=this._register(this.instantiationService.createInstance(Ap,ie,void 0,void 0));this.registerListeners()}registerListeners(){this._register(this.onDidPaneCompositeOpen(e=>this.onDidOpen(e)));this._register(this.onDidPaneCompositeClose(this.onDidClose,this));this._register(this.globalActions.onDidChange(()=>this.updateGlobalToolbarActions()));this._register(this.registry.onDidDeregister(e=>{const t=this.viewDescriptorService.getViewContainersByLocation(this.location).filter(i=>this.viewDescriptorService.getViewContainerModel(i).activeViewDescriptors.length>0);if(t.length){if(this.getActiveComposite()?.getId()===e.id){const i=this.viewDescriptorService.getDefaultViewContainer(this.location)?.id;const s=t.filter(o=>o.id===i)[0]||t[0];this.doOpenPaneComposite(s.id)}}else{this.layoutService.setPartHidden(true,this.partId)}this.removeComposite(e.id)}));this._register(this.extensionService.onDidRegisterExtensions(()=>{this.layoutCompositeBar()}))}onDidOpen(e){this.activePaneContextKey.set(e.getId())}onDidClose(e){const t=e.getId();if(this.activePaneContextKey.get()===t){this.activePaneContextKey.reset()}}showComposite(e){super.showComposite(e);this.layoutCompositeBar();this.layoutEmptyMessage()}hideActiveComposite(){const e=super.hideActiveComposite();this.layoutCompositeBar();this.layoutEmptyMessage();return e}create(e){this.element=e;this.element.classList.add("pane-composite-part");super.create(e);const t=this.getContentArea();if(t){this.createEmptyPaneMessage(t)}this.updateCompositeBar();const i=this._register(lr(e));this._register(i.onDidFocus(()=>this.paneFocusContextKey.set(true)));this._register(i.onDidBlur(()=>this.paneFocusContextKey.set(false)))}createEmptyPaneMessage(e){this.emptyPaneMessageElement=G(".empty-pane-message-area");const t=G(".empty-pane-message");t.innerText=c(3409,"Drag a view here to display.");this.emptyPaneMessageElement.appendChild(t);e.appendChild(this.emptyPaneMessageElement);const i=s=>{const o=!this.getActiveComposite()||!s;const n=s?this.theme.getColor(Vp)?.toString()||"":"";if(this.titleContainer&&o){this.titleContainer.style.backgroundColor=n}if(this.headerFooterCompositeBarContainer&&o){this.headerFooterCompositeBarContainer.style.backgroundColor=n}this.emptyPaneMessageElement.style.backgroundColor=n};this._register(hr.INSTANCE.registerTarget(this.element,{onDragOver:s=>{Ve.stop(s.eventData,true);if(this.paneCompositeBar.value){const o=this.paneCompositeBar.value.dndHandler.onDragEnter(s.dragAndDropData,void 0,s.eventData);ow(s.eventData.dataTransfer,"move",o)}},onDragEnter:s=>{Ve.stop(s.eventData,true);if(this.paneCompositeBar.value){const o=this.paneCompositeBar.value.dndHandler.onDragEnter(s.dragAndDropData,void 0,s.eventData);i(o)}},onDragLeave:s=>{Ve.stop(s.eventData,true);i(false)},onDragEnd:s=>{Ve.stop(s.eventData,true);i(false)},onDrop:s=>{Ve.stop(s.eventData,true);i(false);if(this.paneCompositeBar.value){this.paneCompositeBar.value.dndHandler.drop(s.dragAndDropData,void 0,s.eventData)}else{const o=s.dragAndDropData.getData();if(o.type==="composite"){const n=this.viewDescriptorService.getViewContainerById(o.id);this.viewDescriptorService.moveViewContainerToLocation(n,this.location,void 0,"dnd");this.openPaneComposite(n.id,true)}else if(o.type==="view"){const n=this.viewDescriptorService.getViewDescriptorById(o.id);if(n&&n.canMoveView){this.viewDescriptorService.moveViewToLocation(n,this.location,"dnd");const r=this.viewDescriptorService.getViewContainerByViewId(n.id);this.openPaneComposite(r.id,true).then(d=>{d?.openView(n.id,true)})}}}}}))}createTitleArea(e){const t=super.createTitleArea(e);this._register(J(t,se.CONTEXT_MENU,s=>{this.onTitleAreaContextMenu(new Un(wt(t),s))}));this._register(Ph.addTarget(t));this._register(J(t,Lh.Contextmenu,s=>{this.onTitleAreaContextMenu(new Un(wt(t),s))}));const i=t.appendChild(G(".global-actions"));this.globalToolBar=this._register(this.instantiationService.createInstance(Al,i,{actionViewItemProvider:(s,o)=>this.actionViewItemProvider(s,o),orientation:oo.HORIZONTAL,getKeyBinding:s=>this.keybindingService.lookupKeybinding(s.id),anchorAlignmentProvider:()=>this.getTitleAreaDropDownAnchorAlignment(),toggleMenuTitle:c(3410,"More Actions..."),hoverDelegate:this.toolbarHoverDelegate,hiddenItemStrategy:xp.NoHide}));this.updateGlobalToolbarActions();return t}createTitleLabel(e){this.titleContainer=e;const t=super.createTitleLabel(e);this.titleLabelElement.draggable=true;const i=()=>{const s=this.getActivePaneComposite();return{type:"composite",id:s.getId()}};this._register(hr.INSTANCE.registerDraggable(this.titleLabelElement,i,{}));return t}updateCompositeBar(e=false){const t=this.compositeBarPosition!==void 0;const i=this.shouldShowCompositeBar();const s=this.compositeBarPosition;const o=i?this.getCompositeBarPosition():void 0;if(!e&&s===o){return}if(t){const r=s===ce.TITLE?this.titleContainer:this.headerFooterCompositeBarContainer;if(!this.paneCompositeBarContainer||!this.paneCompositeBar.value||!r){throw new Error("Composite bar containers should exist when removing the previous composite bar")}this.paneCompositeBarContainer.remove();this.paneCompositeBarContainer=void 0;this.paneCompositeBar.value=void 0;r.classList.remove("has-composite-bar");if(s===ce.TOP){this.removeFooterHeaderArea(true)}else if(s===ce.BOTTOM){this.removeFooterHeaderArea(false)}}let n;switch(o){case ce.TOP:n=this.createHeaderArea();break;case ce.TITLE:n=this.titleContainer;break;case ce.BOTTOM:n=this.createFooterArea();break}if(i){if(this.paneCompositeBarContainer||this.paneCompositeBar.value||!n){throw new Error("Invalid composite bar state when creating the new composite bar")}n.classList.add("has-composite-bar");this.paneCompositeBarContainer=Rp(n,G(".composite-bar-container"));this.paneCompositeBar.value=this.createCompositeBar();this.paneCompositeBar.value.create(this.paneCompositeBarContainer);if(o===ce.TOP){this.setHeaderArea(n)}else if(o===ce.BOTTOM){this.setFooterArea(n)}}this.compositeBarPosition=o;if(e){this.layoutCompositeBar()}}createHeaderArea(){const e=super.createHeaderArea();return this.createHeaderFooterCompositeBarArea(e)}createFooterArea(){const e=super.createFooterArea();return this.createHeaderFooterCompositeBarArea(e)}createHeaderFooterCompositeBarArea(e){if(this.headerFooterCompositeBarContainer){throw new Error("Header or Footer composite bar already exists")}this.headerFooterCompositeBarContainer=e;this.headerFooterCompositeBarDispoables.add(J(e,se.CONTEXT_MENU,t=>{this.onCompositeBarAreaContextMenu(new Un(wt(e),t))}));this.headerFooterCompositeBarDispoables.add(Ph.addTarget(e));this.headerFooterCompositeBarDispoables.add(J(e,Lh.Contextmenu,t=>{this.onCompositeBarAreaContextMenu(new Un(wt(e),t))}));return e}removeFooterHeaderArea(e){this.headerFooterCompositeBarContainer=void 0;this.headerFooterCompositeBarDispoables.clear();if(e){this.removeHeaderArea()}else{this.removeFooterArea()}}createCompositeBar(){return this.instantiationService.createInstance(nw,this.getCompositeBarOptions(),this.partId,this)}onTitleAreaUpdate(e){super.onTitleAreaUpdate(e);this.layoutCompositeBar()}async openPaneComposite(e,t){if(typeof e==="string"&&this.getPaneComposite(e)){return this.doOpenPaneComposite(e,t)}await this.extensionService.whenInstalledExtensionsRegistered();if(typeof e==="string"&&this.getPaneComposite(e)){return this.doOpenPaneComposite(e,t)}return void 0}async doOpenPaneComposite(e,t){if(this.blockOpening){return this.blockOpening.p}let i;if(!this.layoutService.isVisible(this.partId)){try{i=this.blockOpening=new no;this.layoutService.setPartHidden(false,this.partId)}finally{this.blockOpening=void 0}}try{const s=this.openComposite(e,t);i?.complete(s);return s}catch(s){i?.error(s);throw s}}getPaneComposite(e){return this.registry.getPaneComposite(e)}getPaneComposites(){return this.registry.getPaneComposites().sort((e,t)=>{if(typeof e.order!=="number"){return 1}if(typeof t.order!=="number"){return-1}return e.order-t.order})}getPinnedPaneCompositeIds(){return this.paneCompositeBar.value?.getPinnedPaneCompositeIds()??[]}getVisiblePaneCompositeIds(){return this.paneCompositeBar.value?.getVisiblePaneCompositeIds()??[]}getPaneCompositeIds(){return this.paneCompositeBar.value?.getPaneCompositeIds()??[]}getActivePaneComposite(){return this.getActiveComposite()}getLastActivePaneCompositeId(){return this.getLastActiveCompositeId()}hideActivePaneComposite(){if(this.layoutService.isVisible(this.partId)){this.layoutService.setPartHidden(true,this.partId)}this.hideActiveComposite()}focusCompositeBar(){this.paneCompositeBar.value?.focus()}layout(e,t,i,s){if(!this.layoutService.isVisible(this.partId)){return}this.contentDimension=new Ft(e,t);super.layout(this.contentDimension.width,this.contentDimension.height,i,s);this.layoutCompositeBar();this.layoutEmptyMessage()}layoutCompositeBar(){if(this.contentDimension&&this.dimension&&this.paneCompositeBar.value){const e=this.compositeBarPosition===ce.TITLE?16:8;const t=this.partId===V.PANEL_PART?0:1;let i=this.contentDimension.width-e-t;i=Math.max(Ud.MIN_COMPOSITE_BAR_WIDTH,i-this.getToolbarWidth());this.paneCompositeBar.value.layout(i,this.dimension.height)}}layoutEmptyMessage(){const e=!this.getActiveComposite();this.element.classList.toggle("empty",e);if(e){this.titleLabel?.updateTitle("","")}}updateGlobalToolbarActions(){const e=this.globalActions.getPrimaryActions();const t=this.globalActions.getSecondaryActions();this.globalToolBar?.setActions(so(e),so(t))}getToolbarWidth(){if(!this.toolBar||this.compositeBarPosition!==ce.TITLE){return 0}const e=this.getActivePaneComposite();if(!e){return 0}const t=this.toolBar.getItemsWidth()+this.toolBar.getItemsLength()*4;const i=this.globalToolBar?this.globalToolBar.getItemsWidth()+this.globalToolBar.getItemsLength()*4:0;return t+i+5}onTitleAreaContextMenu(e){if(this.shouldShowCompositeBar()&&this.getCompositeBarPosition()===ce.TITLE){return this.onCompositeBarContextMenu(e)}else{const t=this.getActivePaneComposite();const i=t?t.getContextMenuActions():[];if(i.length){this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>i,getActionViewItem:(s,o)=>this.actionViewItemProvider(s,o),actionRunner:t.getActionRunner(),skipTelemetry:true})}}}onCompositeBarAreaContextMenu(e){return this.onCompositeBarContextMenu(e)}onCompositeBarContextMenu(e){if(this.paneCompositeBar.value){const t=[...this.paneCompositeBar.value.getContextMenuActions()];if(t.length){this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>t,skipTelemetry:true})}}}getViewsSubmenuAction(){const e=this.getActivePaneComposite()?.getViewPaneContainer();if(e){const t=new L;const i=t.add(this.contextKeyService.createScoped(this.element));i.createKey("viewContainer",e.viewContainer.id);const s=this.menuService.getMenuActions(Tl,i,{shouldForwardArgs:true,renderShortTitle:true});const o=rw(s,()=>true).primary;t.dispose();return o.length>1&&o.some(n=>n.enabled)?new ur("views",c(3411,"Views"),o):void 0}return void 0}};cn=Ud=E([h(9,Qe),h(10,le),h(11,ot),h(12,Te),h(13,zt),h(14,bt),h(15,N),h(16,pe),h(17,We),h(18,ee),h(19,Kt),h(20,Ki)],cn);var Kd;Le(Zf);let zd=class OA extends cn{static{Kd=this}static{this.activeViewletSettingsKey="workbench.sidebar.activeviewletid"}get snap(){return true}get preferredWidth(){const e=this.getActivePaneComposite();if(!e){return}const t=e.getOptimalWidth();if(typeof t!=="number"){return}return Math.max(t,300)}constructor(e,t,i,s,o,n,r,d,l,u,p,f,g){super(V.SIDEBAR_PART,{hasTitle:true,borderWidth:()=>this.getColor(pr)||this.getColor(Es)?1:0},Kd.activeViewletSettingsKey,aw.bindTo(u),dw.bindTo(u),"sideBar","viewlet",cw,kp,e,t,i,s,o,n,r,d,l,u,p,g);this.configurationService=f;this.minimumWidth=170;this.maximumWidth=Number.POSITIVE_INFINITY;this.minimumHeight=0;this.maximumHeight=Number.POSITIVE_INFINITY;this.priority=li.Low;this.activityBarPart=this._register(this.instantiationService.createInstance(Kn,this));this.rememberActivityBarVisiblePosition();this._register(f.onDidChangeConfiguration(m=>{if(m.affectsConfiguration(Et.ACTIVITY_BAR_LOCATION)){this.onDidChangeActivityBarLocation()}}));this.registerActions()}onDidChangeActivityBarLocation(){this.activityBarPart.hide();this.updateCompositeBar();const e=this.getActiveComposite()?.getId();if(e){this.onTitleAreaUpdate(e)}if(this.shouldShowActivityBar()){this.activityBarPart.show()}this.rememberActivityBarVisiblePosition()}updateStyles(){super.updateStyles();const e=Se(this.getContainer());e.style.backgroundColor=this.getColor(Zs)||"";e.style.color=this.getColor(Pp)||"";const t=this.getColor(pr)||this.getColor(Es);const i=this.layoutService.getSideBarPosition()===gt.LEFT;e.style.borderRightWidth=t&&i?"1px":"";e.style.borderRightStyle=t&&i?"solid":"";e.style.borderRightColor=i?t||"":"";e.style.borderLeftWidth=t&&!i?"1px":"";e.style.borderLeftStyle=t&&!i?"solid":"";e.style.borderLeftColor=!i?t||"":"";e.style.outlineColor=this.getColor(lw)??""}layout(e,t,i,s){if(!this.layoutService.isVisible(V.SIDEBAR_PART)){return}super.layout(e,t,i,s)}getTitleAreaDropDownAnchorAlignment(){return this.layoutService.getSideBarPosition()===gt.LEFT?bd.LEFT:bd.RIGHT}createCompositeBar(){return this.instantiationService.createInstance(hw,this.getCompositeBarOptions(),this.partId,this,false)}getCompositeBarOptions(){return{partContainerClass:"sidebar",pinnedViewContainersKey:Kn.pinnedViewContainersKey,placeholderViewContainersKey:Kn.placeholderViewContainersKey,viewContainersWorkspaceStateKey:Kn.viewContainersWorkspaceStateKey,icon:true,orientation:oo.HORIZONTAL,recomputeSizes:true,activityHoverOptions:{position:()=>this.getCompositeBarPosition()===ce.BOTTOM?ro.ABOVE:ro.BELOW},fillExtraContextMenuActions:e=>{if(this.getCompositeBarPosition()===ce.TITLE){const t=this.getViewsSubmenuAction();if(t){e.push(new Mi);e.push(t)}}},compositeSize:0,iconSize:16,overflowActionSize:30,colors:e=>({activeBackgroundColor:e.getColor(Zs),inactiveBackgroundColor:e.getColor(Zs),activeBorderBottomColor:e.getColor(Fp),activeForegroundColor:e.getColor(Bp),inactiveForegroundColor:e.getColor(Np),badgeBackground:e.getColor(Op),badgeForeground:e.getColor(Mp),dragAndDropBorder:e.getColor(Lp)}),compact:true}}shouldShowCompositeBar(){const e=this.configurationService.getValue(Et.ACTIVITY_BAR_LOCATION);return e===xe.TOP||e===xe.BOTTOM}shouldShowActivityBar(){if(this.shouldShowCompositeBar()){return false}return this.configurationService.getValue(Et.ACTIVITY_BAR_LOCATION)!==xe.HIDDEN}getCompositeBarPosition(){const e=this.configurationService.getValue(Et.ACTIVITY_BAR_LOCATION);switch(e){case xe.TOP:return ce.TOP;case xe.BOTTOM:return ce.BOTTOM;case xe.HIDDEN:case xe.DEFAULT:default:return ce.TITLE}}rememberActivityBarVisiblePosition(){const e=this.configurationService.getValue(Et.ACTIVITY_BAR_LOCATION);if(e!==xe.HIDDEN){this.storageService.store(Et.ACTIVITY_BAR_LOCATION,e,M.PROFILE,Ee.USER)}}getRememberedActivityBarVisiblePosition(){const e=this.storageService.get(Et.ACTIVITY_BAR_LOCATION,M.PROFILE);switch(e){case xe.TOP:return xe.TOP;case xe.BOTTOM:return xe.BOTTOM;default:return xe.DEFAULT}}getPinnedPaneCompositeIds(){return this.shouldShowCompositeBar()?super.getPinnedPaneCompositeIds():this.activityBarPart.getPinnedPaneCompositeIds()}getVisiblePaneCompositeIds(){return this.shouldShowCompositeBar()?super.getVisiblePaneCompositeIds():this.activityBarPart.getVisiblePaneCompositeIds()}getPaneCompositeIds(){return this.shouldShowCompositeBar()?super.getPaneCompositeIds():this.activityBarPart.getPaneCompositeIds()}async focusActivityBar(){if(this.configurationService.getValue(Et.ACTIVITY_BAR_LOCATION)===xe.HIDDEN){await this.configurationService.updateValue(Et.ACTIVITY_BAR_LOCATION,this.getRememberedActivityBarVisiblePosition());this.onDidChangeActivityBarLocation()}if(this.shouldShowCompositeBar()){this.focusCompositeBar()}else{if(!this.layoutService.isVisible(V.ACTIVITYBAR_PART)){this.layoutService.setPartHidden(false,V.ACTIVITYBAR_PART)}this.activityBarPart.show(true)}}registerActions(){const e=this;this._register(v(class extends j{constructor(){super({id:uw,title:I(3456,"Toggle Activity Bar Visibility")})}run(){const t=e.configurationService.getValue(Et.ACTIVITY_BAR_LOCATION)===xe.HIDDEN?e.getRememberedActivityBarVisiblePosition():xe.HIDDEN;return e.configurationService.updateValue(Et.ACTIVITY_BAR_LOCATION,t)}}))}toJSON(){return{type:V.SIDEBAR_PART}}};zd=Kd=E([h(0,Qe),h(1,le),h(2,ot),h(3,Te),h(4,zt),h(5,bt),h(6,N),h(7,pe),h(8,We),h(9,ee),h(10,Kt),h(11,X),h(12,Ki)],zd);let $d=class NA extends k{constructor(e,t,i){super();this.viewId=e;this.viewDescriptorService=t;this.activityService=i;this.activity=void 0;this.activityDisposable=k.None;this._register(x.filter(this.viewDescriptorService.onDidChangeContainer,s=>s.views.some(o=>o.id===e))(()=>this.update()));this._register(x.filter(this.viewDescriptorService.onDidChangeLocation,s=>s.views.some(o=>o.id===e))(()=>this.update()))}setActivity(e){this.activity=e;this.update()}clearActivity(){this.activity=void 0;this.update()}update(){this.activityDisposable.dispose();const e=this.viewDescriptorService.getViewContainerByViewId(this.viewId);if(e&&this.activity){this.activityDisposable=this.activityService.showViewContainerActivity(e.id,this.activity)}}dispose(){this.activityDisposable.dispose();super.dispose()}};$d=E([h(1,We),h(2,ks)],$d);let qd=class BA extends k{constructor(e,t){super();this.viewDescriptorService=e;this.instantiationService=t;this.viewActivities=new Map;this._onDidChangeActivity=this._register(new _);this.onDidChangeActivity=this._onDidChangeActivity.event;this.viewContainerActivities=new Map;this.globalActivities=new Map}showViewContainerActivity(e,t){const i=this.viewDescriptorService.getViewContainerById(e);if(!i){return k.None}let s=this.viewContainerActivities.get(e);if(!s){s=[];this.viewContainerActivities.set(e,s)}s.push(t);this._onDidChangeActivity.fire(i);return de(()=>{s.splice(s.indexOf(t),1);if(s.length===0){this.viewContainerActivities.delete(e)}this._onDidChangeActivity.fire(i)})}getViewContainerActivities(e){const t=this.viewDescriptorService.getViewContainerById(e);if(t){return this.viewContainerActivities.get(e)??[]}return[]}showViewActivity(e,t){let i=this.viewActivities.get(e);if(i){i.id++}else{i={id:1,activity:this.instantiationService.createInstance($d,e)};this.viewActivities.set(e,i)}const s=i.id;i.activity.setActivity(t);const o=i;return de(()=>{if(o.id===s){o.activity.dispose();this.viewActivities.delete(e)}})}showAccountsActivity(e){return this.showActivity(pw,e)}showGlobalActivity(e){return this.showActivity(gw,e)}getActivity(e){return this.globalActivities.get(e)??[]}showActivity(e,t){let i=this.globalActivities.get(e);if(!i){i=[];this.globalActivities.set(e,i)}i.push(t);this._onDidChangeActivity.fire(e);return de(()=>{i.splice(i.indexOf(t),1);if(i.length===0){this.globalActivities.delete(e)}this._onDidChangeActivity.fire(e)})}};qd=E([h(0,We),h(1,N)],qd);var jd;Le(bw);let Yd=class FA extends cn{static{jd=this}get preferredHeight(){return this.layoutService.mainContainerDimension.height*.4}get preferredWidth(){const e=this.getActivePaneComposite();if(!e){return}const t=e.getOptimalWidth();if(typeof t!=="number"){return}return Math.max(t,300)}static{this.activePanelSettingsKey="workbench.panelpart.activepanelid"}constructor(e,t,i,s,o,n,r,d,l,u,p,f,g,m){super(V.PANEL_PART,{hasTitle:true},jd.activePanelSettingsKey,fw.bindTo(u),mw.bindTo(u),"panel","panel",void 0,ww,e,t,i,s,o,n,r,d,l,u,p,g);this.commandService=f;this.configurationService=m;this.minimumWidth=300;this.maximumWidth=Number.POSITIVE_INFINITY;this.minimumHeight=77;this.maximumHeight=Number.POSITIVE_INFINITY;this._register(this.configurationService.onDidChangeConfiguration(y=>{if(y.affectsConfiguration("workbench.panel.showLabels")){this.updateCompositeBar(true)}}))}updateStyles(){super.updateStyles();const e=Se(this.getContainer());e.style.backgroundColor=this.getColor(za)||"";const t=this.getColor(gr)||this.getColor(Es)||"";e.style.borderLeftColor=t;e.style.borderRightColor=t;e.style.borderBottomColor=t;const i=this.getTitleArea();if(i){i.style.borderTopColor=this.getColor(gr)||this.getColor(Es)||""}}getCompositeBarOptions(){return{partContainerClass:"panel",pinnedViewContainersKey:"workbench.panel.pinnedPanels",placeholderViewContainersKey:"workbench.panel.placeholderPanels",viewContainersWorkspaceStateKey:"workbench.panel.viewContainersWorkspaceState",icon:this.configurationService.getValue("workbench.panel.showLabels")===false,orientation:oo.HORIZONTAL,recomputeSizes:true,activityHoverOptions:{position:()=>this.layoutService.getPanelPosition()===gt.BOTTOM&&!this.layoutService.isPanelMaximized()?ro.ABOVE:ro.BELOW},fillExtraContextMenuActions:e=>this.fillExtraContextMenuActions(e),compositeSize:0,iconSize:16,compact:true,overflowActionSize:44,colors:e=>({activeBackgroundColor:e.getColor(za),inactiveBackgroundColor:e.getColor(za),activeBorderBottomColor:e.getColor(Up),activeForegroundColor:e.getColor(Hp),inactiveForegroundColor:e.getColor(Wp),badgeBackground:e.getColor(yw),badgeForeground:e.getColor(vw),dragAndDropBorder:e.getColor(Gp)})}}fillExtraContextMenuActions(e){if(this.getCompositeBarPosition()===ce.TITLE){const d=this.getViewsSubmenuAction();if(d){e.push(new Mi);e.push(d)}}const t=this.menuService.getMenuActions(w.PanelPositionMenu,this.contextKeyService,{shouldForwardArgs:true});const i=this.menuService.getMenuActions(w.PanelAlignmentMenu,this.contextKeyService,{shouldForwardArgs:true});const s=fr(t).secondary;const o=fr(i).secondary;const n=this.configurationService.getValue("workbench.panel.showLabels");const r=Js({id:"workbench.action.panel.toggleShowLabels",label:n?c(3449,"Show Icons"):c(3450,"Show Labels"),run:()=>this.configurationService.updateValue("workbench.panel.showLabels",!n)});e.push(...[new Mi,new ur("workbench.action.panel.position",c(3451,"Panel Position"),s),new ur("workbench.action.panel.align",c(3452,"Align Panel"),o),r,Js({id:Mh.ID,label:c(3453,"Hide Panel"),run:()=>this.commandService.executeCommand(Mh.ID)})])}layout(e,t,i,s){let o;switch(this.layoutService.getPanelPosition()){case gt.RIGHT:o=new Ft(e-1,t);break;case gt.TOP:o=new Ft(e,t-1);break;default:o=new Ft(e,t);break}super.layout(o.width,o.height,i,s)}shouldShowCompositeBar(){return true}getCompositeBarPosition(){return ce.TITLE}toJSON(){return{type:V.PANEL_PART}}};Yd=jd=E([h(0,Qe),h(1,le),h(2,ot),h(3,Te),h(4,zt),h(5,bt),h(6,N),h(7,pe),h(8,We),h(9,ee),h(10,Kt),h(11,bi),h(12,Ki),h(13,X)],Yd);const tI=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Zd;Le(tI);function am(a){return a.getValue("editor.dropIntoEditor.enabled")}function dm(a){return a.shiftKey}let Jd=class GA extends Kp{static{Zd=this}static{this.OVERLAY_ID="monaco-workbench-editor-drop-overlay"}get disposed(){return!!this._disposed}constructor(e,t,i,s,o,n,r,d){super(t);this.groupView=e;this.configurationService=i;this.instantiationService=s;this.editorService=o;this.editorGroupService=n;this.treeViewsDragAndDropService=r;this.contextService=d;this.editorTransfer=Xs.getInstance();this.groupTransfer=Xs.getInstance();this.treeItemsTransfer=Xs.getInstance();this.cleanupOverlayScheduler=this._register(new zp(()=>this.dispose(),300));this.enableDropIntoEditor=am(this.configurationService)&&this.isDropIntoActiveEditorEnabled();this.create()}create(){const e=this.getOverlayOffsetHeight();const t=this.container=G("div",{id:Zd.OVERLAY_ID});t.style.top=`${e}px`;this.groupView.element.appendChild(t);this.groupView.element.classList.add("dragged-over");this._register(de(()=>{t.remove();this.groupView.element.classList.remove("dragged-over")}));this.overlay=G(".editor-group-overlay-indicator");t.appendChild(this.overlay);if(this.enableDropIntoEditor){this.dropIntoPromptElement=_w(c(3226,"Hold __{0}__ to drop into editor",mt?"⇧":"Shift"),{});this.dropIntoPromptElement.classList.add("editor-group-overlay-drop-into-prompt");this.overlay.appendChild(this.dropIntoPromptElement)}this.registerListeners(t);this.updateStyles()}updateStyles(){const e=Se(this.overlay);e.style.backgroundColor=this.getColor(Vp)||"";const t=this.getColor(Ew);e.style.outlineColor=t||"";e.style.outlineOffset=t?"-2px":"";e.style.outlineStyle=t?"dashed":"";e.style.outlineWidth=t?"2px":"";if(this.dropIntoPromptElement){this.dropIntoPromptElement.style.backgroundColor=this.getColor(Iw)??"";this.dropIntoPromptElement.style.color=this.getColor(Dw)??"";const i=this.getColor(Tw);if(i){this.dropIntoPromptElement.style.borderWidth="1px";this.dropIntoPromptElement.style.borderStyle="solid";this.dropIntoPromptElement.style.borderColor=i}else{this.dropIntoPromptElement.style.borderWidth="0"}}}registerListeners(e){this._register(new Aw(e,{onDragOver:t=>{if(this.enableDropIntoEditor&&dm(t)){this.dispose();return}const i=this.groupTransfer.hasData(ls.prototype);const s=this.editorTransfer.hasData(ji.prototype);if(!s&&!i&&t.dataTransfer){t.dataTransfer.dropEffect="copy"}let o=true;if(i){o=this.isCopyOperation(t)}else if(s){const r=this.editorTransfer.getData(ji.prototype);if(Array.isArray(r)&&r.length>0){o=this.isCopyOperation(t,r[0].identifier)}}if(!o){const r=this.findSourceGroupView();if(r===this.groupView){if(i||s&&r.count<2){this.hideOverlay();return}}}let n=!!this.editorGroupService.partOptions.splitOnDragAndDrop;if(this.isToggleSplitOperation(t)){n=!n}this.positionOverlay(t.offsetX,t.offsetY,i,n);if(this.cleanupOverlayScheduler.isScheduled()){this.cleanupOverlayScheduler.cancel()}},onDragLeave:t=>this.dispose(),onDragEnd:t=>this.dispose(),onDrop:t=>{Ve.stop(t,true);this.dispose();if(this.currentDropOperation){this.handleDrop(t,this.currentDropOperation.splitDirection)}}}));this._register(J(e,se.MOUSE_OVER,()=>{if(!this.cleanupOverlayScheduler.isScheduled()){this.cleanupOverlayScheduler.schedule()}}))}isDropIntoActiveEditorEnabled(){return!!this.groupView.activeEditor?.hasCapability(Oh.CanDropIntoEditor)}findSourceGroupView(){if(this.groupTransfer.hasData(ls.prototype)){const e=this.groupTransfer.getData(ls.prototype);if(Array.isArray(e)&&e.length>0){return this.editorGroupService.getGroup(e[0].identifier)}}else if(this.editorTransfer.hasData(ji.prototype)){const e=this.editorTransfer.getData(ji.prototype);if(Array.isArray(e)&&e.length>0){return this.editorGroupService.getGroup(e[0].identifier.groupId)}}return void 0}async handleDrop(e,t){const i=()=>{let s;if(typeof t==="number"){s=this.editorGroupService.addGroup(this.groupView,t)}else{s=this.groupView}return s};if(this.groupTransfer.hasData(ls.prototype)){const s=this.groupTransfer.getData(ls.prototype);if(Array.isArray(s)&&s.length>0){const o=this.editorGroupService.getGroup(s[0].identifier);if(o){if(typeof t!=="number"&&o===this.groupView){return}let n;if(typeof t==="number"){if(this.isCopyOperation(e)){n=this.editorGroupService.copyGroup(o,this.groupView,t)}else{n=this.editorGroupService.moveGroup(o,this.groupView,t)}}else{let r=void 0;if(this.isCopyOperation(e)){r={mode:$p.COPY_EDITORS}}this.editorGroupService.mergeGroup(o,this.groupView,r)}if(n){this.editorGroupService.activateGroup(n)}}this.groupTransfer.clearData(ls.prototype)}}else if(this.editorTransfer.hasData(ji.prototype)){const s=this.editorTransfer.getData(ji.prototype);if(Array.isArray(s)&&s.length>0){const o=s;const n=s[0].identifier;const r=this.editorGroupService.getGroup(n.groupId);if(r){const d=this.isCopyOperation(e,n);let l=void 0;if(this.editorGroupService.partOptions.closeEmptyGroups&&r.count===1&&typeof t==="number"&&!d){l=this.editorGroupService.moveGroup(r,this.groupView,t)}else{l=i();if(r===l){return}const u=xw(this.groupView,o.map(p=>p.identifier.editor));if(!d){r.moveEditors(u,l)}else{r.copyEditors(u,l)}}l.focus()}this.editorTransfer.clearData(ji.prototype)}}else if(this.treeItemsTransfer.hasData(fs.prototype)){const s=this.treeItemsTransfer.getData(fs.prototype);if(Array.isArray(s)&&s.length>0){const o=[];for(const n of s){const r=await this.treeViewsDragAndDropService.removeDragOperationTransfer(n.identifier);if(r){const d=await Rw(r);o.push(...d.map(l=>({...l,options:{...l.options,pinned:true}})))}}if(o.length){this.editorService.openEditors(o,i(),{validateTrust:true})}}this.treeItemsTransfer.clearData(fs.prototype)}else{const s=this.instantiationService.createInstance(Vw,{allowWorkspaceOpen:!Is||kw(this.contextService.getWorkspace())});s.handleDrop(e,wt(this.groupView.element),()=>i(),o=>o?.focus())}}isCopyOperation(e,t){if(t?.editor.hasCapability(Oh.Singleton)){return false}return e.ctrlKey&&!mt||e.altKey&&mt}isToggleSplitOperation(e){return e.altKey&&!mt||e.shiftKey&&mt}positionOverlay(e,t,i,s){const o=this.editorGroupService.partOptions.openSideBySideDirection==="right";const n=this.groupView.element.clientWidth;const r=this.groupView.element.clientHeight-this.getOverlayOffsetHeight();let d;let l;if(s){if(i){d=o?.3:.1}else{d=.1}if(i){l=o?.1:.3}else{l=.1}}else{d=0;l=0}const u=n*d;const p=r*l;const f=n/3;const g=r/3;let m;if(e>u&&e<n-u&&t>p&&t<r-p){m=void 0}else{if(o){if(e<f){m=he.LEFT}else if(e>f*2){m=he.RIGHT}else if(t<r/2){m=he.UP}else{m=he.DOWN}}else{if(t<g){m=he.UP}else if(t>g*2){m=he.DOWN}else if(e<n/2){m=he.LEFT}else{m=he.RIGHT}}}switch(m){case he.UP:this.doPositionOverlay({top:"0",left:"0",width:"100%",height:"50%"});this.toggleDropIntoPrompt(false);break;case he.DOWN:this.doPositionOverlay({top:"50%",left:"0",width:"100%",height:"50%"});this.toggleDropIntoPrompt(false);break;case he.LEFT:this.doPositionOverlay({top:"0",left:"0",width:"50%",height:"100%"});this.toggleDropIntoPrompt(false);break;case he.RIGHT:this.doPositionOverlay({top:"0",left:"50%",width:"50%",height:"100%"});this.toggleDropIntoPrompt(false);break;default:this.doPositionOverlay({top:"0",left:"0",width:"100%",height:"100%"});this.toggleDropIntoPrompt(true)}const y=Se(this.overlay);y.style.opacity="1";setTimeout(()=>y.classList.add("overlay-move-transition"),0);this.currentDropOperation={splitDirection:m}}doPositionOverlay(e){const[t,i]=Pw(this.container,this.overlay);const s=this.getOverlayOffsetHeight();if(s){t.style.height=`calc(100% - ${s}px)`}else{t.style.height="100%"}i.style.top=e.top;i.style.left=e.left;i.style.width=e.width;i.style.height=e.height}getOverlayOffsetHeight(){if(!this.groupView.isEmpty&&this.editorGroupService.partOptions.showTabs==="multiple"){return this.groupView.titleHeight.offset}return 0}hideOverlay(){const e=Se(this.overlay);this.doPositionOverlay({top:"0",left:"0",width:"100%",height:"100%"});e.style.opacity="0";e.classList.remove("overlay-move-transition");this.currentDropOperation=void 0}toggleDropIntoPrompt(e){if(!this.dropIntoPromptElement){return}this.dropIntoPromptElement.style.opacity=e?"1":"0"}contains(e){return e===this.container||e===this.overlay}dispose(){super.dispose();this._disposed=true}};Jd=Zd=E([h(1,pe),h(2,X),h(3,N),h(4,Y),h(5,qe),h(6,qp),h(7,yn)],Jd);let Xd=class WA extends Kp{constructor(e,t,i,s,o,n){super(s);this.container=e;this.delegate=t;this.editorGroupService=i;this.configurationService=o;this.instantiationService=n;this.counter=0;this.editorTransfer=Xs.getInstance();this.groupTransfer=Xs.getInstance();this.registerListeners()}get overlay(){if(this._overlay&&!this._overlay.disposed){return this._overlay}return void 0}registerListeners(){this._register(J(this.container,se.DRAG_ENTER,e=>this.onDragEnter(e)));this._register(J(this.container,se.DRAG_LEAVE,()=>this.onDragLeave()));for(const e of[this.container,wt(this.container)]){this._register(J(e,se.DRAG_END,()=>this.onDragEnd()))}}onDragEnter(e){if(am(this.configurationService)&&dm(e)){return}this.counter++;if(!this.editorTransfer.hasData(ji.prototype)&&!this.groupTransfer.hasData(ls.prototype)&&e.dataTransfer){const i=W.as(Cw.DragAndDropContribution).getAll();const s=Array.from(i).map(o=>o.dataFormatKey);if(!Sw(e,Go.FILES,Cd.FILES,Go.RESOURCES,Cd.EDITORS,...s)){e.dataTransfer.dropEffect="none";return}}this.updateContainer(true);const t=e.target;if(t){if(this.overlay&&!this.overlay.contains(t)){this.disposeOverlay()}if(!this.overlay){const i=this.findTargetGroupView(t);if(i){this._overlay=this.instantiationService.createInstance(Jd,i)}}}}onDragLeave(){this.counter--;if(this.counter===0){this.updateContainer(false)}}onDragEnd(){this.counter=0;this.updateContainer(false);this.disposeOverlay()}findTargetGroupView(e){const t=this.editorGroupService.groups;return t.find(i=>Sd(e,i.element)||this.delegate.containsGroup?.(i))}updateContainer(e){this.container.classList.toggle("dragged-over",e)}dispose(){super.dispose();this.disposeOverlay()}disposeOverlay(){if(this.overlay){this.overlay.dispose();this._overlay=void 0}}};Xd=E([h(2,qe),h(3,pe),h(4,X),h(5,N)],Xd);const ko={targetWidth:900,leftMarginRatio:.1909,rightMarginRatio:.1909};const ld={type:"distribute"};function Qu(a){const e=G(".centered-layout-margin");e.style.height="100%";if(a){e.style.backgroundColor=a.toString()}return{element:e,layout:()=>void 0,minimumSize:60,maximumSize:Number.POSITIVE_INFINITY,onDidChange:x.None}}function iI(a,e){return{element:a.element,get maximumSize(){return a.maximumWidth},get minimumSize(){return a.minimumWidth},onDidChange:x.map(a.onDidChange,t=>t&&t.width),layout:(t,i,s)=>a.layout(t,e(),s?.top??0,(s?.left??0)+i)}}class sI{constructor(e,t,i={...ko},s=false){this.container=e;this.view=t;this.state=i;this.centeredLayoutFixedWidth=s;this.lastLayoutPosition={width:0,height:0,left:0,top:0};this.didLayout=false;this.splitViewDisposables=new L;this._boundarySashes={};this.container.appendChild(this.view.element);this.container.style.overflow="hidden"}get minimumWidth(){return this.splitView?this.splitView.minimumSize:this.view.minimumWidth}get maximumWidth(){return this.splitView?this.splitView.maximumSize:this.view.maximumWidth}get minimumHeight(){return this.view.minimumHeight}get maximumHeight(){return this.view.maximumHeight}get onDidChange(){return this.view.onDidChange}get boundarySashes(){return this._boundarySashes}set boundarySashes(e){this._boundarySashes=e;if(!this.splitView){return}this.splitView.orthogonalStartSash=e.top;this.splitView.orthogonalEndSash=e.bottom}layout(e,t,i,s){this.lastLayoutPosition={width:e,height:t,top:i,left:s};if(this.splitView){this.splitView.layout(e,this.lastLayoutPosition);if(!this.didLayout||this.centeredLayoutFixedWidth){this.resizeSplitViews()}}else{this.view.layout(e,t,i,s)}this.didLayout=true}resizeSplitViews(){if(!this.splitView){return}if(this.centeredLayoutFixedWidth){const e=Math.min(this.lastLayoutPosition.width,this.state.targetWidth);const t=(this.lastLayoutPosition.width-e)/2;this.splitView.resizeView(0,Math.floor(t));this.splitView.resizeView(1,e);this.splitView.resizeView(2,Math.ceil(t))}else{const e=this.state.leftMarginRatio*this.lastLayoutPosition.width;const t=this.state.rightMarginRatio*this.lastLayoutPosition.width;const i=this.lastLayoutPosition.width-e-t;this.splitView.resizeView(0,e);this.splitView.resizeView(1,i);this.splitView.resizeView(2,t)}}setFixedWidth(e){this.centeredLayoutFixedWidth=e;if(!!this.splitView){this.updateState();this.resizeSplitViews()}}updateState(){if(!!this.splitView){this.state.targetWidth=this.splitView.getViewSize(1);this.state.leftMarginRatio=this.splitView.getViewSize(0)/this.lastLayoutPosition.width;this.state.rightMarginRatio=this.splitView.getViewSize(2)/this.lastLayoutPosition.width}}isActive(){return!!this.splitView}styles(e){this.style=e;if(this.splitView&&this.emptyViews){this.splitView.style(this.style);this.emptyViews[0].element.style.backgroundColor=this.style.background.toString();this.emptyViews[1].element.style.backgroundColor=this.style.background.toString()}}activate(e){if(e===this.isActive()){return}if(e){this.view.element.remove();this.splitView=new tn(this.container,{inverseAltBehavior:true,orientation:q.HORIZONTAL,styles:this.style});this.splitView.orthogonalStartSash=this.boundarySashes.top;this.splitView.orthogonalEndSash=this.boundarySashes.bottom;this.splitViewDisposables.add(this.splitView.onDidSashChange(()=>{if(!!this.splitView){this.updateState()}}));this.splitViewDisposables.add(this.splitView.onDidSashReset(()=>{this.state={...ko};this.resizeSplitViews()}));this.splitView.layout(this.lastLayoutPosition.width,this.lastLayoutPosition);const t=this.style?this.style.background:void 0;this.emptyViews=[Qu(t),Qu(t)];this.splitView.addView(this.emptyViews[0],ld,0);this.splitView.addView(iI(this.view,()=>this.lastLayoutPosition.height),ld,1);this.splitView.addView(this.emptyViews[1],ld,2);this.resizeSplitViews()}else{this.splitView?.el.remove();this.splitViewDisposables.clear();this.splitView?.dispose();this.splitView=void 0;this.emptyViews=void 0;this.container.appendChild(this.view.element);this.view.layout(this.lastLayoutPosition.width,this.lastLayoutPosition.height,this.lastLayoutPosition.top,this.lastLayoutPosition.left)}}isDefault(e){if(this.centeredLayoutFixedWidth){return e.targetWidth===ko.targetWidth}else{return e.leftMarginRatio===ko.leftMarginRatio&&e.rightMarginRatio===ko.rightMarginRatio}}dispose(){this.splitViewDisposables.dispose();if(this.splitView){this.splitView.dispose();this.splitView=void 0}}}var Ai;class oI{constructor(){this.element=G(".grid-view-container");this._onDidChange=new Xi;this.onDidChange=this._onDidChange.event}get minimumWidth(){return this.gridWidget?this.gridWidget.minimumWidth:0}get maximumWidth(){return this.gridWidget?this.gridWidget.maximumWidth:Number.POSITIVE_INFINITY}get minimumHeight(){return this.gridWidget?this.gridWidget.minimumHeight:0}get maximumHeight(){return this.gridWidget?this.gridWidget.maximumHeight:Number.POSITIVE_INFINITY}get gridWidget(){return this._gridWidget}set gridWidget(e){this.element.innerText="";if(e){this.element.appendChild(e.element);this._onDidChange.input=e.onDidChange}else{this._onDidChange.input=x.None}this._gridWidget=e}layout(e,t,i,s){this.gridWidget?.layout(e,t,i,s)}dispose(){this._onDidChange.dispose()}}let Ar=class HA extends Dp{static{Ai=this}static{this.EDITOR_PART_UI_STATE_STORAGE_KEY="editorpart.state"}static{this.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY="editorpart.centeredview"}constructor(e,t,i,s,o,n,r,d,l,u,p){super(t,{hasTitle:false},n,d,l);this.editorPartsView=e;this.groupsLabel=i;this.windowId=s;this.instantiationService=o;this.configurationService=r;this.hostService=u;this.contextKeyService=p;this._onDidFocus=this._register(new _);this.onDidFocus=this._onDidFocus.event;this._onDidLayout=this._register(new _);this.onDidLayout=this._onDidLayout.event;this._onDidChangeActiveGroup=this._register(new _);this.onDidChangeActiveGroup=this._onDidChangeActiveGroup.event;this._onDidChangeGroupIndex=this._register(new _);this.onDidChangeGroupIndex=this._onDidChangeGroupIndex.event;this._onDidChangeGroupLabel=this._register(new _);this.onDidChangeGroupLabel=this._onDidChangeGroupLabel.event;this._onDidChangeGroupLocked=this._register(new _);this.onDidChangeGroupLocked=this._onDidChangeGroupLocked.event;this._onDidChangeGroupMaximized=this._register(new _);this.onDidChangeGroupMaximized=this._onDidChangeGroupMaximized.event;this._onDidActivateGroup=this._register(new _);this.onDidActivateGroup=this._onDidActivateGroup.event;this._onDidAddGroup=this._register(new _d);this.onDidAddGroup=this._onDidAddGroup.event;this._onDidRemoveGroup=this._register(new _d);this.onDidRemoveGroup=this._onDidRemoveGroup.event;this._onDidMoveGroup=this._register(new _);this.onDidMoveGroup=this._onDidMoveGroup.event;this.onDidSetGridWidget=this._register(new _);this._onDidChangeSizeConstraints=this._register(new Xi);this.onDidChangeSizeConstraints=x.any(this.onDidSetGridWidget.event,this._onDidChangeSizeConstraints.event);this._onDidScroll=this._register(new Xi);this.onDidScroll=x.any(this.onDidSetGridWidget.event,this._onDidScroll.event);this._onDidChangeEditorPartOptions=this._register(new _);this.onDidChangeEditorPartOptions=this._onDidChangeEditorPartOptions.event;this._onWillDispose=this._register(new _);this.onWillDispose=this._onWillDispose.event;this.workspaceMemento=this.getMemento(M.WORKSPACE,Ee.USER);this.profileMemento=this.getMemento(M.PROFILE,Ee.MACHINE);this.groupViews=new Map;this.mostRecentActiveGroups=[];this.gridWidgetDisposables=this._register(new L);this.gridWidgetView=this._register(new oI);this.enforcedPartOptions=[];this.top=0;this.left=0;this.sideGroup={openEditor:(f,g)=>{const[m]=this.scopedInstantiationService.invokeFunction(y=>Yf(y,{editor:f,options:g},jp));return m.openEditor(f,g)}};this._isReady=false;this.whenReadyPromise=new no;this.whenReady=this.whenReadyPromise.p;this.whenRestoredPromise=new no;this.whenRestored=this.whenRestoredPromise.p;this._willRestoreState=false;this.priority=li.High;this._partOptions=Nh(this.configurationService,this.themeService);this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationUpdated(e)));this._register(this.themeService.onDidFileIconThemeChange(()=>this.handleChangedPartOptions()));this._register(this.onDidChangeMementoValue(M.WORKSPACE,this._store)(e=>this.onDidChangeMementoState(e)))}onConfigurationUpdated(e){if(Lw(e)){this.handleChangedPartOptions()}}handleChangedPartOptions(){const e=this._partOptions;const t=Nh(this.configurationService,this.themeService);for(const i of this.enforcedPartOptions){Object.assign(t,i)}this._partOptions=t;this._onDidChangeEditorPartOptions.fire({oldPartOptions:e,newPartOptions:t})}get partOptions(){return this._partOptions}enforcePartOptions(e){this.enforcedPartOptions.push(e);this.handleChangedPartOptions();return de(()=>{this.enforcedPartOptions.splice(this.enforcedPartOptions.indexOf(e),1);this.handleChangedPartOptions()})}get contentDimension(){return this._contentDimension}get activeGroup(){return this._activeGroup}get groups(){return Array.from(this.groupViews.values())}get count(){return this.groupViews.size}get orientation(){return this.gridWidget&&this.gridWidget.orientation===q.VERTICAL?Bs.VERTICAL:Bs.HORIZONTAL}get isReady(){return this._isReady}get hasRestorableState(){return!!this.workspaceMemento[Ai.EDITOR_PART_UI_STATE_STORAGE_KEY]}get willRestoreState(){return this._willRestoreState}getGroups(e=Oe.CREATION_TIME){switch(e){case Oe.CREATION_TIME:return this.groups;case Oe.MOST_RECENTLY_ACTIVE:{const t=ts(this.mostRecentActiveGroups.map(i=>this.getGroup(i)));return Qs([...t,...this.groups])}case Oe.GRID_APPEARANCE:{const t=[];if(this.gridWidget){this.fillGridNodes(t,this.gridWidget.getViews())}return t}}}fillGridNodes(e,t){if(ys(t)){t.children.forEach(i=>this.fillGridNodes(e,i))}else{e.push(t.view)}}hasGroup(e){return this.groupViews.has(e)}getGroup(e){return this.groupViews.get(e)}findGroup(e,t=this.activeGroup,i){if(typeof e.direction==="number"){return this.doFindGroupByDirection(e.direction,t,i)}if(typeof e.location==="number"){return this.doFindGroupByLocation(e.location,t,i)}throw new Error("invalid arguments")}doFindGroupByDirection(e,t,i){const s=this.assertGroupView(t);const o=this.gridWidget.getNeighborViews(s,this.toGridViewDirection(e),i);o.sort((n,r)=>this.mostRecentActiveGroups.indexOf(n.id)-this.mostRecentActiveGroups.indexOf(r.id));return o[0]}doFindGroupByLocation(e,t,i){const s=this.assertGroupView(t);const o=this.getGroups(Oe.GRID_APPEARANCE);const n=o.indexOf(s);switch(e){case ft.FIRST:return o[0];case ft.LAST:return o[o.length-1];case ft.NEXT:{let r=o[n+1];if(!r&&i){r=this.doFindGroupByLocation(ft.FIRST,t)}return r}case ft.PREVIOUS:{let r=o[n-1];if(!r&&i){r=this.doFindGroupByLocation(ft.LAST,t)}return r}}}activateGroup(e,t){const i=this.assertGroupView(e);this.doSetGroupActive(i);if(!t){this.hostService.moveTop(wt(this.element))}return i}restoreGroup(e){const t=this.assertGroupView(e);this.doRestoreGroup(t);return t}getSize(e){const t=this.assertGroupView(e);return this.gridWidget.getViewSize(t)}setSize(e,t){const i=this.assertGroupView(e);this.gridWidget.resizeView(i,t)}arrangeGroups(e,t=this.activeGroup){if(this.count<2){return}if(!this.gridWidget){return}const i=this.assertGroupView(t);switch(e){case zi.EVEN:this.gridWidget.distributeViewSizes();break;case zi.MAXIMIZE:if(this.groups.length<2){return}this.gridWidget.maximizeView(i);i.focus();break;case zi.EXPAND:this.gridWidget.expandView(i);break}}toggleMaximizeGroup(e=this.activeGroup){if(this.hasMaximizedGroup()){this.unmaximizeGroup()}else{this.arrangeGroups(zi.MAXIMIZE,e)}}toggleExpandGroup(e=this.activeGroup){if(this.isGroupExpanded(this.activeGroup)){this.arrangeGroups(zi.EVEN)}else{this.arrangeGroups(zi.EXPAND,e)}}unmaximizeGroup(){this.gridWidget.exitMaximizedView();this._activeGroup.focus()}hasMaximizedGroup(){return this.gridWidget.hasMaximizedView()}isGroupMaximized(e){return this.gridWidget.isViewMaximized(e)}isGroupExpanded(e){return this.gridWidget.isViewExpanded(e)}setGroupOrientation(e){if(!this.gridWidget){return}const t=e===Bs.HORIZONTAL?q.HORIZONTAL:q.VERTICAL;if(this.gridWidget.orientation!==t){this.gridWidget.orientation=t}}applyLayout(e){const t=this.shouldRestoreFocus(this.container);let i=0;function s(d){for(const l of d){if(Array.isArray(l.groups)){s(l.groups)}else{i++}}}s(e.groups);let o=this.getGroups(Oe.GRID_APPEARANCE);if(i<o.length){const d=o[i-1];o.forEach((l,u)=>{if(u>=i){this.mergeGroup(l,d)}});o=this.getGroups(Oe.GRID_APPEARANCE)}const n=this.activeGroup;const r=rm({orientation:this.toGridViewOrientation(e.orientation,this.isTwoDimensionalGrid()?this.gridWidget.orientation:gi(this.gridWidget.orientation)),groups:e.groups});this.doApplyGridState(r,n.id,o);if(t){this._activeGroup.focus()}}getLayout(){const e=this.gridWidget.serialize();const t=e.orientation===q.HORIZONTAL?Bs.HORIZONTAL:Bs.VERTICAL;const i=this.serializedNodeToGroupLayoutArgument(e.root);return{orientation:t,groups:i.groups}}serializedNodeToGroupLayoutArgument(e){if(e.type==="branch"){return{size:e.size,groups:e.data.map(t=>this.serializedNodeToGroupLayoutArgument(t))}}return{size:e.size}}shouldRestoreFocus(e){if(!e){return false}const t=Rl();if(t===e.ownerDocument.body){return true}return Mw(e)}isTwoDimensionalGrid(){const e=this.gridWidget.getViews();if(ys(e)){return e.children.some(t=>ys(t))}return false}addGroup(e,t,i){const s=this.assertGroupView(e);let o;if(s.groupsView===this){const n=this.shouldRestoreFocus(s.element);const r=this.groupViews.size>1&&this.isGroupExpanded(s);o=this.doCreateGroupView(i);this.gridWidget.addView(o,this.getSplitSizingStyle(),s,this.toGridViewDirection(t));this.updateContainer();this._onDidAddGroup.fire(o);this.notifyGroupIndexChange();if(r){this.arrangeGroups(zi.EXPAND,o)}if(n){s.focus()}}else{o=s.groupsView.addGroup(s,t,i)}return o}getSplitSizingStyle(){switch(this._partOptions.splitSizing){case"distribute":return io.Distribute;case"split":return io.Split;default:return io.Auto}}doCreateGroupView(e,t){let i;if(e instanceof zn){i=zn.createCopy(e,this.editorPartsView,this,this.groupsLabel,this.count,this.scopedInstantiationService,t)}else if(Ow(e)){i=zn.createFromSerialized(e,this.editorPartsView,this,this.groupsLabel,this.count,this.scopedInstantiationService,t)}else{i=zn.createNew(this.editorPartsView,this,this.groupsLabel,this.count,this.scopedInstantiationService,t)}this.groupViews.set(i.id,i);const s=new L;s.add(i.onDidFocus(()=>{this.doSetGroupActive(i);this._onDidFocus.fire()}));s.add(i.onDidModelChange(o=>{switch(o.kind){case tr.GROUP_LOCKED:this._onDidChangeGroupLocked.fire(i);break;case tr.GROUP_INDEX:this._onDidChangeGroupIndex.fire(i);break;case tr.GROUP_LABEL:this._onDidChangeGroupLabel.fire(i);break}}));s.add(i.onDidActiveEditorChange(()=>{this.updateContainer()}));x.once(i.onWillDispose)(()=>{$e(s);this.groupViews.delete(i.id);this.doUpdateMostRecentActive(i)});return i}doSetGroupActive(e){if(this._activeGroup!==e){const t=this._activeGroup;this._activeGroup=e;this.doUpdateMostRecentActive(e,true);if(t&&!t.disposed){t.setActive(false)}e.setActive(true);this.doRestoreGroup(e);this._onDidChangeActiveGroup.fire(e)}this._onDidActivateGroup.fire(e)}doRestoreGroup(e){if(!this.gridWidget){return}try{if(this.hasMaximizedGroup()&&!this.isGroupMaximized(e)){this.unmaximizeGroup()}const t=this.gridWidget.getViewSize(e);if(t.width===e.minimumWidth||t.height===e.minimumHeight){this.arrangeGroups(zi.EXPAND,e)}}catch(t){}}doUpdateMostRecentActive(e,t){const i=this.mostRecentActiveGroups.indexOf(e.id);if(i!==-1){this.mostRecentActiveGroups.splice(i,1)}if(t){this.mostRecentActiveGroups.unshift(e.id)}}toGridViewDirection(e){switch(e){case he.UP:return oe.Up;case he.DOWN:return oe.Down;case he.LEFT:return oe.Left;case he.RIGHT:return oe.Right}}toGridViewOrientation(e,t){if(typeof e==="number"){return e===Bs.HORIZONTAL?q.HORIZONTAL:q.VERTICAL}return t}removeGroup(e,t){const i=this.assertGroupView(e);if(this.count===1){return}if(i.isEmpty){this.doRemoveEmptyGroup(i,t)}else{this.doRemoveGroupWithEditors(i)}}doRemoveGroupWithEditors(e){const t=this.getGroups(Oe.MOST_RECENTLY_ACTIVE);let i;if(this._activeGroup===e){i=t[1]}else{i=t[0]}this.mergeGroup(e,i)}doRemoveEmptyGroup(e,t){const i=!t&&this.shouldRestoreFocus(this.container);if(this._activeGroup===e){const s=this.getGroups(Oe.MOST_RECENTLY_ACTIVE);const o=s[1];this.doSetGroupActive(o)}this.gridWidget.removeView(e,this.getSplitSizingStyle());e.dispose();if(i){this._activeGroup.focus()}this.notifyGroupIndexChange();this.updateContainer();this._onDidRemoveGroup.fire(e)}moveGroup(e,t,i){const s=this.assertGroupView(e);const o=this.assertGroupView(t);if(s.id===o.id){throw new Error("Cannot move group into its own")}const n=this.shouldRestoreFocus(s.element);let r;if(s.groupsView===o.groupsView){this.gridWidget.moveView(s,this.getSplitSizingStyle(),o,this.toGridViewDirection(i));r=s}else{r=o.groupsView.addGroup(o,i,s);s.closeAllEditors();this.removeGroup(s,n)}if(n){r.focus()}this._onDidMoveGroup.fire(r);this.notifyGroupIndexChange();return r}copyGroup(e,t,i){const s=this.assertGroupView(e);const o=this.assertGroupView(t);const n=this.shouldRestoreFocus(s.element);const r=this.addGroup(o,i,s);if(n){r.focus()}return r}mergeGroup(e,t,i){const s=this.assertGroupView(e);const o=this.assertGroupView(t);const n=[];let r=i&&typeof i.index==="number"?i.index:o.count;for(const l of s.editors){const u=!s.isActive(l)||this._activeGroup!==s;let p;if(o.contains(l)&&(o.isSticky(l)||i?.preserveExistingIndex));else{p=r;r++}n.push({editor:l,options:{index:p,inactive:u,preserveFocus:u}})}let d=true;if(i?.mode===$p.COPY_EDITORS){s.copyEditors(n,o)}else{d=s.moveEditors(n,o)}if(s.isEmpty&&!s.disposed){this.removeGroup(s,true)}return d}mergeAllGroups(e,t){const i=this.assertGroupView(e);let s=true;for(const o of this.getGroups(Oe.MOST_RECENTLY_ACTIVE)){if(o===i){continue}const n=this.mergeGroup(o,i,t);if(!n){s=false}}return s}assertGroupView(e){let t;if(typeof e==="number"){t=this.editorPartsView.getGroup(e)}else{t=e}if(!t){throw new Error("Invalid editor group provided!")}return t}createEditorDropTarget(e,t){Nw(ao(e));return this.scopedInstantiationService.createInstance(Xd,e,t)}get minimumWidth(){return Math.min(this.centeredLayoutWidget.minimumWidth,this.layoutService.getMaximumEditorDimensions(this.layoutService.getContainer(wt(this.container))).width)}get maximumWidth(){return this.centeredLayoutWidget.maximumWidth}get minimumHeight(){return Math.min(this.centeredLayoutWidget.minimumHeight,this.layoutService.getMaximumEditorDimensions(this.layoutService.getContainer(wt(this.container))).height)}get maximumHeight(){return this.centeredLayoutWidget.maximumHeight}get snap(){return this.layoutService.getPanelAlignment()==="center"}get onDidChange(){return x.any(this.centeredLayoutWidget.onDidChange,this.onDidSetGridWidget.event)}get gridSeparatorBorder(){return this.theme.getColor(Bw)||this.theme.getColor(Es)||Bt.transparent}updateStyles(){const e=Se(this.container);e.style.backgroundColor=this.getColor(Fw)||"";const t={separatorBorder:this.gridSeparatorBorder,background:this.theme.getColor(Gw)||Bt.transparent};this.gridWidget.style(t);this.centeredLayoutWidget.styles(t)}createContentArea(e,t){this.element=e;this.container=G(".content");if(this.windowId!==ae.vscodeWindowId){this.container.classList.add("auxiliary")}e.appendChild(this.container);const i=this._register(this.contextKeyService.createScoped(this.container));this.scopedInstantiationService=this._register(this.instantiationService.createChild(new aa([ee,i])));this._willRestoreState=!t||t.restorePreviousState;this.doCreateGridControl();this.centeredLayoutWidget=this._register(new sI(this.container,this.gridWidgetView,this.profileMemento[Ai.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY],this._partOptions.centeredLayoutFixedWidth));this._register(this.onDidChangeEditorPartOptions(s=>this.centeredLayoutWidget.setFixedWidth(s.newPartOptions.centeredLayoutFixedWidth??false)));this.setupDragAndDropSupport(e,this.container);this.handleContextKeys(i);this.whenReadyPromise.complete();this._isReady=true;Yp.settled(this.groups.map(s=>s.whenRestored)).finally(()=>{this.whenRestoredPromise.complete()});return this.container}handleContextKeys(e){const t=vo.bindTo(e);t.set(this.windowId!==ae.vscodeWindowId);const i=Vl.bindTo(e);const s=kl.bindTo(e);const o=()=>{const n=this.count;if(n>1){i.set(true)}else{i.reset()}if(this.hasMaximizedGroup()){s.set(true)}else{s.reset()}};o();this._register(this.onDidAddGroup(()=>o()));this._register(this.onDidRemoveGroup(()=>o()));this._register(this.onDidChangeGroupMaximized(()=>o()))}setupDragAndDropSupport(e,t){this._register(this.createEditorDropTarget(t,Object.create(null)));const i=G(".drop-block-overlay");e.appendChild(i);this._register(Ww(i,()=>i.classList.remove("visible")));this._register(hr.INSTANCE.registerTarget(this.element,{onDragStart:u=>i.classList.add("visible"),onDragEnd:u=>i.classList.remove("visible")}));let s;let o;let n;let r;const d=u=>{if(!this.layoutService.isVisible(V.PANEL_PART)&&u===this.layoutService.getPanelPosition()){this.layoutService.setPartHidden(false,V.PANEL_PART)}else if(!this.layoutService.isVisible(V.AUXILIARYBAR_PART)&&u===(this.layoutService.getSideBarPosition()===gt.RIGHT?gt.LEFT:gt.RIGHT)){this.layoutService.setPartHidden(false,V.AUXILIARYBAR_PART)}};const l=()=>{if(s){clearTimeout(s);s=void 0}if(o){clearTimeout(o);o=void 0}};this._register(hr.INSTANCE.registerTarget(i,{onDragOver:u=>{Ve.stop(u.eventData,true);if(u.eventData.dataTransfer){u.eventData.dataTransfer.dropEffect="none"}const p=i.getBoundingClientRect();let f=void 0;let g=void 0;const m=100;if(u.eventData.clientX<p.left+m){f=gt.LEFT}if(u.eventData.clientX>p.right-m){f=gt.RIGHT}if(u.eventData.clientY>p.bottom-m){g=gt.BOTTOM}if(u.eventData.clientY<p.top+m){g=gt.TOP}if(s&&f!==n){clearTimeout(s);s=void 0}if(o&&g!==r){clearTimeout(o);o=void 0}if(!s&&f!==void 0){n=f;s=setTimeout(()=>d(f),200)}if(!o&&g!==void 0){r=g;o=setTimeout(()=>d(g),200)}},onDragLeave:()=>l(),onDragEnd:()=>l(),onDrop:()=>l()}))}centerLayout(e){this.centeredLayoutWidget.activate(e)}isLayoutCentered(){if(this.centeredLayoutWidget){return this.centeredLayoutWidget.isActive()}return false}doCreateGridControl(){let e=false;if(this._willRestoreState){e=!this.doCreateGridControlWithPreviousState()}if(!this.gridWidget||e){const t=this.doCreateGroupView();this.doSetGridWidget(new Ji(t));this.doSetGroupActive(t)}this.updateContainer();this.notifyGroupIndexChange()}doCreateGridControlWithPreviousState(){const e=this.loadState();if(e?.serializedGrid){try{this.mostRecentActiveGroups=e.mostRecentActiveGroups;this.doCreateGridControlWithState(e.serializedGrid,e.activeGroup)}catch(t){co(new Error(`Error restoring editor grid widget: ${t} (with state: ${JSON.stringify(e)})`));this.disposeGroups();return false}}return true}doCreateGridControlWithState(e,t,i,s){let o;if(i){o=i.slice(0)}else{o=[]}const n=[];const r=Ji.deserialize(e,{fromJSON:d=>{let l;if(o.length>0){l=o.shift()}else{l=this.doCreateGroupView(d,s)}n.push(l);if(l.id===t){this.doSetGroupActive(l)}return l}},{styles:{separatorBorder:this.gridSeparatorBorder}});if(!this._activeGroup){this.doSetGroupActive(n[0])}if(this.mostRecentActiveGroups.some(d=>!this.getGroup(d))){this.mostRecentActiveGroups=n.map(d=>d.id)}this.doSetGridWidget(r)}doSetGridWidget(e){let t={};if(this.gridWidget){t=this.gridWidget.boundarySashes;this.gridWidget.dispose()}this.gridWidget=e;this.gridWidget.boundarySashes=t;this.gridWidgetView.gridWidget=e;this._onDidChangeSizeConstraints.input=e.onDidChange;this._onDidScroll.input=e.onDidScroll;this.gridWidgetDisposables.clear();this.gridWidgetDisposables.add(e.onDidChangeViewMaximized(i=>this._onDidChangeGroupMaximized.fire(i)));this.onDidSetGridWidget.fire(void 0)}updateContainer(){const e=Se(this.container);e.classList.toggle("empty",this.isEmpty)}notifyGroupIndexChange(){this.getGroups(Oe.GRID_APPEARANCE).forEach((e,t)=>e.notifyIndexChanged(t))}notifyGroupsLabelChange(e){for(const t of this.groups){t.notifyLabelChanged(e)}}get isEmpty(){return this.count===1&&this._activeGroup.isEmpty}setBoundarySashes(e){this.gridWidget.boundarySashes=e;this.centeredLayoutWidget.boundarySashes=e}layout(e,t,i,s){this.top=i;this.left=s;const o=super.layoutContents(e,t).contentSize;this.doLayout(Ft.lift(o),i,s)}doLayout(e,t=this.top,i=this.left){this._contentDimension=e;this.centeredLayoutWidget.layout(this._contentDimension.width,this._contentDimension.height,t,i);this._onDidLayout.fire(e)}saveState(){if(this.gridWidget){if(this.isEmpty){delete this.workspaceMemento[Ai.EDITOR_PART_UI_STATE_STORAGE_KEY]}else{this.workspaceMemento[Ai.EDITOR_PART_UI_STATE_STORAGE_KEY]=this.createState()}}if(this.centeredLayoutWidget){const e=this.centeredLayoutWidget.state;if(this.centeredLayoutWidget.isDefault(e)){delete this.profileMemento[Ai.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY]}else{this.profileMemento[Ai.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY]=e}}super.saveState()}loadState(){return this.workspaceMemento[Ai.EDITOR_PART_UI_STATE_STORAGE_KEY]}createState(){return{serializedGrid:this.gridWidget.serialize(),activeGroup:this._activeGroup.id,mostRecentActiveGroups:this.mostRecentActiveGroups}}applyState(e,t){if(e==="empty"){return this.doApplyEmptyState()}else{return this.doApplyState(e,t)}}async doApplyState(e,t){const i=await this.doPrepareApplyState();this._onDidAddGroup.pause();this._onDidRemoveGroup.pause();this.disposeGroups();this.mostRecentActiveGroups=e.mostRecentActiveGroups;try{this.doApplyGridState(e.serializedGrid,e.activeGroup,void 0,t)}finally{this._onDidRemoveGroup.resume();this._onDidAddGroup.resume()}await this.activeGroup.openEditors(i.flatMap(s=>s.editors).filter(s=>this.editorPartsView.groups.every(o=>!o.contains(s))).map(s=>({editor:s,options:{pinned:true,preserveFocus:true,inactive:true}})))}async doApplyEmptyState(){await this.doPrepareApplyState();this.mergeAllGroups(this.activeGroup)}async doPrepareApplyState(){const e=this.getGroups(Oe.MOST_RECENTLY_ACTIVE);for(const t of e){await t.closeAllEditors({excludeConfirming:true})}return e}doApplyGridState(e,t,i,s){this.doCreateGridControlWithState(e,t,i,s);this.doLayout(this._contentDimension);this.updateContainer();for(const o of this.getGroups(Oe.GRID_APPEARANCE)){if(!i?.includes(o)){this._onDidAddGroup.fire(o)}}this.notifyGroupIndexChange()}onDidChangeMementoState(e){if(e.external&&e.scope===M.WORKSPACE){this.reloadMemento(e.scope);const t=this.loadState();if(t){this.applyState(t)}}}toJSON(){return{type:V.EDITOR_PART}}disposeGroups(){for(const e of this.groups){e.dispose();this._onDidRemoveGroup.fire(e)}this.groupViews.clear();this.mostRecentActiveGroups=[]}dispose(){this._onWillDispose.fire();this.disposeGroups();this.gridWidget?.dispose();super.dispose()}};Ar=Ai=E([h(4,N),h(5,pe),h(6,X),h(7,le),h(8,Te),h(9,is),h(10,ee)],Ar);let Qd=class UA extends Ar{constructor(e,t,i,s,o,n,r,d){super(e,V.EDITOR_PART,"",ae.vscodeWindowId,t,i,s,o,n,r,d)}};Qd=E([h(1,N),h(2,pe),h(3,X),h(4,le),h(5,Te),h(6,is),h(7,ee)],Qd);const nI=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Fs;Le(nI);let ec=class KA extends cn{static{Fs=this}static{this.activeViewSettingsKey="workbench.auxiliarybar.activepanelid"}static{this.pinnedViewsKey="workbench.auxiliarybar.pinnedPanels"}static{this.placeholdeViewContainersKey="workbench.auxiliarybar.placeholderPanels"}static{this.viewContainersWorkspaceStateKey="workbench.auxiliarybar.viewContainersWorkspaceState"}get preferredHeight(){return this.layoutService.mainContainerDimension.height*.4}get preferredWidth(){const e=this.getActivePaneComposite();if(!e){return}const t=e.getOptimalWidth();if(typeof t!=="number"){return}return Math.max(t,300)}constructor(e,t,i,s,o,n,r,d,l,u,p,f,g,m){super(V.AUXILIARYBAR_PART,{hasTitle:true,borderWidth:()=>this.getColor(pr)||this.getColor(Es)?1:0},Fs.activeViewSettingsKey,Hw.bindTo(u),Uw.bindTo(u),"auxiliarybar","auxiliarybar",void 0,kp,e,t,i,s,o,n,r,d,l,u,p,g);this.commandService=f;this.configurationService=m;this.minimumWidth=170;this.maximumWidth=Number.POSITIVE_INFINITY;this.minimumHeight=0;this.maximumHeight=Number.POSITIVE_INFINITY;this.priority=li.Low;this.configuration=this.resolveConfiguration();this._register(m.onDidChangeConfiguration(y=>{if(y.affectsConfiguration(Et.ACTIVITY_BAR_LOCATION)){this.configuration=this.resolveConfiguration();this.onDidChangeActivityBarLocation()}else if(y.affectsConfiguration("workbench.secondarySideBar.showLabels")){this.configuration=this.resolveConfiguration();this.updateCompositeBar(true)}}))}resolveConfiguration(){const e=this.configurationService.getValue(Et.ACTIVITY_BAR_LOCATION);const t=e!==xe.TOP;const i=t&&this.configurationService.getValue("workbench.secondarySideBar.showLabels")!==false;return{position:e,canShowLabels:t,showLabels:i}}onDidChangeActivityBarLocation(){this.updateCompositeBar();const e=this.getActiveComposite()?.getId();if(e){this.onTitleAreaUpdate(e)}}updateStyles(){super.updateStyles();const e=Se(this.getContainer());e.style.backgroundColor=this.getColor(Zs)||"";const t=this.getColor(pr)||this.getColor(Es);const i=this.layoutService.getSideBarPosition()===gt.RIGHT;e.style.color=this.getColor(Pp)||"";e.style.borderLeftColor=t??"";e.style.borderRightColor=t??"";e.style.borderLeftStyle=t&&!i?"solid":"none";e.style.borderRightStyle=t&&i?"solid":"none";e.style.borderLeftWidth=t&&!i?"1px":"0px";e.style.borderRightWidth=t&&i?"1px":"0px"}getCompositeBarOptions(){const e=this;return{partContainerClass:"auxiliarybar",pinnedViewContainersKey:Fs.pinnedViewsKey,placeholderViewContainersKey:Fs.placeholdeViewContainersKey,viewContainersWorkspaceStateKey:Fs.viewContainersWorkspaceStateKey,icon:!this.configuration.showLabels,orientation:oo.HORIZONTAL,recomputeSizes:true,activityHoverOptions:{position:()=>this.getCompositeBarPosition()===ce.BOTTOM?ro.ABOVE:ro.BELOW},fillExtraContextMenuActions:t=>this.fillExtraContextMenuActions(t),compositeSize:0,iconSize:16,get overflowActionSize(){return e.getCompositeBarPosition()===ce.TITLE?40:30},colors:t=>({activeBackgroundColor:t.getColor(Zs),inactiveBackgroundColor:t.getColor(Zs),get activeBorderBottomColor(){return e.getCompositeBarPosition()===ce.TITLE?t.getColor(Up):t.getColor(Fp)},get activeForegroundColor(){return e.getCompositeBarPosition()===ce.TITLE?t.getColor(Hp):t.getColor(Bp)},get inactiveForegroundColor(){return e.getCompositeBarPosition()===ce.TITLE?t.getColor(Wp):t.getColor(Np)},badgeBackground:t.getColor(Op),badgeForeground:t.getColor(Mp),get dragAndDropBorder(){return e.getCompositeBarPosition()===ce.TITLE?t.getColor(Gp):t.getColor(Lp)}}),compact:true}}fillExtraContextMenuActions(e){const t=this.layoutService.getSideBarPosition()===gt.LEFT;if(this.getCompositeBarPosition()===ce.TITLE){const n=this.getViewsSubmenuAction();if(n){e.push(new Mi);e.push(n)}}const i=this.menuService.getMenuActions(w.ActivityBarPositionMenu,this.contextKeyService,{shouldForwardArgs:true,renderShortTitle:true});const s=fr(i).secondary;const o=Js({id:"workbench.action.auxiliarybar.toggleShowLabels",label:this.configuration.showLabels?c(2857,"Show Icons"):c(2858,"Show Labels"),enabled:this.configuration.canShowLabels,run:()=>this.configurationService.updateValue("workbench.secondarySideBar.showLabels",!this.configuration.showLabels)});e.push(...[new Mi,new ur("workbench.action.panel.position",c(2859,"Activity Bar Position"),s),Js({id:Bh.ID,label:t?c(2860,"Move Secondary Side Bar Left"):c(2861,"Move Secondary Side Bar Right"),run:()=>this.commandService.executeCommand(Bh.ID)}),o,Js({id:$a.ID,label:c(2862,"Hide Secondary Side Bar"),run:()=>this.commandService.executeCommand($a.ID)})])}shouldShowCompositeBar(){return this.configuration.position!==xe.HIDDEN}getCompositeBarPosition(){switch(this.configuration.position){case xe.TOP:return ce.TOP;case xe.BOTTOM:return ce.BOTTOM;case xe.HIDDEN:return ce.TITLE;case xe.DEFAULT:return ce.TITLE;default:return ce.TITLE}}createHeaderArea(){const e=super.createHeaderArea();const t=G(".auxiliary-bar-global-header");const i=this.headerFooterCompositeBarDispoables.add(this.instantiationService.createInstance(Ap,w.AuxiliaryBarHeader,void 0,void 0));const s=this.headerFooterCompositeBarDispoables.add(this.instantiationService.createInstance(Al,t,{actionViewItemProvider:(o,n)=>this.headerActionViewItemProvider(o,n),orientation:oo.HORIZONTAL,hiddenItemStrategy:xp.NoHide,getKeyBinding:o=>this.keybindingService.lookupKeybinding(o.id)}));s.setActions(so(i.getPrimaryActions()));this.headerFooterCompositeBarDispoables.add(i.onDidChange(()=>s.setActions(so(i.getPrimaryActions()))));e.appendChild(t);return e}headerActionViewItemProvider(e,t){if(e.id===$a.ID){return this.instantiationService.createInstance(Pl,void 0,e,t)}return void 0}toJSON(){return{type:V.AUXILIARYBAR_PART}}};ec=Fs=E([h(0,Qe),h(1,le),h(2,ot),h(3,Te),h(4,zt),h(5,bt),h(6,N),h(7,pe),h(8,We),h(9,ee),h(10,Kt),h(11,bi),h(12,Ki),h(13,X)],ec);var Gs;var tc;const La=$w(new _);v(class extends j{constructor(){super({id:"workbench.action.toggleCompactAuxiliaryWindow",title:I(2881,"Toggle Window Compact Mode"),category:_e.View,f1:true,precondition:Yw})}async run(){La.fire({windowId:Ds().vscodeWindowId,compact:"toggle"})}});v(class extends j{constructor(){super({id:"workbench.action.enableCompactAuxiliaryWindow",title:c(2882,"Set Compact Mode"),icon:A.screenFull,menu:{id:w.LayoutControlMenu,when:S.and(Ed,Id.toNegated()),order:0}})}async run(){La.fire({windowId:Ds().vscodeWindowId,compact:true})}});v(class extends j{constructor(){super({id:"workbench.action.disableCompactAuxiliaryWindow",title:c(2883,"Unset Compact Mode"),icon:A.screenNormal,toggled:S.and(Ed,Id),menu:{id:w.LayoutControlMenu,when:S.and(Ed,Id),order:0}})}async run(){La.fire({windowId:Ds().vscodeWindowId,compact:false})}});let ic=class zA{static{Gs=this}static{this.STATUS_BAR_VISIBILITY="workbench.statusBar.visible"}constructor(e,t,i,s,o,n,r,d,l){this.editorPartsView=e;this.instantiationService=t;this.auxiliaryWindowService=i;this.lifecycleService=s;this.configurationService=o;this.statusbarService=n;this.titleService=r;this.editorService=d;this.layoutService=l}async create(e,t){const i=this;const s=new L;let o=Boolean(t?.compact);function n(){let R=0;if(D){R+=C.height}if(g&&m){R+=g.height}return R}function r(R){if(D){sn(C.container)}else{on(C.container)}if(R){u.layout()}}function d(R){if(!g){return}if(m){sn(g.container)}else{on(g.container)}if(R){u.layout()}}function l(R){if(R===o){return}o=R;u.updateOptions({compact:o});g?.updateOptions({compact:o});f.updateOptions({compact:o});const z=D;D=!o&&i.configurationService.getValue(Gs.STATUS_BAR_VISIBILITY)!==false;if(z!==D){r(true)}}const u=s.add(await this.auxiliaryWindowService.open(t));const p=G(".part.editor",{role:"main"});p.style.position="relative";u.container.appendChild(p);const f=s.add(this.instantiationService.createInstance(sc,u.window.vscodeWindowId,this.editorPartsView,t?.state,e));f.updateOptions({compact:o});s.add(this.editorPartsView.registerPart(f));f.create(p);let g=void 0;let m=false;const y=qw&&jw();if(y){g=s.add(this.titleService.createAuxiliaryTitlebarPart(u.container,f));g.updateOptions({compact:o});m=Fh(this.configurationService,u.window,void 0);const R=()=>{const z=m;m=Fh(this.configurationService,u.window,void 0);if(z!==m){d(true)}};s.add(g.onDidChange(()=>u.layout()));s.add(this.layoutService.onDidChangePartVisibility(()=>R()));s.add(Kw(z=>{if(z!==u.window.vscodeWindowId){return}R()}));d(false)}else{s.add(this.instantiationService.createInstance(zw,u.window,f))}const C=s.add(this.statusbarService.createAuxiliaryStatusbarPart(u.container));let D=!o&&this.configurationService.getValue(Gs.STATUS_BAR_VISIBILITY)!==false;s.add(this.configurationService.onDidChangeConfiguration(R=>{if(R.affectsConfiguration(Gs.STATUS_BAR_VISIBILITY)){D=!o&&this.configurationService.getValue(Gs.STATUS_BAR_VISIBILITY)!==false;r(true)}}));r(false);const F=s.add(x.once(f.onWillClose)(()=>u.window.close()));s.add(x.once(u.onUnload)(()=>{if(s.isDisposed){return}F.dispose();f.close();s.dispose()}));s.add(x.once(this.lifecycleService.onDidShutdown)(()=>s.dispose()));s.add(u.onBeforeUnload(R=>{for(const z of f.groups){for(const H of z.editors){const Z=H.canMove(z.id,this.editorPartsView.mainPart.activeGroup.id);if(typeof Z==="string"){z.openEditor(H);R.veto(Z);break}}}}));s.add(u.onWillLayout(R=>{const z=g?.height??0;g?.layout(R.width,z,0,0);const H=R.height-n();f.layout(R.width,H,z,0);C.layout(R.width,C.height,R.height-C.height,0)}));u.layout();s.add(La.event(R=>{if(R.windowId===u.window.vscodeWindowId){let z;if(typeof R.compact==="boolean"){z=R.compact}else{z=!o}l(z)}}));const P=s.add(this.instantiationService.createChild(new aa([ss,this.statusbarService.createScoped(C,s)],[Y,this.editorService.createScoped(f,s)])));return{part:f,instantiationService:P,disposables:s}}};ic=Gs=E([h(1,N),h(2,Ll),h(3,bn),h(4,X),h(5,ss),h(6,Zw),h(7,Y),h(8,Te)],ic);let sc=class $A extends Ar{static{tc=this}static{this.COUNTER=1}constructor(e,t,i,s,o,n,r,d,l,u,p){const f=tc.COUNTER++;super(t,`workbench.parts.auxiliaryEditor.${f}`,s,e,o,n,r,d,l,u,p);this.state=i;this._onWillClose=this._register(new _);this.onWillClose=this._onWillClose.event;this.optionsDisposable=this._register(new Ie)}updateOptions(e){if(e.compact&&!this.optionsDisposable.value){this.optionsDisposable.value=this.enforcePartOptions({showTabs:"none"})}else if(!e.compact){this.optionsDisposable.clear()}}removeGroup(e,t){const i=this.assertGroupView(e);if(this.count===1&&this.activeGroup===i){this.doRemoveLastGroup(t)}else{super.removeGroup(e,t)}}doRemoveLastGroup(e){const t=!e&&this.shouldRestoreFocus(this.container);const i=this.editorPartsView.getGroups(Oe.MOST_RECENTLY_ACTIVE);const s=i[1];if(s){s.groupsView.activateGroup(s);if(t){s.focus()}}this.doClose(false)}loadState(){return this.state}saveState(){return}close(){return this.doClose(true)}doClose(e){let t=true;if(e){for(const i of this.groups){i.closeAllEditors({excludeConfirming:true})}t=this.mergeGroupsToMainPart()}this._onWillClose.fire();return t}mergeGroupsToMainPart(){if(!this.groups.some(i=>i.count>0)){return true}let e=void 0;for(const i of this.editorPartsView.mainPart.getGroups(Oe.MOST_RECENTLY_ACTIVE)){if(!i.isLocked){e=i;break}}if(!e){e=this.editorPartsView.mainPart.addGroup(this.editorPartsView.mainPart.activeGroup,this.partOptions.openSideBySideDirection==="right"?he.RIGHT:he.DOWN)}const t=this.mergeAllGroups(e,{preserveExistingIndex:true});e.focus();return t}};sc=tc=E([h(4,N),h(5,pe),h(6,X),h(7,le),h(8,Te),h(9,is),h(10,ee)],sc);var us;let ep=class qA extends Jw{static{us=this}constructor(e,t,i,s,o){super("workbench.editorParts",i,t);this.instantiationService=e;this.storageService=t;this.auxiliaryWindowService=s;this.contextKeyService=o;this.mapPartToInstantiationService=new Map;this._onDidCreateAuxiliaryEditorPart=this._register(new _);this.onDidCreateAuxiliaryEditorPart=this._onDidCreateAuxiliaryEditorPart.event;this.workspaceMemento=this.getMemento(M.WORKSPACE,Ee.USER);this._isReady=false;this.whenReadyPromise=new no;this.whenReady=this.whenReadyPromise.p;this.whenRestoredPromise=new no;this.whenRestored=this.whenRestoredPromise.p;this.editorWorkingSets=(()=>{const n=this.storageService.get(us.EDITOR_WORKING_SETS_STORAGE_KEY,M.WORKSPACE);if(n){return JSON.parse(n)}return[]})();this._onDidActiveGroupChange=this._register(new _);this.onDidChangeActiveGroup=this._onDidActiveGroupChange.event;this._onDidAddGroup=this._register(new _);this.onDidAddGroup=this._onDidAddGroup.event;this._onDidRemoveGroup=this._register(new _);this.onDidRemoveGroup=this._onDidRemoveGroup.event;this._onDidMoveGroup=this._register(new _);this.onDidMoveGroup=this._onDidMoveGroup.event;this._onDidActivateGroup=this._register(new _);this.onDidActivateGroup=this._onDidActivateGroup.event;this._onDidChangeGroupIndex=this._register(new _);this.onDidChangeGroupIndex=this._onDidChangeGroupIndex.event;this._onDidChangeGroupLocked=this._register(new _);this.onDidChangeGroupLocked=this._onDidChangeGroupLocked.event;this._onDidChangeGroupMaximized=this._register(new _);this.onDidChangeGroupMaximized=this._onDidChangeGroupMaximized.event;this.globalContextKeys=new Map;this.scopedContextKeys=new Map;this.contextKeyProviders=new Map;this.registeredContextKeys=new Map;this.contextKeyProviderDisposables=this._register(new mr);this.mainPart=this._register(this.createMainEditorPart());this._register(this.registerPart(this.mainPart));this.mostRecentActiveParts=[this.mainPart];this.restoreParts();this.registerListeners()}registerListeners(){this._register(this.onDidChangeMementoValue(M.WORKSPACE,this._store)(e=>this.onDidChangeMementoState(e)));this.whenReady.then(()=>this.registerGroupsContextKeyListeners())}createMainEditorPart(){return this.instantiationService.createInstance(Qd,this)}getScopedInstantiationService(e){if(e===this.mainPart){if(!this.mapPartToInstantiationService.has(e.windowId)){this.instantiationService.invokeFunction(t=>{const i=t.get(Y);this.mapPartToInstantiationService.set(e.windowId,this._register(this.instantiationService.createChild(new aa([Y,i.createScoped("main",this._store)]))))})}}return this.mapPartToInstantiationService.get(e.windowId)??this.instantiationService}async createAuxiliaryEditorPart(e){const{part:t,instantiationService:i,disposables:s}=await this.instantiationService.createInstance(ic,this).create(this.getGroupsLabel(this._parts.size),e);this.mapPartToInstantiationService.set(t.windowId,i);s.add(de(()=>this.mapPartToInstantiationService.delete(t.windowId)));this._onDidAddGroup.fire(t.activeGroup);this._onDidCreateAuxiliaryEditorPart.fire(t);return t}registerPart(e){const t=this._register(new L);t.add(super.registerPart(e));this.registerEditorPartListeners(e,t);return t}unregisterPart(e){super.unregisterPart(e);this.parts.forEach((t,i)=>{if(t===this.mainPart){return}t.notifyGroupsLabelChange(this.getGroupsLabel(i))})}registerEditorPartListeners(e,t){t.add(e.onDidFocus(()=>{this.doUpdateMostRecentActive(e,true);if(this._parts.size>1){this._onDidActiveGroupChange.fire(this.activeGroup)}}));t.add(de(()=>this.doUpdateMostRecentActive(e)));t.add(e.onDidChangeActiveGroup(i=>this._onDidActiveGroupChange.fire(i)));t.add(e.onDidAddGroup(i=>this._onDidAddGroup.fire(i)));t.add(e.onDidRemoveGroup(i=>this._onDidRemoveGroup.fire(i)));t.add(e.onDidMoveGroup(i=>this._onDidMoveGroup.fire(i)));t.add(e.onDidActivateGroup(i=>this._onDidActivateGroup.fire(i)));t.add(e.onDidChangeGroupMaximized(i=>this._onDidChangeGroupMaximized.fire(i)));t.add(e.onDidChangeGroupIndex(i=>this._onDidChangeGroupIndex.fire(i)));t.add(e.onDidChangeGroupLocked(i=>this._onDidChangeGroupLocked.fire(i)))}doUpdateMostRecentActive(e,t){const i=this.mostRecentActiveParts.indexOf(e);if(i!==-1){this.mostRecentActiveParts.splice(i,1)}if(t){this.mostRecentActiveParts.unshift(e)}}getGroupsLabel(e){return c(3249,"Window {0}",e+1)}getPart(e){if(this._parts.size>1){if(ao(e)){const t=e;return this.getPartByDocument(t.ownerDocument)}else{const t=e;let i;if(typeof t==="number"){i=t}else{i=t.id}for(const s of this._parts){if(s.hasGroup(i)){return s}}}}return this.mainPart}static{this.EDITOR_PARTS_UI_STATE_STORAGE_KEY="editorparts.state"}get isReady(){return this._isReady}async restoreParts(){await this.mainPart.whenReady;if(this.mainPart.willRestoreState){const t=this.loadState();if(t){await this.restoreState(t)}}const e=this.mostRecentActiveParts.at(0);e?.activeGroup.focus();this._isReady=true;this.whenReadyPromise.complete();await Promise.allSettled(this.parts.map(t=>t.whenRestored));this.whenRestoredPromise.complete()}loadState(){return this.workspaceMemento[us.EDITOR_PARTS_UI_STATE_STORAGE_KEY]}saveState(){const e=this.createState();if(e.auxiliary.length===0){delete this.workspaceMemento[us.EDITOR_PARTS_UI_STATE_STORAGE_KEY]}else{this.workspaceMemento[us.EDITOR_PARTS_UI_STATE_STORAGE_KEY]=e}}createState(){return{auxiliary:this.parts.filter(e=>e!==this.mainPart).map(e=>{const t=this.auxiliaryWindowService.getWindow(e.windowId);return{state:e.createState(),...t?.createState()}}),mru:this.mostRecentActiveParts.map(e=>this.parts.indexOf(e))}}async restoreState(e){if(e.auxiliary.length){const t=[];for(const i of e.auxiliary){t.push(this.createAuxiliaryEditorPart(i))}await Promise.allSettled(t);if(e.mru.length===this.parts.length){this.mostRecentActiveParts=e.mru.map(i=>this.parts[i])}else{this.mostRecentActiveParts=[...this.parts]}await Promise.allSettled(this.parts.map(i=>i.whenReady))}}get hasRestorableState(){return this.parts.some(e=>e.hasRestorableState)}onDidChangeMementoState(e){if(e.external&&e.scope===M.WORKSPACE){this.reloadMemento(e.scope);const t=this.loadState();if(t){this.applyState(t)}}}async applyState(e){for(const t of this.parts){if(t===this.mainPart){continue}for(const s of t.getGroups(Oe.MOST_RECENTLY_ACTIVE)){await s.closeAllEditors({excludeConfirming:true})}const i=t.close();if(!i){return false}}if(e!=="empty"){await this.restoreState(e)}return true}static{this.EDITOR_WORKING_SETS_STORAGE_KEY="editor.workingSets"}saveWorkingSet(e){const t={id:yo(),name:e,main:this.mainPart.createState(),auxiliary:this.createState()};this.editorWorkingSets.push(t);this.saveWorkingSets();return{id:t.id,name:t.name}}getWorkingSets(){return this.editorWorkingSets.map(e=>({id:e.id,name:e.name}))}deleteWorkingSet(e){const t=this.indexOfWorkingSet(e);if(typeof t==="number"){this.editorWorkingSets.splice(t,1);this.saveWorkingSets()}}async applyWorkingSet(e,t){let i;if(e==="empty"){i="empty"}else{i=this.editorWorkingSets[this.indexOfWorkingSet(e)??-1]}if(!i){return false}const s=await this.applyState(i==="empty"?i:i.auxiliary);if(!s){return false}await this.mainPart.applyState(i==="empty"?i:i.main,t);if(!t?.preserveFocus){const o=this.mostRecentActiveParts.at(0);if(o){await o.whenReady;o.activeGroup.focus()}}return true}indexOfWorkingSet(e){for(let t=0;t<this.editorWorkingSets.length;t++){if(this.editorWorkingSets[t].id===e.id){return t}}return void 0}saveWorkingSets(){this.storageService.store(us.EDITOR_WORKING_SETS_STORAGE_KEY,JSON.stringify(this.editorWorkingSets),M.WORKSPACE,Ee.MACHINE)}get activeGroup(){return this.activePart.activeGroup}get sideGroup(){return this.activePart.sideGroup}get groups(){return this.getGroups()}get count(){return this.groups.length}getGroups(e=Oe.CREATION_TIME){if(this._parts.size>1){let t;switch(e){case Oe.GRID_APPEARANCE:case Oe.CREATION_TIME:t=this.parts;break;case Oe.MOST_RECENTLY_ACTIVE:t=Qs([...this.mostRecentActiveParts,...this.parts]);break}return t.map(i=>i.getGroups(e)).flat()}return this.mainPart.getGroups(e)}getGroup(e){if(this._parts.size>1){for(const t of this._parts){const i=t.getGroup(e);if(i){return i}}}return this.mainPart.getGroup(e)}assertGroupView(e){let t;if(typeof e==="number"){t=this.getGroup(e)}else{t=e}if(!t){throw new Error("Invalid editor group provided!")}return t}activateGroup(e){return this.getPart(e).activateGroup(e)}getSize(e){return this.getPart(e).getSize(e)}setSize(e,t){this.getPart(e).setSize(e,t)}arrangeGroups(e,t=this.activePart.activeGroup){this.getPart(t).arrangeGroups(e,t)}toggleMaximizeGroup(e=this.activePart.activeGroup){this.getPart(e).toggleMaximizeGroup(e)}toggleExpandGroup(e=this.activePart.activeGroup){this.getPart(e).toggleExpandGroup(e)}restoreGroup(e){return this.getPart(e).restoreGroup(e)}applyLayout(e){this.activePart.applyLayout(e)}getLayout(){return this.activePart.getLayout()}get orientation(){return this.activePart.orientation}setGroupOrientation(e){this.activePart.setGroupOrientation(e)}findGroup(e,t=this.activeGroup,i){const s=this.getPart(t);if(this._parts.size>1){const o=this.getGroups(Oe.GRID_APPEARANCE);if(e.location===ft.FIRST||e.location===ft.LAST){return e.location===ft.FIRST?o[0]:o[o.length-1]}const n=s.findGroup(e,t,false);if(n){return n}if(e.location===ft.NEXT||e.location===ft.PREVIOUS){const r=this.assertGroupView(t);const d=o.indexOf(r);if(e.location===ft.NEXT){let l=o[d+1];if(!l&&i){l=o[0]}return l}else{let l=o[d-1];if(!l&&i){l=o[o.length-1]}return l}}}return s.findGroup(e,t,i)}addGroup(e,t){return this.getPart(e).addGroup(e,t)}removeGroup(e){this.getPart(e).removeGroup(e)}moveGroup(e,t,i){return this.getPart(e).moveGroup(e,t,i)}mergeGroup(e,t,i){return this.getPart(e).mergeGroup(e,t,i)}mergeAllGroups(e,t){return this.activePart.mergeAllGroups(e,t)}copyGroup(e,t,i){return this.getPart(e).copyGroup(e,t,i)}createEditorDropTarget(e,t){return this.getPart(e).createEditorDropTarget(e,t)}registerGroupsContextKeyListeners(){this._register(this.onDidChangeActiveGroup(()=>this.updateGlobalContextKeys()));this.groups.forEach(e=>this.registerGroupContextKeyProvidersListeners(e));this._register(this.onDidAddGroup(e=>this.registerGroupContextKeyProvidersListeners(e)));this._register(this.onDidRemoveGroup(e=>{this.scopedContextKeys.delete(e.id);this.registeredContextKeys.delete(e.id);this.contextKeyProviderDisposables.deleteAndDispose(e.id)}))}updateGlobalContextKeys(){const e=this.scopedContextKeys.get(this.activeGroup.id);if(!e){return}for(const[t,i]of this.globalContextKeys){const s=e.get(t);if(s){i.set(s.get())}else{i.reset()}}}bind(e,t){let i=this.globalContextKeys.get(e.key);if(!i){i=e.bindTo(this.contextKeyService);this.globalContextKeys.set(e.key,i)}let s=this.scopedContextKeys.get(t.id);if(!s){s=new Map;this.scopedContextKeys.set(t.id,s)}let o=s.get(e.key);if(!o){o=e.bindTo(t.scopedContextKeyService);s.set(e.key,o)}const n=this;return{get(){return o.get()},set(r){if(n.activeGroup===t){i.set(r)}o.set(r)},reset(){if(n.activeGroup===t){i.reset()}o.reset()}}}registerContextKeyProvider(e){if(this.contextKeyProviders.has(e.contextKey.key)||this.globalContextKeys.has(e.contextKey.key)){throw new Error(`A context key provider for key ${e.contextKey.key} already exists.`)}this.contextKeyProviders.set(e.contextKey.key,e);const t=()=>{for(const s of this.groups){this.updateRegisteredContextKey(s,e)}};t();const i=e.onDidChange?.(()=>t());return de(()=>{i?.dispose();this.globalContextKeys.delete(e.contextKey.key);this.scopedContextKeys.forEach(s=>s.delete(e.contextKey.key));this.contextKeyProviders.delete(e.contextKey.key);this.registeredContextKeys.forEach(s=>s.delete(e.contextKey.key))})}registerGroupContextKeyProvidersListeners(e){const t=e.onDidActiveEditorChange(()=>{for(const i of this.contextKeyProviders.values()){this.updateRegisteredContextKey(e,i)}});this.contextKeyProviderDisposables.set(e.id,t)}updateRegisteredContextKey(e,t){let i=this.registeredContextKeys.get(e.id);if(!i){i=new Map;this.registeredContextKeys.set(e.id,i)}let s=i.get(t.contextKey.key);if(!s){s=this.bind(t.contextKey,e);i.set(t.contextKey.key,s)}s.set(t.getGroupContextKeyValue(e))}get partOptions(){return this.mainPart.partOptions}get onDidChangeEditorPartOptions(){return this.mainPart.onDidChangeEditorPartOptions}};ep=us=E([h(0,N),h(1,le),h(2,pe),h(3,Ll),h(4,ee)],ep);function cm(a){return`${a}.hidden`}let oc=class jA extends k{constructor(e,t,i,s){super();this.viewContainerName=t;this.storageService=i;this._onDidChangeStoredState=this._register(new _);this.onDidChangeStoredState=this._onDidChangeStoredState.event;this.logger=new Ml(()=>s.createLogger(Ol,{name:Bl,group:Nl}));this.globalViewsStateStorageId=cm(e);this.workspaceViewsStateStorageId=e;this._register(this.storageService.onDidChangeValue(M.PROFILE,this.globalViewsStateStorageId,this._store)(()=>this.onDidStorageChange()));this.state=this.initialize()}set(e,t){this.state.set(e,t)}get(e){return this.state.get(e)}updateState(e){this.updateWorkspaceState(e);this.updateGlobalState(e)}updateWorkspaceState(e){const t=this.getStoredWorkspaceState();for(const i of e){const s=this.get(i.id);if(s){t[i.id]={collapsed:!!s.collapsed,isHidden:!s.visibleWorkspace,size:s.size,order:i.workspace&&s?s.order:void 0}}}if(Object.keys(t).length>0){this.storageService.store(this.workspaceViewsStateStorageId,JSON.stringify(t),M.WORKSPACE,Ee.MACHINE)}else{this.storageService.remove(this.workspaceViewsStateStorageId,M.WORKSPACE)}}updateGlobalState(e){const t=this.getStoredGlobalState();for(const i of e){const s=this.get(i.id);t.set(i.id,{id:i.id,isHidden:s&&i.canToggleVisibility?!s.visibleGlobal:false,order:!i.workspace&&s?s.order:void 0})}this.setStoredGlobalState(t)}onDidStorageChange(){if(this.globalViewsStatesValue!==this.getStoredGlobalViewsStatesValue()){this._globalViewsStatesValue=void 0;const e=this.getStoredGlobalState();const t=this.getStoredWorkspaceState();const i=[];for(const[s,o]of e){const n=this.get(s);if(n){if(n.visibleGlobal!==!o.isHidden){if(!o.isHidden){this.logger.value.info(`View visibility state changed: ${s} is now visible`,this.viewContainerName)}i.push({id:s,visible:!o.isHidden})}}else{const r=t[s];this.set(s,{active:false,visibleGlobal:!o.isHidden,visibleWorkspace:Lo(r?.isHidden)?void 0:!r?.isHidden,collapsed:r?.collapsed,order:r?.order,size:r?.size})}}if(i.length){this._onDidChangeStoredState.fire(i);for(const s of i){const o=this.get(s.id);if(o){o.visibleGlobal=s.visible}}}}}initialize(){const e=new Map;const t=this.getStoredWorkspaceState();for(const r of Object.keys(t)){const d=t[r];e.set(r,{active:false,visibleGlobal:void 0,visibleWorkspace:Lo(d.isHidden)?void 0:!d.isHidden,collapsed:d.collapsed,order:d.order,size:d.size})}const i=this.storageService.get(this.globalViewsStateStorageId,M.WORKSPACE,"[]");const{state:s}=this.parseStoredGlobalState(i);if(s.size>0){for(const{id:r,isHidden:d}of s.values()){const l=e.get(r);if(l){if(Lo(l.visibleWorkspace)){l.visibleWorkspace=!d}}else{e.set(r,{active:false,collapsed:void 0,visibleGlobal:void 0,visibleWorkspace:!d})}}this.storageService.remove(this.globalViewsStateStorageId,M.WORKSPACE)}const{state:o,hasDuplicates:n}=this.parseStoredGlobalState(this.globalViewsStatesValue);if(n){this.setStoredGlobalState(o)}for(const{id:r,isHidden:d,order:l}of o.values()){const u=e.get(r);if(u){u.visibleGlobal=!d;if(!Lo(l)){u.order=l}}else{e.set(r,{active:false,visibleGlobal:!d,order:l,collapsed:void 0,visibleWorkspace:void 0})}}return e}getStoredWorkspaceState(){return JSON.parse(this.storageService.get(this.workspaceViewsStateStorageId,M.WORKSPACE,"{}"))}getStoredGlobalState(){return this.parseStoredGlobalState(this.globalViewsStatesValue).state}setStoredGlobalState(e){this.globalViewsStatesValue=JSON.stringify([...e.values()])}parseStoredGlobalState(e){const t=JSON.parse(e);let i=false;const s=t.reduce((o,n)=>{if(typeof n==="string"){i=i||o.has(n);o.set(n,{id:n,isHidden:true})}else{i=i||o.has(n.id);o.set(n.id,n)}return o},new Map);return{state:s,hasDuplicates:i}}get globalViewsStatesValue(){if(!this._globalViewsStatesValue){this._globalViewsStatesValue=this.getStoredGlobalViewsStatesValue()}return this._globalViewsStatesValue}set globalViewsStatesValue(e){if(this.globalViewsStatesValue!==e){this._globalViewsStatesValue=e;this.setStoredGlobalViewsStatesValue(e)}}getStoredGlobalViewsStatesValue(){return this.storageService.get(this.globalViewsStateStorageId,M.PROFILE,"[]")}setStoredGlobalViewsStatesValue(e){this.storageService.store(this.globalViewsStateStorageId,e,M.PROFILE,Ee.USER)}};oc=E([h(2,le),h(3,Fl)],oc);let nc=class YA extends k{get title(){return this._title}get icon(){return this._icon}get keybindingId(){return this._keybindingId}get allViewDescriptors(){return this.viewDescriptorItems.map(e=>e.viewDescriptor)}get activeViewDescriptors(){return this.viewDescriptorItems.filter(e=>e.state.active).map(e=>e.viewDescriptor)}get visibleViewDescriptors(){return this.viewDescriptorItems.filter(e=>this.isViewDescriptorVisible(e)).map(e=>e.viewDescriptor)}constructor(e,t,i,s){super();this.viewContainer=e;this.contextKeyService=i;this.contextKeys=new Xw;this.viewDescriptorItems=[];this._onDidChangeContainerInfo=this._register(new _);this.onDidChangeContainerInfo=this._onDidChangeContainerInfo.event;this._onDidChangeAllViewDescriptors=this._register(new _);this.onDidChangeAllViewDescriptors=this._onDidChangeAllViewDescriptors.event;this._onDidChangeActiveViewDescriptors=this._register(new _);this.onDidChangeActiveViewDescriptors=this._onDidChangeActiveViewDescriptors.event;this._onDidAddVisibleViewDescriptors=this._register(new _);this.onDidAddVisibleViewDescriptors=this._onDidAddVisibleViewDescriptors.event;this._onDidRemoveVisibleViewDescriptors=this._register(new _);this.onDidRemoveVisibleViewDescriptors=this._onDidRemoveVisibleViewDescriptors.event;this._onDidMoveVisibleViewDescriptors=this._register(new _);this.onDidMoveVisibleViewDescriptors=this._onDidMoveVisibleViewDescriptors.event;this.logger=new Ml(()=>s.createLogger(Ol,{name:Bl,group:Nl}));this._register(x.filter(i.onDidChangeContext,o=>o.affectsSome(this.contextKeys))(()=>this.onDidChangeContext()));this.viewDescriptorsState=this._register(t.createInstance(oc,e.storageId||`${e.id}.state`,typeof e.title==="string"?e.title:e.title.original));this._register(this.viewDescriptorsState.onDidChangeStoredState(o=>this.updateVisibility(o)));this.updateContainerInfo()}updateContainerInfo(){const e=this.viewContainer.alwaysUseContainerInfo||this.visibleViewDescriptors.length===0||this.visibleViewDescriptors.some(d=>W.as(it.ViewsRegistry).getViewContainer(d.id)===this.viewContainer);const t=e?typeof this.viewContainer.title==="string"?this.viewContainer.title:this.viewContainer.title.value:this.visibleViewDescriptors[0]?.containerTitle||this.visibleViewDescriptors[0]?.name?.value||"";let i=false;if(this._title!==t){this._title=t;i=true}const s=e?this.viewContainer.icon:this.visibleViewDescriptors[0]?.containerIcon||Zp;let o=false;if(!this.isEqualIcon(s)){this._icon=s;o=true}const n=this.viewContainer.openCommandActionDescriptor?.id??this.activeViewDescriptors.find(d=>d.openCommandActionDescriptor)?.openCommandActionDescriptor?.id;let r=false;if(this._keybindingId!==n){this._keybindingId=n;r=true}if(i||o||r){this._onDidChangeContainerInfo.fire({title:i,icon:o,keybindingId:r})}}isEqualIcon(e){if(K.isUri(e)){return K.isUri(this._icon)&&vi(e,this._icon)}else if(ye.isThemeIcon(e)){return ye.isThemeIcon(this._icon)&&ye.isEqual(e,this._icon)}return e===this._icon}isVisible(e){const t=this.viewDescriptorItems.find(i=>i.viewDescriptor.id===e);if(!t){throw new Error(`Unknown view ${e}`)}return this.isViewDescriptorVisible(t)}setVisible(e,t){this.updateVisibility([{id:e,visible:t}])}updateVisibility(e){const t=ts(e.filter(({visible:o})=>!o).map(({id:o})=>this.findAndIgnoreIfNotFound(o)));const i=[];for(const{viewDescriptorItem:o,visibleIndex:n}of t){if(this.updateViewDescriptorItemVisibility(o,false)){i.push({viewDescriptor:o.viewDescriptor,index:n})}}if(i.length){this.broadCastRemovedVisibleViewDescriptors(i)}const s=[];for(const{id:o,visible:n}of e){if(!n){continue}const r=this.findAndIgnoreIfNotFound(o);if(!r){continue}const{viewDescriptorItem:d,visibleIndex:l}=r;if(this.updateViewDescriptorItemVisibility(d,true)){s.push({index:l,viewDescriptor:d.viewDescriptor,size:d.state.size,collapsed:!!d.state.collapsed})}}if(s.length){this.broadCastAddedVisibleViewDescriptors(s)}}updateViewDescriptorItemVisibility(e,t){if(!e.viewDescriptor.canToggleVisibility){return false}if(this.isViewDescriptorVisibleWhenActive(e)===t){return false}if(e.viewDescriptor.workspace){e.state.visibleWorkspace=t}else{e.state.visibleGlobal=t;if(t){this.logger.value.info(`Showing view ${e.viewDescriptor.id} in the container ${this.viewContainer.id}`)}}return this.isViewDescriptorVisible(e)===t}isCollapsed(e){return!!this.find(e).viewDescriptorItem.state.collapsed}setCollapsed(e,t){const{viewDescriptorItem:i}=this.find(e);if(i.state.collapsed!==t){i.state.collapsed=t}this.viewDescriptorsState.updateState(this.allViewDescriptors)}getSize(e){return this.find(e).viewDescriptorItem.state.size}setSizes(e){for(const{id:t,size:i}of e){const{viewDescriptorItem:s}=this.find(t);if(s.state.size!==i){s.state.size=i}}this.viewDescriptorsState.updateState(this.allViewDescriptors)}move(e,t){const i=this.viewDescriptorItems.findIndex(r=>r.viewDescriptor.id===e);const s=this.viewDescriptorItems.findIndex(r=>r.viewDescriptor.id===t);const o=this.viewDescriptorItems[i];const n=this.viewDescriptorItems[s];Qw(this.viewDescriptorItems,i,s);for(let r=0;r<this.viewDescriptorItems.length;r++){this.viewDescriptorItems[r].state.order=r}this.broadCastMovedViewDescriptors({index:i,viewDescriptor:o.viewDescriptor},{index:s,viewDescriptor:n.viewDescriptor})}add(e){const t=[];for(const o of e){const n=o.viewDescriptor;if(n.when){for(const d of n.when.keys()){this.contextKeys.add(d)}}let r=this.viewDescriptorsState.get(n.id);if(r){if(n.workspace){r.visibleWorkspace=Ei(o.visible)?Ei(r.visibleWorkspace)?!n.hideByDefault:r.visibleWorkspace:o.visible}else{const d=r.visibleGlobal;r.visibleGlobal=Ei(o.visible)?Ei(r.visibleGlobal)?!n.hideByDefault:r.visibleGlobal:o.visible;if(r.visibleGlobal&&!d){this.logger.value.info(`Added view ${n.id} in the container ${this.viewContainer.id} and showing it.`,`${d}`,`${n.hideByDefault}`,`${o.visible}`)}}r.collapsed=Ei(o.collapsed)?Ei(r.collapsed)?!!n.collapsed:r.collapsed:o.collapsed}else{r={active:false,visibleGlobal:Ei(o.visible)?!n.hideByDefault:o.visible,visibleWorkspace:Ei(o.visible)?!n.hideByDefault:o.visible,collapsed:Ei(o.collapsed)?!!n.collapsed:o.collapsed}}this.viewDescriptorsState.set(n.id,r);r.active=this.contextKeyService.contextMatchesRules(n.when);t.push({viewDescriptor:n,state:r})}this.viewDescriptorItems.push(...t);this.viewDescriptorItems.sort(this.compareViewDescriptors.bind(this));this._onDidChangeAllViewDescriptors.fire({added:t.map(({viewDescriptor:o})=>o),removed:[]});const i=[];for(const o of t){if(o.state.active){i.push({viewDescriptorItem:o,visible:this.isViewDescriptorVisible(o)})}}if(i.length){this._onDidChangeActiveViewDescriptors.fire({added:i.map(({viewDescriptorItem:o})=>o.viewDescriptor),removed:[]})}const s=[];for(const{viewDescriptorItem:o,visible:n}of i){if(n&&this.isViewDescriptorVisible(o)){const{visibleIndex:r}=this.find(o.viewDescriptor.id);s.push({index:r,viewDescriptor:o.viewDescriptor,size:o.state.size,collapsed:!!o.state.collapsed})}}this.broadCastAddedVisibleViewDescriptors(s)}remove(e){const t=[];const i=[];const s=[];const o=[];for(const n of e){if(n.when){for(const d of n.when.keys()){this.contextKeys.delete(d)}}const r=this.viewDescriptorItems.findIndex(d=>d.viewDescriptor.id===n.id);if(r!==-1){t.push(n);const d=this.viewDescriptorItems[r];if(d.state.active){s.push(d.viewDescriptor)}if(this.isViewDescriptorVisible(d)){const{visibleIndex:l}=this.find(d.viewDescriptor.id);o.push({index:l,viewDescriptor:d.viewDescriptor})}i.push(d)}}i.forEach(n=>this.viewDescriptorItems.splice(this.viewDescriptorItems.indexOf(n),1));this.broadCastRemovedVisibleViewDescriptors(o);if(s.length){this._onDidChangeActiveViewDescriptors.fire({added:[],removed:s})}if(t.length){this._onDidChangeAllViewDescriptors.fire({added:[],removed:t})}}onDidChangeContext(){const e=[];const t=[];for(const o of this.viewDescriptorItems){const n=o.state.active;const r=this.contextKeyService.contextMatchesRules(o.viewDescriptor.when);if(n!==r){if(r){e.push({item:o,visibleWhenActive:this.isViewDescriptorVisibleWhenActive(o)})}else{t.push(o)}}}const i=[];for(const o of t){if(this.isViewDescriptorVisible(o)){const{visibleIndex:n}=this.find(o.viewDescriptor.id);i.push({index:n,viewDescriptor:o.viewDescriptor})}}t.forEach(o=>o.state.active=false);e.forEach(({item:o})=>o.state.active=true);this.broadCastRemovedVisibleViewDescriptors(i);if(e.length||t.length){this._onDidChangeActiveViewDescriptors.fire({added:e.map(({item:o})=>o.viewDescriptor),removed:t.map(o=>o.viewDescriptor)})}const s=[];for(const{item:o,visibleWhenActive:n}of e){if(n&&this.isViewDescriptorVisible(o)){const{visibleIndex:r}=this.find(o.viewDescriptor.id);s.push({index:r,viewDescriptor:o.viewDescriptor,size:o.state.size,collapsed:!!o.state.collapsed})}}this.broadCastAddedVisibleViewDescriptors(s)}broadCastAddedVisibleViewDescriptors(e){if(e.length){this._onDidAddVisibleViewDescriptors.fire(e.sort((t,i)=>t.index-i.index));this.updateState(`Added views:${e.map(t=>t.viewDescriptor.id).join(",")} in ${this.viewContainer.id}`)}}broadCastRemovedVisibleViewDescriptors(e){if(e.length){this._onDidRemoveVisibleViewDescriptors.fire(e.sort((t,i)=>i.index-t.index));this.updateState(`Removed views:${e.map(t=>t.viewDescriptor.id).join(",")} from ${this.viewContainer.id}`)}}broadCastMovedViewDescriptors(e,t){this._onDidMoveVisibleViewDescriptors.fire({from:e,to:t});this.updateState(`Moved view ${e.viewDescriptor.id} to ${t.viewDescriptor.id} in ${this.viewContainer.id}`)}updateState(e){this.logger.value.info(e);this.viewDescriptorsState.updateState(this.allViewDescriptors);this.updateContainerInfo()}isViewDescriptorVisible(e){if(!e.state.active){return false}return this.isViewDescriptorVisibleWhenActive(e)}isViewDescriptorVisibleWhenActive(e){if(e.viewDescriptor.workspace){return!!e.state.visibleWorkspace}return!!e.state.visibleGlobal}find(e){const t=this.findAndIgnoreIfNotFound(e);if(t){return t}throw new Error(`view descriptor ${e} not found`)}findAndIgnoreIfNotFound(e){for(let t=0,i=0;t<this.viewDescriptorItems.length;t++){const s=this.viewDescriptorItems[t];if(s.viewDescriptor.id===e){return{index:t,visibleIndex:i,viewDescriptorItem:s}}if(this.isViewDescriptorVisible(s)){i++}}return void 0}compareViewDescriptors(e,t){if(e.viewDescriptor.id===t.viewDescriptor.id){return 0}return this.getViewOrder(e)-this.getViewOrder(t)||this.getGroupOrderResult(e.viewDescriptor,t.viewDescriptor)}getViewOrder(e){const t=typeof e.state.order==="number"?e.state.order:e.viewDescriptor.order;return typeof t==="number"?t:Number.MAX_VALUE}getGroupOrderResult(e,t){if(!e.group||!t.group){return 0}if(e.group===t.group){return 0}return e.group<t.group?-1:1}};nc=E([h(1,N),h(2,ee),h(3,Fl)],nc);var di;function tp(a){return`${a}.state`}let rc=class ZA extends k{static{di=this}static{this.VIEWS_CUSTOMIZATIONS="views.customizations"}static{this.COMMON_CONTAINER_ID_PREFIX="workbench.views.service"}get viewContainers(){return this.viewContainersRegistry.all}constructor(e,t,i,s,o,n){super();this.instantiationService=e;this.contextKeyService=t;this.storageService=i;this.extensionService=s;this.telemetryService=o;this._onDidChangeContainer=this._register(new _);this.onDidChangeContainer=this._onDidChangeContainer.event;this._onDidChangeLocation=this._register(new _);this.onDidChangeLocation=this._onDidChangeLocation.event;this._onDidChangeContainerLocation=this._register(new _);this.onDidChangeContainerLocation=this._onDidChangeContainerLocation.event;this.viewContainerModels=this._register(new mr);this.viewsVisibilityActionDisposables=this._register(new mr);this.canRegisterViewsVisibilityActions=false;this._onDidChangeViewContainers=this._register(new _);this.onDidChangeViewContainers=this._onDidChangeViewContainers.event;this.logger=new Ml(()=>n.createLogger(Ol,{name:Bl,group:Nl}));this.activeViewContextKeys=new Map;this.movableViewContextKeys=new Map;this.defaultViewLocationContextKeys=new Map;this.defaultViewContainerLocationContextKeys=new Map;this.viewContainersRegistry=W.as(it.ViewContainersRegistry);this.viewsRegistry=W.as(it.ViewsRegistry);this.migrateToViewsCustomizationsStorage();this.viewContainersCustomLocations=new Map(Object.entries(this.viewCustomizations.viewContainerLocations));this.viewDescriptorsCustomLocations=new Map(Object.entries(this.viewCustomizations.viewLocations));this.viewContainerBadgeEnablementStates=new Map(Object.entries(this.viewCustomizations.viewContainerBadgeEnablementStates));this.viewContainers.forEach(r=>this.onDidRegisterViewContainer(r));this._register(this.viewsRegistry.onViewsRegistered(r=>this.onDidRegisterViews(r)));this._register(this.viewsRegistry.onViewsDeregistered(({views:r,viewContainer:d})=>this.onDidDeregisterViews(r,d)));this._register(this.viewsRegistry.onDidChangeContainer(({views:r,from:d,to:l})=>this.onDidChangeDefaultContainer(r,d,l)));this._register(this.viewContainersRegistry.onDidRegister(({viewContainer:r})=>{this.onDidRegisterViewContainer(r);this._onDidChangeViewContainers.fire({added:[{container:r,location:this.getViewContainerLocation(r)}],removed:[]})}));this._register(this.viewContainersRegistry.onDidDeregister(({viewContainer:r,viewContainerLocation:d})=>{this.onDidDeregisterViewContainer(r);this._onDidChangeViewContainers.fire({removed:[{container:r,location:d}],added:[]})}));this._register(this.storageService.onDidChangeValue(M.PROFILE,di.VIEWS_CUSTOMIZATIONS,this._store)(()=>this.onDidStorageChange()));this.extensionService.whenInstalledExtensionsRegistered().then(()=>this.whenExtensionsRegistered())}migrateToViewsCustomizationsStorage(){if(this.storageService.get(di.VIEWS_CUSTOMIZATIONS,M.PROFILE)){return}const e=this.storageService.get("views.cachedViewContainerLocations",M.PROFILE);const t=this.storageService.get("views.cachedViewPositions",M.PROFILE);if(!e&&!t){return}const i=e?JSON.parse(e):[];const s=t?JSON.parse(t):[];const o={viewContainerLocations:i.reduce((n,[r,d])=>{n[r]=d;return n},{}),viewLocations:s.reduce((n,[r,{containerId:d}])=>{n[r]=d;return n},{}),viewContainerBadgeEnablementStates:{}};this.storageService.store(di.VIEWS_CUSTOMIZATIONS,JSON.stringify(o),M.PROFILE,Ee.USER);this.storageService.remove("views.cachedViewContainerLocations",M.PROFILE);this.storageService.remove("views.cachedViewPositions",M.PROFILE)}registerGroupedViews(e){for(const[t,i]of e.entries()){const s=this.viewContainersRegistry.get(t);if(!s||!this.viewContainerModels.has(s)){if(this.isGeneratedContainerId(t)){const n=this.viewContainersCustomLocations.get(t);if(n!==void 0){this.registerGeneratedViewContainer(n,t)}}continue}const o=i.filter(n=>this.getViewContainerModel(s).allViewDescriptors.filter(r=>r.id===n.id).length===0);this.addViews(s,o)}}deregisterGroupedViews(e){for(const[t,i]of e.entries()){const s=this.viewContainersRegistry.get(t);if(!s||!this.viewContainerModels.has(s)){continue}this.removeViews(s,i)}}moveOrphanViewsToDefaultLocation(){for(const[e,t]of this.viewDescriptorsCustomLocations.entries()){if(this.viewContainersRegistry.get(t)){continue}const i=this.viewsRegistry.getViewContainer(e);const s=this.getViewDescriptorById(e);if(i&&s){this.addViews(i,[s])}}}whenExtensionsRegistered(){this.moveOrphanViewsToDefaultLocation();for(const e of[...this.viewContainersCustomLocations.keys()]){this.cleanUpGeneratedViewContainer(e)}this.saveViewCustomizations();for(const[e,t]of this.viewContainerModels){this.registerViewsVisibilityActions(e,t)}this.canRegisterViewsVisibilityActions=true}onDidRegisterViews(e){this.contextKeyService.bufferChangeEvents(()=>{e.forEach(({views:t,viewContainer:i})=>{const s=this.regroupViews(i.id,t);this.registerGroupedViews(s);t.forEach(o=>this.getOrCreateMovableViewContextKey(o).set(!!o.canMoveView))})})}isGeneratedContainerId(e){return e.startsWith(di.COMMON_CONTAINER_ID_PREFIX)}onDidDeregisterViews(e,t){const i=this.regroupViews(t.id,e);this.deregisterGroupedViews(i);this.contextKeyService.bufferChangeEvents(()=>{e.forEach(s=>this.getOrCreateMovableViewContextKey(s).set(false))})}regroupViews(e,t){const i=new Map;for(const s of t){const o=this.viewDescriptorsCustomLocations.get(s.id)??e;let n=i.get(o);if(!n){i.set(o,n=[])}n.push(s)}return i}getViewDescriptorById(e){return this.viewsRegistry.getView(e)}getViewLocationById(e){const t=this.getViewContainerByViewId(e);if(t===null){return null}return this.getViewContainerLocation(t)}getViewContainerByViewId(e){const t=this.viewDescriptorsCustomLocations.get(e);return t?this.viewContainersRegistry.get(t)??null:this.getDefaultContainerById(e)}getViewContainerLocation(e){return this.viewContainersCustomLocations.get(e.id)??this.getDefaultViewContainerLocation(e)}getDefaultViewContainerLocation(e){return this.viewContainersRegistry.getViewContainerLocation(e)}getDefaultContainerById(e){return this.viewsRegistry.getViewContainer(e)??null}getViewContainerModel(e){return this.getOrRegisterViewContainerModel(e)}getViewContainerById(e){return this.viewContainersRegistry.get(e)||null}getViewContainersByLocation(e){return this.viewContainers.filter(t=>this.getViewContainerLocation(t)===e)}getDefaultViewContainer(e){return this.viewContainersRegistry.getDefaultViewContainer(e)}moveViewContainerToLocation(e,t,i,s){this.logger.value.info(`moveViewContainerToLocation: viewContainer:${e.id} location:${t} reason:${s}`);this.moveViewContainerToLocationWithoutSaving(e,t,i);this.saveViewCustomizations()}getViewContainerBadgeEnablementState(e){return this.viewContainerBadgeEnablementStates.get(e)??true}setViewContainerBadgeEnablementState(e,t){this.viewContainerBadgeEnablementStates.set(e,t);this.saveViewCustomizations()}moveViewToLocation(e,t,i){this.logger.value.info(`moveViewToLocation: view:${e.id} location:${t} reason:${i}`);const s=this.registerGeneratedViewContainer(t);this.moveViewsToContainer([e],s)}moveViewsToContainer(e,t,i,s){if(!e.length){return}this.logger.value.info(`moveViewsToContainer: views:${e.map(r=>r.id).join(",")} viewContainer:${t.id} reason:${s}`);const o=this.getViewContainerByViewId(e[0].id);const n=t;if(o&&n&&o!==n){this.moveViewsWithoutSaving(e,o,n,i);this.cleanUpGeneratedViewContainer(o.id);this.saveViewCustomizations();this.reportMovedViews(e,o,n)}}reset(){for(const e of this.viewContainers){const t=this.getViewContainerModel(e);for(const o of t.allViewDescriptors){const n=this.getDefaultContainerById(o.id);const r=this.getViewContainerByViewId(o.id);if(r&&n&&r!==n){this.moveViewsWithoutSaving([o],r,n)}}const i=this.getDefaultViewContainerLocation(e);const s=this.getViewContainerLocation(e);if(i!==null&&s!==i){this.moveViewContainerToLocationWithoutSaving(e,i)}this.cleanUpGeneratedViewContainer(e.id)}this.viewContainersCustomLocations.clear();this.viewDescriptorsCustomLocations.clear();this.saveViewCustomizations()}isViewContainerRemovedPermanently(e){return this.isGeneratedContainerId(e)&&!this.viewContainersCustomLocations.has(e)}onDidChangeDefaultContainer(e,t,i){const s=e.filter(o=>!this.viewDescriptorsCustomLocations.has(o.id)||!this.viewContainers.includes(t)&&this.viewDescriptorsCustomLocations.get(o.id)===t.id);if(s.length){this.moveViewsWithoutSaving(s,t,i)}}reportMovedViews(e,t,i){const s=f=>{if(f.id.startsWith(di.COMMON_CONTAINER_ID_PREFIX)){return"custom"}if(!f.extensionId){return f.id}return"extension"};const o=this.getViewContainerLocation(t);const n=this.getViewContainerLocation(i);const r=e.length;const d=s(t);const l=s(i);const u=o===$.Panel?"panel":"sidebar";const p=n===$.Panel?"panel":"sidebar";this.telemetryService.publicLog2("viewDescriptorService.moveViews",{viewCount:r,fromContainer:d,toContainer:l,fromLocation:u,toLocation:p})}moveViewsWithoutSaving(e,t,i,s=xo.Expand){this.removeViews(t,e);this.addViews(i,e,s);const o=this.getViewContainerLocation(t);const n=this.getViewContainerLocation(i);if(o!==n){this._onDidChangeLocation.fire({views:e,from:o,to:n})}this._onDidChangeContainer.fire({views:e,from:t,to:i})}moveViewContainerToLocationWithoutSaving(e,t,i){const s=this.getViewContainerLocation(e);const o=t;if(s!==o){const n=this.isGeneratedContainerId(e.id);const r=o===this.getDefaultViewContainerLocation(e);if(n||!r){this.viewContainersCustomLocations.set(e.id,o)}else{this.viewContainersCustomLocations.delete(e.id)}this.getOrCreateDefaultViewContainerLocationContextKey(e).set(n||r);e.requestedIndex=i;this._onDidChangeContainerLocation.fire({viewContainer:e,from:s,to:o});const d=this.getViewsByContainer(e);this._onDidChangeLocation.fire({views:d,from:s,to:o})}}cleanUpGeneratedViewContainer(e){if(!this.isGeneratedContainerId(e)){return}const t=this.getViewContainerById(e);if(t&&this.getViewContainerModel(t)?.allViewDescriptors.length){return}if([...this.viewDescriptorsCustomLocations.values()].includes(e)){return}if(t){this.viewContainersRegistry.deregisterViewContainer(t)}this.viewContainersCustomLocations.delete(e);this.viewContainerBadgeEnablementStates.delete(e);this.storageService.remove(cm(t?.storageId||tp(e)),M.PROFILE)}registerGeneratedViewContainer(e,t){const i=t||this.generateContainerId(e);const s=this.viewContainersRegistry.registerViewContainer({id:i,ctorDescriptor:new Q(Cn,[i,{mergeViewWithContainerWhenSingleView:true}]),title:{value:c(12897,"User View Container"),original:"User View Container"},icon:e===$.Sidebar?Zp:void 0,storageId:tp(i),hideIfEmpty:true},e,{doNotRegisterOpenCommand:true});if(this.viewContainersCustomLocations.get(s.id)!==e){this.viewContainersCustomLocations.set(s.id,e)}this.getOrCreateDefaultViewContainerLocationContextKey(s).set(true);return s}onDidStorageChange(){if(JSON.stringify(this.viewCustomizations)!==this.getStoredViewCustomizationsValue()){this.onDidViewCustomizationsStorageChange()}}onDidViewCustomizationsStorageChange(){this._viewCustomizations=void 0;const e=new Map(Object.entries(this.viewCustomizations.viewContainerLocations));const t=new Map(Object.entries(this.viewCustomizations.viewLocations));const i=[];const s=[];for(const[o,n]of e.entries()){const r=this.getViewContainerById(o);if(r){if(n!==this.getViewContainerLocation(r)){i.push([r,n])}}else if(this.isGeneratedContainerId(o)){this.registerGeneratedViewContainer(n,o)}}for(const o of this.viewContainers){if(!e.has(o.id)){const n=this.getViewContainerLocation(o);const r=this.getDefaultViewContainerLocation(o);if(n!==r){i.push([o,r])}}}for(const[o,n]of t.entries()){const r=this.getViewDescriptorById(o);if(r){const d=this.getViewContainerByViewId(o);const l=this.viewContainersRegistry.get(n);if(d&&l&&l!==d){s.push({views:[r],from:d,to:l})}}}for(const o of this.viewContainers){const n=this.getViewContainerModel(o);for(const r of n.allViewDescriptors){if(!t.has(r.id)){const d=this.getViewContainerByViewId(r.id);const l=this.getDefaultContainerById(r.id);if(d&&l&&d!==l){s.push({views:[r],from:d,to:l})}}}}for(const[o,n]of i){this.moveViewContainerToLocationWithoutSaving(o,n)}for(const{views:o,from:n,to:r}of s){this.moveViewsWithoutSaving(o,n,r,xo.Default)}this.viewContainersCustomLocations=e;this.viewDescriptorsCustomLocations=t}generateContainerId(e){return`${di.COMMON_CONTAINER_ID_PREFIX}.${ev(e)}.${yo()}`}saveViewCustomizations(){const e={viewContainerLocations:{},viewLocations:{},viewContainerBadgeEnablementStates:{}};for(const[t,i]of this.viewContainersCustomLocations){const s=this.getViewContainerById(t);if(s&&!this.isGeneratedContainerId(t)&&i===this.getDefaultViewContainerLocation(s)){continue}e.viewContainerLocations[t]=i}for(const[t,i]of this.viewDescriptorsCustomLocations){const s=this.getViewContainerById(i);if(s){const o=this.getDefaultContainerById(t);if(o?.id===s.id){continue}}e.viewLocations[t]=i}for(const[t,i]of this.viewContainerBadgeEnablementStates){if(i===false){e.viewContainerBadgeEnablementStates[t]=i}}this.viewCustomizations=e}get viewCustomizations(){if(!this._viewCustomizations){this._viewCustomizations=JSON.parse(this.getStoredViewCustomizationsValue());this._viewCustomizations.viewContainerLocations=this._viewCustomizations.viewContainerLocations??{};this._viewCustomizations.viewLocations=this._viewCustomizations.viewLocations??{};this._viewCustomizations.viewContainerBadgeEnablementStates=this._viewCustomizations.viewContainerBadgeEnablementStates??{}}return this._viewCustomizations}set viewCustomizations(e){const t=JSON.stringify(e);if(JSON.stringify(this.viewCustomizations)!==t){this._viewCustomizations=e;this.setStoredViewCustomizationsValue(t)}}getStoredViewCustomizationsValue(){return this.storageService.get(di.VIEWS_CUSTOMIZATIONS,M.PROFILE,"{}")}setStoredViewCustomizationsValue(e){this.storageService.store(di.VIEWS_CUSTOMIZATIONS,e,M.PROFILE,Ee.USER)}getViewsByContainer(e){const t=this.viewsRegistry.getViews(e).filter(i=>{const s=this.viewDescriptorsCustomLocations.get(i.id)??e.id;return s===e.id});for(const[i,s]of this.viewDescriptorsCustomLocations.entries()){if(s!==e.id){continue}if(this.viewsRegistry.getViewContainer(i)===e){continue}const o=this.getViewDescriptorById(i);if(o){t.push(o)}}return t}onDidRegisterViewContainer(e){const t=this.isGeneratedContainerId(e.id)?true:this.getViewContainerLocation(e)===this.getDefaultViewContainerLocation(e);this.getOrCreateDefaultViewContainerLocationContextKey(e).set(t);this.getOrRegisterViewContainerModel(e)}getOrRegisterViewContainerModel(e){let t=this.viewContainerModels.get(e)?.viewContainerModel;if(!t){const i=new L;t=i.add(this.instantiationService.createInstance(nc,e));this.onDidChangeActiveViews({added:t.activeViewDescriptors,removed:[]});t.onDidChangeActiveViewDescriptors(n=>this.onDidChangeActiveViews(n),this,i);this.onDidChangeVisibleViews({added:[...t.visibleViewDescriptors],removed:[]});t.onDidAddVisibleViewDescriptors(n=>this.onDidChangeVisibleViews({added:n.map(({viewDescriptor:r})=>r),removed:[]}),this,i);t.onDidRemoveVisibleViewDescriptors(n=>this.onDidChangeVisibleViews({added:[],removed:n.map(({viewDescriptor:r})=>r)}),this,i);i.add(de(()=>this.viewsVisibilityActionDisposables.deleteAndDispose(e)));i.add(this.registerResetViewContainerAction(e));const s={viewContainerModel:t,disposables:i,dispose:()=>i.dispose()};this.viewContainerModels.set(e,s);this.onDidRegisterViews([{views:this.viewsRegistry.getViews(e),viewContainer:e}]);const o=this.getViewsByContainer(e).filter(n=>this.getDefaultContainerById(n.id)!==e);if(o.length){this.addViews(e,o);this.contextKeyService.bufferChangeEvents(()=>{o.forEach(n=>this.getOrCreateMovableViewContextKey(n).set(!!n.canMoveView))})}if(this.canRegisterViewsVisibilityActions){this.registerViewsVisibilityActions(e,s)}}return t}onDidDeregisterViewContainer(e){this.viewContainerModels.deleteAndDispose(e);this.viewsVisibilityActionDisposables.deleteAndDispose(e)}onDidChangeActiveViews({added:e,removed:t}){this.contextKeyService.bufferChangeEvents(()=>{e.forEach(i=>this.getOrCreateActiveViewContextKey(i).set(true));t.forEach(i=>this.getOrCreateActiveViewContextKey(i).set(false))})}onDidChangeVisibleViews({added:e,removed:t}){this.contextKeyService.bufferChangeEvents(()=>{e.forEach(i=>this.getOrCreateVisibleViewContextKey(i).set(true));t.forEach(i=>this.getOrCreateVisibleViewContextKey(i).set(false))})}registerViewsVisibilityActions(e,{viewContainerModel:t,disposables:i}){this.viewsVisibilityActionDisposables.deleteAndDispose(e);this.viewsVisibilityActionDisposables.set(e,this.registerViewsVisibilityActionsForContainer(t));i.add(x.any(t.onDidChangeActiveViewDescriptors,t.onDidAddVisibleViewDescriptors,t.onDidRemoveVisibleViewDescriptors,t.onDidMoveVisibleViewDescriptors)(s=>{this.viewsVisibilityActionDisposables.deleteAndDispose(e);this.viewsVisibilityActionDisposables.set(e,this.registerViewsVisibilityActionsForContainer(t))}))}registerViewsVisibilityActionsForContainer(e){const t=new L;e.activeViewDescriptors.forEach((i,s)=>{if(!i.remoteAuthority){t.add(v(class extends Gh{constructor(){super({id:`${i.id}.toggleVisibility`,viewPaneContainerId:e.viewContainer.id,precondition:i.canToggleVisibility&&(!e.isVisible(i.id)||e.visibleViewDescriptors.length>1)?S.true():S.false(),toggled:S.has(`${i.id}.visible`),title:i.name,metadata:{description:I(12898,"Toggles the visibility of the {0} view if the view container it is located in is visible",i.name.value)},menu:[{id:Tl,when:S.equals("viewContainer",e.viewContainer.id),order:s},{id:w.ViewContainerTitleContext,when:S.equals("viewContainer",e.viewContainer.id),order:s,group:"1_toggleVisibility"},{id:w.ViewTitleContext,when:S.or(...e.visibleViewDescriptors.map(o=>S.equals("view",o.id))),order:s,group:"2_toggleVisibility"}]})}async runInViewPaneContainer(o,n){n.toggleViewVisibility(i.id)}}));t.add(v(class extends Gh{constructor(){super({id:`${i.id}.removeView`,viewPaneContainerId:e.viewContainer.id,title:c(12899,"Hide '{0}'",i.name.value),metadata:{description:I(12900,"Hides the {0} view if it is visible and the view container it is located in is visible",i.name.value)},precondition:i.canToggleVisibility&&(!e.isVisible(i.id)||e.visibleViewDescriptors.length>1)?S.true():S.false(),menu:[{id:w.ViewTitleContext,when:S.and(S.equals("view",i.id),S.has(`${i.id}.visible`)),group:"1_hide",order:1}]})}async runInViewPaneContainer(o,n){if(n.getView(i.id)?.isVisible()){n.toggleViewVisibility(i.id)}}}))}});return t}registerResetViewContainerAction(e){const t=this;return v(class JA extends j{constructor(){super({id:`${e.id}.resetViewContainerLocation`,title:I(12901,"Reset Location"),menu:[{id:w.ViewContainerTitleContext,group:"1_viewActions",when:S.or(S.and(S.equals("viewContainer",e.id),S.equals(`${e.id}.defaultViewContainerLocation`,false)))}]})}run(s){t.moveViewContainerToLocation(e,t.getDefaultViewContainerLocation(e),void 0,this.desc.id);s.get(st).openViewContainer(e.id,true)}})}addViews(e,t,i=xo.Default){this.contextKeyService.bufferChangeEvents(()=>{t.forEach(s=>{const o=this.getDefaultContainerById(s.id)===e;this.getOrCreateDefaultViewLocationContextKey(s).set(o);if(o){this.viewDescriptorsCustomLocations.delete(s.id)}else{this.viewDescriptorsCustomLocations.set(s.id,e.id)}})});this.getViewContainerModel(e).add(t.map(s=>{return{viewDescriptor:s,collapsed:i===xo.Default?void 0:false,visible:i===xo.Default?void 0:true}}))}removeViews(e,t){this.contextKeyService.bufferChangeEvents(()=>{t.forEach(i=>{if(this.viewDescriptorsCustomLocations.get(i.id)===e.id){this.viewDescriptorsCustomLocations.delete(i.id)}this.getOrCreateDefaultViewLocationContextKey(i).set(false)})});this.getViewContainerModel(e).remove(t)}getOrCreateActiveViewContextKey(e){const t=`${e.id}.active`;let i=this.activeViewContextKeys.get(t);if(!i){i=new U(t,false).bindTo(this.contextKeyService);this.activeViewContextKeys.set(t,i)}return i}getOrCreateVisibleViewContextKey(e){const t=`${e.id}.visible`;let i=this.activeViewContextKeys.get(t);if(!i){i=new U(t,false).bindTo(this.contextKeyService);this.activeViewContextKeys.set(t,i)}return i}getOrCreateMovableViewContextKey(e){const t=`${e.id}.canMove`;let i=this.movableViewContextKeys.get(t);if(!i){i=new U(t,false).bindTo(this.contextKeyService);this.movableViewContextKeys.set(t,i)}return i}getOrCreateDefaultViewLocationContextKey(e){const t=`${e.id}.defaultViewLocation`;let i=this.defaultViewLocationContextKeys.get(t);if(!i){i=new U(t,false).bindTo(this.contextKeyService);this.defaultViewLocationContextKeys.set(t,i)}return i}getOrCreateDefaultViewContainerLocationContextKey(e){const t=`${e.id}.defaultViewContainerLocation`;let i=this.defaultViewContainerLocationContextKeys.get(t);if(!i){i=new U(t,false).bindTo(this.contextKeyService);this.defaultViewContainerLocationContextKeys.set(t,i)}return i}};rc=di=E([h(0,N),h(1,ee),h(2,le),h(3,Kt),h(4,si),h(5,Fl)],rc);var xi;let ac=class XA extends k{static{xi=this}static{this.configureDefaultID="promptOpenWith.configureDefault"}static{this.cacheStorageID="editorOverrideService.cache"}static{this.conflictingDefaultsStorageID="editorOverrideService.conflictingDefaults"}constructor(e,t,i,s,o,n,r,d){super();this.editorGroupService=e;this.instantiationService=t;this.configurationService=i;this.quickInputService=s;this.notificationService=o;this.storageService=n;this.extensionService=r;this.logService=d;this._onDidChangeEditorRegistrations=this._register(new _d);this.onDidChangeEditorRegistrations=this._onDidChangeEditorRegistrations.event;this._editors=new Map;this._flattenedEditors=new Map;this._shouldReFlattenEditors=true;this.cache=new Set(JSON.parse(this.storageService.get(xi.cacheStorageID,M.PROFILE,JSON.stringify([]))));this.storageService.remove(xi.cacheStorageID,M.PROFILE);this._register(this.storageService.onWillSaveState(()=>{this.cacheEditors()}));this._register(this.extensionService.onDidRegisterExtensions(()=>{this.cache=void 0}))}resolveUntypedInputAndGroup(e,t){const i=e;const s=this.instantiationService.invokeFunction(Yf,i,t);if(s instanceof Promise){return s.then(([o,n])=>[i,o,n])}else{const[o,n]=s;return[i,o,n]}}async resolveEditor(e,t){this._flattenedEditors=this._flattenEditorsMap();if(Wh(e)){return this.doResolveSideBySideEditor(e,t)}let i;const s=this.resolveUntypedInputAndGroup(e,t);if(s instanceof Promise){i=await s}else{i=s}if(!i){return Lt.NONE}const[o,n,r]=i;if(r){o.options={...o.options,activation:r}}let d=vt.getCanonicalUri(o,{supportSideBySide:ui.PRIMARY});if(this.cache&&d&&this.resourceMatchesCache(d)){await this.extensionService.whenInstalledExtensionsRegistered()}if(d===void 0){d=K.from({scheme:fe.untitled})}else if(d.scheme===void 0||d===null){return Lt.NONE}if(o.options?.override===qa.PICK){const f=await this.doPickEditor(o);if(!f){return Lt.ABORT}o.options=f}let{editor:l,conflictingDefault:u}=this.getEditor(d,o.options?.override);if(!l&&(o.options?.override||tv(e))){return Lt.NONE}else if(!l){const f=this.getEditor(d,Ot.id);l=f?.editor;u=f?.conflictingDefault;if(!l){return Lt.NONE}}if(ja(o)&&o.options?.override===void 0){let f=vt.getCanonicalUri(o,{supportSideBySide:ui.SECONDARY});if(!f){f=K.from({scheme:fe.untitled})}const{editor:g}=this.getEditor(f,void 0);if(!g||l.editorInfo.id!==g.editorInfo.id){const{editor:m,conflictingDefault:y}=this.getEditor(d,Ot.id);l=m;u=y}if(!l){return Lt.NONE}}o.options={override:l.editorInfo.id,...o.options};if(l.editorFactoryObject.createDiffEditorInput===void 0&&ja(o)){return Lt.NONE}const p=await this.doResolveEditor(o,n,l);if(u&&p){await this.doHandleConflictingDefaults(d,l.editorInfo.label,o,p.editor,n)}if(p){if(p.editor.editorId!==l.editorInfo.id){this.logService.warn(`Editor ID Mismatch: ${p.editor.editorId} !== ${l.editorInfo.id}. This will cause bugs. Please ensure editorInput.editorId matches the registered id`)}return{...p,group:n}}return Lt.ABORT}async doResolveSideBySideEditor(e,t){const i=await this.resolveEditor(e.primary,t);if(!Hh(i)){return Lt.NONE}const s=await this.resolveEditor(e.secondary,i.group??t);if(!Hh(s)){return Lt.NONE}return{group:i.group??s.group,editor:this.instantiationService.createInstance(Sn,e.label,e.description,s.editor,i.editor),options:e.options}}bufferChangeEvents(e){this._onDidChangeEditorRegistrations.pause();try{e()}finally{this._onDidChangeEditorRegistrations.resume()}}registerEditor(e,t,i,s){let o=this._editors.get(e);if(o===void 0){o=new Map;this._editors.set(e,o)}let n=o.get(t.id);if(n===void 0){n=[]}const r=iv(n,{globPattern:e,editorInfo:t,options:i,editorFactoryObject:s});o.set(t.id,n);this._shouldReFlattenEditors=true;this._onDidChangeEditorRegistrations.fire();return de(()=>{r();if(n&&n.length===0){o?.delete(t.id)}this._shouldReFlattenEditors=true;this._onDidChangeEditorRegistrations.fire()})}getAssociationsForResource(e){const t=this.getAllUserAssociations();let i=t.filter(o=>o.filenamePattern&&ir(o.filenamePattern,e));i=i.sort((o,n)=>(n.filenamePattern?.length??0)-(o.filenamePattern?.length??0));const s=this._registeredEditors;return i.filter(o=>s.find(n=>n.editorInfo.id===o.viewType))}getAllUserAssociations(){const e=this.configurationService.inspect(Uh)||{};const t=e.defaultValue??{};const i=e.workspaceValue??{};const s=e.userValue??{};const o={...i};for(const[r,d]of Object.entries({...t,...s})){if(o[r]===void 0){o[r]=d}}const n=[];for(const[r,d]of Object.entries(o)){const l={filenamePattern:r,viewType:d};n.push(l)}return n}_flattenEditorsMap(){if(!this._shouldReFlattenEditors){return this._flattenedEditors}this._shouldReFlattenEditors=false;const e=new Map;for(const[t,i]of this._editors){const s=[];for(const o of i.values()){let n=void 0;for(const r of o){if(!n){n={editorInfo:r.editorInfo,globPattern:r.globPattern,options:{},editorFactoryObject:{}}}n.options={...n.options,...r.options};n.editorFactoryObject={...n.editorFactoryObject,...r.editorFactoryObject}}if(n){s.push(n)}}e.set(t,s)}return e}get _registeredEditors(){return Array.from(this._flattenedEditors.values()).flat()}updateUserAssociations(e,t){const i={viewType:t,filenamePattern:e};const s=this.getAllUserAssociations();const o=Object.create(null);for(const n of[...s,i]){if(n.filenamePattern){o[n.filenamePattern]=n.viewType}}this.configurationService.updateValue(Uh,o)}findMatchingEditors(e){const t=this.getAssociationsForResource(e);const i=[];for(const[s,o]of this._flattenedEditors){for(const n of o){const r=t.find(d=>d.viewType===n.editorInfo.id);if(r&&n.editorInfo.priority!==be.exclusive||ir(s,e)){i.push(n)}}}return i.sort((s,o)=>{if(Nt(o.editorInfo.priority)===Nt(s.editorInfo.priority)&&typeof o.globPattern==="string"&&typeof s.globPattern==="string"){return o.globPattern.length-s.globPattern.length}return Nt(o.editorInfo.priority)-Nt(s.editorInfo.priority)})}getEditors(e){this._flattenedEditors=this._flattenEditorsMap();if(K.isUri(e)){const t=this.findMatchingEditors(e);if(t.find(i=>i.editorInfo.priority===be.exclusive)){return[]}return t.map(i=>i.editorInfo)}return Qs(this._registeredEditors.map(t=>t.editorInfo),t=>t.id)}getEditor(e,t){const i=(u,p)=>{return u.find(f=>{if(f.options&&f.options.canSupportResource!==void 0){return f.editorInfo.id===p&&f.options.canSupportResource(e)}return f.editorInfo.id===p})};if(t&&t!==qa.EXCLUSIVE_ONLY){const u=this._registeredEditors;return{editor:i(u,t),conflictingDefault:false}}const s=this.findMatchingEditors(e);const o=this.getAssociationsForResource(e);const n=t===qa.EXCLUSIVE_ONLY?be.exclusive:be.builtin;let r=s.filter(u=>Nt(u.editorInfo.priority)>=Nt(n)&&u.editorInfo.id!==Ot.id);if(r.length===0){return{editor:o[0]&&n!==be.exclusive?i(s,o[0].viewType):void 0,conflictingDefault:false}}const d=r[0].editorInfo.priority===be.exclusive?r[0].editorInfo.id:o[0]?.viewType||r[0].editorInfo.id;let l=false;r=r.filter(u=>u.editorInfo.priority!==be.exclusive);if(o.length===0&&r.length>1){l=true}return{editor:i(s,d),conflictingDefault:l}}async doResolveEditor(e,t,i){let s=e.options;const o=vt.getCanonicalUri(e,{supportSideBySide:ui.PRIMARY});if(s&&typeof s.activation==="undefined"){s={...s,activation:s.preserveFocus?sv.RESTORE:void 0}}if(ov(e)){if(!i.editorFactoryObject.createMergeEditorInput){return}const l=await i.editorFactoryObject.createMergeEditorInput(e,t);return{editor:l.editor,options:l.options??s}}if(ja(e)){if(!i.editorFactoryObject.createDiffEditorInput){return}const l=await i.editorFactoryObject.createDiffEditorInput(e,t);return{editor:l.editor,options:l.options??s}}if(nv(e)){if(!i.editorFactoryObject.createMultiDiffEditorInput){return}const l=await i.editorFactoryObject.createMultiDiffEditorInput(e,t);return{editor:l.editor,options:l.options??s}}if(Wh(e)){throw new Error(`Untyped side by side editor input not supported here.`)}if(rv(e)){if(!i.editorFactoryObject.createUntitledEditorInput){return}const l=await i.editorFactoryObject.createUntitledEditorInput(e,t);return{editor:l.editor,options:l.options??s}}if(o===void 0){throw new Error(`Undefined resource on non untitled editor input.`)}const n=typeof i.options?.singlePerResource==="function"?i.options.singlePerResource():i.options?.singlePerResource;if(n){const l=this.findExistingEditorsForResource(o,i.editorInfo.id);if(l.length){const u=await this.moveExistingEditorForResource(l,t);if(u){return{editor:u,options:s}}else{return}}}if(!i.editorFactoryObject.createEditorInput){return}const r=await i.editorFactoryObject.createEditorInput(e,t);s=r.options??s;const d=r.editor;return{editor:d,options:s}}async moveExistingEditorForResource(e,t){const i=e[0];for(const{editor:s,group:o}of e){if(s!==i.editor){const n=await o.closeEditor(s);if(!n){return}}}if(t.id!==i.group.id){const s=i.group.moveEditor(i.editor,t);if(!s){return}}return i.editor}findExistingEditorsForResource(e,t){const i=[];const s=Qs([...this.editorGroupService.groups]);for(const o of s){for(const n of o.editors){if(vi(n.resource,e)&&n.editorId===t){i.push({editor:n,group:o})}}}return i}async doHandleConflictingDefaults(e,t,i,s,o){const n=this.findMatchingEditors(e);const r=JSON.parse(this.storageService.get(xi.conflictingDefaultsStorageID,M.PROFILE,"{}"));const d=`*${hi(e)}`;const l=()=>{r[d]=[];n.forEach(f=>r[d].push(f.editorInfo.id));this.storageService.store(xi.conflictingDefaultsStorageID,JSON.stringify(r),M.PROFILE,Ee.MACHINE)};if(r[d]&&r[d].find(f=>f===s.editorId)){return}const u=this.notificationService.prompt(ve.Warning,c(12182,"There are multiple default editors available for the resource."),[{label:c(12183,"Configure Default"),run:async()=>{const f=await this.doPickEditor(i,true);if(!f){return}i.options=f;const g=await this.resolveEditor(i,o);if(g===Lt.ABORT||g===Lt.NONE){return}o.replaceEditors([{editor:s,replacement:g.editor,options:g.options??f}])}},{label:c(12184,"Keep {0}",t),run:l}]);const p=u.onDidClose(()=>{l();p.dispose()})}mapEditorsToQuickPickEntry(e,t){const i=this.editorGroupService.activeGroup.findEditors(e).at(0);let s=e.scheme===fe.untitled?this._registeredEditors.filter(p=>p.editorInfo.priority!==be.exclusive):this.findMatchingEditors(e);s=Qs(s,p=>p.editorInfo.id);const o=this.getAssociationsForResource(e)[0]?.viewType;s=s.sort((p,f)=>{if(p.editorInfo.id===Ot.id){return-1}else if(f.editorInfo.id===Ot.id){return 1}else{return Nt(f.editorInfo.priority)-Nt(p.editorInfo.priority)}});const n=[];const r=c(12185,"Active");const d=c(12186,"Default");const l=c(12187,"Active and Default");let u=o;if(!u&&s.length>2&&s[1]?.editorInfo.priority!==be.option){u=s[1]?.editorInfo.id}if(!u){u=Ot.id}s.forEach(p=>{const f=i?.editorId??Ot.id;const g=i?p.editorInfo.id===f:false;const m=p.editorInfo.id===u;const y={id:p.editorInfo.id,label:p.editorInfo.label,description:g&&m?l:g?r:m?d:void 0,detail:p.editorInfo.detail??p.editorInfo.priority};n.push(y)});if(!t&&hi(e)!==""){const p={type:"separator"};n.push(p);const f={id:xi.configureDefaultID,label:c(12188,"Configure default editor for '{0}'...",`*${hi(e)}`)};n.push(f)}return n}async doPickEditor(e,t){let i=vt.getOriginalUri(e,{supportSideBySide:ui.PRIMARY});if(i===void 0){i=K.from({scheme:fe.untitled})}const s=this.mapEditorsToQuickPickEntry(i,t);const o=new L;const n=o.add(this.quickInputService.createQuickPick({useSeparators:true}));const r=t?c(12189,"Select new default editor for '{0}'",`*${hi(i)}`):c(12190,"Select editor for '{0}'",Oi(i));n.placeholder=r;n.canAcceptInBackground=true;n.items=s;const d=n.items.find(u=>u.type==="item");if(d){n.selectedItems=[d]}const l=await new Promise(u=>{o.add(n.onDidAccept(p=>{let f=void 0;if(n.selectedItems.length===1){f={item:n.selectedItems[0],keyMods:n.keyMods,openInBackground:p.inBackground}}if(i&&t&&f?.item.id){this.updateUserAssociations(`*${hi(i)}`,f.item.id)}u(f)}));o.add(n.onDidHide(()=>{o.dispose();u(void 0)}));o.add(n.onDidTriggerItemButton(p=>{u({item:p.item,openInBackground:false});if(i&&p.item&&p.item.id){this.updateUserAssociations(`*${hi(i)}`,p.item.id)}}));n.show()});n.dispose();if(l){if(l.item.id===xi.configureDefaultID){return this.doPickEditor(e,true)}const u={...e.options,override:l.item.id,preserveFocus:l.openInBackground||e.options?.preserveFocus};return u}return void 0}cacheEditors(){const e=new Set;for(const[i,s]of this._flattenedEditors){const o=!!s.find(n=>n.editorInfo.priority!==be.option&&n.editorInfo.id!==Ot.id);if(!o){continue}if(av(i)){e.add(`${i.pattern}`)}else{e.add(i)}}const t=this.getAllUserAssociations();for(const i of t){if(i.filenamePattern){e.add(i.filenamePattern)}}this.storageService.store(xi.cacheStorageID,JSON.stringify(Array.from(e)),M.PROFILE,Ee.MACHINE)}resourceMatchesCache(e){if(!this.cache){return false}for(const t of this.cache){if(ir(t,e)){return true}}return false}};ac=xi=E([h(0,qe),h(1,N),h(2,X),h(3,kt),h(4,Qe),h(5,le),h(6,Kt),h(7,et)],ac);var dc;let cc=class QA extends k{static{dc=this}static{this.UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX=/Untitled-\d+/}constructor(e,t){super();this.instantiationService=e;this.configurationService=t;this._onDidSave=this._register(new _);this.onDidSave=this._onDidSave.event;this._onDidChangeDirty=this._register(new _);this.onDidChangeDirty=this._onDidChangeDirty.event;this._onDidChangeEncoding=this._register(new _);this.onDidChangeEncoding=this._onDidChangeEncoding.event;this._onDidCreate=this._register(new _);this.onDidCreate=this._onDidCreate.event;this._onWillDispose=this._register(new _);this.onWillDispose=this._onWillDispose.event;this._onDidChangeLabel=this._register(new _);this.onDidChangeLabel=this._onDidChangeLabel.event;this.mapResourceToModel=new Ts}get(e){return this.mapResourceToModel.get(e)}getValue(e){return this.get(e)?.textEditorModel?.getValue()}async resolve(e){const t=this.doCreateOrGet(e);await t.resolve();return t}create(e){return this.doCreateOrGet(e)}doCreateOrGet(e=Object.create(null)){const t=this.massageOptions(e);if(t.untitledResource&&this.mapResourceToModel.has(t.untitledResource)){return this.mapResourceToModel.get(t.untitledResource)}return this.doCreate(t)}massageOptions(e){const t=Object.create(null);if(e.associatedResource){t.untitledResource=K.from({scheme:fe.untitled,authority:e.associatedResource.authority,fragment:e.associatedResource.fragment,path:e.associatedResource.path,query:e.associatedResource.query});t.associatedResource=e.associatedResource}else{if(e.untitledResource?.scheme===fe.untitled){t.untitledResource=e.untitledResource}}if(e.languageId){t.languageId=e.languageId}else if(!t.associatedResource){const i=this.configurationService.getValue();if(i.files?.defaultLanguage){t.languageId=i.files.defaultLanguage}}t.encoding=e.encoding;t.initialValue=e.initialValue;return t}doCreate(e){let t=e.untitledResource;if(!t){let s=1;do{t=K.from({scheme:fe.untitled,path:`Untitled-${s}`});s++}while(this.mapResourceToModel.has(t))}const i=this._register(this.instantiationService.createInstance(dv,t,!!e.associatedResource,e.initialValue,e.languageId,e.encoding));this.registerModel(i);return i}registerModel(e){const t=new L;t.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire(e)));t.add(e.onDidChangeName(()=>this._onDidChangeLabel.fire(e)));t.add(e.onDidChangeEncoding(()=>this._onDidChangeEncoding.fire(e)));t.add(e.onWillDispose(()=>this._onWillDispose.fire(e)));x.once(e.onWillDispose)(()=>{this.mapResourceToModel.delete(e.resource);t.dispose()});this.mapResourceToModel.set(e.resource,e);this._onDidCreate.fire(e);if(e.isDirty()){this._onDidChangeDirty.fire(e)}}isUntitledWithAssociatedResource(e){return e.scheme===fe.untitled&&e.path.length>1&&!dc.UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX.test(e.path)}canDispose(e){if(e.isDisposed()){return true}return this.doCanDispose(e)}async doCanDispose(e){if(e.isDirty()){await x.toPromise(e.onDidChangeDirty);return this.canDispose(e)}return true}notifyDidSave(e,t){this._onDidSave.fire({source:e,target:t})}};cc=dc=E([h(0,N),h(1,X)],cc);var ci;var lc;let xr=class ex extends k{static{ci=this}static{this.MOUSE_NAVIGATION_SETTING="workbench.editor.mouseBackForwardToNavigate"}static{this.NAVIGATION_SCOPE_SETTING="workbench.editor.navigationScope"}constructor(e,t,i,s,o,n,r,d,l,u,p){super();this.editorService=e;this.editorGroupService=t;this.contextService=i;this.storageService=s;this.configurationService=o;this.fileService=n;this.workspacesService=r;this.instantiationService=d;this.layoutService=l;this.contextKeyService=u;this.logService=p;this.activeEditorListeners=this._register(new L);this.lastActiveEditor=void 0;this._onDidChangeEditorNavigationStack=this._register(new _);this.onDidChangeEditorNavigationStack=this._onDidChangeEditorNavigationStack.event;this.defaultScopedEditorNavigationStack=void 0;this.editorGroupScopedNavigationStacks=new Map;this.editorScopedNavigationStacks=new Map;this.editorNavigationScope=ht.DEFAULT;this.recentlyUsedEditorsStack=void 0;this.recentlyUsedEditorsStackIndex=0;this.recentlyUsedEditorsInGroupStack=void 0;this.recentlyUsedEditorsInGroupStackIndex=0;this.navigatingInRecentlyUsedEditorsStack=false;this.navigatingInRecentlyUsedEditorsInGroupStack=false;this.recentlyClosedEditors=[];this.ignoreEditorCloseEvent=false;this.history=void 0;this.editorHistoryListeners=new Map;this.resourceExcludeMatcher=this._register(new cv(ae,()=>{const f=this._register(this.instantiationService.createInstance(lv,g=>hv(g?this.configurationService.getValue({resource:g}):this.configurationService.getValue())||Object.create(null),g=>g.affectsConfiguration(uv)||g.affectsConfiguration(pv)));this._register(f.onExpressionChange(()=>this.removeExcludedFromHistory()));return f}));this.editorHelper=this.instantiationService.createInstance(Rr);this.canNavigateBackContextKey=new U("canNavigateBack",false,c(12399,"Whether it is possible to navigate back in editor history")).bindTo(this.contextKeyService);this.canNavigateForwardContextKey=new U("canNavigateForward",false,c(12400,"Whether it is possible to navigate forward in editor history")).bindTo(this.contextKeyService);this.canNavigateBackInNavigationsContextKey=new U("canNavigateBackInNavigationLocations",false,c(12401,"Whether it is possible to navigate back in editor navigation locations history")).bindTo(this.contextKeyService);this.canNavigateForwardInNavigationsContextKey=new U("canNavigateForwardInNavigationLocations",false,c(12402,"Whether it is possible to navigate forward in editor navigation locations history")).bindTo(this.contextKeyService);this.canNavigateToLastNavigationLocationContextKey=new U("canNavigateToLastNavigationLocation",false,c(12403,"Whether it is possible to navigate to the last editor navigation location")).bindTo(this.contextKeyService);this.canNavigateBackInEditsContextKey=new U("canNavigateBackInEditLocations",false,c(12404,"Whether it is possible to navigate back in editor edit locations history")).bindTo(this.contextKeyService);this.canNavigateForwardInEditsContextKey=new U("canNavigateForwardInEditLocations",false,c(12405,"Whether it is possible to navigate forward in editor edit locations history")).bindTo(this.contextKeyService);this.canNavigateToLastEditLocationContextKey=new U("canNavigateToLastEditLocation",false,c(12406,"Whether it is possible to navigate to the last editor edit location")).bindTo(this.contextKeyService);this.canReopenClosedEditorContextKey=new U("canReopenClosedEditor",false,c(12407,"Whether it is possible to reopen the last closed editor")).bindTo(this.contextKeyService);this.registerListeners();if(this.editorService.activeEditorPane){this.onDidActiveEditorChange()}}registerListeners(){this.registerMouseNavigationListener();this._register(this.editorService.onDidActiveEditorChange(()=>this.onDidActiveEditorChange()));this._register(this.editorService.onDidOpenEditorFail(e=>this.remove(e.editor)));this._register(this.editorService.onDidCloseEditor(e=>this.onDidCloseEditor(e)));this._register(this.editorService.onDidMostRecentlyActiveEditorsChange(()=>this.handleEditorEventInRecentEditorsStack()));this._register(this.editorGroupService.onDidRemoveGroup(e=>this.onDidRemoveGroup(e)));this._register(this.fileService.onDidFilesChange(e=>this.onDidFilesChange(e)));this._register(this.fileService.onDidRunOperation(e=>this.onDidFilesChange(e)));this._register(this.storageService.onWillSaveState(()=>this.saveState()));this.registerEditorNavigationScopeChangeListener();this._register(this.onDidChangeEditorNavigationStack(()=>this.updateContextKeys()));this._register(this.editorGroupService.onDidChangeActiveGroup(()=>this.updateContextKeys()))}onDidCloseEditor(e){this.handleEditorCloseEventInHistory(e);this.handleEditorCloseEventInReopen(e)}registerMouseNavigationListener(){const e=this._register(new L);const t=()=>{e.clear();if(this.configurationService.getValue(ci.MOUSE_NAVIGATION_SETTING)){this._register(x.runAndSubscribe(this.layoutService.onDidAddContainer,({container:i,disposables:s})=>{const o=s.add(new L);o.add(J(i,se.MOUSE_DOWN,n=>this.onMouseDownOrUp(n,true)));o.add(J(i,se.MOUSE_UP,n=>this.onMouseDownOrUp(n,false)));e.add(o)},{container:this.layoutService.mainContainer,disposables:this._store}))}};this._register(this.configurationService.onDidChangeConfiguration(i=>{if(i.affectsConfiguration(ci.MOUSE_NAVIGATION_SETTING)){t()}}));t()}onMouseDownOrUp(e,t){switch(e.button){case 3:Ve.stop(e);if(t){this.goBack()}break;case 4:Ve.stop(e);if(t){this.goForward()}break}}onDidRemoveGroup(e){this.handleEditorGroupRemoveInNavigationStacks(e)}onDidActiveEditorChange(){const e=this.editorGroupService.activeGroup;const t=e.activeEditorPane;if(this.lastActiveEditor&&this.editorHelper.matchesEditorIdentifier(this.lastActiveEditor,t)){return}this.lastActiveEditor=t?.input?{editor:t.input,groupId:t.group.id}:void 0;this.activeEditorListeners.clear();if(!t?.group.isTransient(t.input)){this.handleActiveEditorChange(e,t)}else{this.logService.trace(`[History]: ignoring transient editor change until becoming non-transient (editor: ${t.input?.resource?.toString()}})`);const i=e.onDidModelChange(s=>{if(s.kind===tr.EDITOR_TRANSIENT&&s.editor===t.input&&!t.group.isTransient(t.input)){i.dispose();this.handleActiveEditorChange(e,t)}});this.activeEditorListeners.add(i)}if(Dd(t)){this.activeEditorListeners.add(t.onDidChangeSelection(i=>{if(!t.group.isTransient(t.input)){this.handleActiveEditorSelectionChangeEvent(e,t,i)}else{this.logService.trace(`[History]: ignoring transient editor selection change (editor: ${t.input?.resource?.toString()}})`)}}))}this.updateContextKeys()}onDidFilesChange(e){if(e instanceof Wo){if(e.gotDeleted()){this.remove(e)}}else{if(e.isOperation(Ho.DELETE)){this.remove(e)}else if(e.isOperation(Ho.MOVE)&&e.target.isFile){this.move(e)}}}handleActiveEditorChange(e,t){this.handleActiveEditorChangeInHistory(t);this.handleActiveEditorChangeInNavigationStacks(e,t)}handleActiveEditorSelectionChangeEvent(e,t,i){this.handleActiveEditorSelectionChangeInNavigationStacks(e,t,i)}move(e){this.moveInHistory(e);this.moveInEditorNavigationStacks(e)}remove(e){this.removeFromHistory(e);this.removeFromEditorNavigationStacks(e);this.removeFromRecentlyClosedEditors(e);this.removeFromRecentlyOpened(e)}removeFromRecentlyOpened(e){let t=void 0;if(ze(e)){t=vt.getOriginalUri(e)}else if(e instanceof Wo);else{t=e.resource}if(t){this.workspacesService.removeRecentlyOpened([t])}}clear(){this.clearRecentlyOpened();this.clearEditorNavigationStacks();this.recentlyClosedEditors=[];this.updateContextKeys()}updateContextKeys(){this.contextKeyService.bufferChangeEvents(()=>{const e=this.getStack();this.canNavigateBackContextKey.set(e.canGoBack(Ge.NONE));this.canNavigateForwardContextKey.set(e.canGoForward(Ge.NONE));this.canNavigateBackInNavigationsContextKey.set(e.canGoBack(Ge.NAVIGATION));this.canNavigateForwardInNavigationsContextKey.set(e.canGoForward(Ge.NAVIGATION));this.canNavigateToLastNavigationLocationContextKey.set(e.canGoLast(Ge.NAVIGATION));this.canNavigateBackInEditsContextKey.set(e.canGoBack(Ge.EDITS));this.canNavigateForwardInEditsContextKey.set(e.canGoForward(Ge.EDITS));this.canNavigateToLastEditLocationContextKey.set(e.canGoLast(Ge.EDITS));this.canReopenClosedEditorContextKey.set(this.recentlyClosedEditors.length>0)})}registerEditorNavigationScopeChangeListener(){const e=()=>{this.disposeEditorNavigationStacks();const t=this.configurationService.getValue(ci.NAVIGATION_SCOPE_SETTING);if(t==="editorGroup"){this.editorNavigationScope=ht.EDITOR_GROUP}else if(t==="editor"){this.editorNavigationScope=ht.EDITOR}else{this.editorNavigationScope=ht.DEFAULT}};this._register(this.configurationService.onDidChangeConfiguration(t=>{if(t.affectsConfiguration(ci.NAVIGATION_SCOPE_SETTING)){e()}}));e()}getStack(e=this.editorGroupService.activeGroup,t=e.activeEditor){switch(this.editorNavigationScope){case ht.EDITOR:{if(!t){return new rI}let i=this.editorScopedNavigationStacks.get(e.id);if(!i){i=new Map;this.editorScopedNavigationStacks.set(e.id,i)}let s=i.get(t)?.stack;if(!s){const o=new L;s=o.add(this.instantiationService.createInstance(Yo,ht.EDITOR));o.add(s.onDidChange(()=>this._onDidChangeEditorNavigationStack.fire()));i.set(t,{stack:s,disposable:o})}return s}case ht.EDITOR_GROUP:{let i=this.editorGroupScopedNavigationStacks.get(e.id)?.stack;if(!i){const s=new L;i=s.add(this.instantiationService.createInstance(Yo,ht.EDITOR_GROUP));s.add(i.onDidChange(()=>this._onDidChangeEditorNavigationStack.fire()));this.editorGroupScopedNavigationStacks.set(e.id,{stack:i,disposable:s})}return i}case ht.DEFAULT:{if(!this.defaultScopedEditorNavigationStack){this.defaultScopedEditorNavigationStack=this._register(this.instantiationService.createInstance(Yo,ht.DEFAULT));this._register(this.defaultScopedEditorNavigationStack.onDidChange(()=>this._onDidChangeEditorNavigationStack.fire()))}return this.defaultScopedEditorNavigationStack}}}goForward(e){return this.getStack().goForward(e)}goBack(e){return this.getStack().goBack(e)}goPrevious(e){return this.getStack().goPrevious(e)}goLast(e){return this.getStack().goLast(e)}handleActiveEditorChangeInNavigationStacks(e,t){this.getStack(e,t?.input).handleActiveEditorChange(t)}handleActiveEditorSelectionChangeInNavigationStacks(e,t,i){this.getStack(e,t.input).handleActiveEditorSelectionChange(t,i)}handleEditorCloseEventInHistory(e){const t=this.editorScopedNavigationStacks.get(e.groupId);if(t){const i=t.get(e.editor);if(i){i.disposable.dispose();t.delete(e.editor)}if(t.size===0){this.editorScopedNavigationStacks.delete(e.groupId)}}}handleEditorGroupRemoveInNavigationStacks(e){this.defaultScopedEditorNavigationStack?.remove(e.id);const t=this.editorGroupScopedNavigationStacks.get(e.id);if(t){t.disposable.dispose();this.editorGroupScopedNavigationStacks.delete(e.id)}}clearEditorNavigationStacks(){this.withEachEditorNavigationStack(e=>e.clear())}removeFromEditorNavigationStacks(e){this.withEachEditorNavigationStack(t=>t.remove(e))}moveInEditorNavigationStacks(e){this.withEachEditorNavigationStack(t=>t.move(e))}withEachEditorNavigationStack(e){if(this.defaultScopedEditorNavigationStack){e(this.defaultScopedEditorNavigationStack)}for(const[,t]of this.editorGroupScopedNavigationStacks){e(t.stack)}for(const[,t]of this.editorScopedNavigationStacks){for(const[,i]of t){e(i.stack)}}}disposeEditorNavigationStacks(){this.defaultScopedEditorNavigationStack?.dispose();this.defaultScopedEditorNavigationStack=void 0;for(const[,e]of this.editorGroupScopedNavigationStacks){e.disposable.dispose()}this.editorGroupScopedNavigationStacks.clear();for(const[,e]of this.editorScopedNavigationStacks){for(const[,t]of e){t.disposable.dispose()}}this.editorScopedNavigationStacks.clear()}openNextRecentlyUsedEditor(e){const[t,i]=this.ensureRecentlyUsedStack(s=>s-1,e);return this.doNavigateInRecentlyUsedEditorsStack(t[i],e)}openPreviouslyUsedEditor(e){const[t,i]=this.ensureRecentlyUsedStack(s=>s+1,e);return this.doNavigateInRecentlyUsedEditorsStack(t[i],e)}async doNavigateInRecentlyUsedEditorsStack(e,t){if(e){const i=typeof t!=="number"||!this.editorGroupService.getGroup(t);if(i){this.navigatingInRecentlyUsedEditorsStack=true}else{this.navigatingInRecentlyUsedEditorsInGroupStack=true}const s=this.editorGroupService.getGroup(e.groupId)??this.editorGroupService.activeGroup;try{await s.openEditor(e.editor)}finally{if(i){this.navigatingInRecentlyUsedEditorsStack=false}else{this.navigatingInRecentlyUsedEditorsInGroupStack=false}}}}ensureRecentlyUsedStack(e,t){let i;let s;const o=typeof t==="number"?this.editorGroupService.getGroup(t):void 0;if(!o){i=this.recentlyUsedEditorsStack||this.editorService.getEditors(Ya.MOST_RECENTLY_ACTIVE);s=this.recentlyUsedEditorsStackIndex}else{i=this.recentlyUsedEditorsInGroupStack||o.getEditors(Ya.MOST_RECENTLY_ACTIVE).map(r=>({groupId:o.id,editor:r}));s=this.recentlyUsedEditorsInGroupStackIndex}let n=e(s);if(n<0){n=0}else if(n>i.length-1){n=i.length-1}if(!o){this.recentlyUsedEditorsStack=i;this.recentlyUsedEditorsStackIndex=n}else{this.recentlyUsedEditorsInGroupStack=i;this.recentlyUsedEditorsInGroupStackIndex=n}return[i,n]}handleEditorEventInRecentEditorsStack(){if(!this.navigatingInRecentlyUsedEditorsStack){this.recentlyUsedEditorsStack=void 0;this.recentlyUsedEditorsStackIndex=0}if(!this.navigatingInRecentlyUsedEditorsInGroupStack){this.recentlyUsedEditorsInGroupStack=void 0;this.recentlyUsedEditorsInGroupStackIndex=0}}static{this.MAX_RECENTLY_CLOSED_EDITORS=20}handleEditorCloseEventInReopen(e){if(this.ignoreEditorCloseEvent){return}const{editor:t,context:i}=e;if(i===Kh.REPLACE||i===Kh.MOVE){return}const s=t.toUntyped();if(!s){return}const o=[];const n=vt.getOriginalUri(t,{supportSideBySide:ui.BOTH});if(K.isUri(n)){o.push(n)}else if(n){o.push(...ts([n.primary,n.secondary]))}this.removeFromRecentlyClosedEditors(t);this.recentlyClosedEditors.push({editorId:t.editorId,editor:s,resource:vt.getOriginalUri(t),associatedResources:o,index:e.index,sticky:e.sticky});if(this.recentlyClosedEditors.length>ci.MAX_RECENTLY_CLOSED_EDITORS){this.recentlyClosedEditors.shift()}this.canReopenClosedEditorContextKey.set(true)}async reopenLastClosedEditor(){const e=this.recentlyClosedEditors.pop();let t=void 0;if(e){t=this.doReopenLastClosedEditor(e)}this.canReopenClosedEditorContextKey.set(this.recentlyClosedEditors.length>0);return t}async doReopenLastClosedEditor(e){const t={pinned:true,sticky:e.sticky,index:e.index,ignoreError:true};if(e.sticky&&!this.editorGroupService.activeGroup.isSticky(e.index)||!e.sticky&&this.editorGroupService.activeGroup.isSticky(e.index)){t.index=void 0}let i=void 0;if(!this.editorGroupService.activeGroup.contains(e.editor)){this.ignoreEditorCloseEvent=true;try{i=await this.editorService.openEditor({...e.editor,options:{...e.editor.options,...t}})}finally{this.ignoreEditorCloseEvent=false}}if(!i){gv(this.recentlyClosedEditors,e);this.reopenLastClosedEditor()}}removeFromRecentlyClosedEditors(e){this.recentlyClosedEditors=this.recentlyClosedEditors.filter(t=>{if(ze(e)&&t.editorId!==e.editorId){return true}if(t.resource&&this.editorHelper.matchesFile(t.resource,e)){return false}if(t.associatedResources.some(i=>this.editorHelper.matchesFile(i,e))){return false}return true});this.canReopenClosedEditorContextKey.set(this.recentlyClosedEditors.length>0)}static{this.MAX_HISTORY_ITEMS=200}static{this.HISTORY_STORAGE_KEY="history.entries"}handleActiveEditorChangeInHistory(e){const t=e?.input;if(!t||t.isDisposed()||!this.includeInHistory(t)){return}this.removeFromHistory(t);this.addToHistory(t)}addToHistory(e,t=true){this.ensureHistoryLoaded(this.history);const i=this.editorHelper.preferResourceEditorInput(e);if(!i){return}if(t){this.history.unshift(i)}else{this.history.push(i)}if(this.history.length>ci.MAX_HISTORY_ITEMS){this.editorHelper.clearOnEditorDispose(this.history.pop(),this.editorHistoryListeners)}if(ze(e)){this.editorHelper.onEditorDispose(e,()=>this.updateHistoryOnEditorDispose(i),this.editorHistoryListeners)}}updateHistoryOnEditorDispose(e){if(ze(e)){if(!fv(e)){this.removeFromHistory(e)}else{const t=[];const i=e.primary.matches(e.secondary)?[e.primary]:[e.primary,e.secondary];for(const s of i){const o=this.editorHelper.preferResourceEditorInput(s);if(Td(o)&&this.includeInHistory(o)){t.push(o)}}this.replaceInHistory(e,...t)}}else{if(!this.includeInHistory(e)){this.removeFromHistory(e)}}}includeInHistory(e){if(ze(e)){return true}return!this.resourceExcludeMatcher.value.matches(e.resource)}removeExcludedFromHistory(){this.ensureHistoryLoaded(this.history);this.history=this.history.filter(e=>{const t=this.includeInHistory(e);if(!t){this.editorHelper.clearOnEditorDispose(e,this.editorHistoryListeners)}return t})}moveInHistory(e){if(e.isOperation(Ho.MOVE)){const t=this.removeFromHistory(e);if(t){this.addToHistory({resource:e.target.resource})}}}removeFromHistory(e){let t=false;this.ensureHistoryLoaded(this.history);this.history=this.history.filter(i=>{const s=this.editorHelper.matchesEditor(e,i);if(s){this.editorHelper.clearOnEditorDispose(e,this.editorHistoryListeners);t=true}return!s});return t}replaceInHistory(e,...t){this.ensureHistoryLoaded(this.history);let i=false;const s=[];for(const o of this.history){if(this.editorHelper.matchesEditor(e,o)){this.editorHelper.clearOnEditorDispose(e,this.editorHistoryListeners);if(!i){s.push(...t);i=true}}else if(!t.some(n=>this.editorHelper.matchesEditor(n,o))){s.push(o)}}if(!i){s.push(...t)}this.history=s}clearRecentlyOpened(){this.history=[];for(const[,e]of this.editorHistoryListeners){$e(e)}this.editorHistoryListeners.clear()}getHistory(){this.ensureHistoryLoaded(this.history);return this.history}ensureHistoryLoaded(e){if(!this.history){this.history=[];if(this.editorGroupService.isReady){this.loadHistory()}else{(async()=>{await this.editorGroupService.whenReady;this.loadHistory()})()}}}loadHistory(){this.history=[];const e=this.loadHistoryFromStorage();const t=[...this.editorService.getEditors(Ya.MOST_RECENTLY_ACTIVE)].reverse();const i=new Set;for(const{editor:s}of t){if(!this.includeInHistory(s)){continue}if(s.resource){const o=`${s.resource.toString()}/${s.editorId}`;if(i.has(o)){continue}i.add(o)}this.addToHistory(s)}for(const s of e){const o=`${s.resource.toString()}/${s.options?.override}`;if(!i.has(o)&&this.includeInHistory(s)){i.add(o);this.addToHistory(s,false)}}}loadHistoryFromStorage(){const e=[];const t=this.storageService.get(ci.HISTORY_STORAGE_KEY,M.WORKSPACE);if(t){try{const i=JSON.parse(t);for(const s of i){if(!s.editor||!s.editor.resource){continue}try{e.push({...s.editor,resource:typeof s.editor.resource==="string"?K.parse(s.editor.resource):K.from(s.editor.resource)})}catch(o){co(o)}}}catch(i){co(i)}}return e}saveState(){if(!this.history){return}const e=[];for(const t of this.history){if(ze(t)||!Td(t)){continue}e.push({editor:{...t,resource:t.resource.toString()}})}this.storageService.store(ci.HISTORY_STORAGE_KEY,JSON.stringify(e),M.WORKSPACE,Ee.MACHINE)}getLastActiveWorkspaceRoot(e,t){const i=this.contextService.getWorkspace().folders;if(i.length===0){return void 0}if(i.length===1){const s=i[0].uri;if((!e||s.scheme===e)&&(!t||s.authority===t)){return s}return void 0}for(const s of this.getHistory()){if(ze(s)){continue}if(e&&s.resource.scheme!==e){continue}if(t&&s.resource.authority!==t){continue}const o=this.contextService.getWorkspaceFolder(s.resource);if(o){return o.uri}}for(const s of i){const o=s.uri;if((!e||o.scheme===e)&&(!t||o.authority===t)){return o}}return void 0}getLastActiveFile(e,t){for(const i of this.getHistory()){let s;if(ze(i)){s=vt.getOriginalUri(i,{filterByScheme:e})}else{s=i.resource}if(s&&s.scheme===e&&(!t||s.authority===t)){return s}}return void 0}dispose(){super.dispose();for(const[,e]of this.editorGroupScopedNavigationStacks){e.disposable.dispose()}for(const[,e]of this.editorScopedNavigationStacks){for(const[,t]of e){t.disposable.dispose()}}for(const[,e]of this.editorHistoryListeners){e.dispose()}}};xr=ci=E([h(0,Y),h(1,qe),h(2,yn),h(3,le),h(4,X),h(5,je),h(6,mv),h(7,N),h(8,Te),h(9,ee),h(10,et)],xr);wv(Gl,xr,vv.Eager);class ip{constructor(e,t,i){this.editorIdentifier=e;this.selection=t;this.reason=i}justifiesNewNavigationEntry(e){if(this.editorIdentifier.groupId!==e.editorIdentifier.groupId){return true}if(!this.editorIdentifier.editor.matches(e.editorIdentifier.editor)){return true}if(!this.selection||!e.selection){return true}const t=this.selection.compare(e.selection);if(t===wr.SIMILAR&&(e.reason===Zt.NAVIGATION||e.reason===Zt.JUMP)){return true}return t===wr.DIFFERENT}}let Yo=class tx extends k{constructor(e,t){super();this.scope=e;this.instantiationService=t;this.selectionsStack=this._register(this.instantiationService.createInstance(Zo,Ge.NONE,this.scope));this.editsStack=this._register(this.instantiationService.createInstance(Zo,Ge.EDITS,this.scope));this.navigationsStack=this._register(this.instantiationService.createInstance(Zo,Ge.NAVIGATION,this.scope));this.stacks=[this.selectionsStack,this.editsStack,this.navigationsStack];this.onDidChange=x.any(this.selectionsStack.onDidChange,this.editsStack.onDidChange,this.navigationsStack.onDidChange)}canGoForward(e){return this.getStack(e).canGoForward()}goForward(e){return this.getStack(e).goForward()}canGoBack(e){return this.getStack(e).canGoBack()}goBack(e){return this.getStack(e).goBack()}goPrevious(e){return this.getStack(e).goPrevious()}canGoLast(e){return this.getStack(e).canGoLast()}goLast(e){return this.getStack(e).goLast()}getStack(e=Ge.NONE){switch(e){case Ge.NONE:return this.selectionsStack;case Ge.EDITS:return this.editsStack;case Ge.NAVIGATION:return this.navigationsStack}}handleActiveEditorChange(e){this.selectionsStack.notifyNavigation(e)}handleActiveEditorSelectionChange(e,t){const i=this.selectionsStack.current;this.selectionsStack.notifyNavigation(e,t);if(t.reason===Zt.EDIT){this.editsStack.notifyNavigation(e,t)}else if((t.reason===Zt.NAVIGATION||t.reason===Zt.JUMP)&&!this.selectionsStack.isNavigating()){if(t.reason===Zt.JUMP&&!this.navigationsStack.isNavigating()){if(i){this.navigationsStack.addOrReplace(i.groupId,i.editor,i.selection)}}this.navigationsStack.notifyNavigation(e,t)}}clear(){for(const e of this.stacks){e.clear()}}remove(e){for(const t of this.stacks){t.remove(e)}}move(e){for(const t of this.stacks){t.move(e)}}};Yo=E([h(1,N)],Yo);class rI{constructor(){this.onDidChange=x.None}canGoForward(){return false}async goForward(){}canGoBack(){return false}async goBack(){}async goPrevious(){}canGoLast(){return false}async goLast(){}handleActiveEditorChange(){}handleActiveEditorSelectionChange(){}clear(){}remove(){}move(){}dispose(){}}let Zo=class ix extends k{static{lc=this}static{this.MAX_STACK_SIZE=50}get current(){return this.stack[this.index]}set current(e){if(e){this.stack[this.index]=e}}constructor(e,t,i,s,o,n){super();this.filter=e;this.scope=t;this.editorService=s;this.editorGroupService=o;this.logService=n;this._onDidChange=this._register(new _);this.onDidChange=this._onDidChange.event;this.mapEditorToDisposable=new Map;this.mapGroupToDisposable=new Map;this.stack=[];this.index=-1;this.previousIndex=-1;this.navigating=false;this.currentSelectionState=void 0;this.editorHelper=i.createInstance(Rr);this.registerListeners()}registerListeners(){this._register(this.onDidChange(()=>this.traceStack()));this._register(this.logService.onDidChangeLogLevel(()=>this.traceStack()))}traceStack(){if(this.logService.getLevel()!==qh.Trace){return}const e=[];for(const t of this.stack){if(typeof t.selection?.log==="function"){e.push(`- group: ${t.groupId}, editor: ${t.editor.resource?.toString()}, selection: ${t.selection.log()}`)}else{e.push(`- group: ${t.groupId}, editor: ${t.editor.resource?.toString()}, selection: <none>`)}}if(e.length===0){this.trace(`index: ${this.index}, navigating: ${this.isNavigating()}: <empty>`)}else{this.trace(`index: ${this.index}, navigating: ${this.isNavigating()}
${e.join("\n")}
			`)}}trace(e,t=null,i){if(this.logService.getLevel()!==qh.Trace){return}let s;switch(this.filter){case Ge.NONE:s="global";break;case Ge.EDITS:s="edits";break;case Ge.NAVIGATION:s="navigation";break}let o;switch(this.scope){case ht.DEFAULT:o="default";break;case ht.EDITOR_GROUP:o="editorGroup";break;case ht.EDITOR:o="editor";break}if(t!==null){this.logService.trace(`[History stack ${s}-${o}]: ${e} (editor: ${t?.resource?.toString()}, event: ${this.traceEvent(i)})`)}else{this.logService.trace(`[History stack ${s}-${o}]: ${e}`)}}traceEvent(e){if(!e){return"<none>"}switch(e.reason){case Zt.EDIT:return"edit";case Zt.NAVIGATION:return"navigation";case Zt.JUMP:return"jump";case Zt.PROGRAMMATIC:return"programmatic";case Zt.USER:return"user"}}registerGroupListeners(e){if(!this.mapGroupToDisposable.has(e)){const t=this.editorGroupService.getGroup(e);if(t){this.mapGroupToDisposable.set(e,t.onWillMoveEditor(i=>this.onWillMoveEditor(i)))}}}onWillMoveEditor(e){this.trace("onWillMoveEditor()",e.editor);if(this.scope===ht.EDITOR_GROUP){return}for(const t of this.stack){if(t.groupId!==e.groupId){continue}if(!this.editorHelper.matchesEditor(e.editor,t.editor)){continue}t.groupId=e.target}}notifyNavigation(e,t){this.trace("notifyNavigation()",e?.input,t);const i=Dd(e);const s=e?.input&&!e.input.isDisposed();if(this.navigating){this.trace(`notifyNavigation() ignoring (navigating)`,e?.input,t);if(i&&s){this.trace("notifyNavigation() updating current selection state",e?.input,t);this.currentSelectionState=new ip({groupId:e.group.id,editor:e.input},e.getSelection(),t?.reason)}else{this.trace("notifyNavigation() dropping current selection state",e?.input,t);this.currentSelectionState=void 0}}else{this.trace(`notifyNavigation() not ignoring`,e?.input,t);if(i&&s){this.onSelectionAwareEditorNavigation(e.group.id,e.input,e.getSelection(),t)}else{this.currentSelectionState=void 0;if(s){this.onNonSelectionAwareEditorNavigation(e.group.id,e.input)}}}}onSelectionAwareEditorNavigation(e,t,i,s){if(this.current?.groupId===e&&!i&&this.editorHelper.matchesEditor(this.current.editor,t)){return}this.trace("onSelectionAwareEditorNavigation()",t,s);const o=new ip({groupId:e,editor:t},i,s?.reason);if(!this.currentSelectionState||this.currentSelectionState.justifiesNewNavigationEntry(o)){this.doAdd(e,t,o.selection)}else{this.doReplace(e,t,o.selection)}this.currentSelectionState=o}onNonSelectionAwareEditorNavigation(e,t){if(this.current?.groupId===e&&this.editorHelper.matchesEditor(this.current.editor,t)){return}this.trace("onNonSelectionAwareEditorNavigation()",t);this.doAdd(e,t)}doAdd(e,t,i){if(!this.navigating){this.addOrReplace(e,t,i)}}doReplace(e,t,i){if(!this.navigating){this.addOrReplace(e,t,i,true)}}addOrReplace(e,t,i,s){this.registerGroupListeners(e);let o=false;if(this.current){if(s){o=true}else if(this.shouldReplaceStackEntry(this.current,{groupId:e,editor:t,selection:i})){o=true}}const n=this.editorHelper.preferResourceEditorInput(t);if(!n){return}if(o){this.trace("replace()",n)}else{this.trace("add()",n)}const r={groupId:e,editor:n,selection:i};const d=[];if(o){if(this.current){d.push(this.current)}this.current=r}else{if(this.stack.length>this.index+1){for(let l=this.index+1;l<this.stack.length;l++){d.push(this.stack[l])}this.stack=this.stack.slice(0,this.index+1)}this.stack.splice(this.index+1,0,r);if(this.stack.length>lc.MAX_STACK_SIZE){d.push(this.stack.shift());if(this.previousIndex>=0){this.previousIndex--}}else{this.setIndex(this.index+1,true)}}for(const l of d){this.editorHelper.clearOnEditorDispose(l.editor,this.mapEditorToDisposable)}if(ze(n)){this.editorHelper.onEditorDispose(n,()=>this.remove(n),this.mapEditorToDisposable)}this._onDidChange.fire()}shouldReplaceStackEntry(e,t){if(e.groupId!==t.groupId){return false}if(!this.editorHelper.matchesEditor(e.editor,t.editor)){return false}if(!e.selection){return true}if(!t.selection){return false}return e.selection.compare(t.selection)===wr.IDENTICAL}move(e){if(e.isOperation(Ho.MOVE)){for(const t of this.stack){if(this.editorHelper.matchesEditor(e,t.editor)){t.editor={resource:e.target.resource}}}}}remove(e){const t=this.stack.length;this.stack=this.stack.filter(i=>{const s=typeof e==="number"?i.groupId===e:this.editorHelper.matchesEditor(e,i.editor);if(s){this.editorHelper.clearOnEditorDispose(i.editor,this.mapEditorToDisposable)}return!s});if(t===this.stack.length){return}this.flatten();this.index=this.stack.length-1;this.previousIndex=-1;if(typeof e==="number"){this.mapGroupToDisposable.get(e)?.dispose();this.mapGroupToDisposable.delete(e)}this._onDidChange.fire()}flatten(){const e=[];let t=void 0;for(const i of this.stack){if(t&&this.shouldReplaceStackEntry(i,t)){continue}t=i;e.push(i)}this.stack=e}clear(){this.index=-1;this.previousIndex=-1;this.stack.splice(0);for(const[,e]of this.mapEditorToDisposable){$e(e)}this.mapEditorToDisposable.clear();for(const[,e]of this.mapGroupToDisposable){$e(e)}this.mapGroupToDisposable.clear()}dispose(){super.dispose();this.clear()}canGoForward(){return this.stack.length>this.index+1}async goForward(){const e=await this.maybeGoCurrent();if(e){return}if(!this.canGoForward()){return}this.setIndex(this.index+1);return this.navigate()}canGoBack(){return this.index>0}async goBack(){const e=await this.maybeGoCurrent();if(e){return}if(!this.canGoBack()){return}this.setIndex(this.index-1);return this.navigate()}async goPrevious(){const e=await this.maybeGoCurrent();if(e){return}if(this.previousIndex===-1){return this.goBack()}this.setIndex(this.previousIndex);return this.navigate()}canGoLast(){return this.stack.length>0}async goLast(){if(!this.canGoLast()){return}this.setIndex(this.stack.length-1);return this.navigate()}async maybeGoCurrent(){if(this.filter===Ge.NONE){return false}if(this.isCurrentSelectionActive()){return false}await this.navigate();return true}isCurrentSelectionActive(){if(!this.current?.selection){return false}const e=this.editorService.activeEditorPane;if(!Dd(e)){return false}if(e.group.id!==this.current.groupId){return false}if(!e.input||!this.editorHelper.matchesEditor(e.input,this.current.editor)){return false}const t=e.getSelection();if(!t){return false}return t.compare(this.current.selection)===wr.IDENTICAL}setIndex(e,t){this.previousIndex=this.index;this.index=e;if(!t){this._onDidChange.fire()}}async navigate(){this.navigating=true;try{if(this.current){await this.doNavigate(this.current)}}finally{this.navigating=false}}doNavigate(e){let t=Object.create(null);if(e.selection){t=e.selection.restore(t)}if(ze(e.editor)){return this.editorService.openEditor(e.editor,t,e.groupId)}return this.editorService.openEditor({...e.editor,options:{...e.editor.options,...t}},e.groupId)}isNavigating(){return this.navigating}};Zo=lc=E([h(2,N),h(3,Y),h(4,qe),h(5,et)],Zo);let Rr=class sx{constructor(e,t,i,s){this.uriIdentityService=e;this.lifecycleService=t;this.fileService=i;this.pathService=s}preferResourceEditorInput(e){const t=vt.getOriginalUri(e);const i=t?.scheme===fe.file||t?.scheme===fe.vscodeRemote||t?.scheme===fe.vscodeUserData||t?.scheme===this.pathService.defaultUriScheme;if(i){if(ze(e)){const s=e.toUntyped();if(Td(s)){return s}}return e}else{return ze(e)?e:void 0}}matchesEditor(e,t){if(e instanceof Wo||e instanceof zh){if(ze(t)){return false}if(e instanceof Wo){return e.contains(t.resource,$h.DELETED)}return this.matchesFile(t.resource,e)}if(ze(e)){if(ze(t)){return e.matches(t)}return this.matchesFile(t.resource,e)}if(ze(t)){return this.matchesFile(e.resource,t)}return e&&t&&this.uriIdentityService.extUri.isEqual(e.resource,t.resource)}matchesFile(e,t){if(t instanceof Wo){return t.contains(e,$h.DELETED)}if(t instanceof zh){return this.uriIdentityService.extUri.isEqualOrParent(e,t.resource)}if(ze(t)){const i=t.resource;if(!i){return false}if(this.lifecycleService.phase>=_n.Restored&&!this.fileService.hasProvider(i)){return false}return this.uriIdentityService.extUri.isEqual(i,e)}return this.uriIdentityService.extUri.isEqual(t?.resource,e)}matchesEditorIdentifier(e,t){if(!t?.group){return false}if(e.groupId!==t.group.id){return false}return t.input?e.editor.matches(t.input):false}onEditorDispose(e,t,i){const s=x.once(e.onWillDispose)(()=>t());let o=i.get(e);if(!o){o=new L;i.set(e,o)}o.add(s)}clearOnEditorDispose(e,t){if(!ze(e)){return}const i=t.get(e);if(i){$e(i);t.delete(e)}}};Rr=E([h(0,Jp),h(1,bn),h(2,je),h(3,Wl)],Rr);const aI=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));const dI=new U("activeCustomEditorId","",{type:"string",description:c(5403,"The viewType of the currently active custom editor.")});const cI=new U("focusedCustomEditorIsEditable",false);var Vr;(function(a){a["default"]="default";a["builtin"]="builtin";a["option"]="option"})(Vr||(Vr={}));class sp{constructor(e){this.id=e.id;this.displayName=e.displayName;this.providerDisplayName=e.providerDisplayName;this.priority=e.priority;this.selector=e.selector}matches(e){return this.selector.some(t=>t.filenamePattern&&ir(t.filenamePattern,e))}}class hd{constructor(e){this.allEditors=Qs(e,t=>t.id)}get length(){return this.allEditors.length}get defaultEditor(){return this.allEditors.find(e=>{switch(e.priority){case be.default:case be.builtin:return this.allEditors.every(t=>t===e||lI(t,e));default:return false}})}get bestAvailableEditor(){const e=Array.from(this.allEditors).sort((t,i)=>{return Nt(t.priority)-Nt(i.priority)});return e[0]}}function lI(a,e){return Nt(a.priority)<Nt(e.priority)}class hI{constructor(e){this._references=new Map;this._uriIdentityService=e}async getAllModels(e){const t=`${e.toString()}@@@`;const i=[];for(const[s,o]of this._references){if(s.startsWith(t)&&o.model){i.push(await o.model)}}return i}async get(e,t){const i=this.key(e,t);const s=this._references.get(i);return s?.model}tryRetain(e,t){const i=this.key(e,t);const s=this._references.get(i);if(!s){return void 0}s.counter++;return s.model.then(o=>{return{object:o,dispose:Hl(()=>{if(--s.counter<=0){s.model.then(n=>n.dispose());this._references.delete(i)}})}})}add(e,t,i){const s=this.key(e,t);const o=this._references.get(s);if(o){throw new Error("Model already exists")}this._references.set(s,{viewType:t,model:i,counter:0});return this.tryRetain(e,t)}disposeAllModelsForView(e){for(const[t,i]of this._references){if(i.viewType===e){i.model.then(s=>s.dispose());this._references.delete(t)}}}key(e,t){e=this._uriIdentityService.asCanonicalUri(e);return`${e.toString()}@@@${t}`}}const Yt=Object.freeze({viewType:"viewType",displayName:"displayName",selector:"selector",priority:"priority"});const uI={description:c(5405,"Contributed custom editors."),type:"array",defaultSnippets:[{body:[{[Yt.viewType]:"$1",[Yt.displayName]:"$2",[Yt.selector]:[{filenamePattern:"$3"}]}]}],items:{type:"object",required:[Yt.viewType,Yt.displayName,Yt.selector],properties:{[Yt.viewType]:{type:"string",markdownDescription:c(5406,"Identifier for the custom editor. This must be unique across all custom editors, so we recommend including your extension id as part of `viewType`. The `viewType` is used when registering custom editors with `vscode.registerCustomEditorProvider` and in the `onCustomEditor:${id}` [activation event](https://code.visualstudio.com/api/references/activation-events).")},[Yt.displayName]:{type:"string",description:c(5407,"Human readable name of the custom editor. This is displayed to users when selecting which editor to use.")},[Yt.selector]:{type:"array",description:c(5408,"Set of globs that the custom editor is enabled for."),items:{type:"object",defaultSnippets:[{body:{filenamePattern:"$1"}}],properties:{filenamePattern:{type:"string",description:c(5409,"Glob that the custom editor is enabled for.")}}}},[Yt.priority]:{type:"string",markdownDeprecationMessage:c(5410,"Controls if the custom editor is enabled automatically when the user opens a file. This may be overridden by users using the `workbench.editorAssociations` setting."),enum:[Vr.default,Vr.option],markdownEnumDescriptions:[c(5411,"The editor is automatically used when the user opens a resource, provided that no other default custom editors are registered for that resource."),c(5412,"The editor is not automatically used when the user opens a resource, but a user can switch to the editor using the `Reopen With` command.")],default:"default"}}}};const pI=Ul.registerExtensionPoint({extensionPoint:"customEditors",deps:[yv],jsonSchema:uI,activationEventsGenerator:(a,e)=>{for(const t of a){const i=t[Yt.viewType];if(i){e.push(`onCustomEditor:${i}`)}}}});class gI extends k{constructor(){super(...arguments);this.type="table"}shouldRender(e){return!!e.contributes?.customEditors}render(e){const t=e.contributes?.customEditors||[];if(!t.length){return{data:{headers:[],rows:[]},dispose:()=>{}}}const i=[c(5413,"View Type"),c(5414,"Priority"),c(5415,"Filename Pattern")];const s=t.map(o=>{return[o.viewType,o.priority??"",ts(o.selector.map(n=>n.filenamePattern)).join(", ")]});return{data:{headers:i,rows:s},dispose:()=>{}}}}W.as(Kl.ExtensionFeaturesRegistry).registerExtensionFeature({id:"customEditors",label:c(5416,"Custom Editors"),access:{canToggle:false},renderer:new Q(gI)});class Jo extends k{static{this.CUSTOM_EDITORS_STORAGE_ID="customEditors"}static{this.CUSTOM_EDITORS_ENTRY_ID="editors"}constructor(e){super();this._editors=new Map;this._onChange=this._register(new _);this.onChange=this._onChange.event;this._memento=new Xp(Jo.CUSTOM_EDITORS_STORAGE_ID,e);const t=this._memento.getMemento(M.PROFILE,Ee.MACHINE);for(const i of t[Jo.CUSTOM_EDITORS_ENTRY_ID]||[]){this.add(new sp(i))}pI.setHandler(i=>{this.update(i)})}update(e){this._editors.clear();for(const i of e){for(const s of i.value){this.add(new sp({id:s.viewType,displayName:s.displayName,providerDisplayName:i.description.isBuiltin?c(5402,"Built-in"):i.description.displayName||i.description.identifier.value,selector:s.selector||[],priority:fI(s,i.description)}))}}const t=this._memento.getMemento(M.PROFILE,Ee.MACHINE);t[Jo.CUSTOM_EDITORS_ENTRY_ID]=Array.from(this._editors.values());this._memento.saveMemento();this._onChange.fire()}[Symbol.iterator](){return this._editors.values()}get(e){return this._editors.get(e)}getContributedEditors(e){return Array.from(this._editors.values()).filter(t=>t.matches(e))}add(e){if(this._editors.has(e.id)){console.error(`Custom editor with id '${e.id}' already registered`);return}this._editors.set(e.id,e)}}function fI(a,e){switch(a.priority){case be.default:case be.option:return a.priority;case be.builtin:return e.isBuiltin?be.builtin:be.default;default:return be.default}}Le(aI);let hc=class ox extends k{constructor(e,t,i,s,o,n,r){super();this.editorService=i;this.editorGroupService=s;this.instantiationService=o;this.uriIdentityService=n;this.editorResolverService=r;this._untitledCounter=0;this._editorResolverDisposables=this._register(new L);this._editorCapabilities=new Map;this._onDidChangeEditorTypes=this._register(new _);this.onDidChangeEditorTypes=this._onDidChangeEditorTypes.event;this._fileEditorFactory=W.as(Ct.EditorFactory).getFileEditorFactory();this._models=new hI(this.uriIdentityService);this._contributedEditors=this._register(new Jo(t));this.editorResolverService.bufferChangeEvents(this.registerContributionPoints.bind(this));this._register(this._contributedEditors.onChange(()=>{this.editorResolverService.bufferChangeEvents(this.registerContributionPoints.bind(this));this._onDidChangeEditorTypes.fire()}));const d={contextKey:dI,getGroupContextKeyValue:p=>this.getActiveCustomEditorId(p),onDidChange:this.onDidChangeEditorTypes};const l={contextKey:cI,getGroupContextKeyValue:p=>this.getCustomEditorIsEditable(p),onDidChange:this.onDidChangeEditorTypes};this._register(this.editorGroupService.registerContextKeyProvider(d));this._register(this.editorGroupService.registerContextKeyProvider(l));this._register(e.onDidRunOperation(p=>{if(p.isOperation(Ho.MOVE)){this.handleMovedFileInOpenedFileEditors(p.resource,this.uriIdentityService.asCanonicalUri(p.target.resource))}}));const u=105;this._register(Qp.addImplementation(u,"custom-editor",()=>{return this.withActiveCustomEditor(p=>p.undo())}));this._register(eg.addImplementation(u,"custom-editor",()=>{return this.withActiveCustomEditor(p=>p.redo())}))}getEditorTypes(){return[...this._contributedEditors]}withActiveCustomEditor(e){const t=this.editorService.activeEditor;if(t instanceof ut){const i=e(t);if(i){return i}return true}return false}registerContributionPoints(){this._editorResolverDisposables.clear();for(const e of this._contributedEditors){for(const t of e.selector){if(!t.filenamePattern){continue}this._editorResolverDisposables.add(this.editorResolverService.registerEditor(t.filenamePattern,{id:e.id,label:e.displayName,detail:e.providerDisplayName,priority:e.priority},{singlePerResource:()=>!(this.getCustomEditorCapabilities(e.id)?.supportsMultipleEditorsPerDocument??false)},{createEditorInput:({resource:i},s)=>{return{editor:ut.create(this.instantiationService,i,e.id,s.id)}},createUntitledEditorInput:({resource:i},s)=>{return{editor:ut.create(this.instantiationService,i??K.from({scheme:fe.untitled,authority:`Untitled-${this._untitledCounter++}`}),e.id,s.id)}},createDiffEditorInput:(i,s)=>{return{editor:this.createDiffEditorInput(i,e.id,s)}}}))}}}createDiffEditorInput(e,t,i){const s=ut.create(this.instantiationService,Se(e.modified.resource),t,i.id,{customClasses:"modified"});const o=ut.create(this.instantiationService,Se(e.original.resource),t,i.id,{customClasses:"original"});return this.instantiationService.createInstance(ca,e.label,e.description,o,s,true)}get models(){return this._models}getCustomEditor(e){return this._contributedEditors.get(e)}getContributedCustomEditors(e){return new hd(this._contributedEditors.getContributedEditors(e))}getUserConfiguredCustomEditors(e){const t=this.editorResolverService.getAssociationsForResource(e);return new hd(ts(t.map(i=>this._contributedEditors.get(i.viewType))))}getAllCustomEditors(e){return new hd([...this.getUserConfiguredCustomEditors(e).allEditors,...this.getContributedCustomEditors(e).allEditors])}registerCustomEditorCapabilities(e,t){if(this._editorCapabilities.has(e)){throw new Error(`Capabilities for ${e} already set`)}this._editorCapabilities.set(e,t);return de(()=>{this._editorCapabilities.delete(e)})}getCustomEditorCapabilities(e){return this._editorCapabilities.get(e)}getActiveCustomEditorId(e){const t=e.activeEditorPane;const i=t?.input?.resource;if(!i){return""}return t?.input instanceof ut?t.input.viewType:""}getCustomEditorIsEditable(e){const t=e.activeEditorPane;const i=t?.input?.resource;if(!i){return false}return t?.input instanceof ut}async handleMovedFileInOpenedFileEditors(e,t){if(hi(e).toLowerCase()===hi(t).toLowerCase()){return}const i=this.getAllCustomEditors(t);if(!i.allEditors.some(o=>o.priority!==be.option)){return}const s=new Map;for(const o of this.editorGroupService.groups){for(const n of o.editors){if(this._fileEditorFactory.isFileEditor(n)&&!(n instanceof ut)&&vi(n.resource,t)){let r=s.get(o.id);if(!r){r=[];s.set(o.id,r)}r.push(n)}}}if(!s.size){return}for(const[o,n]of s){this.editorService.replaceEditors(n.map(r=>{let d;if(i.defaultEditor){const l=i.defaultEditor.id;d=ut.create(this.instantiationService,t,l,o)}else{d={resource:t,options:{override:Ot.id}}}return{editor:r,replacement:d,options:{preserveFocus:true}}}),o)}}};hc=E([h(0,je),h(1,le),h(2,Y),h(3,qe),h(4,N),h(5,Jp),h(6,la)],hc);let uc=class nx extends k{constructor(e,t){super();this._themeService=e;this._configurationService=t;this._cachedWebViewThemeData=void 0;this._onThemeDataChanged=this._register(new _);this.onThemeDataChanged=this._onThemeDataChanged.event;this._register(this._themeService.onDidColorThemeChange(()=>{this._reset()}));const i=["editor.fontFamily","editor.fontWeight","editor.fontSize","accessibility.underlineLinks"];this._register(this._configurationService.onDidChangeConfiguration(s=>{if(i.some(o=>s.affectsConfiguration(o))){this._reset()}}))}getTheme(){return this._themeService.getColorTheme()}getWebviewThemeData(){if(!this._cachedWebViewThemeData){const e=this._configurationService.getValue("editor");const t=e.fontFamily||sr.fontFamily;const i=e.fontWeight||sr.fontWeight;const s=e.fontSize||sr.fontSize;const o=this._configurationService.getValue("accessibility.underlineLinks");const n=this._themeService.getColorTheme();const r=bv().getColors().reduce((u,p)=>{const f=n.getColor(p.id);if(f){u["vscode-"+p.id.replace(".","-")]=f.toString()}return u},{});const d={"vscode-font-family":Cv,"vscode-font-weight":"normal","vscode-font-size":"13px","vscode-editor-font-family":t,"vscode-editor-font-weight":i,"vscode-editor-font-size":s+"px","text-link-decoration":o?"underline":"none",...r};const l=ln.fromTheme(n);this._cachedWebViewThemeData={styles:d,activeTheme:l,themeLabel:n.label,themeId:n.settingsId}}return this._cachedWebViewThemeData}_reset(){this._cachedWebViewThemeData=void 0;this._onThemeDataChanged.fire()}};uc=E([h(0,GE),h(1,X)],uc);var ln;(function(a){a["light"]="vscode-light";a["dark"]="vscode-dark";a["highContrast"]="vscode-high-contrast";a["highContrastLight"]="vscode-high-contrast-light"})(ln||(ln={}));(function(a){function e(t){switch(t.type){case Ks.LIGHT:return a.light;case Ks.DARK:return a.dark;case Ks.HIGH_CONTRAST_DARK:return a.highContrast;case Ks.HIGH_CONTRAST_LIGHT:return a.highContrastLight}}a.fromTheme=e})(ln||(ln={}));class mI{constructor(e,t,i){this._getExtensionLocation=e;this._getMappings=t;this.tunnelService=i;this._tunnels=new Map}async getRedirect(e,t){const i=K.parse(t);const s=Sv(i);if(!s){return void 0}for(const o of this._getMappings()){if(o.webviewPort===s.port){const n=this._getExtensionLocation();if(n&&n.scheme===fe.vscodeRemote){const r=e&&await this.getOrCreateTunnel(e,o.extensionHostPort);if(r){if(r.tunnelLocalPort===o.webviewPort){return void 0}return encodeURI(i.with({authority:`127.0.0.1:${r.tunnelLocalPort}`}).toString(true))}}if(o.webviewPort!==o.extensionHostPort){return encodeURI(i.with({authority:`${s.address}:${o.extensionHostPort}`}).toString(true))}}}return void 0}async dispose(){for(const e of this._tunnels.values()){await e.dispose()}this._tunnels.clear()}async getOrCreateTunnel(e,t){const i=this._tunnels.get(t);if(i){return i}const s=await this.tunnelService.openTunnel({getAddress:async()=>e},void 0,t);let o;if(typeof s==="string"){o=void 0}if(o){this._tunnels.set(t,o)}return o}}const wI=new Map([[".svg","image/svg+xml"],[".txt",Uo.text],[".css","text/css"],[".js","application/javascript"],[".cjs","application/javascript"],[".mjs","application/javascript"],[".json","application/json"],[".html","text/html"],[".htm","text/html"],[".xhtml","application/xhtml+xml"],[".oft","font/otf"],[".xml","application/xml"],[".wasm","application/wasm"]]);function vI(a){const e=_v(a.fsPath).toLowerCase();return wI.get(e)||Ev(a.fsPath)||Uo.unknown}var Pi;(function(a){let e;(function(s){s[s["Success"]=0]="Success";s[s["Failed"]=1]="Failed";s[s["AccessDenied"]=2]="AccessDenied";s[s["NotModified"]=3]="NotModified"})(e=a.Type||(a.Type={}));class t{constructor(o,n,r,d){this.stream=o;this.etag=n;this.mtime=r;this.mimeType=d;this.type=e.Success}}a.StreamSuccess=t;a.Failed={type:e.Failed};a.AccessDenied={type:e.AccessDenied};class i{constructor(o,n){this.mimeType=o;this.mtime=n;this.type=e.NotModified}}a.NotModified=i})(Pi||(Pi={}));async function yI(a,e,t,i,s){i.debug(`loadLocalResource - begin. requestUri=${a}`);const o=bI(a,e.roots);i.debug(`loadLocalResource - found resource to load. requestUri=${a}, resourceToLoad=${o}`);if(!o){return Pi.AccessDenied}const n=vI(a);try{const r=await t.readFileStream(o,{etag:e.ifNoneMatch},s);return new Pi.StreamSuccess(r.value,r.etag,r.mtime,n)}catch(r){if(r instanceof Iv){const d=r.fileOperationResult;if(d===Dv.FILE_NOT_MODIFIED_SINCE){return new Pi.NotModified(n,r.options?.mtime)}}i.debug(`loadLocalResource - Error using fileReader. requestUri=${a}`);console.log(r);return Pi.Failed}}function bI(a,e){for(const t of e){if(CI(t,a)){return SI(a)}}return void 0}function CI(a,e){if(a.scheme!==e.scheme){return false}let t=jh(e.fsPath);let i=jh(a.fsPath+(a.fsPath.endsWith(Yh)?"":Yh));if(Zh(a.fsPath)&&Zh(e.fsPath)){i=i.toLowerCase();t=t.toLowerCase()}return t.startsWith(i)}function SI(a){if(a.scheme===fe.vscodeRemote){return K.from({scheme:fe.vscodeRemote,authority:a.authority,path:"/vscode-resource",query:JSON.stringify({requestResourcePath:a.path})})}return a}const _I=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Le(_I);const EI=c(5144,"Find");const II=c(5145,"Find");const DI=c(5146,"Previous Match");const TI=c(5147,"Next Match");const AI=c(5148,"Close");const Qn=310;const xI=73;class RI extends Tv{constructor(e,t,i,s,o){super();this._keybindingService=o;this._isVisible=false;this._foundMatch=false;this._width=0;this.state=this._register(new Av);this._matchesLimit=e.matchesLimit??Number.MAX_SAFE_INTEGER;this._findInput=this._register(new xv(null,t,{label:EI,placeholder:II,validation:d=>{if(d.length===0||!this._findInput.getRegex()){return null}try{new RegExp(d);return null}catch(l){this._foundMatch=false;this.updateButtons(this._foundMatch);return{content:l.message}}},showCommonFindToggles:e.showCommonFindToggles,appendCaseSensitiveLabel:e.appendCaseSensitiveActionId?this._getKeybinding(e.appendCaseSensitiveActionId):void 0,appendRegexLabel:e.appendRegexActionId?this._getKeybinding(e.appendRegexActionId):void 0,appendWholeWordsLabel:e.appendWholeWordsActionId?this._getKeybinding(e.appendWholeWordsActionId):void 0,showHistoryHint:()=>Rv(o),inputBoxStyles:$l,toggleStyles:zl},i));this._updateHistoryDelayer=this._register(new Vv(500));this._register(this._findInput.onInput(async d=>{if(!e.checkImeCompletionState||!this._findInput.isImeSessionInProgress){this._foundMatch=this._onInputChanged();if(e.showResultCount){await this.updateResultCount()}this.updateButtons(this._foundMatch);this.focusFindBox();this._delayedUpdateHistory()}}));this._findInput.setRegex(!!this.state.isRegex);this._findInput.setCaseSensitive(!!this.state.matchCase);this._findInput.setWholeWords(!!this.state.wholeWord);this._register(this._findInput.onDidOptionChange(()=>{this.state.change({isRegex:this._findInput.getRegex(),wholeWord:this._findInput.getWholeWords(),matchCase:this._findInput.getCaseSensitive()},true)}));this._register(this.state.onFindReplaceStateChange(()=>{this._findInput.setRegex(this.state.isRegex);this._findInput.setWholeWords(this.state.wholeWord);this._findInput.setCaseSensitive(this.state.matchCase);this.findFirst()}));this.prevBtn=this._register(new Za({label:DI+(e.previousMatchActionId?this._getKeybinding(e.previousMatchActionId):""),icon:kv,onTrigger:()=>{this.find(true)}},s));this.nextBtn=this._register(new Za({label:TI+(e.nextMatchActionId?this._getKeybinding(e.nextMatchActionId):""),icon:Pv,onTrigger:()=>{this.find(false)}},s));const n=this._register(new Za({label:AI+(e.closeWidgetActionId?this._getKeybinding(e.closeWidgetActionId):""),icon:Lv,onTrigger:()=>{this.hide()}},s));this._innerDomNode=document.createElement("div");this._innerDomNode.classList.add("simple-find-part");this._innerDomNode.appendChild(this._findInput.domNode);this._innerDomNode.appendChild(this.prevBtn.domNode);this._innerDomNode.appendChild(this.nextBtn.domNode);this._innerDomNode.appendChild(n.domNode);this._domNode=document.createElement("div");this._domNode.classList.add("simple-find-part-wrapper");this._domNode.appendChild(this._innerDomNode);this.onkeyup(this._innerDomNode,d=>{if(d.equals(T.Escape)){this.hide();d.preventDefault();return}});this._focusTracker=this._register(lr(this._innerDomNode));this._register(this._focusTracker.onDidFocus(this._onFocusTrackerFocus.bind(this)));this._register(this._focusTracker.onDidBlur(this._onFocusTrackerBlur.bind(this)));this._findInputFocusTracker=this._register(lr(this._findInput.domNode));this._register(this._findInputFocusTracker.onDidFocus(this._onFindInputFocusTrackerFocus.bind(this)));this._register(this._findInputFocusTracker.onDidBlur(this._onFindInputFocusTrackerBlur.bind(this)));this._register(J(this._innerDomNode,"click",d=>{d.stopPropagation()}));if(e?.showResultCount){this._domNode.classList.add("result-count");this._matchesCount=document.createElement("div");this._matchesCount.className="matchesCount";this._findInput.domNode.insertAdjacentElement("afterend",this._matchesCount);this._register(this._findInput.onDidChange(async()=>{await this.updateResultCount()}));this._register(this._findInput.onDidOptionChange(async()=>{this._foundMatch=this._onInputChanged();await this.updateResultCount();this.focusFindBox();this._delayedUpdateHistory()}))}let r=e?.initialWidth;if(r){r=r<Qn?Qn:r;this._domNode.style.width=`${r}px`}if(e?.enableSash){const d=r??Qn;let l=d;const u=this._register(new Mv(this._innerDomNode,this,{orientation:q.VERTICAL,size:1}));this._register(u.onDidStart(()=>{l=parseFloat(Jh(this._domNode).width)}));this._register(u.onDidChange(p=>{const f=l+p.startX-p.currentX;if(f<d){return}this._domNode.style.width=`${f}px`}));this._register(u.onDidReset(p=>{const f=parseFloat(Jh(this._domNode).width);if(f===d){this._domNode.style.width="100%"}else{this._domNode.style.width=`${d}px`}}))}}getVerticalSashLeft(e){return 0}get inputValue(){return this._findInput.getValue()}get focusTracker(){return this._focusTracker}_getKeybinding(e){const t=this._keybindingService?.lookupKeybinding(e);if(!t){return""}return` (${t.getLabel()})`}dispose(){super.dispose();this._domNode?.remove()}isVisible(){return this._isVisible}getDomNode(){return this._domNode}getFindInputDomNode(){return this._findInput.domNode}reveal(e,t=true){if(e){this._findInput.setValue(e)}if(this._isVisible){this._findInput.select();return}this._isVisible=true;this.updateResultCount();this.layout();setTimeout(()=>{this._innerDomNode.classList.toggle("suppress-transition",!t);this._innerDomNode.classList.add("visible","visible-transition");this._innerDomNode.setAttribute("aria-hidden","false");this._findInput.select();if(!t){setTimeout(()=>{this._innerDomNode.classList.remove("suppress-transition")},0)}},0)}show(e){if(e&&!this._isVisible){this._findInput.setValue(e)}this._isVisible=true;this.layout();setTimeout(()=>{this._innerDomNode.classList.add("visible","visible-transition");this._innerDomNode.setAttribute("aria-hidden","false")},0)}hide(e=true){if(this._isVisible){this._innerDomNode.classList.toggle("suppress-transition",!e);this._innerDomNode.classList.remove("visible-transition");this._innerDomNode.setAttribute("aria-hidden","true");setTimeout(()=>{this._isVisible=false;this.updateButtons(this._foundMatch);this._innerDomNode.classList.remove("visible","suppress-transition")},e?200:0)}}layout(e=this._width){this._width=e;if(!this._isVisible){return}if(this._matchesCount){let t=false;if(Qn+xI+28>=e){t=true}this._innerDomNode.classList.toggle("reduced-find-widget",t)}}_delayedUpdateHistory(){this._updateHistoryDelayer.trigger(this._updateHistory.bind(this))}_updateHistory(){this._findInput.inputBox.addToHistory()}_getRegexValue(){return this._findInput.getRegex()}_getWholeWordValue(){return this._findInput.getWholeWords()}_getCaseSensitiveValue(){return this._findInput.getCaseSensitive()}updateButtons(e){const t=this.inputValue.length>0;this.prevBtn.setEnabled(this._isVisible&&t&&e);this.nextBtn.setEnabled(this._isVisible&&t&&e)}focusFindBox(){this.nextBtn.focus();this._findInput.inputBox.focus()}async updateResultCount(){if(!this._matchesCount){this.updateButtons(this._foundMatch);return}const e=await this._getResultCount();this._matchesCount.innerText="";const t=this.inputValue.length>0&&e?.resultCount===0;this._matchesCount.classList.toggle("no-results",t);let i="";if(e?.resultCount){let s=String(e.resultCount);if(e.resultCount>=this._matchesLimit){s+="+"}let o=String(e.resultIndex+1);if(o==="0"){o="?"}i=Mo(Ov,o,s)}else{i=Xh}Nv(this._announceSearchResults(i,this.inputValue));this._matchesCount.appendChild(document.createTextNode(i));this._foundMatch=!!e&&e.resultCount>0;this.updateButtons(this._foundMatch)}changeState(e){this.state.change(e,false)}_announceSearchResults(e,t){if(!t){return c(5149,"Enter search input")}if(e===Xh){return t===""?c(5150,"{0} found",e):c(5151,"{0} found for '{1}'",e,t)}return c(5152,"{0} found for '{1}'",e,t)}}const VI=ne("simpleFindWidget.sashBorder",{dark:"#454545",light:"#C8C8C8",hcDark:"#6FC3DF",hcLight:"#0F4A85"},c(5153,"Border color of the sash border."));tg((a,e)=>{const t=a.getColor(VI);e.addRule(`.monaco-workbench .simple-find-part .monaco-sash { background-color: ${t}; border-color: ${t} }`)});let pc=class rx extends RI{async _getResultCount(e){return void 0}constructor(e,t,i,s,o){super({showCommonFindToggles:false,checkImeCompletionState:e.checkImeCompletionState,enableSash:true},t,i,s,o);this._delegate=e;this._findWidgetFocused=ql.bindTo(i);this._register(e.hasFindResult(n=>{this.updateButtons(n);this.focusFindBox()}));this._register(e.onDidStopFind(()=>{this.updateButtons(false)}))}find(e){const t=this.inputValue;if(t){this._delegate.find(t,e)}}hide(e=true){super.hide(e);this._delegate.stopFind(true);this._delegate.focus()}_onInputChanged(){const e=this.inputValue;if(e){this._delegate.updateFind(e)}else{this._delegate.stopFind(false)}return false}_onFocusTrackerFocus(){this._findWidgetFocused.set(true)}_onFocusTrackerBlur(){this._findWidgetFocused.reset()}_onFindInputFocusTrackerFocus(){}_onFindInputFocusTrackerBlur(){}findFirst(){}};pc=E([h(1,ha),h(2,ee),h(3,bt),h(4,zt)],pc);var gs;(function(a){let e;(function(i){i[i["Initializing"]=0]="Initializing";i[i["Ready"]=1]="Ready"})(e=a.Type||(a.Type={}));class t{constructor(s){this.pendingMessages=s;this.type=e.Initializing}}a.Initializing=t;a.Ready={type:e.Ready}})(gs||(gs={}));const kI="webviewId";let gc=class ax extends k{get window(){return typeof this._windowId==="number"?ua(this._windowId)?.window:void 0}get platform(){return"browser"}get element(){return this._element}get isFocused(){if(!this._focused){return false}if(!this.window){return false}if(this.window.document.activeElement&&this.window.document.activeElement!==this.element){return false}return true}constructor(e,t,i,s,o,n,r,d,l,u,p,f){super();this.webviewThemeDataProvider=t;this._environmentService=n;this._fileService=r;this._logService=d;this._remoteAuthorityResolverService=l;this._tunnelService=u;this._accessibilityService=f;this.id=yo();this._windowId=void 0;this._expectedServiceWorkerVersion=4;this._state=new gs.Initializing([]);this._resourceLoadingCts=this._register(new es);this._focusDelayer=this._register(new Bv(50));this._onDidHtmlChange=this._register(new _);this.onDidHtmlChange=this._onDidHtmlChange.event;this._messageHandlers=new Map;this.checkImeCompletionState=true;this._disposed=false;this._onMissingCsp=this._register(new _);this.onMissingCsp=this._onMissingCsp.event;this._onDidClickLink=this._register(new _);this.onDidClickLink=this._onDidClickLink.event;this._onDidReload=this._register(new _);this.onDidReload=this._onDidReload.event;this._onMessage=this._register(new _);this.onMessage=this._onMessage.event;this._onDidScroll=this._register(new _);this.onDidScroll=this._onDidScroll.event;this._onDidWheel=this._register(new _);this.onDidWheel=this._onDidWheel.event;this._onDidUpdateState=this._register(new _);this.onDidUpdateState=this._onDidUpdateState.event;this._onDidFocus=this._register(new _);this.onDidFocus=this._onDidFocus.event;this._onDidBlur=this._register(new _);this.onDidBlur=this._onDidBlur.event;this._onFatalError=this._register(new _);this.onFatalError=this._onFatalError.event;this._onDidDispose=this._register(new _);this.onDidDispose=this._onDidDispose.event;this._hasAlertedAboutMissingCsp=false;this._hasFindResult=this._register(new _);this.hasFindResult=this._hasFindResult.event;this._onDidStopFind=this._register(new _);this.onDidStopFind=this._onDidStopFind.event;this.providedViewType=e.providedViewType;this.origin=e.origin??this.id;this._options=e.options;this.extension=e.extension;this._content={html:"",title:e.title,options:e.contentOptions,state:void 0};this._portMappingManager=this._register(new mI(()=>this.extension?.location,()=>this._content.options.portMapping||[],this._tunnelService));this._element=this._createElement(e.options,e.contentOptions);this._register(this.on("no-csp-found",()=>{this.handleNoCspFound()}));this._register(this.on("did-click-link",({uri:g})=>{this._onDidClickLink.fire(g)}));this._register(this.on("onmessage",({message:g,transfer:m})=>{this._onMessage.fire({message:g,transfer:m})}));this._register(this.on("did-scroll",({scrollYPercentage:g})=>{this._onDidScroll.fire({scrollYPercentage:g})}));this._register(this.on("do-reload",()=>{this.reload()}));this._register(this.on("do-update-state",g=>{this.state=g;this._onDidUpdateState.fire(g)}));this._register(this.on("did-focus",()=>{this.handleFocusChange(true)}));this._register(this.on("did-blur",()=>{this.handleFocusChange(false)}));this._register(this.on("did-scroll-wheel",g=>{this._onDidWheel.fire(g)}));this._register(this.on("did-find",({didFind:g})=>{this._hasFindResult.fire(g)}));this._register(this.on("fatal-error",g=>{o.error(c(11474,"Error loading webview: {0}",g.message));this._onFatalError.fire({message:g.message})}));this._register(this.on("did-keydown",g=>{this.handleKeyEvent("keydown",g)}));this._register(this.on("did-keyup",g=>{this.handleKeyEvent("keyup",g)}));this._register(this.on("did-context-menu",g=>{if(!this.element){return}if(!this._contextKeyService){return}const m=this.element.getBoundingClientRect();const y=this._contextKeyService.createOverlay([...Object.entries(g.context),[kI,this.providedViewType]]);s.showContextMenu({menuId:w.WebviewContext,menuActionOptions:{shouldForwardArgs:true},contextKeyService:y,getActionsContext:()=>({...g.context,webview:this.providedViewType}),getAnchor:()=>({x:m.x+g.clientX,y:m.y+g.clientY})});this._send("set-context-menu-visible",{visible:true})}));this._register(this.on("load-resource",async g=>{try{const m=Fv(g.authority);const y=K.from({scheme:g.scheme,authority:m,path:decodeURIComponent(g.path),query:g.query?decodeURIComponent(g.query):g.query});this.loadResource(g.id,y,g.ifNoneMatch)}catch(m){this._send("did-load-resource",{id:g.id,status:404,path:g.path})}}));this._register(this.on("load-localhost",g=>{this.localLocalhost(g.id,g.origin)}));this._register(x.runAndSubscribe(t.onThemeDataChanged,()=>this.style()));this._register(f.onDidChangeReducedMotion(()=>this.style()));this._register(f.onDidChangeScreenReaderOptimized(()=>this.style()));this._register(s.onDidHideContextMenu(()=>this._send("set-context-menu-visible",{visible:false})));this._confirmBeforeClose=i.getValue("window.confirmBeforeClose");this._register(i.onDidChangeConfiguration(g=>{if(g.affectsConfiguration("window.confirmBeforeClose")){this._confirmBeforeClose=i.getValue("window.confirmBeforeClose");this._send("set-confirm-before-close",this._confirmBeforeClose)}}));this._register(this.on("drag-start",()=>{this._startBlockingIframeDragEvents()}));this._register(this.on("drag",g=>{this.handleDragEvent("drag",g)}));if(e.options.enableFindWidget){this._webviewFindWidget=this._register(p.createInstance(pc,this))}}dispose(){this._disposed=true;this.element?.remove();this._element=void 0;this._messagePort=void 0;if(this._state.type===gs.Type.Initializing){for(const e of this._state.pendingMessages){e.resolve(false)}this._state.pendingMessages=[]}this._onDidDispose.fire();this._resourceLoadingCts.dispose(true);super.dispose()}setContextKeyService(e){this._contextKeyService=e}postMessage(e,t){return this._send("message",{message:e,transfer:t})}async _send(e,t,i=[]){if(this._state.type===gs.Type.Initializing){const{promise:s,resolve:o}=ig();this._state.pendingMessages.push({channel:e,data:t,transferable:i,resolve:o});return s}else{return this.doPostMessage(e,t,i)}}_createElement(e,t){const i=document.createElement("iframe");i.name=this.id;i.className=`webview ${e.customClasses||""}`;i.sandbox.add("allow-scripts","allow-same-origin","allow-forms","allow-pointer-lock","allow-downloads");const s=["cross-origin-isolated","autoplay"];if(!Qh){s.push("clipboard-read","clipboard-write")}i.setAttribute("allow",s.join("; "));i.style.border="none";i.style.width="100%";i.style.height="100%";i.focus=()=>{this._doFocus()};return i}_initElement(e,t,i,s){const o={id:this.id,parentId:s.vscodeWindowId.toString(),origin:this.origin,swVersion:String(this._expectedServiceWorkerVersion),extensionId:t?.id.value??"",platform:this.platform,"vscode-resource-base-authority":Wv,parentOrigin:s.origin};if(this._options.disableServiceWorker){o.disableServiceWorker="true"}if(this._environmentService.remoteAuthority){o.remoteAuthority=this._environmentService.remoteAuthority}if(i.purpose){o.purpose=i.purpose}o.serviceWorkerUri=Ko.asBrowserUri("vs/workbench/contrib/webview/browser/pre/service-worker.js").toString(true);o.fakeHtmlUri=Ko.asBrowserUri("vs/workbench/contrib/webview/browser/pre/fake.html").toString(true);Gv.addSearchParam(o,true,true);const n=new URLSearchParams(o).toString();const r=Qh?"index-no-csp.html":"index.html";const d=Ko.asBrowserUri(`vs/workbench/contrib/webview/browser/pre/${r}`);this.element.setAttribute("src",`${d.toString(true)}?${n}`)}mountTo(e,t){if(!this.element){return}this._windowId=t.vscodeWindowId;this._encodedWebviewOriginPromise=Hv(t.origin,this.origin).then(i=>this._encodedWebviewOrigin=i);this._encodedWebviewOriginPromise.then(i=>{if(!this._disposed){this._initElement(i,this.extension,this._options,t)}});this._registerMessageHandler(t);if(this._webviewFindWidget){e.appendChild(this._webviewFindWidget.getDomNode())}for(const i of[se.MOUSE_DOWN,se.MOUSE_MOVE,se.DROP]){this._register(J(e,i,()=>{this._stopBlockingIframeDragEvents()}))}for(const i of[e,t]){this._register(J(i,se.DRAG_END,()=>{this._stopBlockingIframeDragEvents()}))}e.id=this.id;e.appendChild(this.element)}_registerMessageHandler(e){const t=this._register(J(e,"message",i=>{if(!this._encodedWebviewOrigin||i?.data?.target!==this.id){return}if(i.data.channel==="webview-ready"){if(this._messagePort){return}this._logService.debug(`Webview(${this.id}): webview ready`);this._messagePort=i.ports[0];this._messagePort.onmessage=s=>{const o=this._messageHandlers.get(s.data.channel);if(!o){console.log(`No handlers found for '${s.data.channel}'`);return}o?.forEach(n=>n(s.data.data,s))};this.element?.classList.add("ready");if(this._state.type===gs.Type.Initializing){this._state.pendingMessages.forEach(({channel:s,data:o,resolve:n})=>n(this.doPostMessage(s,o)))}this._state=gs.Ready;t.dispose()}}))}_startBlockingIframeDragEvents(){if(this.element){this.element.style.pointerEvents="none"}}_stopBlockingIframeDragEvents(){if(this.element){this.element.style.pointerEvents="auto"}}webviewContentEndpoint(e){const t=this._environmentService.webviewExternalEndpoint;if(!t){throw new Error(`'webviewExternalEndpoint' has not been configured. Webviews will not work!`)}const i=t.replace("{{uuid}}",e);if(i[i.length-1]==="/"){return i.slice(0,i.length-1)}return i}doPostMessage(e,t,i=[]){if(this.element&&this._messagePort){this._messagePort.postMessage({channel:e,args:t},i);return true}return false}on(e,t){let i=this._messageHandlers.get(e);if(!i){i=new Set;this._messageHandlers.set(e,i)}i.add(t);return de(()=>{this._messageHandlers.get(e)?.delete(t)})}handleNoCspFound(){if(this._hasAlertedAboutMissingCsp){return}this._hasAlertedAboutMissingCsp=true;if(this.extension?.id){if(this._environmentService.isExtensionDevelopment){this._onMissingCsp.fire(this.extension.id)}}}reload(){this.doUpdateContent(this._content);const e=this._register(this.on("did-load",()=>{this._onDidReload.fire();e.dispose()}))}setHtml(e){this.doUpdateContent({...this._content,html:e});this._onDidHtmlChange.fire(e)}setTitle(e){this._content={...this._content,title:e};this._send("set-title",e)}set contentOptions(e){this._logService.debug(`Webview(${this.id}): will update content options`);if(Uv(e,this._content.options)){this._logService.debug(`Webview(${this.id}): skipping content options update`);return}this.doUpdateContent({...this._content,options:e})}set localResourcesRoot(e){this._content={...this._content,options:{...this._content.options,localResourceRoots:e}}}set state(e){this._content={...this._content,state:e}}set initialScrollProgress(e){this._send("initial-scroll-position",e)}doUpdateContent(e){this._logService.debug(`Webview(${this.id}): will update content`);this._content=e;const t=!!this._content.options.allowScripts;this._send("content",{contents:this._content.html,title:this._content.title,options:{allowMultipleAPIAcquire:!!this._content.options.allowMultipleAPIAcquire,allowScripts:t,allowForms:this._content.options.allowForms??t},state:this._content.state,cspSource:Kv,confirmBeforeClose:this._confirmBeforeClose})}style(){let{styles:e,activeTheme:t,themeLabel:i,themeId:s}=this.webviewThemeDataProvider.getWebviewThemeData();if(this._options.transformCssVariables){e=this._options.transformCssVariables(e)}const o=this._accessibilityService.isMotionReduced();const n=this._accessibilityService.isScreenReaderOptimized();this._send("styles",{styles:e,activeTheme:t,themeId:s,themeLabel:i,reduceMotion:o,screenReader:n})}handleFocusChange(e){this._focused=e;if(e){this._onDidFocus.fire()}else{this._onDidBlur.fire()}}handleKeyEvent(e,t){const i=new KeyboardEvent(e,t);Object.defineProperty(i,"target",{get:()=>this.element});this.window?.dispatchEvent(i)}handleDragEvent(e,t){const i=new DragEvent(e,t);Object.defineProperty(i,"target",{get:()=>this.element});this.window?.dispatchEvent(i)}windowDidDragStart(){this._startBlockingIframeDragEvents()}windowDidDragEnd(){this._stopBlockingIframeDragEvents()}selectAll(){this.execCommand("selectAll")}copy(){this.execCommand("copy")}paste(){this.execCommand("paste")}cut(){this.execCommand("cut")}undo(){this.execCommand("undo")}redo(){this.execCommand("redo")}execCommand(e){if(this.element){this._send("execCommand",e)}}async loadResource(e,t,i){try{const s=await yI(t,{ifNoneMatch:i,roots:this._content.options.localResourceRoots||[]},this._fileService,this._logService,this._resourceLoadingCts.token);switch(s.type){case Pi.Type.Success:{const o=await this.streamToBuffer(s.stream);return this._send("did-load-resource",{id:e,status:200,path:t.path,mime:s.mimeType,data:o,etag:s.etag,mtime:s.mtime},[o])}case Pi.Type.NotModified:{return this._send("did-load-resource",{id:e,status:304,path:t.path,mime:s.mimeType,mtime:s.mtime})}case Pi.Type.AccessDenied:{return this._send("did-load-resource",{id:e,status:401,path:t.path})}}}catch{}return this._send("did-load-resource",{id:e,status:404,path:t.path})}async streamToBuffer(e){const t=await zv(e);return t.buffer.buffer}async localLocalhost(e,t){const i=this._environmentService.remoteAuthority;const s=i?await this._remoteAuthorityResolverService.resolveAuthority(i):void 0;const o=s?await this._portMappingManager.getRedirect(s.authority,t):void 0;return this._send("did-load-localhost",{id:e,origin:t,location:o})}focus(){this._doFocus();this.handleFocusChange(true)}_doFocus(){if(!this.element){return}try{this.element.contentWindow?.focus()}catch{}this._focusDelayer.trigger(async()=>{if(!this.isFocused||!this.element){return}if(this.window?.document.activeElement&&this.window.document.activeElement!==this.element&&this.window.document.activeElement?.tagName!=="BODY"){return}this.window?.document.body?.focus();this._send("focus",void 0)})}find(e,t){if(!this.element){return}this._send("find",{value:e,previous:t})}updateFind(e){if(!e||!this.element){return}this._send("find",{value:e})}stopFind(e){if(!this.element){return}this._send("find-stop",{clearSelection:!e});this._onDidStopFind.fire()}showFind(e=true){this._webviewFindWidget?.reveal(void 0,e)}hideFind(e=true){this._webviewFindWidget?.hide(e)}runFindAction(e){this._webviewFindWidget?.find(e)}};gc=E([h(2,X),h(3,ot),h(4,Qe),h(5,Qt),h(6,je),h(7,et),h(8,$v),h(9,Vt),h(10,N),h(11,qv)],gc);let fc=class dx extends k{get window(){return ua(this._windowId,true).window}constructor(e,t,i,s){super();this._layoutService=t;this._webviewService=i;this._baseContextKeyService=s;this._isFirstLoad=true;this._firstLoadPendingMessages=new Set;this._webview=this._register(new Ie);this._webviewEvents=this._register(new L);this._html="";this._initialScrollProgress=0;this._state=void 0;this._owner=void 0;this._windowId=void 0;this._scopedContextKeyService=this._register(new Ie);this._shouldShowFindWidgetOnRestore=false;this._isDisposed=false;this._onDidDispose=this._register(new _);this.onDidDispose=this._onDidDispose.event;this._onDidFocus=this._register(new _);this.onDidFocus=this._onDidFocus.event;this._onDidBlur=this._register(new _);this.onDidBlur=this._onDidBlur.event;this._onDidClickLink=this._register(new _);this.onDidClickLink=this._onDidClickLink.event;this._onDidReload=this._register(new _);this.onDidReload=this._onDidReload.event;this._onDidScroll=this._register(new _);this.onDidScroll=this._onDidScroll.event;this._onDidUpdateState=this._register(new _);this.onDidUpdateState=this._onDidUpdateState.event;this._onMessage=this._register(new _);this.onMessage=this._onMessage.event;this._onMissingCsp=this._register(new _);this.onMissingCsp=this._onMissingCsp.event;this._onDidWheel=this._register(new _);this.onDidWheel=this._onDidWheel.event;this._onFatalError=this._register(new _);this.onFatalError=this._onFatalError.event;this.providedViewType=e.providedViewType;this.origin=e.origin??yo();this._title=e.title;this._extension=e.extension;this._options=e.options;this._contentOptions=e.contentOptions}get isFocused(){return!!this._webview.value?.isFocused}dispose(){this._isDisposed=true;this._container?.domNode.remove();this._container=void 0;for(const e of this._firstLoadPendingMessages){e.resolve(false)}this._firstLoadPendingMessages.clear();this._onDidDispose.fire();super.dispose()}get container(){if(this._isDisposed){throw new Error(`OverlayWebview has been disposed`)}if(!this._container){const e=document.createElement("div");e.style.position="absolute";e.style.overflow="hidden";this._container=new jv(e);this._container.setVisibility("hidden");this._layoutService.getContainer(this.window).appendChild(e)}return this._container.domNode}claim(e,t,i){if(this._isDisposed){return}const s=this._owner;if(this._windowId!==t.vscodeWindowId){this.release(s);this._webview.clear();this._webviewEvents.clear();this._container?.domNode.remove();this._container=void 0}this._owner=e;this._windowId=t.vscodeWindowId;this._show(t);if(s!==e){const o=i||this._baseContextKeyService;this._scopedContextKeyService.clear();this._scopedContextKeyService.value=o.createScoped(this.container);const n=this._findWidgetVisible?.get();this._findWidgetVisible?.reset();this._findWidgetVisible=sg.bindTo(o);this._findWidgetVisible.set(!!n);this._findWidgetEnabled?.reset();this._findWidgetEnabled=og.bindTo(o);this._findWidgetEnabled.set(!!this.options.enableFindWidget);this._webview.value?.setContextKeyService(this._scopedContextKeyService.value)}}release(e){if(this._owner!==e){return}this._scopedContextKeyService.clear();this._owner=void 0;if(this._container){this._container.setVisibility("hidden")}if(this._options.retainContextWhenHidden){this._shouldShowFindWidgetOnRestore=!!this._findWidgetVisible?.get();this.hideFind(false)}else{this._webview.clear();this._webviewEvents.clear()}}layoutWebviewOverElement(e,t,i){if(!this._container||!this._container.domNode.parentElement){return}const s=this._layoutService.whenContainerStylesLoaded(this.window);if(s){s.then(()=>this.doLayoutWebviewOverElement(e,t,i))}else{this.doLayoutWebviewOverElement(e,t,i)}}doLayoutWebviewOverElement(e,t,i){if(!this._container||!this._container.domNode.parentElement){return}const s=e.getBoundingClientRect();const o=this._container.domNode.parentElement.getBoundingClientRect();const n=(o.height-this._container.domNode.parentElement.clientHeight)/2;const r=(o.width-this._container.domNode.parentElement.clientWidth)/2;this._container.setTop(s.top-o.top-n);this._container.setLeft(s.left-o.left-r);this._container.setWidth(t?t.width:s.width);this._container.setHeight(t?t.height:s.height);if(i){const{top:d,left:l,right:u,bottom:p}=PI(s,i);this._container.domNode.style.clipPath=`polygon(${l}px ${d}px, ${u}px ${d}px, ${u}px ${p}px, ${l}px ${p}px)`}}_show(e){if(this._isDisposed){throw new Error("OverlayWebview is disposed")}if(!this._webview.value){const t=this._webviewService.createWebviewElement({providedViewType:this.providedViewType,origin:this.origin,title:this._title,options:this._options,contentOptions:this._contentOptions,extension:this.extension});this._webview.value=t;t.state=this._state;if(this._scopedContextKeyService.value){this._webview.value.setContextKeyService(this._scopedContextKeyService.value)}if(this._html){t.setHtml(this._html)}if(this._options.tryRestoreScrollPosition){t.initialScrollProgress=this._initialScrollProgress}this._findWidgetEnabled?.set(!!this.options.enableFindWidget);t.mountTo(this.container,e);this._webviewEvents.clear();this._webviewEvents.add(t.onDidFocus(()=>{this._onDidFocus.fire()}));this._webviewEvents.add(t.onDidBlur(()=>{this._onDidBlur.fire()}));this._webviewEvents.add(t.onDidClickLink(i=>{this._onDidClickLink.fire(i)}));this._webviewEvents.add(t.onMessage(i=>{this._onMessage.fire(i)}));this._webviewEvents.add(t.onMissingCsp(i=>{this._onMissingCsp.fire(i)}));this._webviewEvents.add(t.onDidWheel(i=>{this._onDidWheel.fire(i)}));this._webviewEvents.add(t.onDidReload(()=>{this._onDidReload.fire()}));this._webviewEvents.add(t.onFatalError(i=>{this._onFatalError.fire(i)}));this._webviewEvents.add(t.onDidScroll(i=>{this._initialScrollProgress=i.scrollYPercentage;this._onDidScroll.fire(i)}));this._webviewEvents.add(t.onDidUpdateState(i=>{this._state=i;this._onDidUpdateState.fire(i)}));if(this._isFirstLoad){this._firstLoadPendingMessages.forEach(async i=>{i.resolve(await t.postMessage(i.message,i.transfer))})}this._isFirstLoad=false;this._firstLoadPendingMessages.clear()}if(this.options.retainContextWhenHidden&&this._shouldShowFindWidgetOnRestore){this.showFind(false);this._shouldShowFindWidgetOnRestore=false}this._container?.setVisibility("visible")}setHtml(e){this._html=e;this._withWebview(t=>t.setHtml(e))}setTitle(e){this._title=e;this._withWebview(t=>t.setTitle(e))}get initialScrollProgress(){return this._initialScrollProgress}set initialScrollProgress(e){this._initialScrollProgress=e;this._withWebview(t=>t.initialScrollProgress=e)}get state(){return this._state}set state(e){this._state=e;this._withWebview(t=>t.state=e)}get extension(){return this._extension}set extension(e){this._extension=e;this._withWebview(t=>t.extension=e)}get options(){return this._options}set options(e){this._options={customClasses:this._options.customClasses,...e}}get contentOptions(){return this._contentOptions}set contentOptions(e){this._contentOptions=e;this._withWebview(t=>t.contentOptions=e)}set localResourcesRoot(e){this._withWebview(t=>t.localResourcesRoot=e)}async postMessage(e,t){if(this._webview.value){return this._webview.value.postMessage(e,t)}if(this._isFirstLoad){let i;const s=new Promise(o=>i=o);this._firstLoadPendingMessages.add({message:e,transfer:t,resolve:i});return s}return false}focus(){this._webview.value?.focus()}reload(){this._webview.value?.reload()}selectAll(){this._webview.value?.selectAll()}copy(){this._webview.value?.copy()}paste(){this._webview.value?.paste()}cut(){this._webview.value?.cut()}undo(){this._webview.value?.undo()}redo(){this._webview.value?.redo()}showFind(e=true){if(this._webview.value){this._webview.value.showFind(e);this._findWidgetVisible?.set(true)}}hideFind(e=true){this._findWidgetVisible?.reset();this._webview.value?.hideFind(e)}runFindAction(e){this._webview.value?.runFindAction(e)}_withWebview(e){if(this._webview.value){e(this._webview.value)}}windowDidDragStart(){this._webview.value?.windowDidDragStart()}windowDidDragEnd(){this._webview.value?.windowDidDragEnd()}setContextKeyService(e){this._webview.value?.setContextKeyService(e)}};fc=E([h(1,Te),h(2,Ps),h(3,ee)],fc);function PI(a,e){const t=e.getBoundingClientRect();const i=Math.max(t.top-a.top,0);const s=Math.max(a.width-(a.right-t.right),0);const o=Math.max(a.height-(a.bottom-t.bottom),0);const n=Math.max(t.left-a.left,0);return{top:i,right:s,bottom:o,left:n}}let mc=class cx extends k{constructor(e){super();this._instantiationService=e;this._webviews=new Set;this._onDidChangeActiveWebview=this._register(new _);this.onDidChangeActiveWebview=this._onDidChangeActiveWebview.event;this._webviewThemeDataProvider=this._instantiationService.createInstance(uc)}get activeWebview(){return this._activeWebview}_updateActiveWebview(e){if(e!==this._activeWebview){this._activeWebview=e;this._onDidChangeActiveWebview.fire(e)}}get webviews(){return this._webviews.values()}createWebviewElement(e){const t=this._instantiationService.createInstance(gc,e,this._webviewThemeDataProvider);this.registerNewWebview(t);return t}createWebviewOverlay(e){const t=this._instantiationService.createInstance(fc,e);this.registerNewWebview(t);return t}registerNewWebview(e){this._webviews.add(e);const t=new L;t.add(e.onDidFocus(()=>{this._updateActiveWebview(e)}));const i=()=>{if(this._activeWebview===e){this._updateActiveWebview(void 0)}};t.add(e.onDidBlur(i));t.add(e.onDidDispose(()=>{i();t.dispose();this._webviews.delete(e)}))}};mc=E([h(0,N)],mc);class LI extends k{constructor(){super(...arguments);this._resolvers=new Map;this._awaitingRevival=new Map;this._onNewResolverRegistered=this._register(new _);this.onNewResolverRegistered=this._onNewResolverRegistered.event}register(e,t){if(this._resolvers.has(e)){throw new Error(`View resolver already registered for ${e}`)}this._resolvers.set(e,t);this._onNewResolverRegistered.fire({viewType:e});const i=this._awaitingRevival.get(e);if(i){t.resolve(i.webview,ei.None).then(()=>{this._awaitingRevival.delete(e);i.resolve()})}return de(()=>{this._resolvers.delete(e)})}resolve(e,t,i){const s=this._resolvers.get(e);if(!s){if(this._awaitingRevival.has(e)){throw new Error("View already awaiting revival")}const{promise:o,resolve:n}=ig();this._awaitingRevival.set(e,{webview:t,resolve:n});return o}return s.resolve(t,i)}}const MI=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));const OI=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Le(OI);class NI extends k{constructor(e,t,i,s){super();this.container=e;this.message=t;this.options=s;this.modalElement=this.container.appendChild(G(`.monaco-dialog-modal-block.dimmed`));this.shadowElement=this.modalElement.appendChild(G(".dialog-shadow"));this.element=this.shadowElement.appendChild(G(".monaco-dialog-box"));this.element.setAttribute("role","dialog");this.element.tabIndex=-1;on(this.element);this.buttonStyles=s.buttonStyles;if(Array.isArray(i)&&i.length>0){this.buttons=i}else if(!this.options.disableDefaultAction){this.buttons=[c(3,"OK")]}else{this.buttons=[]}const o=this.element.appendChild(G(".dialog-buttons-row"));this.buttonsContainer=o.appendChild(G(".dialog-buttons"));const n=this.element.appendChild(G(".dialog-message-row"));this.iconElement=n.appendChild(G("#monaco-dialog-icon.dialog-icon"));this.iconElement.setAttribute("aria-label",this.getIconAriaLabel());this.messageContainer=n.appendChild(G(".dialog-message-container"));if(this.options.detail||this.options.renderBody){const d=this.messageContainer.appendChild(G(".dialog-message"));const l=d.appendChild(G("#monaco-dialog-message-text.dialog-message-text"));l.innerText=this.message}this.messageDetailElement=this.messageContainer.appendChild(G("#monaco-dialog-message-detail.dialog-message-detail"));if(this.options.detail||!this.options.renderBody){this.messageDetailElement.innerText=this.options.detail?this.options.detail:t}else{this.messageDetailElement.style.display="none"}if(this.options.renderBody){const d=this.messageContainer.appendChild(G("#monaco-dialog-message-body.dialog-message-body"));this.options.renderBody(d);for(const l of this.messageContainer.querySelectorAll("a")){l.tabIndex=0}}if(this.options.inputs){this.inputs=this.options.inputs.map(d=>{const l=this.messageContainer.appendChild(G(".dialog-message-input"));const u=this._register(new ng(l,void 0,{placeholder:d.placeholder,type:d.type??"text",inputBoxStyles:s.inputBoxStyles}));if(d.value){u.value=d.value}return u})}else{this.inputs=[]}if(this.options.checkboxLabel){const d=this.messageContainer.appendChild(G(".dialog-checkbox-row"));const l=this.checkbox=this._register(new Yv(this.options.checkboxLabel,!!this.options.checkboxChecked,s.checkboxStyles));d.appendChild(l.domNode);const u=d.appendChild(G(".dialog-checkbox-message"));u.innerText=this.options.checkboxLabel;this._register(J(u,se.CLICK,()=>l.checked=!l.checked))}const r=this.element.appendChild(G(".dialog-toolbar-row"));this.toolbarContainer=r.appendChild(G(".dialog-toolbar"));this.applyStyles()}getIconAriaLabel(){let e=c(4,"Info");switch(this.options.type){case"error":e=c(5,"Error");break;case"warning":e=c(6,"Warning");break;case"pending":e=c(7,"In Progress");break}return e}updateMessage(e){this.messageDetailElement.innerText=e}async show(){this.focusToReturn=this.container.ownerDocument.activeElement;return new Promise(e=>{jl(this.buttonsContainer);const t=()=>{e({button:this.options.cancelId||0,checkboxChecked:this.checkbox?this.checkbox.checked:void 0});return};this._register(de(t));const i=this.buttonBar=this._register(new rg(this.buttonsContainer));const s=this.rearrangeButtons(this.buttons,this.options.cancelId);const o=d=>{e({button:s[d].index,checkboxChecked:this.checkbox?this.checkbox.checked:void 0,values:this.inputs.length>0?this.inputs.map(l=>l.value):void 0})};s.forEach((d,l)=>{const u=s[l].index===0;let p;if(u&&this.options?.primaryButtonDropdown){const f=Zv(this.options.primaryButtonDropdown.actions)?this.options.primaryButtonDropdown.actions.getActions():this.options.primaryButtonDropdown.actions;p=this._register(i.addButtonWithDropdown({...this.options.primaryButtonDropdown,...this.buttonStyles,dropdownLayer:2600,actions:f.map(g=>Js({...g,run:async()=>{await g.run();o(l)}}))}))}else if(this.options.buttonDetails){p=this._register(i.addButtonWithDescription({secondary:!u,...this.buttonStyles}))}else{p=this._register(i.addButton({secondary:!u,...this.buttonStyles}))}p.label=Jv(s[l].label,true);if(p instanceof Xv){p.description=this.options.buttonDetails[s[l].index]}this._register(p.onDidClick(f=>{if(f){Ve.stop(f)}o(l)}))});const n=wt(this.container);this._register(J(n,"keydown",d=>{const l=new eu(d);if(l.equals(O.Alt)){l.preventDefault()}if(l.equals(T.Enter)){if(this.inputs.some(p=>p.hasFocus())){Ve.stop(d);e({button:s.find(p=>p.index!==this.options.cancelId)?.index??0,checkboxChecked:this.checkbox?this.checkbox.checked:void 0,values:this.inputs.length>0?this.inputs.map(p=>p.value):void 0})}return}if(mt&&l.equals(O.CtrlCmd|T.KeyD)){Ve.stop(d);const p=s.find(f=>f.index===1&&f.index!==this.options.cancelId);if(p){e({button:p.index,checkboxChecked:this.checkbox?this.checkbox.checked:void 0,values:this.inputs.length>0?this.inputs.map(f=>f.value):void 0})}return}if(l.equals(T.Space)){return}let u=false;if(l.equals(T.Tab)||l.equals(T.RightArrow)||l.equals(O.Shift|T.Tab)||l.equals(T.LeftArrow)){const p=[];let f=-1;if(this.messageContainer){const g=this.messageContainer.querySelectorAll("a");for(const m of g){p.push(m);if(ag(m)){f=p.length-1}}}for(const g of this.inputs){p.push(g);if(g.hasFocus()){f=p.length-1}}if(this.checkbox){p.push(this.checkbox);if(this.checkbox.hasFocus()){f=p.length-1}}if(this.buttonBar){for(const g of this.buttonBar.buttons){if(g instanceof Qv){p.push(g.primaryButton);if(g.primaryButton.hasFocus()){f=p.length-1}p.push(g.dropdownButton);if(g.dropdownButton.hasFocus()){f=p.length-1}}else{p.push(g);if(g.hasFocus()){f=p.length-1}}}}if(l.equals(T.Tab)||l.equals(T.RightArrow)){const g=(f+1)%p.length;p[g].focus()}else{if(f===-1){f=p.length}let g=f-1;if(g===-1){g=p.length-1}p[g].focus()}u=true}if(u){Ve.stop(d,true)}else if(this.options.keyEventProcessor){this.options.keyEventProcessor(l)}},true));this._register(J(n,"keyup",d=>{Ve.stop(d,true);const l=new eu(d);if(!this.options.disableCloseAction&&l.equals(T.Escape)){t()}},true));this._register(J(this.element,"focusout",d=>{if(!!d.relatedTarget&&!!this.element){if(!Sd(d.relatedTarget,this.element)){this.focusToReturn=d.relatedTarget;if(d.target){d.target.focus();Ve.stop(d,true)}}}},false));const r="codicon-modifier-spin";this.iconElement.classList.remove(...ye.asClassNameArray(A.dialogError),...ye.asClassNameArray(A.dialogWarning),...ye.asClassNameArray(A.dialogInfo),...ye.asClassNameArray(A.loading),r);if(this.options.icon){this.iconElement.classList.add(...ye.asClassNameArray(this.options.icon))}else{switch(this.options.type){case"error":this.iconElement.classList.add(...ye.asClassNameArray(A.dialogError));break;case"warning":this.iconElement.classList.add(...ye.asClassNameArray(A.dialogWarning));break;case"pending":this.iconElement.classList.add(...ye.asClassNameArray(A.loading),r);break;case"none":this.iconElement.classList.add("no-codicon");break;case"info":case"question":default:this.iconElement.classList.add(...ye.asClassNameArray(A.dialogInfo));break}}if(!this.options.disableCloseAction){const d=this._register(new En(this.toolbarContainer,{}));const l=this._register(new ti("dialog.close",c(8,"Close Dialog"),ye.asClassName(A.dialogClose),true,async()=>{e({button:this.options.cancelId||0,checkboxChecked:this.checkbox?this.checkbox.checked:void 0})}));d.push(l,{icon:true,label:false})}this.applyStyles();this.element.setAttribute("aria-modal","true");this.element.setAttribute("aria-labelledby","monaco-dialog-icon monaco-dialog-message-text");this.element.setAttribute("aria-describedby","monaco-dialog-icon monaco-dialog-message-text monaco-dialog-message-detail monaco-dialog-message-body");sn(this.element);if(this.inputs.length>0){this.inputs[0].focus();this.inputs[0].select()}else{s.forEach((d,l)=>{if(d.index===0){i.buttons[l].focus()}})}})}applyStyles(){const e=this.options.dialogStyles;const t=e.dialogForeground;const i=e.dialogBackground;const s=e.dialogShadow?`0 0px 8px ${e.dialogShadow}`:"";const o=e.dialogBorder?`1px solid ${e.dialogBorder}`:"";const n=e.textLinkForeground;this.shadowElement.style.boxShadow=s;this.element.style.color=t??"";this.element.style.backgroundColor=i??"";this.element.style.border=o;if(n){for(const d of this.messageContainer.getElementsByTagName("a")){d.style.color=n}}let r;switch(this.options.type){case"none":break;case"error":r=e.errorIconForeground;break;case"warning":r=e.warningIconForeground;break;default:r=e.infoIconForeground;break}if(r){this.iconElement.style.color=r}}dispose(){super.dispose();if(this.modalElement){this.modalElement.remove();this.modalElement=void 0}if(this.focusToReturn&&Sd(this.focusToReturn,this.container.ownerDocument.body)){this.focusToReturn.focus();this.focusToReturn=void 0}}rearrangeButtons(e,t){const i=e.map((s,o)=>({label:s,index:o}));if(e.length<2){return i}if(mt||ey){if(typeof t==="number"&&i[t]){const s=i.splice(t,1)[0];i.splice(1,0,s)}i.reverse()}else if(dg){if(typeof t==="number"&&i[t]){const s=i.splice(t,1)[0];i.push(s)}}return i}}const BI=["workbench.action.quit","workbench.action.reloadWindow","copy","cut","editor.action.selectAll","editor.action.clipboardCopyAction","editor.action.clipboardCutAction","editor.action.clipboardPasteAction"];function FI(a,e,t,i=BI){return{keyEventProcessor:s=>{const o=e.softDispatch(s,t.activeContainer);if(o.kind===sy.KbFound&&o.commandId){if(!i.includes(o.commandId)){Ve.stop(s,true)}}},buttonStyles:nn,checkboxStyles:iy,inputBoxStyles:$l,dialogStyles:ty,...a}}Le(MI);let wc=class lx extends k{constructor(e,t,i,s,o,n,r,d,l){super();this.activityService=e;this.paneCompositeService=t;this.viewDescriptorService=i;this.viewsService=s;this.notificationService=o;this.statusbarService=n;this.layoutService=r;this.keybindingService=d;this.userActivityService=l;this.windowProgressStack=[];this.windowProgressStatusEntry=void 0}async withProgress(e,t,i){const{location:s}=e;const o=async r=>{const d=this.userActivityService.markActive({whenHeldFor:15e3});try{return await t(r)}finally{d.dispose()}};const n=r=>{const d=this.viewDescriptorService.getViewContainerById(r);if(d){const l=this.viewDescriptorService.getViewContainerLocation(d);if(l!==null){return this.withPaneCompositeProgress(r,l,o,{...e,location:r})}}if(this.viewDescriptorService.getViewDescriptorById(r)!==null){return this.withViewProgress(r,o,{...e,location:r})}throw new Error(`Bad progress location: ${r}`)};if(typeof s==="string"){return n(s)}switch(s){case $i.Notification:{let r=e.priority;if(r!==Ro.URGENT){if(this.notificationService.getFilter()===tu.ERROR){r=Ro.SILENT}else if(oy(e.source)&&this.notificationService.getFilter(e.source)===tu.ERROR){r=Ro.SILENT}}return this.withNotificationProgress({...e,location:s,priority:r},o,i)}case $i.Window:{const r=e.type;if(e.command){return this.withWindowProgress({...e,location:s,type:r},o)}return this.withNotificationProgress({delay:150,...e,priority:Ro.SILENT,location:$i.Notification,type:r},o,i)}case $i.Explorer:return this.withPaneCompositeProgress("workbench.view.explorer",$.Sidebar,o,{...e,location:s});case $i.Scm:return n("workbench.scm");case $i.Extensions:return this.withPaneCompositeProgress("workbench.view.extensions",$.Sidebar,o,{...e,location:s});case $i.Dialog:return this.withDialogProgress(e,o,i);default:throw new Error(`Bad progress location: ${s}`)}}withWindowProgress(e,t){const i=[e,new cg(()=>this.updateWindowProgress())];const s=t(i[1]);let o=setTimeout(()=>{o=void 0;this.windowProgressStack.unshift(i);this.updateWindowProgress();Promise.all([rn(150),s]).finally(()=>{const n=this.windowProgressStack.indexOf(i);this.windowProgressStack.splice(n,1);this.updateWindowProgress()})},150);return s.finally(()=>clearTimeout(o))}updateWindowProgress(e=0){if(e<this.windowProgressStack.length){const[t,i]=this.windowProgressStack[e];const s=t.title;const o=i.value&&i.value.message;const n=t.command;let r;let d;const l=t.source&&typeof t.source!=="string"?t.source.label:t.source;if(s&&o){r=c(12530,"{0}: {1}",s,o);d=l?c(12531,"[{0}] {1}: {2}",l,s,o):r}else if(s){r=s;d=l?c(12532,"[{0}]: {1}",l,s):r}else if(o){r=o;d=l?c(12532,"[{0}]: {1}",l,o):r}else{this.updateWindowProgress(e+1);return}const u={name:c(12533,"Progress Message"),text:r,showProgress:t.type||true,ariaLabel:r,tooltip:iu(d).trim(),command:n};if(this.windowProgressStatusEntry){this.windowProgressStatusEntry.update(u)}else{this.windowProgressStatusEntry=this.statusbarService.addEntry(u,"status.progress",Ke.LEFT,-Number.MAX_VALUE)}}else{this.windowProgressStatusEntry?.dispose();this.windowProgressStatusEntry=void 0}}withNotificationProgress(e,t,i){const s=new class extends k{get step(){return this._step}get done(){return this._done}constructor(){super();this._onDidReport=this._register(new _);this.onDidReport=this._onDidReport.event;this._onWillDispose=this._register(new _);this.onWillDispose=this._onWillDispose.event;this._step=void 0;this._done=false;this.promise=t(this);this.promise.finally(()=>{this.dispose()})}report(g){this._step=g;this._onDidReport.fire(g)}cancel(g){i?.(g);this.dispose()}dispose(){this._done=true;this._onWillDispose.fire();super.dispose()}};const o=()=>{const g=new no;this.withWindowProgress({location:$i.Window,title:e.title?vr(e.title).toString():void 0,command:"notifications.showList",type:e.type},m=>{function y(D){if(D.message){m.report({message:vr(D.message).toString()})}}if(s.step){y(s.step)}const C=s.onDidReport(D=>y(D));g.p.finally(()=>C.dispose());x.once(s.onWillDispose)(()=>g.complete());return g.p});return de(()=>g.complete())};const n=(g,m,y)=>{const C=new L;const D=e.primaryActions?Array.from(e.primaryActions):[];const F=e.secondaryActions?Array.from(e.secondaryActions):[];if(e.buttons){e.buttons.forEach((H,Z)=>{const ie=new class extends ti{constructor(){super(`progress.button.${H}`,H,void 0,true)}async run(){s.cancel(Z)}};C.add(ie);D.push(ie)})}if(e.cancellable){const H=new class extends ti{constructor(){super("progress.cancel",typeof e.cancellable==="string"?e.cancellable:c(12534,"Cancel"),void 0,true)}async run(){s.cancel()}};C.add(H);D.push(H)}const P=this.notificationService.notify({severity:ve.Info,message:iu(g),source:e.source,actions:{primary:D,secondary:F},progress:typeof y==="number"&&y>=0?{total:100,worked:y}:{infinite:true},priority:m});let R=void 0;const z=H=>{$e(R);if(!H&&!s.done){R=o()}};C.add(P.onDidChangeVisibility(z));if(m===Ro.SILENT){z(false)}x.once(P.onDidClose)(()=>{C.dispose();$e(R)});return P};const r=(g,m)=>{if(typeof m==="number"&&m>=0){g.progress.total(100);g.progress.worked(m)}else{g.progress.infinite()}};let d;let l;let u;const p=g=>{if(g?.message&&e.title){u=`${e.title}: ${g.message}`}else{u=e.title||g?.message}if(!d&&u){if(typeof e.delay==="number"&&e.delay>0){if(typeof l!=="number"){l=setTimeout(()=>d=n(u,e.priority,g?.increment),e.delay)}}else{d=n(u,e.priority,g?.increment)}}if(d){if(u){d.updateMessage(u)}if(typeof g?.increment==="number"){r(d,g.increment)}}};p(s.step);const f=s.onDidReport(g=>p(g));x.once(s.onWillDispose)(()=>f.dispose());(async()=>{try{if(typeof e.delay==="number"&&e.delay>0){await s.promise}else{await Promise.all([rn(800),s.promise])}}finally{clearTimeout(l);d?.close()}})();return s.promise}withPaneCompositeProgress(e,t,i,s){const o=this.paneCompositeService.getProgressIndicator(e,t);const n=o?this.withCompositeProgress(o,i,s):i({report:()=>{}});if(t===$.Sidebar){this.showOnActivityBar(e,s,n)}return n}withViewProgress(e,t,i){const s=this.viewsService.getViewProgressIndicator(e);const o=s?this.withCompositeProgress(s,t,i):t({report:()=>{}});const n=this.viewDescriptorService.getViewContainerByViewId(e)?.id;if(n===void 0){return o}this.showOnActivityBar(n,i,o);return o}showOnActivityBar(e,t,i){let s;let o=setTimeout(()=>{o=void 0;const n=this.activityService.showViewContainerActivity(e,{badge:new ny(()=>"")});const r=Date.now();const d=300;s={dispose(){const l=Date.now()-r;if(l<d){setTimeout(()=>n.dispose(),d-l)}else{n.dispose()}}}},t.delay||300);i.finally(()=>{clearTimeout(o);$e(s)})}withCompositeProgress(e,t,i){let s=void 0;function o(r){let d=void 0;let l=void 0;if(typeof r!=="undefined"){if(typeof r==="number"){d=r}else if(typeof r.increment==="number"){d=r.total??100;l=r.increment}}if(typeof d==="number"){if(!s){s=e.show(d,i.delay);n.catch(()=>void 0).finally(()=>s?.done())}if(typeof l==="number"){s.worked(l)}}else{s?.done();e.showWhile(n,i.delay)}return s}const n=t({report:r=>{o(r)}});o(i.total);return n}withDialogProgress(e,t,i){const s=new L;let o;let n=false;const r=g=>{const m=e.buttons||[];if(!e.sticky){m.push(e.cancellable?typeof e.cancellable==="boolean"?c(12534,"Cancel"):e.cancellable:c(12535,"Dismiss"))}o=new NI(this.layoutService.activeContainer,g,m,FI({type:"pending",detail:e.detail,cancelId:m.length-1,disableCloseAction:e.sticky,disableDefaultAction:e.sticky},this.keybindingService,this.layoutService));s.add(o);o.show().then(y=>{if(!n){i?.(y.button)}$e(o)});return o};let d=e.delay??0;let l=void 0;const u=s.add(new zp(()=>{d=0;if(l&&!o){o=r(l)}else if(l){o.updateMessage(l)}},0));const p=function(g){l=g;if(!u.isScheduled()){u.schedule(d)}};const f=t({report:g=>{p(g.message)}});f.finally(()=>{n=true;$e(s)});if(e.title){p(e.title)}return f}};wc=E([h(0,ks),h(1,Vs),h(2,We),h(3,st),h(4,Qe),h(5,ss),h(6,lg),h(7,zt),h(8,ry)],wc);let vc=class hx extends k{constructor(e){super();this.paneCompositeParts=new Map;const t=e.createInstance(Yd);const i=e.createInstance(zd);const s=e.createInstance(ec);this.paneCompositeParts.set($.Panel,t);this.paneCompositeParts.set($.Sidebar,i);this.paneCompositeParts.set($.AuxiliaryBar,s);const o=this._register(new L);this.onDidPaneCompositeOpen=x.any(...su.map(n=>x.map(this.paneCompositeParts.get(n).onDidPaneCompositeOpen,r=>{return{composite:r,viewContainerLocation:n}},o)));this.onDidPaneCompositeClose=x.any(...su.map(n=>x.map(this.paneCompositeParts.get(n).onDidPaneCompositeClose,r=>{return{composite:r,viewContainerLocation:n}},o)))}openPaneComposite(e,t,i){return this.getPartByLocation(t).openPaneComposite(e,i)}getActivePaneComposite(e){return this.getPartByLocation(e).getActivePaneComposite()}getPaneComposite(e,t){return this.getPartByLocation(t).getPaneComposite(e)}getPaneComposites(e){return this.getPartByLocation(e).getPaneComposites()}getPinnedPaneCompositeIds(e){return this.getPartByLocation(e).getPinnedPaneCompositeIds()}getVisiblePaneCompositeIds(e){return this.getPartByLocation(e).getVisiblePaneCompositeIds()}getPaneCompositeIds(e){return this.getPartByLocation(e).getPaneCompositeIds()}getProgressIndicator(e,t){return this.getPartByLocation(t).getProgressIndicator(e)}hideActivePaneComposite(e){this.getPartByLocation(e).hideActivePaneComposite()}getLastActivePaneCompositeId(e){return this.getPartByLocation(e).getLastActivePaneCompositeId()}getPartByLocation(e){return Se(this.paneCompositeParts.get(e))}};vc=E([h(0,N)],vc);async function GI(a){const e=navigator.usb;if(!e){return void 0}const t=await e.requestDevice({filters:a?.filters??[]});if(!t){return void 0}return{deviceClass:t.deviceClass,deviceProtocol:t.deviceProtocol,deviceSubclass:t.deviceSubclass,deviceVersionMajor:t.deviceVersionMajor,deviceVersionMinor:t.deviceVersionMinor,deviceVersionSubminor:t.deviceVersionSubminor,manufacturerName:t.manufacturerName,productId:t.productId,productName:t.productName,serialNumber:t.serialNumber,usbVersionMajor:t.usbVersionMajor,usbVersionMinor:t.usbVersionMinor,usbVersionSubminor:t.usbVersionSubminor,vendorId:t.vendorId}}async function WI(a){const e=navigator.serial;if(!e){return void 0}const t=await e.requestPort({filters:a?.filters??[]});if(!t){return void 0}const i=t.getInfo();return{usbVendorId:i.usbVendorId,usbProductId:i.usbProductId}}async function HI(a){const e=navigator.hid;if(!e){return void 0}const t=await e.requestDevice({filters:a?.filters??[]});if(!t.length){return void 0}const i=t[0];return{opened:i.opened,vendorId:i.vendorId,productId:i.productId,productName:i.productName,collections:i.collections}}const UI=c(1893,"open");const KI=c(1894,"close");const zI=c(1895,"find");var ud={open:UI,close:KI,find:zI};let yc=class ux{constructor(e,t,i,s){this.fileService=e;this.environmentService=t;this.lifecycleService=i;this.logService=s}async getLogs(){return ay(this.fileService,this.environmentService)}async whenWorkbenchRestored(){this.logService.info("[driver] Waiting for restored lifecycle phase...");await this.lifecycleService.when(_n.Restored);this.logService.info("[driver] Restored lifecycle phase reached. Waiting for contributions...");await W.as(pa.Workbench).whenRestored;this.logService.info("[driver] Workbench contributions created.")}async setValue(e,t){const i=ae.document.querySelector(e);if(!i){return Promise.reject(new Error(`Element not found: ${e}`))}const s=i;s.value=t;const o=new Event("input",{bubbles:true,cancelable:true});s.dispatchEvent(o)}async isActiveElement(e){const t=ae.document.querySelector(e);if(t!==ae.document.activeElement){const i=[];let s=ae.document.activeElement;while(s){const o=s.tagName;const n=s.id?`#${s.id}`:"";const r=ts(s.className.split(/\s+/g).map(d=>d.trim())).map(d=>`.${d}`).join("");i.unshift(`${o}${n}${r}`);s=s.parentElement}throw new Error(`Active element not found. Current active element is '${i.join(" > ")}'. Looking for ${e}`)}return true}async getElements(e,t){const i=ae.document.querySelectorAll(e);const s=[];for(let o=0;o<i.length;o++){const n=i.item(o);s.push(this.serializeElement(n,t))}return s}serializeElement(e,t){const i=Object.create(null);for(let r=0;r<e.attributes.length;r++){const d=e.attributes.item(r);if(d){i[d.name]=d.value}}const s=[];if(t){for(let r=0;r<e.children.length;r++){const d=e.children.item(r);if(d){s.push(this.serializeElement(d,true))}}}const{left:o,top:n}=ou(e);return{tagName:e.tagName,className:e.className,textContent:e.textContent||"",attributes:i,children:s,left:o,top:n}}async getElementXY(e,t,i){const s=typeof t==="number"&&typeof i==="number"?{x:t,y:i}:void 0;return this._getElementXY(e,s)}async typeInEditor(e,t){const i=ae.document.querySelector(e);if(!i){throw new Error(`Editor not found: ${e}`)}if(nu(i)){const s=i.editContext;if(!s){throw new Error(`Edit context not found: ${e}`)}const o=s.selectionStart;const n=s.selectionEnd;const r=new TextUpdateEvent("textupdate",{updateRangeStart:o,updateRangeEnd:n,text:t,selectionStart:o+t.length,selectionEnd:o+t.length,compositionStart:0,compositionEnd:0});s.dispatchEvent(r)}else if(ru(i)){const s=i.selectionStart;const o=s+t.length;const n=i.value;const r=n.substr(0,s)+t+n.substr(s);i.value=r;i.setSelectionRange(o,o);const d=new Event("input",{"bubbles":true,"cancelable":true});i.dispatchEvent(d)}}async getEditorSelection(e){const t=ae.document.querySelector(e);if(!t){throw new Error(`Editor not found: ${e}`)}if(nu(t)){const i=t.editContext;if(!i){throw new Error(`Edit context not found: ${e}`)}return{selectionStart:i.selectionStart,selectionEnd:i.selectionEnd}}else if(ru(t)){return{selectionStart:t.selectionStart,selectionEnd:t.selectionEnd}}else{throw new Error(`Unknown type of element: ${e}`)}}async getTerminalBuffer(e){const t=ae.document.querySelector(e);if(!t){throw new Error(`Terminal not found: ${e}`)}const i=t.xterm;if(!i){throw new Error(`Xterm not found: ${e}`)}const s=[];for(let o=0;o<i.buffer.active.length;o++){s.push(i.buffer.active.getLine(o).translateToString(true))}return s}async writeInTerminal(e,t){const i=ae.document.querySelector(e);if(!i){throw new Error(`Element not found: ${e}`)}const s=i.xterm;if(!s){throw new Error(`Xterm not found: ${e}`)}s.input(t)}getLocaleInfo(){return Promise.resolve({language:cy,locale:dy})}getLocalizedStrings(){return Promise.resolve({open:ud.open,close:ud.close,find:ud.find})}async _getElementXY(e,t){const i=ae.document.querySelector(e);if(!i){return Promise.reject(new Error(`Element not found: ${e}`))}const{left:s,top:o}=ou(i);const{width:n,height:r}=ug(i);let d,l;if(t){d=s+t.x;l=o+t.y}else{d=s+n/2;l=o+r/2}d=Math.round(d);l=Math.round(l);return{x:d,y:l}}};yc=E([h(0,je),h(1,hg),h(2,bn),h(3,et)],yc);function $I(a){Object.assign(ae,{driver:a.createInstance(yc)})}var ps;let kr=class px extends k{static{ps=this}static{this.TIMEOUT_HANDLES=Number.MIN_SAFE_INTEGER}static{this.TIMEOUT_DISPOSABLES=new Map}constructor(e,t={getWindowsCount:du,getWindows:au},i,s){super();this.hostService=i;this.environmentService=s;this.enableWindowFocusOnElementFocus(e);this.enableMultiWindowAwareTimeout(e,t);this.registerFullScreenListeners(e.vscodeWindowId)}enableWindowFocusOnElementFocus(e){const t=e.HTMLElement.prototype.focus;const i=this;e.HTMLElement.prototype.focus=function(s){i.onElementFocus(wt(this));t.apply(this,[s])}}onElementFocus(e){const t=Ds();if(t!==e&&t.document.hasFocus()){e.focus();if(!this.environmentService.extensionTestsLocationURI&&!e.document.hasFocus()){this.hostService.focus(e)}}}enableMultiWindowAwareTimeout(e,t={getWindowsCount:du,getWindows:au}){const i=e.setTimeout;Object.defineProperty(e,"vscodeOriginalSetTimeout",{get:()=>i});const s=e.clearTimeout;Object.defineProperty(e,"vscodeOriginalClearTimeout",{get:()=>s});e.setTimeout=function(o,n=0,...r){if(t.getWindowsCount()===1||typeof o==="string"||n===0){return i.apply(this,[o,n,...r])}const d=new Set;const l=ps.TIMEOUT_HANDLES++;ps.TIMEOUT_DISPOSABLES.set(l,d);const u=Hl(o,()=>{$e(d);ps.TIMEOUT_DISPOSABLES.delete(l)});for(const{window:p,disposables:f}of t.getWindows()){if(pg(p)&&p.document.visibilityState==="hidden"){continue}let g=false;const m=p.vscodeOriginalSetTimeout.apply(this,[(...C)=>{if(g){return}u(...C)},n,...r]);const y=de(()=>{g=true;p.vscodeOriginalClearTimeout(m);d.delete(y)});f.add(y);d.add(y)}return l};e.clearTimeout=function(o){const n=typeof o==="number"?ps.TIMEOUT_DISPOSABLES.get(o):void 0;if(n){$e(n);ps.TIMEOUT_DISPOSABLES.delete(o)}else{s.apply(this,[o])}}}registerFullScreenListeners(e){this._register(this.hostService.onDidChangeFullScreen(({windowId:t,fullscreen:i})=>{if(t===e){const s=ua(e);if(s){ly(i,s.window)}}}))}static async confirmOnShutdown(e,t){const i=e.get(Ls);const s=e.get(X);const o=t===zo.QUIT?mt?c(3526,"Are you sure you want to quit?"):c(3527,"Are you sure you want to exit?"):c(3528,"Are you sure you want to close the window?");const n=t===zo.QUIT?mt?c(3529,"&&Quit"):c(3530,"&&Exit"):c(3531,"&&Close Window");const r=await i.confirm({message:o,primaryButton:n,checkbox:{label:c(3532,"Do not ask me again")}});if(r.confirmed&&r.checkboxChecked){await s.updateValue("window.confirmBeforeClose","never")}return r.confirmed}};kr=ps=E([h(2,is),h(3,Qt)],kr);let op=class gx extends kr{constructor(e,t,i,s,o,n,r,d,l){super(ae,void 0,l,n);this.openerService=e;this.lifecycleService=t;this.dialogService=i;this.labelService=s;this.productService=o;this.browserEnvironmentService=n;this.layoutService=r;this.instantiationService=d;this.registerListeners();this.create()}registerListeners(){this._register(this.lifecycleService.onWillShutdown(()=>this.onWillShutdown()));const e=yr&&ae.visualViewport?ae.visualViewport:ae;this._register(J(e,se.RESIZE,()=>{this.layoutService.layout();if(yr){ae.scrollTo(0,0)}}));this._register(J(this.layoutService.mainContainer,se.WHEEL,t=>t.preventDefault(),{passive:false}));this._register(J(this.layoutService.mainContainer,se.CONTEXT_MENU,t=>Ve.stop(t,true)));this._register(J(this.layoutService.mainContainer,se.DROP,t=>Ve.stop(t,true)))}onWillShutdown(){x.toPromise(x.any(x.once(new cu(ae.document.body,se.KEY_DOWN,true).event),x.once(new cu(ae.document.body,se.MOUSE_DOWN,true).event))).then(async()=>{await rn(3e3);await this.dialogService.prompt({type:ve.Error,message:c(3533,"An unexpected error occurred that requires a reload of this page."),detail:c(3534,"The workbench was unexpectedly disposed while running."),buttons:[{label:c(3535,"&&Reload"),run:()=>ae.location.reload()}]})})}create(){this.setupOpenHandlers();this.registerLabelFormatters();this.registerCommands();this.setupDriver()}setupDriver(){if(this.environmentService.enableSmokeTestDriver){$I(this.instantiationService)}}setupOpenHandlers(){this.openerService.setDefaultExternalOpener({openExternal:async e=>{let t=false;if(this.browserEnvironmentService.options?.openerAllowedExternalUrlPrefixes){for(const i of this.browserEnvironmentService.options.openerAllowedExternalUrlPrefixes){if(e.startsWith(i)){t=true;break}}}if(Ja(e,fe.http)||Ja(e,fe.https)){if(gg){const i=py(e,!t);if(!i){await this.dialogService.prompt({type:ve.Warning,message:c(3536,"The browser interrupted the opening of a new tab or window. Press 'Open' to open it anyway."),detail:e,buttons:[{label:c(3537,"&&Open"),run:()=>t?lu(e):hu(e)},{label:c(3538,"&&Learn More"),run:()=>this.openerService.open(K.parse("https://aka.ms/allow-vscode-popup"))}],cancelButton:true})}}else{t?lu(e):hu(e)}}else{const i=()=>{this.lifecycleService.withExpectedShutdown({disableShutdownHandling:true},()=>ae.location.href=e)};i();const s=async()=>{const{downloadUrl:o}=this.productService;let n;const r=[{label:c(3539,"&&Try Again"),run:()=>i()}];if(o!==void 0){n=c(3540,"We launched {0} on your computer.\n\nIf {1} did not launch, try again or install it below.",this.productService.nameLong,this.productService.nameLong);r.push({label:c(3541,"&&Install"),run:async()=>{await this.openerService.open(K.parse(o));s()}})}else{n=c(3542,"We launched {0} on your computer.\n\nIf {1} did not launch, try again below.",this.productService.nameLong,this.productService.nameLong)}await this.hostService.withExpectedShutdown(()=>this.dialogService.prompt({type:ve.Info,message:c(3543,"All done. You can close this tab now."),detail:n,buttons:r,cancelButton:true}))};if(Ja(e,this.productService.urlProtocol)){await s()}}return true}})}registerLabelFormatters(){this._register(this.labelService.registerFormatter({scheme:fe.vscodeUserData,priority:true,formatting:{label:"(Settings) ${path}",separator:"/"}}))}registerCommands(){Ne.registerCommand("workbench.experimental.requestUsbDevice",async(e,t)=>{return GI(t)});Ne.registerCommand("workbench.experimental.requestSerialPort",async(e,t)=>{return WI(t)});Ne.registerCommand("workbench.experimental.requestHidDevice",async(e,t)=>{return HI(t)})}};op=E([h(0,St),h(1,bn),h(2,Ls),h(3,os),h(4,hy),h(5,uy),h(6,Te),h(7,N),h(8,is)],op);var bc;var Pr;(function(a){a[a["Maximized"]=0]="Maximized";a[a["Normal"]=1]="Normal";a[a["Fullscreen"]=2]="Fullscreen"})(Pr||(Pr={}));const qI=new Ft(Ad.width,Ad.height);let Cc=class fx extends kr{constructor(e,t,i,s,o,n){super(e,void 0,o,n);this.window=e;this.container=t;this.configurationService=s;this._onWillLayout=this._register(new _);this.onWillLayout=this._onWillLayout.event;this._onDidLayout=this._register(new _);this.onDidLayout=this._onDidLayout.event;this._onBeforeUnload=this._register(new _);this.onBeforeUnload=this._onBeforeUnload.event;this._onUnload=this._register(new _);this.onUnload=this._onUnload.event;this._onWillDispose=this._register(new _);this.onWillDispose=this._onWillDispose.event;this.compact=false;this.whenStylesHaveLoaded=i.wait().then(()=>void 0);this.registerListeners()}updateOptions(e){this.compact=e.compact}registerListeners(){this._register(J(this.window,se.BEFORE_UNLOAD,e=>this.handleBeforeUnload(e)));this._register(J(this.window,se.UNLOAD,()=>this.handleUnload()));this._register(J(this.window,"unhandledrejection",e=>{co(e.reason);e.preventDefault()}));this._register(J(this.window,se.RESIZE,()=>this.layout()));this._register(J(this.container,se.SCROLL,()=>this.container.scrollTop=0));if(Is){this._register(J(this.container,se.DROP,e=>Ve.stop(e,true)));this._register(J(this.container,se.WHEEL,e=>e.preventDefault(),{passive:false}));this._register(J(this.container,se.CONTEXT_MENU,e=>Ve.stop(e,true)))}else{this._register(J(this.window.document.body,se.DRAG_OVER,e=>Ve.stop(e)));this._register(J(this.window.document.body,se.DROP,e=>Ve.stop(e)))}}handleBeforeUnload(e){let t;this._onBeforeUnload.fire({veto(o){if(o){t=o}}});if(t){this.handleVetoBeforeClose(e,t);return}const i=this.configurationService.getValue("window.confirmBeforeClose");const s=i==="always"||i==="keyboardOnly"&&Iy.getInstance().isModifierPressed;if(s){this.confirmBeforeClose(e)}}handleVetoBeforeClose(e,t){this.preventUnload(e)}preventUnload(e){e.preventDefault();e.returnValue=c(12051,"Changes that you made may not be saved. Please check press 'Cancel' and try again.")}confirmBeforeClose(e){this.preventUnload(e)}handleUnload(){this._onUnload.fire()}layout(){const e=ug(this.window.document.body,qI,this.container);this._onWillLayout.fire(e);this._onDidLayout.fire(e)}createState(){return{bounds:{x:this.window.screenX,y:this.window.screenY,width:this.window.outerWidth,height:this.window.outerHeight},zoomLevel:Dy(this.window),compact:this.compact}}dispose(){if(this._store.isDisposed){return}this._onWillDispose.fire();super.dispose()}};Cc=E([h(3,X),h(4,is),h(5,Qt)],Cc);let Sc=class mx extends k{static{bc=this}static{this.WINDOW_IDS=gy(ae)+1}constructor(e,t,i,s,o,n){super();this.layoutService=e;this.dialogService=t;this.configurationService=i;this.telemetryService=s;this.hostService=o;this.environmentService=n;this._onDidOpenAuxiliaryWindow=this._register(new _);this.onDidOpenAuxiliaryWindow=this._onDidOpenAuxiliaryWindow.event;this.windows=new Map}async open(e){ds("code/auxiliaryWindow/willOpen");const t=await this.openWindow(e);if(!t){throw new Error(c(12052,"Unable to open a new window."))}const i=await this.resolveWindowId(t);fy(t,i);const s=new L;const{container:o,stylesLoaded:n}=this.createContainer(t,s,e);const r=this.createAuxiliaryWindow(t,o,n);r.updateOptions({compact:e?.compact??false});const d=new L;this.windows.set(t.vscodeWindowId,r);d.add(de(()=>this.windows.delete(t.vscodeWindowId)));const l=new L;x.once(r.onWillDispose)(()=>{t.close();s.dispose();d.dispose();l.dispose()});d.add(my(t));this._onDidOpenAuxiliaryWindow.fire({window:r,disposables:l});ds("code/auxiliaryWindow/didOpen");this.telemetryService.publicLog2("auxiliaryWindowOpen",{bounds:!!e?.bounds});return r}createAuxiliaryWindow(e,t,i){return new Cc(e,t,i,this.configurationService,this.hostService,this.environmentService)}async openWindow(e){const t=Ds();const i={x:t.screenX,y:t.screenY,width:t.outerWidth,height:t.outerHeight};const s=e?.compact?wy:Ad;const o=Math.max(e?.bounds?.width??s.width,uu.WIDTH);const n=Math.max(e?.bounds?.height??s.height,uu.HEIGHT);let r={x:e?.bounds?.x??Math.max(i.x+i.width/2-o/2,0),y:e?.bounds?.y??Math.max(i.y+i.height/2-n/2,0),width:o,height:n};if(!e?.bounds&&r.x===i.x&&r.y===i.y){r={...r,x:r.x+30,y:r.y+30}}const d=ts(["popup=yes",`left=${r.x}`,`top=${r.y}`,`width=${r.width}`,`height=${r.height}`,e?.nativeTitlebar?"window-native-titlebar=yes":void 0,e?.disableFullscreen?"window-disable-fullscreen=yes":void 0,e?.alwaysOnTop?"window-always-on-top=yes":void 0,e?.mode===Pr.Maximized?"window-maximized=yes":void 0,e?.mode===Pr.Fullscreen?"window-fullscreen=yes":void 0]);const l=ae.open(vy?"":"about:blank",void 0,d.join(","));if(!l&&Is){return(await this.dialogService.prompt({type:ve.Warning,message:c(12053,"The browser interrupted the opening of a new window. Press 'Retry' to try again."),detail:c(12054,"To avoid this problem in the future, please ensure to allow popups for this website."),buttons:[{label:c(12055,"&&Retry"),run:()=>this.openWindow(e)}],cancelButton:true})).result}return l?.window}async resolveWindowId(e){return bc.WINDOW_IDS++}createContainer(e,t,i){this.applyMeta(e);const{stylesLoaded:s}=this.applyCSS(e,t);const o=this.applyHTML(e,t);return{stylesLoaded:s,container:o}}applyMeta(e){for(const i of['meta[charset="utf-8"]','meta[http-equiv="Content-Security-Policy"]','meta[name="viewport"]','meta[name="theme-color"]']){const s=ae.document.querySelector(i);if(s){const o=fg(e.document.head);pu(s,o);if(i==='meta[http-equiv="Content-Security-Policy"]'){const n=o.getAttribute("content");if(n){o.setAttribute("content",n.replace(/(script-src[^\;]*)/,`script-src 'none'`))}}}}const t=ae.document.querySelector('link[rel="icon"]');if(t){const i=yy(e.document.head);pu(t,i)}}applyCSS(e,t){ds("code/auxiliaryWindow/willApplyCSS");e.document.adoptedStyleSheets=[...e.document.adoptedStyleSheets,...(Ty??ae.document).adoptedStyleSheets.map(l=>{const u=new e.CSSStyleSheet;for(const p of l.cssRules){u.insertRule(p.cssText)}return u})];const i=new Map;const s=new by;s.wait().then(()=>ds("code/auxiliaryWindow/didLoadCSSStyles"));const o=t.add(new L);let n=0;function r(){if(--n===0){o.dispose();s.open()}}function d(l){if(Ey(l)){return}const u=e.document.head.appendChild(l.cloneNode(true));if(l.tagName.toLowerCase()==="link"){n++;o.add(J(u,"load",r));o.add(J(u,"error",r))}i.set(l,u)}n++;try{for(const l of ae.document.head.querySelectorAll('link[rel="stylesheet"], style')){d(l)}}finally{r()}t.add(Cy(e));t.add(Sy.observe(ae.document.head,t,{childList:true,subtree:true})(l=>{for(const u of l){if(u.type!=="childList"||u.target.nodeName.toLowerCase()==="title"||u.target.nodeName.toLowerCase()==="script"||u.target.nodeName.toLowerCase()==="meta"){continue}for(const p of u.addedNodes){if(ao(p)&&(p.tagName.toLowerCase()==="style"||p.tagName.toLowerCase()==="link")){d(p)}else if(p.nodeType===Node.TEXT_NODE&&p.parentNode){const f=i.get(p.parentNode);if(f){f.textContent=p.textContent}}}for(const p of u.removedNodes){const f=i.get(p);if(f){f.parentNode?.removeChild(f);i.delete(p)}}}}));ds("code/auxiliaryWindow/didApplyCSS");return{stylesLoaded:s}}applyHTML(e,t){ds("code/auxiliaryWindow/willApplyHTML");const i=G("div",{role:"application"});_y(i,0,0,0,0,"relative");i.style.display="flex";i.style.height="100%";i.style.flexDirection="column";e.document.body.append(i);t.add(Xa(ae.document.documentElement,e.document.documentElement));t.add(Xa(ae.document.body,e.document.body));t.add(Xa(this.layoutService.mainContainer,i,["class"]));ds("code/auxiliaryWindow/didApplyHTML");return i}getWindow(e){return this.windows.get(e)}};Sc=bc=E([h(0,Te),h(1,Ls),h(2,X),h(3,si),h(4,is),h(5,Qt)],Sc);let _c=class wx extends Cn{constructor(e,t,i,s,o,n,r,d,l,u,p,f,g){super(e,{mergeViewWithContainerWhenSingleView:false},r,i,s,l,o,u,d,n,p,f,g);this.constantViewDescriptors=new Map;this.allViews=new Map;this._register(t(m=>{this.filterValue=m;this.onFilterChanged(m)}));this._register(this.viewContainerModel.onDidChangeActiveViewDescriptors(()=>{this.updateAllViews(this.viewContainerModel.activeViewDescriptors)}))}updateAllViews(e){e.forEach(t=>{const i=this.getFilterOn(t);if(!i){return}if(!this.allViews.has(i)){this.allViews.set(i,new Map)}this.allViews.get(i).set(t.id,t);if(this.filterValue&&!this.filterValue.includes(i)&&this.panes.find(s=>s.id===t.id)){this.viewContainerModel.setVisible(t.id,false)}})}addConstantViewDescriptors(e){e.forEach(t=>this.constantViewDescriptors.set(t.id,t))}onFilterChanged(e){if(this.allViews.size===0){this.updateAllViews(this.viewContainerModel.activeViewDescriptors)}this.getViewsNotForTarget(e).forEach(t=>this.viewContainerModel.setVisible(t.id,false));this.getViewsForTarget(e).forEach(t=>this.viewContainerModel.setVisible(t.id,true))}getViewsForTarget(e){const t=[];for(let i=0;i<e.length;i++){if(this.allViews.has(e[i])){t.push(...Array.from(this.allViews.get(e[i]).values()))}}return t}getViewsNotForTarget(e){const t=this.allViews.keys();let i=t.next();let s=[];while(!i.done){let o=false;e.forEach(n=>{if(i.value===n){o=true}});if(!o){s=s.concat(this.getViewsForTarget([i.value]))}i=t.next()}return s}onDidAddViewDescriptors(e){const t=super.onDidAddViewDescriptors(e);for(let i=0;i<e.length;i++){if(this.constantViewDescriptors.has(e[i].viewDescriptor.id)){t[i].setExpanded(false)}}if(this.allViews.size===0){this.updateAllViews(this.viewContainerModel.activeViewDescriptors)}return t}openView(e,t){const i=super.openView(e,t);if(i){const s=Array.from(this.allViews.entries()).find(o=>o[1].has(e));if(s&&!this.filterValue?.includes(s[0])){this.setFilter(s[1].get(e))}}return i}};_c=E([h(2,X),h(3,Te),h(4,si),h(5,le),h(6,N),h(7,pe),h(8,ot),h(9,Kt),h(10,yn),h(11,We),h(12,et)],_c);let Ec=class vx extends k{constructor(e,t,i,s,o){super();this.viewDescriptorService=e;this.paneCompositeService=t;this.contextKeyService=i;this.layoutService=s;this.editorService=o;this._onDidChangeViewVisibility=this._register(new _);this.onDidChangeViewVisibility=this._onDidChangeViewVisibility.event;this._onDidChangeViewContainerVisibility=this._register(new _);this.onDidChangeViewContainerVisibility=this._onDidChangeViewContainerVisibility.event;this._onDidChangeFocusedView=this._register(new _);this.onDidChangeFocusedView=this._onDidChangeFocusedView.event;this.viewContainerDisposables=this._register(new mr);this.viewDisposable=new Map;this.enabledViewContainersContextKeys=new Map;this.visibleViewContextKeys=new Map;this.viewPaneContainers=new Map;this._register(de(()=>{this.viewDisposable.forEach(n=>n.dispose());this.viewDisposable.clear()}));this.viewDescriptorService.viewContainers.forEach(n=>this.onDidRegisterViewContainer(n,this.viewDescriptorService.getViewContainerLocation(n)));this._register(this.viewDescriptorService.onDidChangeViewContainers(({added:n,removed:r})=>this.onDidChangeContainers(n,r)));this._register(this.viewDescriptorService.onDidChangeContainerLocation(({viewContainer:n,from:r,to:d})=>this.onDidChangeContainerLocation(n,r,d)));this._register(this.paneCompositeService.onDidPaneCompositeOpen(n=>this._onDidChangeViewContainerVisibility.fire({id:n.composite.getId(),visible:true,location:n.viewContainerLocation})));this._register(this.paneCompositeService.onDidPaneCompositeClose(n=>this._onDidChangeViewContainerVisibility.fire({id:n.composite.getId(),visible:false,location:n.viewContainerLocation})));this.focusedViewContextKey=or.bindTo(i)}onViewsAdded(e){for(const t of e){this.onViewsVisibilityChanged(t,t.isBodyVisible())}}onViewsVisibilityChanged(e,t){this.getOrCreateActiveViewContextKey(e).set(t);this._onDidChangeViewVisibility.fire({id:e.id,visible:t})}onViewsRemoved(e){for(const t of e){this.onViewsVisibilityChanged(t,false)}}getOrCreateActiveViewContextKey(e){const t=Ay(e.id);let i=this.visibleViewContextKeys.get(t);if(!i){i=new U(t,false).bindTo(this.contextKeyService);this.visibleViewContextKeys.set(t,i)}return i}onDidChangeContainers(e,t){for(const{container:i,location:s}of t){this.onDidDeregisterViewContainer(i,s)}for(const{container:i,location:s}of e){this.onDidRegisterViewContainer(i,s)}}onDidRegisterViewContainer(e,t){this.registerPaneComposite(e,t);const i=new L;const s=this.viewDescriptorService.getViewContainerModel(e);this.onViewDescriptorsAdded(s.allViewDescriptors,e);i.add(s.onDidChangeAllViewDescriptors(({added:o,removed:n})=>{this.onViewDescriptorsAdded(o,e);this.onViewDescriptorsRemoved(n)}));this.updateViewContainerEnablementContextKey(e);i.add(s.onDidChangeActiveViewDescriptors(()=>this.updateViewContainerEnablementContextKey(e)));i.add(this.registerOpenViewContainerAction(e));this.viewContainerDisposables.set(e.id,i)}onDidDeregisterViewContainer(e,t){this.deregisterPaneComposite(e,t);this.viewContainerDisposables.deleteAndDispose(e.id)}onDidChangeContainerLocation(e,t,i){this.deregisterPaneComposite(e,t);this.registerPaneComposite(e,i);if(this.layoutService.isVisible(gd(i))&&this.viewDescriptorService.getViewContainersByLocation(i).filter(s=>this.isViewContainerActive(s.id)).length===1){this.openViewContainer(e.id)}}onViewDescriptorsAdded(e,t){const i=this.viewDescriptorService.getViewContainerLocation(t);if(i===null){return}for(const s of e){const o=new L;o.add(this.registerOpenViewAction(s));o.add(this.registerFocusViewAction(s,t.title));o.add(this.registerResetViewLocationAction(s));this.viewDisposable.set(s,o)}}onViewDescriptorsRemoved(e){for(const t of e){const i=this.viewDisposable.get(t);if(i){i.dispose();this.viewDisposable.delete(t)}}}updateViewContainerEnablementContextKey(e){let t=this.enabledViewContainersContextKeys.get(e.id);if(!t){t=this.contextKeyService.createKey(pd(e.id),false);this.enabledViewContainersContextKeys.set(e.id,t)}t.set(!(e.hideIfEmpty&&this.viewDescriptorService.getViewContainerModel(e).activeViewDescriptors.length===0))}async openComposite(e,t,i){return this.paneCompositeService.openPaneComposite(e,t,i)}getComposite(e,t){return this.paneCompositeService.getPaneComposite(e,t)}isViewContainerVisible(e){const t=this.viewDescriptorService.getViewContainerById(e);if(!t){return false}const i=this.viewDescriptorService.getViewContainerLocation(t);if(i===null){return false}return this.paneCompositeService.getActivePaneComposite(i)?.getId()===e}isViewContainerActive(e){const t=this.viewDescriptorService.getViewContainerById(e);if(!t){return false}if(!t.hideIfEmpty){return true}return this.viewDescriptorService.getViewContainerModel(t).activeViewDescriptors.length>0}getVisibleViewContainer(e){const t=this.paneCompositeService.getActivePaneComposite(e)?.getId();return t?this.viewDescriptorService.getViewContainerById(t):null}getActiveViewPaneContainerWithId(e){const t=this.viewDescriptorService.getViewContainerById(e);return t?this.getActiveViewPaneContainer(t):null}async openViewContainer(e,t){const i=this.viewDescriptorService.getViewContainerById(e);if(i){const s=this.viewDescriptorService.getViewContainerLocation(i);if(s!==null){const o=await this.paneCompositeService.openPaneComposite(e,s,t);return o||null}}return null}async closeViewContainer(e){const t=this.viewDescriptorService.getViewContainerById(e);if(t){const i=this.viewDescriptorService.getViewContainerLocation(t);const s=i!==null&&this.paneCompositeService.getActivePaneComposite(i);if(i!==null){return s?this.layoutService.setPartHidden(true,gd(i)):void 0}}}isViewVisible(e){const t=this.getActiveViewWithId(e);return t?.isBodyVisible()||false}getActiveViewWithId(e){const t=this.viewDescriptorService.getViewContainerByViewId(e);if(t){const i=this.getActiveViewPaneContainer(t);if(i){return i.getView(e)}}return null}getViewWithId(e){const t=this.viewDescriptorService.getViewContainerByViewId(e);if(t){const i=this.viewPaneContainers.get(t.id);if(i){return i.getView(e)}}return null}getFocusedView(){const e=this.contextKeyService.getContextKeyValue(or.key)??"";return this.viewDescriptorService.getViewDescriptorById(e.toString())}getFocusedViewName(){const e=this.editorService.activeTextEditorControl?.hasTextFocus()?c(12902,"Text Editor"):void 0;return this.getFocusedView()?.name?.value??e??""}async openView(e,t){const i=this.viewDescriptorService.getViewContainerByViewId(e);if(!i){return null}if(!this.viewDescriptorService.getViewContainerModel(i).activeViewDescriptors.some(n=>n.id===e)){return null}const s=this.viewDescriptorService.getViewContainerLocation(i);const o=this.getComposite(i.id,s);if(o){const n=await this.openComposite(o.id,s);if(n&&n.openView){return n.openView(e,t)||null}else if(t){n?.focus()}}return null}closeView(e){const t=this.viewDescriptorService.getViewContainerByViewId(e);if(t){const i=this.getActiveViewPaneContainer(t);if(i){const s=i.getView(e);if(s){if(i.views.length===1){const o=this.viewDescriptorService.getViewContainerLocation(t);if(o===$.Sidebar){this.layoutService.setPartHidden(true,V.SIDEBAR_PART)}else if(o===$.Panel||o===$.AuxiliaryBar){this.paneCompositeService.hideActivePaneComposite(o)}if(this.focusedViewContextKey.get()===e){this.focusedViewContextKey.reset()}}else{s.setExpanded(false)}}}}}getActiveViewPaneContainer(e){const t=this.viewDescriptorService.getViewContainerLocation(e);if(t===null){return null}const i=this.paneCompositeService.getActivePaneComposite(t);if(i?.getId()===e.id){return i.getViewPaneContainer()||null}return null}getViewProgressIndicator(e){const t=this.viewDescriptorService.getViewContainerByViewId(e);if(!t){return void 0}const i=this.viewPaneContainers.get(t.id);if(!i){return void 0}const s=i.getView(e);if(!s){return void 0}if(i.isViewMergedWithContainer()){return this.getViewContainerProgressIndicator(t)}return s.getProgressIndicator()}getViewContainerProgressIndicator(e){const t=this.viewDescriptorService.getViewContainerLocation(e);if(t===null){return void 0}return this.paneCompositeService.getProgressIndicator(e.id,t)}registerOpenViewContainerAction(e){const t=new L;if(e.openCommandActionDescriptor){const{id:i,mnemonicTitle:s,keybindings:o,order:n}=e.openCommandActionDescriptor??{id:e.id};const r=e.openCommandActionDescriptor.title??e.title;const d=this;t.add(v(class yx extends j{constructor(){super({id:i,get title(){const u=d.viewDescriptorService.getViewContainerLocation(e);const p=typeof r==="string"?r:r.value;const f=typeof r==="string"?r:r.original;if(u===$.Sidebar){return{value:c(12903,"Show {0}",p),original:`Show ${f}`}}else{return{value:c(12904,"Toggle {0}",p),original:`Toggle ${f}`}}},category:_e.View,precondition:S.has(pd(e.id)),keybinding:o?{...o,weight:B.WorkbenchContrib}:void 0,f1:true})}async run(u){const p=u.get(qe);const f=u.get(We);const g=u.get(Te);const m=u.get(st);const y=f.getViewContainerLocation(e);switch(y){case $.AuxiliaryBar:case $.Sidebar:{const C=y===$.Sidebar?V.SIDEBAR_PART:V.AUXILIARYBAR_PART;if(!m.isViewContainerVisible(e.id)||!g.hasFocus(C)){await m.openViewContainer(e.id,true)}else{p.activeGroup.focus()}break}case $.Panel:if(!m.isViewContainerVisible(e.id)||!g.hasFocus(V.PANEL_PART)){await m.openViewContainer(e.id,true)}else{m.closeViewContainer(e.id)}break}}}));if(s){const l=this.viewDescriptorService.getDefaultViewContainerLocation(e);t.add(b.appendMenuItem(w.MenubarViewMenu,{command:{id:i,title:s},group:l===$.Sidebar?"3_sidebar":l===$.AuxiliaryBar?"4_auxbar":"5_panel",when:S.has(pd(e.id)),order:n??Number.MAX_VALUE}))}}return t}registerOpenViewAction(e){const t=new L;const i=e.openCommandActionDescriptor?.title??e.name;const s=e.openCommandActionDescriptor?.id??`${e.id}.open`;const o=this;t.add(v(class bx extends j{constructor(){super({id:s,get title(){const r=o.viewDescriptorService.getViewLocationById(e.id);const d=typeof i==="string"?i:i.value;const l=typeof i==="string"?i:i.original;if(r===$.Sidebar){return{value:c(12903,"Show {0}",d),original:`Show ${l}`}}else{return{value:c(12904,"Toggle {0}",d),original:`Toggle ${l}`}}},category:_e.View,precondition:S.has(`${e.id}.active`),keybinding:e.openCommandActionDescriptor?.keybindings?{...e.openCommandActionDescriptor.keybindings,weight:B.WorkbenchContrib}:void 0,f1:e.openCommandActionDescriptor?true:void 0,metadata:{description:c(12905,"Opens view {0}",e.name.value),args:[{name:"options",schema:{type:"object",properties:{"preserveFocus":{type:"boolean",default:false,description:c(12906,"Whether to preserve the existing focus when opening the view.")}}}}]}})}async run(r,d){const l=r.get(qe);const u=r.get(We);const p=r.get(Te);const f=r.get(st);const g=r.get(ee);const m=or.getValue(g);if(m===e.id&&!d?.preserveFocus){const y=u.getViewLocationById(e.id);if(u.getViewLocationById(e.id)===$.Sidebar){l.activeGroup.focus()}else if(y!==null){p.setPartHidden(true,gd(y))}}else{f.openView(e.id,!d?.preserveFocus)}}}));if(e.openCommandActionDescriptor?.mnemonicTitle){const n=this.viewDescriptorService.getDefaultContainerById(e.id);if(n){const r=this.viewDescriptorService.getDefaultViewContainerLocation(n);t.add(b.appendMenuItem(w.MenubarViewMenu,{command:{id:s,title:e.openCommandActionDescriptor.mnemonicTitle},group:r===$.Sidebar?"3_sidebar":r===$.AuxiliaryBar?"4_auxbar":"5_panel",when:S.has(`${e.id}.active`),order:e.openCommandActionDescriptor.order??Number.MAX_VALUE}))}}return t}registerFocusViewAction(e,t){return v(class Cx extends j{constructor(){const s=I(12907,"Focus on {0} View",e.name.value);super({id:e.focusCommand?e.focusCommand.id:`${e.id}.focus`,title:s,category:t,menu:[{id:w.CommandPalette,when:e.when}],keybinding:{when:S.has(`${e.id}.active`),weight:B.WorkbenchContrib,primary:e.focusCommand?.keybindings?.primary,secondary:e.focusCommand?.keybindings?.secondary,linux:e.focusCommand?.keybindings?.linux,mac:e.focusCommand?.keybindings?.mac,win:e.focusCommand?.keybindings?.win},metadata:{description:s.value,args:[{name:"focusOptions",description:"Focus Options",schema:{type:"object",properties:{"preserveFocus":{type:"boolean",default:false}}}}]}})}run(s,o){s.get(st).openView(e.id,!o?.preserveFocus)}})}registerResetViewLocationAction(e){return v(class Sx extends j{constructor(){super({id:`${e.id}.resetViewLocation`,title:I(12908,"Reset Location"),menu:[{id:w.ViewTitleContext,when:S.or(S.and(S.equals("view",e.id),S.equals(`${e.id}.defaultViewLocation`,false))),group:"1_hide",order:2}]})}run(i){const s=i.get(We);const o=s.getDefaultContainerById(e.id);const n=s.getViewContainerModel(o);if(o.hideIfEmpty&&n.visibleViewDescriptors.length===0){const r=s.getDefaultViewContainerLocation(o);s.moveViewContainerToLocation(o,r,void 0,this.desc.id)}s.moveViewsToContainer([e],o,void 0,this.desc.id);i.get(st).openView(e.id,true)}})}registerPaneComposite(e,t){const i=this;let s=class _x extends Hd{constructor(n,r,d,l,u,p,f){super(e.id,n,d,l,u,p,f,r)}createViewPaneContainer(n){const r=this._register(new L);const d=i.createViewPaneContainer(n,e,t,r,this.instantiationService);if(!(d instanceof _c)){r.add(x.any(d.onDidAddViews,d.onDidRemoveViews,d.onTitleAreaUpdate)(()=>{this.updateTitleArea()}))}return d}};s=E([h(0,si),h(1,yn),h(2,le),h(3,N),h(4,pe),h(5,ot),h(6,Kt)],s);W.as(np(t)).registerPaneComposite(gh.create(s,e.id,typeof e.title==="string"?e.title:e.title.value,br(e.icon)?e.icon:void 0,e.order,e.requestedIndex,e.icon instanceof K?e.icon:void 0))}deregisterPaneComposite(e,t){W.as(np(t)).deregisterPaneComposite(e.id)}createViewPaneContainer(e,t,i,s,o){const n=o.createInstance(t.ctorDescriptor.ctor,...t.ctorDescriptor.staticArguments||[]);this.viewPaneContainers.set(n.getId(),n);s.add(de(()=>this.viewPaneContainers.delete(n.getId())));s.add(n.onDidAddViews(r=>this.onViewsAdded(r)));s.add(n.onDidChangeViewVisibility(r=>this.onViewsVisibilityChanged(r,r.isBodyVisible())));s.add(n.onDidRemoveViews(r=>this.onViewsRemoved(r)));s.add(n.onDidFocusView(r=>{if(this.focusedViewContextKey.get()!==r.id){this.focusedViewContextKey.set(r.id);this._onDidChangeFocusedView.fire()}}));s.add(n.onDidBlurView(r=>{if(this.focusedViewContextKey.get()===r.id){this.focusedViewContextKey.reset();this._onDidChangeFocusedView.fire()}}));return n}};Ec=E([h(0,We),h(1,Vs),h(2,ee),h(3,Te),h(4,Y)],Ec);function pd(a){return`viewContainer.${a}.enabled`}function np(a){switch(a){case $.AuxiliaryBar:return wi.Auxiliary;case $.Panel:return wi.Panels;case $.Sidebar:default:return wi.Viewlets}}function gd(a){switch(a){case $.AuxiliaryBar:return V.AUXILIARYBAR_PART;case $.Panel:return V.PANEL_PART;case $.Sidebar:default:return V.SIDEBAR_PART}}class jI{constructor(){this.onWillInstantiateEditorPane=Ni.onWillInstantiateEditorPane}didInstantiateEditorPane(e){return Ni.didInstantiateEditorPane(e)}}class YI{constructor(){this._providers=new Map;this._onDidChange=new _;this.onDidChange=this._onDidChange.event}dispose(){this._onDidChange.dispose()}register(e,t,i,s){const o=this._makeKey(e,t);if(this._providers.has(o)){throw new Error(`A provider for the command ${t} and menu ${e} is already registered.`)}this._providers.set(o,i);const n=s?.(()=>{this._onDidChange.fire(e)});return de(()=>{n?.dispose();this._providers.delete(o)})}lookUp(e,t){return this._providers.get(this._makeKey(e,t))}_makeKey(e,t){return`${e.id}/${t instanceof w?t.id:t}`}}var Ic;class hn{constructor(){this.uris=[]}async perform(){return this}toString(){return"(noop)"}}class lm{constructor(e,t,i){this.newUri=e;this.oldUri=t;this.options=i;this.type="rename"}}let Dc=Ic=class Ex{constructor(e,t,i,s){this._edits=e;this._undoRedoInfo=t;this._workingCopyFileService=i;this._fileService=s}get uris(){return this._edits.flatMap(e=>[e.newUri,e.oldUri])}async perform(e){const t=[];const i=[];for(const s of this._edits){const o=s.options.overwrite===void 0&&s.options.ignoreIfExists&&await this._fileService.exists(s.newUri);if(!o){t.push({file:{source:s.oldUri,target:s.newUri},overwrite:s.options.overwrite});i.push(new lm(s.oldUri,s.newUri,s.options))}}if(t.length===0){return new hn}await this._workingCopyFileService.move(t,e,this._undoRedoInfo);return new Ic(i,{isUndoing:true},this._workingCopyFileService,this._fileService)}toString(){return`(rename ${this._edits.map(e=>`${e.oldUri} to ${e.newUri}`).join(", ")})`}};Dc=Ic=E([h(2,ga),h(3,je)],Dc);class ZI{constructor(e,t,i){this.newUri=e;this.oldUri=t;this.options=i;this.type="copy"}}let Tc=class Ix{constructor(e,t,i,s,o){this._edits=e;this._undoRedoInfo=t;this._workingCopyFileService=i;this._fileService=s;this._instaService=o}get uris(){return this._edits.flatMap(e=>[e.newUri,e.oldUri])}async perform(e){const t=[];for(const o of this._edits){const n=o.options.overwrite===void 0&&o.options.ignoreIfExists&&await this._fileService.exists(o.newUri);if(!n){t.push({file:{source:o.oldUri,target:o.newUri},overwrite:o.options.overwrite})}}if(t.length===0){return new hn}const i=await this._workingCopyFileService.copy(t,e,this._undoRedoInfo);const s=[];for(let o=0;o<i.length;o++){const n=i[o];const r=this._edits[o];s.push(new mh(n.resource,{recursive:true,folder:this._edits[o].options.folder||n.isDirectory,...r.options},false))}return this._instaService.createInstance(un,s,{isUndoing:true})}toString(){return`(copy ${this._edits.map(e=>`${e.oldUri} to ${e.newUri}`).join(", ")})`}};Tc=E([h(2,ga),h(3,je),h(4,N)],Tc);class hm{constructor(e,t,i){this.newUri=e;this.options=t;this.contents=i;this.type="create"}}let Lr=class Dx{constructor(e,t,i,s,o,n){this._edits=e;this._undoRedoInfo=t;this._fileService=i;this._workingCopyFileService=s;this._instaService=o;this._textFileService=n}get uris(){return this._edits.map(e=>e.newUri)}async perform(e){const t=[];const i=[];const s=[];for(const o of this._edits){if(o.newUri.scheme===fe.untitled){continue}if(o.options.overwrite===void 0&&o.options.ignoreIfExists&&await this._fileService.exists(o.newUri)){continue}if(o.options.folder){t.push({resource:o.newUri})}else{const n=typeof o.contents!=="undefined"?o.contents:await this._textFileService.getEncodedReadable(o.newUri);i.push({resource:o.newUri,contents:n,overwrite:o.options.overwrite})}s.push(new mh(o.newUri,o.options,!o.options.folder&&!o.contents))}if(t.length===0&&i.length===0){return new hn}await this._workingCopyFileService.createFolder(t,e,this._undoRedoInfo);await this._workingCopyFileService.create(i,e,this._undoRedoInfo);return this._instaService.createInstance(un,s,{isUndoing:true})}toString(){return`(create ${this._edits.map(e=>e.options.folder?`folder ${e.newUri}`:`file ${e.newUri} with ${e.contents?.byteLength||0} bytes`).join(", ")})`}};Lr=E([h(2,je),h(3,ga),h(4,N),h(5,fa)],Lr);class mh{constructor(e,t,i){this.oldUri=e;this.options=t;this.undoesCreate=i;this.type="delete"}}let un=class Tx{constructor(e,t,i,s,o,n,r){this._edits=e;this._undoRedoInfo=t;this._workingCopyFileService=i;this._fileService=s;this._configurationService=o;this._instaService=n;this._logService=r}get uris(){return this._edits.map(e=>e.oldUri)}async perform(e){const t=[];const i=[];for(const s of this._edits){let o;try{o=await this._fileService.resolve(s.oldUri,{resolveMetadata:true})}catch(d){if(!s.options.ignoreIfNotExists){throw new Error(`${s.oldUri} does not exist and can not be deleted`)}continue}t.push({resource:s.oldUri,recursive:s.options.recursive,useTrash:!s.options.skipTrashBin&&this._fileService.hasCapability(s.oldUri,xy.Trash)&&this._configurationService.getValue("files.enableTrash")});let n;let r=false;if(!s.undoesCreate&&!s.options.folder){r=typeof s.options.maxSize==="number"&&o.size>s.options.maxSize;if(!r){try{n=await this._fileService.readFile(s.oldUri)}catch(d){this._logService.error(d)}}}if(!r){i.push(new hm(s.oldUri,s.options,n?.value))}}if(t.length===0){return new hn}await this._workingCopyFileService.delete(t,e,this._undoRedoInfo);if(i.length===0){return new hn}return this._instaService.createInstance(Lr,i,{isUndoing:true})}toString(){return`(delete ${this._edits.map(e=>e.oldUri).join(", ")})`}};un=E([h(2,ga),h(3,je),h(4,X),h(5,N),h(6,et)],un);class JI{constructor(e,t,i,s){this.label=e;this.code=t;this.operations=i;this.confirmBeforeUndo=s;this.type=mg.Workspace;this.resources=i.flatMap(o=>o.uris)}async undo(){await this._reverse()}async redo(){await this._reverse()}async _reverse(){for(let e=0;e<this.operations.length;e++){const t=this.operations[e];const i=await t.perform(ei.None);this.operations[e]=i}}toString(){return this.operations.map(e=>String(e)).join(", ")}}let Ac=class Ax{constructor(e,t,i,s,o,n,r,d,l,u){this._label=e;this._code=t;this._undoRedoGroup=i;this._undoRedoSource=s;this._confirmBeforeUndo=o;this._progress=n;this._token=r;this._edits=d;this._instaService=l;this._undoRedoService=u}async apply(){const e=[];const t={undoRedoGroupId:this._undoRedoGroup.id};const i=[];for(const n of this._edits){if(n.newResource&&n.oldResource&&!n.options?.copy){i.push(new lm(n.newResource,n.oldResource,n.options??{}))}else if(n.newResource&&n.oldResource&&n.options?.copy){i.push(new ZI(n.newResource,n.oldResource,n.options??{}))}else if(!n.newResource&&n.oldResource){i.push(new mh(n.oldResource,n.options??{},false))}else if(n.newResource&&!n.oldResource){i.push(new hm(n.newResource,n.options??{},await n.options.contents))}}if(i.length===0){return[]}const s=[];s[0]=[i[0]];for(let n=1;n<i.length;n++){const r=i[n];const d=s.at(-1);if(d?.[0].type===r.type){d.push(r)}else{s.push([r])}}for(const n of s){if(this._token.isCancellationRequested){break}let r;switch(n[0].type){case"rename":r=this._instaService.createInstance(Dc,n,t);break;case"copy":r=this._instaService.createInstance(Tc,n,t);break;case"delete":r=this._instaService.createInstance(un,n,t);break;case"create":r=this._instaService.createInstance(Lr,n,t);break}if(r){const d=await r.perform(this._token);e.push(d)}this._progress.report(void 0)}const o=new JI(this._label,this._code,e,this._confirmBeforeUndo);this._undoRedoService.pushElement(o,this._undoRedoGroup,this._undoRedoSource);return o.resources}};Ac=E([h(8,N),h(9,Yl)],Ac);class um{constructor(e){this._modelReference=e;this.model=this._modelReference.object.textEditorModel;this._edits=[]}dispose(){this._modelReference.dispose()}isNoOp(){if(this._edits.length>0){return false}if(this._newEol!==void 0&&this._newEol!==this.model.getEndOfLineSequence()){return false}return true}addEdit(e){this._expectedModelVersionId=e.versionId;const{textEdit:t}=e;if(typeof t.eol==="number"){this._newEol=t.eol}if(!t.range&&!t.text){return}if(me.isEmpty(t.range)&&!t.text){return}let i;if(!t.range){i=this.model.getFullModelRange()}else{i=me.lift(t.range)}this._edits.push({...xd.replaceMove(i,t.text),insertAsSnippet:t.insertAsSnippet,keepWhitespace:t.keepWhitespace})}validate(){if(typeof this._expectedModelVersionId==="undefined"||this.model.getVersionId()===this._expectedModelVersionId){return{canApply:true}}return{canApply:false,reason:this.model.uri}}getBeforeCursorState(){return null}apply(){if(this._edits.length>0){this._edits=this._edits.map(this._transformSnippetStringToInsertText,this).sort((e,t)=>me.compareRangesUsingStarts(e.range,t.range));this.model.pushEditOperations(null,this._edits,()=>null)}if(this._newEol!==void 0){this.model.pushEOL(this._newEol)}}_transformSnippetStringToInsertText(e){if(!e.insertAsSnippet){return e}if(!e.text){return e}const t=ma.asInsertText(e.text);return{...e,insertAsSnippet:false,text:t}}}class XI extends um{constructor(e,t){super(e);this._editor=t}getBeforeCursorState(){return this._canUseEditor()?this._editor.getSelections():null}apply(){if(!this._canUseEditor()){super.apply();return}if(this._edits.length>0){const e=Vy.get(this._editor);if(e&&this._edits.some(t=>t.insertAsSnippet)){const t=[];for(const i of this._edits){if(i.range&&i.text!==null){t.push({range:me.lift(i.range),template:i.insertAsSnippet?i.text:ma.escape(i.text),keepWhitespace:i.keepWhitespace})}}e.apply(t,{undoStopBefore:false,undoStopAfter:false})}else{this._edits=this._edits.map(this._transformSnippetStringToInsertText,this).sort((t,i)=>me.compareRangesUsingStarts(t.range,i.range));this._editor.executeEdits("",this._edits)}}if(this._newEol!==void 0){if(this._editor.hasModel()){this._editor.getModel().pushEOL(this._newEol)}}}_canUseEditor(){return this._editor?.getModel()?.uri.toString()===this.model.uri.toString()}}let xc=class xx{constructor(e,t,i,s,o,n,r,d,l,u,p,f){this._label=e;this._code=t;this._editor=i;this._undoRedoGroup=s;this._undoRedoSource=o;this._progress=n;this._token=r;this._editorWorker=l;this._modelService=u;this._textModelResolverService=p;this._undoRedoService=f;this._edits=new Ts;for(const g of d){let m=this._edits.get(g.resource);if(!m){m=[];this._edits.set(g.resource,m)}m.push(g)}}_validateBeforePrepare(){for(const e of this._edits.values()){for(const t of e){if(typeof t.versionId==="number"){const i=this._modelService.getModel(t.resource);if(i&&i.getVersionId()!==t.versionId){throw new Error(`${i.uri.toString()} has changed in the meantime`)}}}}}async _createEditsTasks(){const e=[];const t=[];for(const[i,s]of this._edits){const o=this._textModelResolverService.createModelReference(i).then(async n=>{let r;let d=false;if(this._editor?.getModel()?.uri.toString()===n.object.textEditorModel.uri.toString()){r=new XI(n,this._editor);d=true}else{r=new um(n)}e.push(r);if(!d){s.forEach(r.addEdit,r);return}const l=async(f,g)=>{const m=s.slice(f,g);const y=await this._editorWorker.computeMoreMinimalEdits(n.object.textEditorModel.uri,m.map(C=>C.textEdit),false);if(!y){m.forEach(r.addEdit,r)}else{y.forEach(C=>r.addEdit(new Bi(n.object.textEditorModel.uri,C,void 0,void 0)))}};let u=0;let p=0;for(;p<s.length;p++){if(s[p].textEdit.insertAsSnippet||s[p].metadata){await l(u,p);r.addEdit(s[p]);u=p+1}}await l(u,p)});t.push(o)}await Promise.all(t);return e}_validateTasks(e){for(const t of e){const i=t.validate();if(!i.canApply){return i}}return{canApply:true}}async apply(){this._validateBeforePrepare();const e=await this._createEditsTasks();try{if(this._token.isCancellationRequested){return[]}const t=[];const i=this._validateTasks(e);if(!i.canApply){throw new Error(`${i.reason.toString()} has changed in the meantime`)}if(e.length===1){const s=e[0];if(!s.isNoOp()){const o=new gu(this._label,this._code,s.model,s.getBeforeCursorState());this._undoRedoService.pushElement(o,this._undoRedoGroup,this._undoRedoSource);s.apply();o.close();t.push(s.model.uri)}this._progress.report(void 0)}else{const s=new Ry(this._label,this._code,e.map(o=>new gu(this._label,this._code,o.model,o.getBeforeCursorState())));this._undoRedoService.pushElement(s,this._undoRedoGroup,this._undoRedoSource);for(const o of e){o.apply();this._progress.report(void 0);t.push(o.model.uri)}s.close()}return t}finally{$e(e)}}};xc=E([h(8,ky),h(9,wa),h(10,bo),h(11,Yl)],xc);class bs extends Py{static is(e){if(e instanceof bs){return true}else{return Ly(e)&&Boolean(e.undo&&e.redo)}}static lift(e){if(e instanceof bs){return e}else{return new bs(e.resource,e.undo,e.redo,e.metadata)}}constructor(e,t,i,s){super(s);this.resource=e;this.undo=t;this.redo=i}}let Rc=class Rx{constructor(e,t,i,s,o,n){this._undoRedoGroup=e;this._undoRedoSource=t;this._progress=i;this._token=s;this._edits=o;this._undoRedoService=n}async apply(){const e=[];for(const t of this._edits){if(this._token.isCancellationRequested){break}await t.redo();this._undoRedoService.pushElement({type:mg.Resource,resource:t.resource,label:t.metadata?.label||"Custom Edit",code:"paste",undo:t.undo,redo:t.redo},this._undoRedoGroup,this._undoRedoSource);this._progress.report(void 0);e.push(t.resource)}return e}};Rc=E([h(5,Yl)],Rc);function QI(a){return a.map(e=>{if(Bi.is(e)){return Bi.lift(e)}if(Gt.is(e)){return Gt.lift(e)}if(Cr.is(e)){return Cr.lift(e)}if(bs.is(e)){return bs.lift(e)}throw new Error("Unsupported edit")})}let Vc=class Vx{constructor(e,t,i,s,o,n,r,d,l,u,p){this._label=e;this._code=t;this._editor=i;this._progress=s;this._token=o;this._edits=n;this._undoRedoGroup=r;this._undoRedoSource=d;this._confirmBeforeUndo=l;this._instaService=u;this._logService=p}ariaMessage(){const e=new Ts;const t=new Ts;let i=0;for(const s of this._edits){if(s instanceof Bi){i+=1;t.set(s.resource,true)}else if(s instanceof Gt){e.set(s.oldResource??s.newResource,true)}}if(this._edits.length===0){return c(4231,"Made no edits")}else if(e.size===0){if(i>1&&t.size>1){return c(4232,"Made {0} text edits in {1} files",i,t.size)}else{return c(4233,"Made {0} text edits in one file",i)}}else{return c(4234,"Made {0} text edits in {1} files, also created or deleted {2} files",i,t.size,e.size)}}async perform(){if(this._edits.length===0){return[]}const e=[1];for(let n=1;n<this._edits.length;n++){if(Object.getPrototypeOf(this._edits[n-1])===Object.getPrototypeOf(this._edits[n])){e[e.length-1]++}else{e.push(1)}}const t=this._edits.length>1?0:void 0;this._progress.report({increment:t,total:100});const i={report:n=>this._progress.report({increment:100/this._edits.length})};const s=[];let o=0;for(const n of e){if(this._token.isCancellationRequested){break}const r=this._edits.slice(o,o+n);if(r[0]instanceof Gt){s.push(await this._performFileEdits(r,this._undoRedoGroup,this._undoRedoSource,this._confirmBeforeUndo,i))}else if(r[0]instanceof Bi){s.push(await this._performTextEdits(r,this._undoRedoGroup,this._undoRedoSource,i))}else if(r[0]instanceof Cr){s.push(await this._performCellEdits(r,this._undoRedoGroup,this._undoRedoSource,i))}else if(r[0]instanceof bs){s.push(await this._performOpaqueEdits(r,this._undoRedoGroup,this._undoRedoSource,i))}else{console.log("UNKNOWN EDIT")}o=o+n}return s.flat()}async _performFileEdits(e,t,i,s,o){this._logService.debug("_performFileEdits",JSON.stringify(e));const n=this._instaService.createInstance(Ac,this._label||c(4235,"Workspace Edit"),this._code||"undoredo.workspaceEdit",t,i,s,o,this._token,e);return await n.apply()}async _performTextEdits(e,t,i,s){this._logService.debug("_performTextEdits",JSON.stringify(e));const o=this._instaService.createInstance(xc,this._label||c(4235,"Workspace Edit"),this._code||"undoredo.workspaceEdit",this._editor,t,i,s,this._token,e);return await o.apply()}async _performCellEdits(e,t,i,s){this._logService.debug("_performCellEdits",JSON.stringify(e));const o=this._instaService.createInstance(Fy,t,i,s,this._token,e);return await o.apply()}async _performOpaqueEdits(e,t,i,s){this._logService.debug("_performOpaqueEdits",JSON.stringify(e));const o=this._instaService.createInstance(Rc,t,i,s,this._token,e);return await o.apply()}};Vc=E([h(9,N),h(10,et)],Vc);let kc=class kx{constructor(e,t,i,s,o,n,r){this._instaService=e;this._logService=t;this._editorService=i;this._lifecycleService=s;this._dialogService=o;this._workingCopyService=n;this._configService=r;this._activeUndoRedoGroups=new wg}setPreviewHandler(e){this._previewHandler=e;return de(()=>{if(this._previewHandler===e){this._previewHandler=void 0}})}hasPreviewHandler(){return Boolean(this._previewHandler)}async apply(e,t){let i=QI(Array.isArray(e)?e:e.edits);if(i.length===0){return{ariaSummary:c(4236,"Made no edits"),isApplied:false}}if(this._previewHandler&&(t?.showPreview||i.some(u=>u.metadata?.needsConfirmation))){i=await this._previewHandler(i,t)}let s=t?.editor;if(!s){const u=this._editorService.activeTextEditorControl;if(My(u)){s=u}else if(Oy(u)){s=u.getModifiedEditor()}}if(s&&s.getOption(pt.readOnly)){s=void 0}let o;let n=()=>{};if(typeof t?.undoRedoGroupId==="number"){for(const u of this._activeUndoRedoGroups){if(u.id===t.undoRedoGroupId){o=u;break}}}if(!o){o=new Ny;n=this._activeUndoRedoGroups.push(o)}const r=t?.quotableLabel||t?.label;const d=this._instaService.createInstance(Vc,r,t?.code,s,t?.progress??cg.None,t?.token??ei.None,i,o,t?.undoRedoSource,!!t?.confirmBeforeUndo);let l;try{l=this._lifecycleService.onBeforeShutdown(p=>p.veto(this._shouldVeto(r,p.reason),"veto.blukEditService"));const u=await d.perform();if(t?.respectAutoSaveConfig&&this._configService.getValue(pm)===true&&u.length>1){await this._saveAll(u)}return{ariaSummary:d.ariaMessage(),isApplied:i.length>0}}catch(u){this._logService.error(u);throw u}finally{l?.dispose();n()}}async _saveAll(e){const t=new By(e);const i=this._workingCopyService.dirtyWorkingCopies.map(async o=>{if(t.has(o.resource)){await o.save()}});const s=await Promise.allSettled(i);for(const o of s){if(o.status==="rejected"){this._logService.warn(o.reason)}}}async _shouldVeto(e,t){let i;let s;switch(t){case zo.CLOSE:i=c(4237,"Are you sure you want to close the window?");s=c(4238,"&&Close Window");break;case zo.LOAD:i=c(4239,"Are you sure you want to change the workspace?");s=c(4240,"Change &&Workspace");break;case zo.RELOAD:i=c(4241,"Are you sure you want to reload the window?");s=c(4242,"&&Reload Window");break;default:i=c(4243,"Are you sure you want to quit?");s=c(4244,"&&Quit");break}const o=await this._dialogService.confirm({message:i,detail:c(4245,"'{0}' is in progress.",e||c(4246,"File operation")),primaryButton:s});return!o.confirmed}};kc=E([h(0,N),h(1,et),h(2,Y),h(3,bn),h(4,Ls),h(5,Gy),h(6,X)],kc);const pm="files.refactoring.autoSave";W.as(Co.Configuration).registerConfiguration({id:"files",properties:{[pm]:{description:c(4247,"Controls if files that were part of a refactoring are saved automatically"),default:true,type:"boolean"}}});const eD=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let Pc=class Px{constructor(e,t,i,s){this._conflicts=new Ts;this._disposables=new L;this._onDidConflict=new _;this.onDidConflict=this._onDidConflict.event;const o=new Ts;for(const r of e){if(r instanceof Bi){o.set(r.resource,true);if(typeof r.versionId==="number"){const d=i.getModel(r.resource);if(d&&d.getVersionId()!==r.versionId){this._conflicts.set(r.resource,true);this._onDidConflict.fire(this)}}}else if(r instanceof Gt){if(r.newResource){o.set(r.newResource,true)}else if(r.oldResource){o.set(r.oldResource,true)}}else if(r instanceof Cr){o.set(r.resource,true)}else{s.warn("UNKNOWN edit type",r)}}this._disposables.add(t.onDidFilesChange(r=>{for(const d of o.keys()){if(!i.getModel(d)&&r.contains(d)){this._conflicts.set(d,true);this._onDidConflict.fire(this);break}}}));const n=r=>{if(o.has(r.uri)){this._conflicts.set(r.uri,true);this._onDidConflict.fire(this)}};for(const r of i.getModels()){this._disposables.add(r.onDidChangeContent(()=>n(r)))}}dispose(){this._disposables.dispose();this._onDidConflict.dispose()}list(){return[...this._conflicts.keys()]}hasConflicts(){return this._conflicts.size>0}};Pc=E([h(1,je),h(2,wa),h(3,et)],Pc);var Lc;var Bo;class tD{constructor(){this._states=new WeakMap;this._checkedCount=0;this._onDidChange=new _;this.onDidChange=this._onDidChange.event}dispose(){this._onDidChange.dispose()}get checkedCount(){return this._checkedCount}isChecked(e){return this._states.get(e)??false}updateChecked(e,t){const i=this._states.get(e);if(i===t){return}if(i===void 0){if(t){this._checkedCount+=1}}else{if(t){this._checkedCount+=1}else{this._checkedCount-=1}}this._states.set(e,t);this._onDidChange.fire(e)}}class iD{constructor(e,t){this.parent=e;this.textEdit=t}}var ke;(function(a){a[a["TextEdit"]=1]="TextEdit";a[a["Create"]=2]="Create";a[a["Delete"]=4]="Delete";a[a["Rename"]=8]="Rename"})(ke||(ke={}));class sD{constructor(e,t){this.uri=e;this.parent=t;this.type=0;this.textEdits=[];this.originalEdits=new Map}addEdit(e,t,i){this.type|=t;this.originalEdits.set(e,i);if(i instanceof Bi){this.textEdits.push(new iD(this,i))}else if(t===ke.Rename){this.newUri=i.newResource}}needsConfirmation(){for(const[,e]of this.originalEdits){if(!this.parent.checked.isChecked(e)){return true}}return false}}class Mr{static{this._defaultMetadata=Object.freeze({label:c(4264,"Other"),icon:A.symbolFile,needsConfirmation:false})}static keyOf(e){return e?.label||"<default>"}constructor(e=Mr._defaultMetadata){this.metadata=e;this.operationByResource=new Map}get fileOperations(){return this.operationByResource.values()}}let Or=Lc=class Lx{static async create(e,t){const i=e.get(N).createInstance(Lc,t);return await i._init()}constructor(e,t,i){this._bulkEdit=e;this._fileService=t;this.checked=new tD;this.fileOperations=[];this.categories=[];this.conflicts=i.createInstance(Pc,e)}dispose(){this.checked.dispose();this.conflicts.dispose()}async _init(){const e=new Map;const t=new Map;const i=new Ts;for(let s=0;s<this._bulkEdit.length;s++){const o=this._bulkEdit[s];let n;let r;this.checked.updateChecked(o,!o.metadata?.needsConfirmation);if(o instanceof Bi){r=ke.TextEdit;n=o.resource}else if(o instanceof Gt){if(o.newResource&&o.oldResource){r=ke.Rename;n=o.oldResource;if(o.options?.overwrite===void 0&&o.options?.ignoreIfExists&&await this._fileService.exists(n)){continue}i.set(o.newResource,n)}else if(o.oldResource){r=ke.Delete;n=o.oldResource;if(o.options?.ignoreIfNotExists&&!await this._fileService.exists(n)){continue}}else if(o.newResource){r=ke.Create;n=o.newResource;if(o.options?.overwrite===void 0&&o.options?.ignoreIfExists&&await this._fileService.exists(n)){continue}}else{continue}}else{continue}const d=(p,f)=>{let g=fu.getComparisonKey(p,true);let m=f.get(g);if(!m&&i.has(p)){p=i.get(p);g=fu.getComparisonKey(p,true);m=f.get(g)}if(!m){m=new sD(p,this);f.set(g,m)}m.addEdit(s,r,o)};d(n,e);const l=Mr.keyOf(o.metadata);let u=t.get(l);if(!u){u=new Mr(o.metadata);t.set(l,u)}d(n,u.operationByResource)}e.forEach(s=>this.fileOperations.push(s));t.forEach(s=>this.categories.push(s));for(const s of this.fileOperations){if(s.type!==ke.TextEdit){let o=true;for(const n of s.originalEdits.values()){if(n instanceof Gt){o=o&&this.checked.isChecked(n)}}if(!o){for(const n of s.originalEdits.values()){this.checked.updateChecked(n,o)}}}}this.categories.sort((s,o)=>{if(s.metadata.needsConfirmation===o.metadata.needsConfirmation){return s.metadata.label.localeCompare(o.metadata.label)}else if(s.metadata.needsConfirmation){return-1}else{return 1}});return this}getWorkspaceEdit(){const e=[];let t=true;for(let i=0;i<this._bulkEdit.length;i++){const s=this._bulkEdit[i];if(this.checked.isChecked(s)){e[i]=s;continue}t=false}if(t){return this._bulkEdit}Uy(e);return e}async getFileEditOperation(e){const t=await e.options.contents;if(!t){return void 0}return xd.replaceMove(me.lift({startLineNumber:0,startColumn:0,endLineNumber:Number.MAX_VALUE,endColumn:0}),t.toString())}async getFileEdits(e){for(const t of this.fileOperations){if(t.uri.toString()===e.toString()){const i=[];let s=false;for(const o of t.originalEdits.values()){if(o instanceof Gt){i.push(this.getFileEditOperation(o))}else if(o instanceof Bi){if(this.checked.isChecked(o)){i.push(Promise.resolve(xd.replaceMove(me.lift(o.textEdit.range),!o.textEdit.insertAsSnippet?o.textEdit.text:ma.asInsertText(o.textEdit.text))))}}else if(!this.checked.isChecked(o)){s=true}}if(s){return[]}return(await Promise.all(i)).filter(o=>o!==void 0).sort((o,n)=>me.compareRangesUsingStarts(o.range,n.range))}}return[]}getUriOfEdit(e){for(const t of this.fileOperations){for(const i of t.originalEdits.values()){if(i===e){return t.uri}}}throw new Error("invalid edit")}};Or=Lc=E([h(1,je),h(2,N)],Or);let Nr=class Mx{static{Bo=this}static{this.Schema="vscode-bulkeditpreview-editor"}static{this.emptyPreview=K.from({scheme:this.Schema,fragment:"empty"})}static fromPreviewUri(e){return K.parse(e.query)}constructor(e,t,i,s){this._operations=e;this._languageService=t;this._modelService=i;this._textModelResolverService=s;this._disposables=new L;this._modelPreviewEdits=new Map;this._instanceId=yo();this._disposables.add(this._textModelResolverService.registerTextModelContentProvider(Bo.Schema,this));this._ready=this._init()}dispose(){this._disposables.dispose()}asPreviewUri(e){return K.from({scheme:Bo.Schema,authority:this._instanceId,path:e.path,query:e.toString()})}async _init(){for(const e of this._operations.fileOperations){await this._applyTextEditsToPreviewModel(e.uri)}this._disposables.add(x.debounce(this._operations.checked.onDidChange,(e,t)=>t,Wy)(e=>{const t=this._operations.getUriOfEdit(e);this._applyTextEditsToPreviewModel(t)}))}async _applyTextEditsToPreviewModel(e){const t=await this._getOrCreatePreviewModel(e);const i=this._modelPreviewEdits.get(t.id);if(i){t.applyEdits(i)}const s=await this._operations.getFileEdits(e);const o=t.applyEdits(s,true);this._modelPreviewEdits.set(t.id,o)}async _getOrCreatePreviewModel(e){const t=this.asPreviewUri(e);let i=this._modelService.getModel(t);if(!i){try{const s=await this._textModelResolverService.createModelReference(e);const o=s.object.textEditorModel;i=this._modelService.createModel(Hy(o.createSnapshot()),this._languageService.createById(o.getLanguageId()),t);s.dispose()}catch{i=this._modelService.createModel("",this._languageService.createByFilepathOrFirstLine(t),t)}queueMicrotask(async()=>{this._disposables.add(await this._textModelResolverService.createModelReference(i.uri))})}return i}async provideTextContent(e){if(e.toString()===Bo.emptyPreview.toString()){return this._modelService.createModel("",null,e)}await this._ready;return this._modelService.getModel(e)}};Nr=Bo=E([h(1,In),h(2,wa),h(3,bo)],Nr);var Mc;var Oc;var Nc;class Dt{constructor(e,t){this.parent=e;this.category=t}isChecked(){const e=this.parent;let t=true;for(const i of this.category.fileOperations){for(const s of i.originalEdits.values()){t=t&&e.checked.isChecked(s)}}return t}setChecked(e){const t=this.parent;for(const i of this.category.fileOperations){for(const s of i.originalEdits.values()){t.checked.updateChecked(s,e)}}}}class At{constructor(e,t){this.parent=e;this.edit=t}isChecked(){const e=this.parent instanceof Dt?this.parent.parent:this.parent;let t=true;if(this.edit.type===ke.TextEdit){t=!this.edit.textEdits.every(i=>!e.checked.isChecked(i.textEdit))}for(const i of this.edit.originalEdits.values()){if(i instanceof Gt){t=t&&e.checked.isChecked(i)}}if(this.parent instanceof Dt&&this.edit.type===ke.TextEdit){for(const i of e.categories){for(const s of i.fileOperations){if(s.uri.toString()===this.edit.uri.toString()){for(const o of s.originalEdits.values()){if(o instanceof Gt){t=t&&e.checked.isChecked(o)}}}}}}return t}setChecked(e){const t=this.parent instanceof Dt?this.parent.parent:this.parent;for(const i of this.edit.originalEdits.values()){t.checked.updateChecked(i,e)}if(this.parent instanceof Dt&&this.edit.type!==ke.TextEdit){for(const i of t.categories){for(const s of i.fileOperations){if(s.uri.toString()===this.edit.uri.toString()){for(const o of s.originalEdits.values()){t.checked.updateChecked(o,e)}}}}}}isDisabled(){if(this.parent instanceof Dt&&this.edit.type===ke.TextEdit){const e=this.parent.parent;let t=true;for(const i of e.categories){for(const s of i.fileOperations){if(s.uri.toString()===this.edit.uri.toString()){for(const o of s.originalEdits.values()){if(o instanceof Gt){t=t&&e.checked.isChecked(o)}}}}}return!t}return false}}class Gi{constructor(e,t,i,s,o,n,r){this.parent=e;this.idx=t;this.edit=i;this.prefix=s;this.selecting=o;this.inserting=n;this.suffix=r}isChecked(){let e=this.parent.parent;if(e instanceof Dt){e=e.parent}return e.checked.isChecked(this.edit.textEdit)}setChecked(e){let t=this.parent.parent;if(t instanceof Dt){t=t.parent}t.checked.updateChecked(this.edit.textEdit,e);if(e){for(const i of this.parent.edit.originalEdits.values()){if(i instanceof Gt){t.checked.updateChecked(i,e)}}}}isDisabled(){return this.parent.isDisabled()}}let Bc=class Ox{constructor(e,t){this._textModelService=e;this._instantiationService=t;this.groupByFile=true}hasChildren(e){if(e instanceof At){return e.edit.textEdits.length>0}if(e instanceof Gi){return false}return true}async getChildren(e){if(e instanceof Or){return this.groupByFile?e.fileOperations.map(t=>new At(e,t)):e.categories.map(t=>new Dt(e,t))}if(e instanceof Dt){return Array.from(e.category.fileOperations,t=>new At(e,t))}if(e instanceof At&&e.edit.textEdits.length>0){let t;let i;try{const o=await this._textModelService.createModelReference(e.edit.uri);t=o.object.textEditorModel;i=o}catch{t=this._instantiationService.createInstance(mu,"",Sr,mu.DEFAULT_CREATION_OPTIONS,null);i=t}const s=e.edit.textEdits.map((o,n)=>{const r=t.validateRange(o.textEdit.textEdit.range);const d=t.tokenization.getLineTokens(r.startLineNumber);let l=23;for(let f=d.findTokenIndexAtOffset(r.startColumn-1)-1;l<50&&f>=0;f--){l=r.startColumn-d.getStartOffset(f)}const u=t.tokenization.getLineTokens(r.endLineNumber);let p=0;for(let f=u.findTokenIndexAtOffset(r.endColumn-1);p<50&&f<u.getCount();f++){p+=u.getEndOffset(f)-u.getStartOffset(f)}return new Gi(e,n,o,t.getValueInRange(new me(r.startLineNumber,r.startColumn-l,r.startLineNumber,r.startColumn)),t.getValueInRange(r),!o.textEdit.textEdit.insertAsSnippet?o.textEdit.textEdit.text:ma.asInsertText(o.textEdit.textEdit.text),t.getValueInRange(new me(r.endLineNumber,r.endColumn,r.endLineNumber,r.endColumn+p)))});i.dispose();return s}return[]}};Bc=E([h(0,bo),h(1,N)],Bc);class oD{compare(e,t){if(e instanceof At&&t instanceof At){return gm(e.edit,t.edit)}if(e instanceof Gi&&t instanceof Gi){return me.compareRangesUsingStarts(e.edit.textEdit.textEdit.range,t.edit.textEdit.textEdit.range)}return 0}}function gm(a,e){return ya(a.uri.toString(),e.uri.toString())}let Fc=class Nx{constructor(e){this._labelService=e}getWidgetAriaLabel(){return c(4265,"Bulk Edit")}getRole(e){return"checkbox"}getAriaLabel(e){if(e instanceof At){if(e.edit.textEdits.length>0){if(e.edit.type&ke.Rename&&e.edit.newUri){return c(4266,"Renaming {0} to {1}, also making text edits",this._labelService.getUriLabel(e.edit.uri,{relative:true}),this._labelService.getUriLabel(e.edit.newUri,{relative:true}))}else if(e.edit.type&ke.Create){return c(4267,"Creating {0}, also making text edits",this._labelService.getUriLabel(e.edit.uri,{relative:true}))}else if(e.edit.type&ke.Delete){return c(4268,"Deleting {0}, also making text edits",this._labelService.getUriLabel(e.edit.uri,{relative:true}))}else{return c(4269,"{0}, making text edits",this._labelService.getUriLabel(e.edit.uri,{relative:true}))}}else{if(e.edit.type&ke.Rename&&e.edit.newUri){return c(4270,"Renaming {0} to {1}",this._labelService.getUriLabel(e.edit.uri,{relative:true}),this._labelService.getUriLabel(e.edit.newUri,{relative:true}))}else if(e.edit.type&ke.Create){return c(4271,"Creating {0}",this._labelService.getUriLabel(e.edit.uri,{relative:true}))}else if(e.edit.type&ke.Delete){return c(4272,"Deleting {0}",this._labelService.getUriLabel(e.edit.uri,{relative:true}))}}}if(e instanceof Gi){if(e.selecting.length>0&&e.inserting.length>0){return c(4273,"line {0}, replacing {1} with {2}",e.edit.textEdit.textEdit.range.startLineNumber,e.selecting,e.inserting)}else if(e.selecting.length>0&&e.inserting.length===0){return c(4274,"line {0}, removing {1}",e.edit.textEdit.textEdit.range.startLineNumber,e.selecting)}else if(e.selecting.length===0&&e.inserting.length>0){return c(4275,"line {0}, inserting {1}",e.edit.textEdit.textEdit.range.startLineNumber,e.selecting)}}return null}};Fc=E([h(0,os)],Fc);class nD{getId(e){if(e instanceof At){return e.edit.uri+(e.parent instanceof Dt?JSON.stringify(e.parent.category.metadata):"")}else if(e instanceof Gi){return e.parent.edit.uri.toString()+e.idx}else{return JSON.stringify(e.category.metadata)}}}class rD{constructor(e){e.classList.add("category");this.icon=document.createElement("div");e.appendChild(this.icon);this.label=new va(e)}}let Br=class Bx{static{Mc=this}static{this.id="CategoryElementRenderer"}constructor(e){this._themeService=e;this.templateId=Mc.id}renderTemplate(e){return new rD(e)}renderElement(e,t,i){i.icon.style.setProperty("--background-dark",null);i.icon.style.setProperty("--background-light",null);i.icon.style.color="";const{metadata:s}=e.element.category;if(ye.isThemeIcon(s.iconPath)){const o=ye.asClassName(s.iconPath);i.icon.className=o?`theme-icon ${o}`:"";i.icon.style.color=s.iconPath.color?this._themeService.getColorTheme().getColor(s.iconPath.color.id)?.toString()??"":""}else if(K.isUri(s.iconPath)){i.icon.className="uri-icon";i.icon.style.setProperty("--background-dark",Vi(s.iconPath));i.icon.style.setProperty("--background-light",Vi(s.iconPath))}else if(s.iconPath){i.icon.className="uri-icon";i.icon.style.setProperty("--background-dark",Vi(s.iconPath.dark));i.icon.style.setProperty("--background-light",Vi(s.iconPath.light))}i.label.setLabel(s.label,s.description,{descriptionMatches:lo(e.filterData)})}disposeTemplate(e){e.label.dispose()}};Br=Mc=E([h(0,pe)],Br);let Gc=class Fx{constructor(e,t,i){this._labelService=i;this._disposables=new L;this._localDisposables=new L;this._checkbox=document.createElement("input");this._checkbox.className="edit-checkbox";this._checkbox.type="checkbox";this._checkbox.setAttribute("role","checkbox");e.appendChild(this._checkbox);this._label=t.create(e,{supportHighlights:true});this._details=document.createElement("span");this._details.className="details";e.appendChild(this._details)}dispose(){this._localDisposables.dispose();this._disposables.dispose();this._label.dispose()}set(e,t){this._localDisposables.clear();this._checkbox.checked=e.isChecked();this._checkbox.disabled=e.isDisabled();this._localDisposables.add(J(this._checkbox,"change",()=>{e.setChecked(this._checkbox.checked)}));if(e.edit.type&ke.Rename&&e.edit.newUri){this._label.setResource({resource:e.edit.uri,name:c(4276,"{0} → {1}",this._labelService.getUriLabel(e.edit.uri,{relative:true}),this._labelService.getUriLabel(e.edit.newUri,{relative:true}))},{fileDecorations:{colors:true,badges:false}});this._details.innerText=c(4277,"(renaming)")}else{const i={matches:lo(t),fileKind:Oo.FILE,fileDecorations:{colors:true,badges:false},extraClasses:[]};if(e.edit.type&ke.Create){this._details.innerText=c(4278,"(creating)")}else if(e.edit.type&ke.Delete){this._details.innerText=c(4279,"(deleting)");i.extraClasses.push("delete")}else{this._details.innerText=""}this._label.setFile(e.edit.uri,i)}}};Gc=E([h(2,os)],Gc);let Fr=class Gx{static{Oc=this}static{this.id="FileElementRenderer"}constructor(e,t){this._resourceLabels=e;this._labelService=t;this.templateId=Oc.id}renderTemplate(e){return new Gc(e,this._resourceLabels,this._labelService)}renderElement(e,t,i){i.set(e.element,e.filterData)}disposeTemplate(e){e.dispose()}};Fr=Oc=E([h(1,os)],Fr);let Wc=class Wx{constructor(e,t){this._themeService=t;this._disposables=new L;this._localDisposables=new L;e.classList.add("textedit");this._checkbox=document.createElement("input");this._checkbox.className="edit-checkbox";this._checkbox.type="checkbox";this._checkbox.setAttribute("role","checkbox");e.appendChild(this._checkbox);this._icon=document.createElement("div");e.appendChild(this._icon);this._label=this._disposables.add(new Ky(e))}dispose(){this._localDisposables.dispose();this._disposables.dispose()}set(e){this._localDisposables.clear();this._localDisposables.add(J(this._checkbox,"change",d=>{e.setChecked(this._checkbox.checked);d.preventDefault()}));if(e.parent.isChecked()){this._checkbox.checked=e.isChecked();this._checkbox.disabled=e.isDisabled()}else{this._checkbox.checked=e.isChecked();this._checkbox.disabled=e.isDisabled()}let t="";t+=e.prefix;t+=e.selecting;t+=e.inserting;t+=e.suffix;const i={start:e.prefix.length,end:e.prefix.length+e.selecting.length,extraClasses:["remove"]};const s={start:i.end,end:i.end+e.inserting.length,extraClasses:["insert"]};let o;const{metadata:n}=e.edit.textEdit;if(n&&n.description){o=c(4280,"{0} - {1}",n.label,n.description)}else if(n){o=n.label}const r=n?.iconPath;if(!r){this._icon.style.display="none"}else{this._icon.style.display="block";this._icon.style.setProperty("--background-dark",null);this._icon.style.setProperty("--background-light",null);if(ye.isThemeIcon(r)){const d=ye.asClassName(r);this._icon.className=d?`theme-icon ${d}`:"";this._icon.style.color=r.color?this._themeService.getColorTheme().getColor(r.color.id)?.toString()??"":""}else if(K.isUri(r)){this._icon.className="uri-icon";this._icon.style.setProperty("--background-dark",Vi(r));this._icon.style.setProperty("--background-light",Vi(r))}else{this._icon.className="uri-icon";this._icon.style.setProperty("--background-dark",Vi(r.dark));this._icon.style.setProperty("--background-light",Vi(r.light))}}this._label.set(t,[i,s],o,true);this._icon.title=o||""}};Wc=E([h(1,pe)],Wc);let Gr=class Hx{static{Nc=this}static{this.id="TextEditElementRenderer"}constructor(e){this._themeService=e;this.templateId=Nc.id}renderTemplate(e){return new Wc(e,this._themeService)}renderElement({element:e},t,i){i.set(e)}disposeTemplate(e){}};Gr=Nc=E([h(0,pe)],Gr);class aD{getHeight(){return 23}getTemplateId(e){if(e instanceof At){return Fr.id}else if(e instanceof Gi){return Gr.id}else{return Br.id}}}class dD{getKeyboardNavigationLabel(e){if(e instanceof At){return Oi(e.edit.uri)}else if(e instanceof Dt){return e.category.metadata.label}return void 0}}var Yi;Le(eD);var Xo;(function(a){a["Data"]="data";a["Message"]="message"})(Xo||(Xo={}));let Pe=class Ux extends ba{static{Yi=this}static{this.ID="refactorPreview"}static{this.Schema="vscode-bulkeditpreview-multieditor"}static{this.ctxHasCategories=new U("refactorPreview.hasCategories",false)}static{this.ctxGroupByFile=new U("refactorPreview.groupByFile",true)}static{this.ctxHasCheckedChanges=new U("refactorPreview.hasCheckedChanges",true)}static{this._memGroupByFile=`${this.ID}.groupByFile`}constructor(e,t,i,s,o,n,r,d,l,u,p,f,g,m,y,C){super({...e,titleMenuId:w.BulkEditTitle},p,f,g,l,u,t,m,y,C);this._instaService=t;this._editorService=i;this._labelService=s;this._textModelService=o;this._dialogService=n;this._contextMenuService=r;this._storageService=d;this._treeViewStates=new Map;this._disposables=new L;this._sessionDisposables=new L;this._computeResourceDiffEditorInputs=new zy(async D=>{const F=new $y(async H=>{const Z=H.uri;const ie=this._currentProvider.asPreviewUri(Z);if(H.type&ke.Delete){return{original:{resource:K.revive(ie)},modified:{resource:void 0},goToFileResource:H.uri}}else{let Ye;try{(await this._textModelService.createModelReference(Z)).dispose();Ye=Z}catch{Ye=Nr.emptyPreview}return{original:{resource:K.revive(Ye)},modified:{resource:K.revive(ie)},goToFileResource:Ye}}});const P=D.slice().sort(gm);const R=[];for(const H of P){R.push(await F.get(H))}const z=async H=>{const Z=await F.get(H);return{original:Z.original.resource,modified:Z.modified.resource}};return{resources:R,getResourceDiffEditorInputIdOfOperation:z}});this.element.classList.add("bulk-edit-panel","show-file-icons");this._ctxHasCategories=Yi.ctxHasCategories.bindTo(l);this._ctxGroupByFile=Yi.ctxGroupByFile.bindTo(l);this._ctxHasCheckedChanges=Yi.ctxHasCheckedChanges.bindTo(l)}dispose(){this._tree.dispose();this._disposables.dispose();super.dispose()}renderBody(e){super.renderBody(e);const t=this._instaService.createInstance(vg,{onDidChangeVisibility:this.onDidChangeBodyVisibility});this._disposables.add(t);const i=document.createElement("div");i.className="content";e.appendChild(i);const s=document.createElement("div");i.appendChild(s);this._treeDataSource=this._instaService.createInstance(Bc);this._treeDataSource.groupByFile=this._storageService.getBoolean(Yi._memGroupByFile,M.PROFILE,true);this._ctxGroupByFile.set(this._treeDataSource.groupByFile);this._tree=this._instaService.createInstance(Ca,this.id,s,new aD,[this._instaService.createInstance(Gr),this._instaService.createInstance(Fr,t),this._instaService.createInstance(Br)],this._treeDataSource,{accessibilityProvider:this._instaService.createInstance(Fc),identityProvider:new nD,expandOnlyOnTwistieClick:true,multipleSelectionSupport:false,keyboardNavigationLabelProvider:new dD,sorter:new oD,selectionNavigation:true});this._disposables.add(this._tree.onContextMenu(this._onContextMenu,this));this._disposables.add(this._tree.onDidOpen(l=>this._openElementInMultiDiffEditor(l)));const o=document.createElement("div");o.className="buttons";i.appendChild(o);const n=new rg(o);this._disposables.add(n);const r=n.addButton({supportIcons:true,...nn});r.label=c(4259,"Apply");r.onDidClick(()=>this.accept(),this,this._disposables);const d=n.addButton({...nn,secondary:true});d.label=c(4260,"Discard");d.onDidClick(()=>this.discard(),this,this._disposables);this._message=document.createElement("span");this._message.className="message";this._message.innerText=c(4261,"Invoke a code action, like rename, to see a preview of its changes here.");e.appendChild(this._message);this._setState(Xo.Message)}layoutBody(e,t){super.layoutBody(e,t);const i=e-50;this._tree.getHTMLElement().parentElement.style.height=`${i}px`;this._tree.layout(i,t)}_setState(e){this.element.dataset["state"]=e}async setInput(e,t){this._setState(Xo.Data);this._sessionDisposables.clear();this._treeViewStates.clear();if(this._currentResolve){this._currentResolve(void 0);this._currentResolve=void 0}const i=await this._instaService.invokeFunction(Or.create,e);this._currentProvider=this._instaService.createInstance(Nr,i);this._sessionDisposables.add(this._currentProvider);this._sessionDisposables.add(i);const s=i.categories.length>1;this._ctxHasCategories.set(s);this._treeDataSource.groupByFile=!s||this._treeDataSource.groupByFile;this._ctxHasCheckedChanges.set(i.checked.checkedCount>0);this._currentInput=i;return new Promise(o=>{t.onCancellationRequested(()=>o(void 0));this._currentResolve=o;this._setTreeInput(i);this._sessionDisposables.add(i.checked.onDidChange(()=>{this._tree.updateChildren();this._ctxHasCheckedChanges.set(i.checked.checkedCount>0)}))})}hasInput(){return Boolean(this._currentInput)}async _setTreeInput(e){const t=this._treeViewStates.get(this._treeDataSource.groupByFile);await this._tree.setInput(e,t);this._tree.domFocus();if(t){return}const i=[...this._tree.getNode(e).children].slice(0,10);while(i.length>0){const{element:s}=i.shift();if(s instanceof At){await this._tree.expand(s,true)}if(s instanceof Dt){await this._tree.expand(s,true);i.push(...this._tree.getNode(s).children)}}}accept(){const e=this._currentInput?.conflicts.list();if(!e||e.length===0){this._done(true);return}let t;if(e.length===1){t=c(4262,"Cannot apply refactoring because '{0}' has changed in the meantime.",this._labelService.getUriLabel(e[0],{relative:true}))}else{t=c(4263,"Cannot apply refactoring because {0} other files have changed in the meantime.",e.length)}this._dialogService.warn(t).finally(()=>this._done(false))}discard(){this._done(false)}_done(e){this._currentResolve?.(e?this._currentInput?.getWorkspaceEdit():void 0);this._currentInput=void 0;this._setState(Xo.Message);this._sessionDisposables.clear()}toggleChecked(){const[e]=this._tree.getFocus();if((e instanceof At||e instanceof Gi)&&!e.isDisabled()){e.setChecked(!e.isChecked())}else if(e instanceof Dt){e.setChecked(!e.isChecked())}}groupByFile(){if(!this._treeDataSource.groupByFile){this.toggleGrouping()}}groupByType(){if(this._treeDataSource.groupByFile){this.toggleGrouping()}}toggleGrouping(){const e=this._tree.getInput();if(e){const t=this._tree.getViewState();this._treeViewStates.set(this._treeDataSource.groupByFile,t);this._treeDataSource.groupByFile=!this._treeDataSource.groupByFile;this._setTreeInput(e);this._storageService.store(Yi._memGroupByFile,this._treeDataSource.groupByFile,M.PROFILE,Ee.USER);this._ctxGroupByFile.set(this._treeDataSource.groupByFile)}}async _openElementInMultiDiffEditor(e){const t=this._currentInput?.fileOperations;if(!t){return}let i=void 0;let s;if(e.element instanceof Gi){s=e.element.parent;i=e.element.edit.textEdit.textEdit.range}else if(e.element instanceof At){s=e.element;i=e.element.edit.textEdits[0]?.textEdit.textEdit.range}else{return}const o=await this._computeResourceDiffEditorInputs.get(t);const n=await o.getResourceDiffEditorInputIdOfOperation(s.edit);const r={...e.editorOptions,viewState:{revealData:{resource:n,range:i}}};const d=K.from({scheme:Yi.Schema});const l="Refactor Preview";this._editorService.openEditor({multiDiffSource:d,label:l,options:r,isTransient:true,description:l,resources:o.resources},e.sideBySide?jp:qy)}_onContextMenu(e){this._contextMenuService.showContextMenu({menuId:w.BulkEditContext,contextKeyService:this.contextKeyService,getAnchor:()=>e.anchor})}};Pe=Yi=E([h(1,N),h(2,Y),h(3,os),h(4,bo),h(5,Ls),h(6,ot),h(7,le),h(8,ee),h(9,We),h(10,zt),h(11,ot),h(12,X),h(13,St),h(14,pe),h(15,bt)],Pe);var Hc;async function Ms(a){const e=await a.openView(Pe.ID,true);if(e instanceof Pe){return e}return void 0}let Uc=class Kx{constructor(e,t){this._paneCompositeService=e;this._editorGroupsService=t;this._activePanel=e.getActivePaneComposite($.Panel)?.getId()}async restore(e,t){if(e){if(typeof this._activePanel==="string"){await this._paneCompositeService.openPaneComposite(this._activePanel,$.Panel)}else{this._paneCompositeService.hideActivePaneComposite($.Panel)}}if(t){for(const i of this._editorGroupsService.groups){const s=[];for(const o of i.editors){const n=vt.getCanonicalUri(o,{supportSideBySide:ui.PRIMARY});if(n?.scheme===Pe.Schema){s.push(o)}}if(s.length){i.closeEditors(s,{preserveFocus:true})}}}}};Uc=E([h(0,Vs),h(1,qe)],Uc);class rp{constructor(e,t=new es){this.uxState=e;this.cts=t}}let Wt=class zx{static{Hc=this}static{this.ID="workbench.contrib.bulkEditPreview"}static{this.ctxEnabled=new U("refactorPreview.enabled",false)}constructor(e,t,i,s,o,n){this._paneCompositeService=e;this._viewsService=t;this._editorGroupsService=i;this._dialogService=s;o.setPreviewHandler(r=>this._previewEdit(r));this._ctxEnabled=Hc.ctxEnabled.bindTo(n)}async _previewEdit(e){this._ctxEnabled.set(true);const t=this._activeSession?.uxState??new Uc(this._paneCompositeService,this._editorGroupsService);const i=await Ms(this._viewsService);if(!i){this._ctxEnabled.set(false);return e}if(i.hasInput()){const{confirmed:o}=await this._dialogService.confirm({type:ve.Info,message:c(4248,"Another refactoring is being previewed."),detail:c(4249,"Press 'Continue' to discard the previous refactoring and continue with the current refactoring."),primaryButton:c(4250,"&&Continue")});if(!o){return[]}}let s;if(this._activeSession){await this._activeSession.uxState.restore(false,true);this._activeSession.cts.dispose(true);s=new rp(t)}else{s=new rp(t)}this._activeSession=s;try{return await i.setInput(e,s.cts.token)??[]}finally{if(this._activeSession===s){await this._activeSession.uxState.restore(true,true);this._activeSession.cts.dispose();this._ctxEnabled.set(false);this._activeSession=void 0}}}};Wt=Hc=E([h(0,Vs),h(1,st),h(2,qe),h(3,Ls),h(4,yg),h(5,ee)],Wt);v(class $x extends j{constructor(){super({id:"refactorPreview.apply",title:I(4251,"Apply Refactoring"),category:I(4252,"Refactor Preview"),icon:A.check,precondition:S.and(Wt.ctxEnabled,Pe.ctxHasCheckedChanges),menu:[{id:w.BulkEditContext,order:1}],keybinding:{weight:B.EditorContrib-10,when:S.and(Wt.ctxEnabled,or.isEqualTo(Pe.ID)),primary:O.CtrlCmd+T.Enter}})}async run(e){const t=e.get(st);const i=await Ms(t);i?.accept()}});v(class qx extends j{constructor(){super({id:"refactorPreview.discard",title:I(4253,"Discard Refactoring"),category:I(4252,"Refactor Preview"),icon:A.clearAll,precondition:Wt.ctxEnabled,menu:[{id:w.BulkEditContext,order:2}]})}async run(e){const t=e.get(st);const i=await Ms(t);i?.discard()}});v(class jx extends j{constructor(){super({id:"refactorPreview.toggleCheckedState",title:I(4254,"Toggle Change"),category:I(4252,"Refactor Preview"),precondition:Wt.ctxEnabled,keybinding:{weight:B.WorkbenchContrib,when:ge,primary:T.Space},menu:{id:w.BulkEditContext,group:"navigation"}})}async run(e){const t=e.get(st);const i=await Ms(t);i?.toggleChecked()}});v(class Yx extends j{constructor(){super({id:"refactorPreview.groupByFile",title:I(4255,"Group Changes By File"),category:I(4252,"Refactor Preview"),icon:A.ungroupByRefType,precondition:S.and(Pe.ctxHasCategories,Pe.ctxGroupByFile.negate(),Wt.ctxEnabled),menu:[{id:w.BulkEditTitle,when:S.and(Pe.ctxHasCategories,Pe.ctxGroupByFile.negate()),group:"navigation",order:3}]})}async run(e){const t=e.get(st);const i=await Ms(t);i?.groupByFile()}});v(class Zx extends j{constructor(){super({id:"refactorPreview.groupByType",title:I(4256,"Group Changes By Type"),category:I(4252,"Refactor Preview"),icon:A.groupByRefType,precondition:S.and(Pe.ctxHasCategories,Pe.ctxGroupByFile,Wt.ctxEnabled),menu:[{id:w.BulkEditTitle,when:S.and(Pe.ctxHasCategories,Pe.ctxGroupByFile),group:"navigation",order:3}]})}async run(e){const t=e.get(st);const i=await Ms(t);i?.groupByType()}});v(class Jx extends j{constructor(){super({id:"refactorPreview.toggleGrouping",title:I(4256,"Group Changes By Type"),category:I(4252,"Refactor Preview"),icon:A.listTree,toggled:Pe.ctxGroupByFile.negate(),precondition:S.and(Pe.ctxHasCategories,Wt.ctxEnabled),menu:[{id:w.BulkEditContext,order:3}]})}async run(e){const t=e.get(st);const i=await Ms(t);i?.toggleGrouping()}});Ci(Wt.ID,Wt,Si.BlockRestore);const fm=Ae("refactor-preview-view-icon",A.lightbulb,c(4257,"View icon of the refactor preview view."));const cD=W.as(it.ViewContainersRegistry).registerViewContainer({id:Pe.ID,title:I(4258,"Refactor Preview"),hideIfEmpty:true,ctorDescriptor:new Q(Cn,[Pe.ID,{mergeViewWithContainerWhenSingleView:true}]),icon:fm,storageId:Pe.ID},$.Panel);W.as(it.ViewsRegistry).registerViews([{id:Pe.ID,name:I(4258,"Refactor Preview"),when:Wt.ctxEnabled,ctorDescriptor:new Q(Pe),containerIcon:fm}],cD);function lD(){return{[yg.toString()]:new Q(kc,[],true)}}const hD=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class rr{constructor(e,t,i,s){this.item=e;this.locations=t;this.model=i;this.parent=s}static compare(e,t){let i=ya(e.item.uri.toString(),t.item.uri.toString());if(i===0){i=me.compareRangesUsingStarts(e.item.range,t.item.range)}return i}}let uD=class Xx{constructor(e){this.getDirection=e}hasChildren(){return true}async getChildren(e){if(e instanceof Sg){return e.roots.map(s=>new rr(s,void 0,e,void 0))}const{model:t,item:i}=e;if(this.getDirection()===Je.CallsFrom){return(await t.resolveOutgoingCalls(i,ei.None)).map(s=>{return new rr(s.to,s.fromRanges.map(o=>({range:o,uri:i.uri})),t,e)})}else{return(await t.resolveIncomingCalls(i,ei.None)).map(s=>{return new rr(s.from,s.fromRanges.map(o=>({range:o,uri:s.from.uri})),t,e)})}}};let pD=class Qx{compare(e,t){return rr.compare(e,t)}};let gD=class eR{constructor(e){this.getDirection=e}getId(e){let t=this.getDirection()+JSON.stringify(e.item.uri)+JSON.stringify(e.item.range);if(e.parent){t+=this.getId(e.parent)}return t}};class fD{constructor(e,t){this.icon=e;this.label=t}}class Ma{constructor(){this.templateId=Ma.id}static{this.id="CallRenderer"}renderTemplate(e){e.classList.add("callhierarchy-element");const t=document.createElement("div");e.appendChild(t);const i=new va(e,{supportHighlights:true});return new fD(t,i)}renderElement(e,t,i){const{element:s,filterData:o}=e;const n=s.item.tags?.includes(bg.Deprecated);i.icon.className="";i.icon.classList.add("inline",...ye.asClassNameArray(Cg.toIcon(s.item.kind)));i.label.setLabel(s.item.name,s.item.detail,{labelEscapeNewLines:true,matches:lo(o),strikethrough:n})}disposeTemplate(e){e.label.dispose()}}let mD=class tR{getHeight(e){return 22}getTemplateId(e){return Ma.id}};let wD=class iR{constructor(e){this.getDirection=e}getWidgetAriaLabel(){return c(4298,"Call Hierarchy")}getAriaLabel(e){if(this.getDirection()===Je.CallsFrom){return c(4299,"calls from {0}",e.item.name)}else{return c(4300,"callers of {0}",e.item.name)}}};var Kc;Le(hD);var Qo;(function(a){a["Loading"]="loading";a["Message"]="message";a["Data"]="data"})(Qo||(Qo={}));let ap=class sR{static store(e,t){t.store("callHierarchyPeekLayout",JSON.stringify(e),M.PROFILE,Ee.MACHINE)}static retrieve(e){const t=e.get("callHierarchyPeekLayout",M.PROFILE,"{}");const i={ratio:.7,height:17};try{return{...i,...JSON.parse(t)}}catch{return i}}constructor(e,t){this.ratio=e;this.height=t}};class vD extends Ca{}let uo=class oR extends _g{static{Kc=this}static{this.TitleMenu=new w("callhierarchy/title")}constructor(e,t,i,s,o,n,r,d,l,u,p){super(e,{showFrame:true,showArrow:true,isResizeable:true,isAccessible:true},p);this._where=t;this._direction=i;this._peekViewService=o;this._editorService=n;this._textModelService=r;this._storageService=d;this._menuService=l;this._contextKeyService=u;this._instantiationService=p;this._treeViewStates=new Map;this._previewDisposable=new L;this.create();this._peekViewService.addExclusiveWidget(e,this);this._applyTheme(s.getColorTheme());this._disposables.add(s.onDidColorThemeChange(this._applyTheme,this));this._disposables.add(this._previewDisposable)}dispose(){ap.store(this._layoutInfo,this._storageService);this._splitView.dispose();this._tree.dispose();this._editor.dispose();super.dispose()}get direction(){return this._direction}_applyTheme(e){const t=e.getColor(Eg)||Bt.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(Tg)||Bt.transparent,primaryHeadingColor:e.getColor(Dg),secondaryHeadingColor:e.getColor(Ig)})}_fillHead(e){super._fillHead(e,true);const t=this._menuService.createMenu(Kc.TitleMenu,this._contextKeyService);const i=()=>{const s=Sa(t.getActions());this._actionbarWidget.clear();this._actionbarWidget.push(s,{label:false,icon:true})};this._disposables.add(t);this._disposables.add(t.onDidChange(i));i()}_fillBody(e){this._layoutInfo=ap.retrieve(this._storageService);this._dim=new Ft(0,0);this._parent=e;e.classList.add("call-hierarchy");const t=document.createElement("div");t.classList.add("message");e.appendChild(t);this._message=t;this._message.tabIndex=0;const i=document.createElement("div");i.classList.add("results");e.appendChild(i);this._splitView=new tn(i,{orientation:q.HORIZONTAL});const s=document.createElement("div");s.classList.add("editor");i.appendChild(s);const o={scrollBeyondLastLine:false,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:true,verticalHasArrows:false,horizontalHasArrows:false,alwaysConsumeMouseWheel:false},overviewRulerLanes:2,fixedOverflowWidgets:true,minimap:{enabled:false}};this._editor=this._instantiationService.createInstance(Ag,s,o,{},this.editor);const n=document.createElement("div");n.classList.add("tree");i.appendChild(n);const r={sorter:new pD,accessibilityProvider:new wD(()=>this._direction),identityProvider:new gD(()=>this._direction),expandOnlyOnTwistieClick:true,overrideStyles:{listBackground:xg}};this._tree=this._instantiationService.createInstance(vD,"CallHierarchyPeek",n,new mD,[this._instantiationService.createInstance(Ma)],this._instantiationService.createInstance(uD,()=>this._direction),r);this._splitView.addView({onDidChange:x.None,element:s,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:d=>{if(this._dim.height){this._editor.layout({height:this._dim.height,width:d})}}},It.Distribute);this._splitView.addView({onDidChange:x.None,element:n,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:d=>{if(this._dim.height){this._tree.layout(this._dim.height,d)}}},It.Distribute);this._disposables.add(this._splitView.onDidSashChange(()=>{if(this._dim.width){this._layoutInfo.ratio=this._splitView.getViewSize(0)/this._dim.width}}));this._disposables.add(this._tree.onDidChangeFocus(this._updatePreview,this));this._disposables.add(this._editor.onMouseDown(d=>{const{event:l,target:u}=d;if(l.detail!==2){return}const[p]=this._tree.getFocus();if(!p){return}this.dispose();this._editorService.openEditor({resource:p.item.uri,options:{selection:u.range}})}));this._disposables.add(this._tree.onMouseDblClick(d=>{if(d.target===Rg.Twistie){return}if(d.element){this.dispose();this._editorService.openEditor({resource:d.element.item.uri,options:{selection:d.element.item.selectionRange,pinned:true}})}}));this._disposables.add(this._tree.onDidChangeSelection(d=>{const[l]=d.elements;if(l&&Vg(d.browserEvent)){this.dispose();this._editorService.openEditor({resource:l.item.uri,options:{selection:l.item.selectionRange,pinned:true}})}}))}async _updatePreview(){const[e]=this._tree.getFocus();if(!e){return}this._previewDisposable.clear();const t={description:"call-hierarchy-decoration",stickiness:kg.NeverGrowsWhenTypingAtEdges,className:"call-decoration",overviewRuler:{color:Pg(Mg),position:Dn.Center}};let i;if(this._direction===Je.CallsFrom){i=e.parent?e.parent.item.uri:e.model.root.uri}else{i=e.item.uri}const s=await this._textModelService.createModelReference(i);this._editor.setModel(s.object.textEditorModel);const o=[];let n;let r=e.locations;if(!r){r=[{uri:e.item.uri,range:e.item.selectionRange}]}for(const l of r){if(l.uri.toString()===i.toString()){o.push({range:l.range,options:t});n=!n?l.range:me.plusRange(l.range,n)}}if(n){this._editor.revealRangeInCenter(n,xt.Immediate);const l=this._editor.createDecorationsCollection(o);this._previewDisposable.add(de(()=>l.clear()))}this._previewDisposable.add(s);const d=this._direction===Je.CallsFrom?c(4293,"Calls from '{0}'",e.model.root.name):c(4294,"Callers of '{0}'",e.model.root.name);this.setTitle(d)}showLoading(){this._parent.dataset["state"]=Qo.Loading;this.setTitle(c(4295,"Loading..."));this._show()}showMessage(e){this._parent.dataset["state"]=Qo.Message;this.setTitle("");this.setMetaTitle("");this._message.innerText=e;this._show();this._message.focus()}async showModel(e){this._show();const t=this._treeViewStates.get(this._direction);await this._tree.setInput(e,t);const i=this._tree.getNode(e).children[0];await this._tree.expand(i.element);if(i.children.length===0){this.showMessage(this._direction===Je.CallsFrom?c(4296,"No calls from '{0}'",e.root.name):c(4297,"No callers of '{0}'",e.root.name))}else{this._parent.dataset["state"]=Qo.Data;if(!t||this._tree.getFocus().length===0){this._tree.setFocus([i.children[0].element])}this._tree.domFocus();this._updatePreview()}}getModel(){return this._tree.getInput()}getFocused(){return this._tree.getFocus()[0]}async updateDirection(e){const t=this._tree.getInput();if(t&&e!==this._direction){this._treeViewStates.set(this._direction,this._tree.getViewState());this._direction=e;await this.showModel(t)}}_show(){if(!this._isShowing){this.editor.revealLineInCenterIfOutsideViewport(this._where.lineNumber,xt.Smooth);super.show(me.fromPositions(this._where),this._layoutInfo.height)}}_onWidth(e){if(this._dim){this._doLayoutBody(this._dim.height,e)}}_doLayoutBody(e,t){if(this._dim.height!==e||this._dim.width!==t){super._doLayoutBody(e,t);this._dim=new Ft(t,e);this._layoutInfo.height=this._viewZone?this._viewZone.heightInLines:this._layoutInfo.height;this._splitView.layout(t);this._splitView.resizeView(0,t*this._layoutInfo.ratio)}}};uo=Kc=E([h(3,pe),h(4,Lg),h(5,Y),h(6,bo),h(7,le),h(8,Ki),h(9,ee),h(10,N)],uo);var Ws;const zc=new U("editorHasCallHierarchyProvider",false,c(4281,"Whether a call hierarchy provider is available"));const On=new U("callHierarchyVisible",false,c(4282,"Whether call hierarchy peek is currently showing"));const pn=new U("callHierarchyDirection",void 0,{type:"string",description:c(4283,"Whether call hierarchy shows incoming or outgoing calls")});function yD(a){return a===Je.CallsFrom||a===Je.CallsTo?a:Je.CallsTo}let Wi=class nR{static{Ws=this}static{this.Id="callHierarchy"}static get(e){return e.getContribution(Ws.Id)}static{this._StorageDirection="callHierarchy/defaultDirection"}constructor(e,t,i,s,o){this._editor=e;this._contextKeyService=t;this._storageService=i;this._editorService=s;this._instantiationService=o;this._dispoables=new L;this._sessionDisposables=new L;this._ctxIsVisible=On.bindTo(this._contextKeyService);this._ctxHasProvider=zc.bindTo(this._contextKeyService);this._ctxDirection=pn.bindTo(this._contextKeyService);this._dispoables.add(x.any(e.onDidChangeModel,e.onDidChangeModelLanguage,Qa.onDidChange)(()=>{this._ctxHasProvider.set(e.hasModel()&&Qa.has(e.getModel()))}));this._dispoables.add(this._sessionDisposables)}dispose(){this._ctxHasProvider.reset();this._ctxIsVisible.reset();this._dispoables.dispose()}async startCallHierarchyFromEditor(){this._sessionDisposables.clear();if(!this._editor.hasModel()){return}const e=this._editor.getModel();const t=this._editor.getPosition();if(!Qa.has(e)){return}const i=new es;const s=Sg.create(e,t,i.token);const o=yD(this._storageService.get(Ws._StorageDirection,M.PROFILE,Je.CallsTo));this._showCallHierarchyWidget(t,o,s,i)}async startCallHierarchyFromCallHierarchy(){if(!this._widget){return}const e=this._widget.getModel();const t=this._widget.getFocused();if(!t||!e){return}const i=await this._editorService.openCodeEditor({resource:t.item.uri},this._editor);if(!i){return}const s=e.fork(t.item);this._sessionDisposables.clear();Ws.get(i)?._showCallHierarchyWidget(me.lift(s.root.selectionRange).getStartPosition(),this._widget.direction,Promise.resolve(s),new es)}_showCallHierarchyWidget(e,t,i,s){this._ctxIsVisible.set(true);this._ctxDirection.set(t);x.any(this._editor.onDidChangeModel,this._editor.onDidChangeModelLanguage)(this.endCallHierarchy,this,this._sessionDisposables);this._widget=this._instantiationService.createInstance(uo,this._editor,e,t);this._widget.showLoading();this._sessionDisposables.add(this._widget.onDidClose(()=>{this.endCallHierarchy();this._storageService.store(Ws._StorageDirection,this._widget.direction,M.PROFILE,Ee.USER)}));this._sessionDisposables.add({dispose(){s.dispose(true)}});this._sessionDisposables.add(this._widget);i.then(o=>{if(s.token.isCancellationRequested){return}if(o){this._sessionDisposables.add(o);this._widget.showModel(o)}else{this._widget.showMessage(c(4284,"No results"))}}).catch(o=>{if(da(o)){this.endCallHierarchy();return}this._widget.showMessage(c(4285,"Failed to show call hierarchy"))})}showOutgoingCalls(){this._widget?.updateDirection(Je.CallsFrom);this._ctxDirection.set(Je.CallsFrom)}showIncomingCalls(){this._widget?.updateDirection(Je.CallsTo);this._ctxDirection.set(Je.CallsTo)}endCallHierarchy(){this._sessionDisposables.clear();this._ctxIsVisible.set(false);this._editor.focus()}};Wi=Ws=E([h(1,ee),h(2,le),h(3,So),h(4,N)],Wi);Zl(Wi.Id,Wi,Jl.Eager);v(class rR extends _i{constructor(){super({id:"editor.showCallHierarchy",title:I(4286,"Peek Call Hierarchy"),menu:{id:w.EditorContextPeek,group:"navigation",order:1e3,when:S.and(zc,_r.notInPeekEditor,an.isInEmbeddedEditor.toNegated())},keybinding:{when:an.editorTextFocus,weight:B.WorkbenchContrib,primary:O.Shift+O.Alt+T.KeyH},precondition:S.and(zc,_r.notInPeekEditor),f1:true})}async runEditorCommand(e,t){return Wi.get(t)?.startCallHierarchyFromEditor()}});v(class extends _i{constructor(){super({id:"editor.showIncomingCalls",title:I(4287,"Show Incoming Calls"),icon:Ae("callhierarchy-incoming",A.callIncoming,c(4288,"Icon for incoming calls in the call hierarchy view.")),precondition:S.and(On,pn.isEqualTo(Je.CallsFrom)),keybinding:{weight:B.WorkbenchContrib,primary:O.Shift+O.Alt+T.KeyH},menu:{id:uo.TitleMenu,when:pn.isEqualTo(Je.CallsFrom),order:1}})}runEditorCommand(a,e){return Wi.get(e)?.showIncomingCalls()}});v(class extends _i{constructor(){super({id:"editor.showOutgoingCalls",title:I(4289,"Show Outgoing Calls"),icon:Ae("callhierarchy-outgoing",A.callOutgoing,c(4290,"Icon for outgoing calls in the call hierarchy view.")),precondition:S.and(On,pn.isEqualTo(Je.CallsTo)),keybinding:{weight:B.WorkbenchContrib,primary:O.Shift+O.Alt+T.KeyH},menu:{id:uo.TitleMenu,when:pn.isEqualTo(Je.CallsTo),order:1}})}runEditorCommand(a,e){return Wi.get(e)?.showOutgoingCalls()}});v(class extends _i{constructor(){super({id:"editor.refocusCallHierarchy",title:I(4291,"Refocus Call Hierarchy"),precondition:On,keybinding:{weight:B.WorkbenchContrib,primary:O.Shift+T.Enter}})}async runEditorCommand(a,e){return Wi.get(e)?.startCallHierarchyFromCallHierarchy()}});v(class extends _i{constructor(){super({id:"editor.closeCallHierarchy",title:c(4292,"Close"),icon:A.close,precondition:On,keybinding:{weight:B.WorkbenchContrib+10,primary:T.Escape,when:S.not("config.editor.stablePeek")},menu:{id:uo.TitleMenu,order:1e3}})}runEditorCommand(a,e){return Wi.get(e)?.endCallHierarchy()}});const bD=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class ar{constructor(e,t,i){this.item=e;this.model=t;this.parent=i}static compare(e,t){let i=ya(e.item.uri.toString(),t.item.uri.toString());if(i===0){i=me.compareRangesUsingStarts(e.item.range,t.item.range)}return i}}class CD{constructor(e){this.getDirection=e}hasChildren(){return true}async getChildren(e){if(e instanceof Og){return e.roots.map(s=>new ar(s,e,void 0))}const{model:t,item:i}=e;if(this.getDirection()===Xe.Supertypes){return(await t.provideSupertypes(i,ei.None)).map(s=>{return new ar(s,t,e)})}else{return(await t.provideSubtypes(i,ei.None)).map(s=>{return new ar(s,t,e)})}}}class SD{compare(e,t){return ar.compare(e,t)}}class _D{constructor(e){this.getDirection=e}getId(e){let t=this.getDirection()+JSON.stringify(e.item.uri)+JSON.stringify(e.item.range);if(e.parent){t+=this.getId(e.parent)}return t}}class ED{constructor(e,t){this.icon=e;this.label=t}}class Oa{constructor(){this.templateId=Oa.id}static{this.id="TypeRenderer"}renderTemplate(e){e.classList.add("typehierarchy-element");const t=document.createElement("div");e.appendChild(t);const i=new va(e,{supportHighlights:true});return new ED(t,i)}renderElement(e,t,i){const{element:s,filterData:o}=e;const n=s.item.tags?.includes(bg.Deprecated);i.icon.classList.add("inline",...ye.asClassNameArray(Cg.toIcon(s.item.kind)));i.label.setLabel(s.item.name,s.item.detail,{labelEscapeNewLines:true,matches:lo(o),strikethrough:n})}disposeTemplate(e){e.label.dispose()}}class ID{getHeight(e){return 22}getTemplateId(e){return Oa.id}}class DD{constructor(e){this.getDirection=e}getWidgetAriaLabel(){return c(11173,"Type Hierarchy")}getAriaLabel(e){if(this.getDirection()===Xe.Supertypes){return c(11174,"supertypes of {0}",e.item.name)}else{return c(11175,"subtypes of {0}",e.item.name)}}}var $c;Le(bD);var en;(function(a){a["Loading"]="loading";a["Message"]="message";a["Data"]="data"})(en||(en={}));class dp{static store(e,t){t.store("typeHierarchyPeekLayout",JSON.stringify(e),M.PROFILE,Ee.MACHINE)}static retrieve(e){const t=e.get("typeHierarchyPeekLayout",M.PROFILE,"{}");const i={ratio:.7,height:17};try{return{...i,...JSON.parse(t)}}catch{return i}}constructor(e,t){this.ratio=e;this.height=t}}class TD extends Ca{}let po=class aR extends _g{static{$c=this}static{this.TitleMenu=new w("typehierarchy/title")}constructor(e,t,i,s,o,n,r,d,l,u,p){super(e,{showFrame:true,showArrow:true,isResizeable:true,isAccessible:true},p);this._where=t;this._direction=i;this._peekViewService=o;this._editorService=n;this._textModelService=r;this._storageService=d;this._menuService=l;this._contextKeyService=u;this._instantiationService=p;this._treeViewStates=new Map;this._previewDisposable=new L;this.create();this._peekViewService.addExclusiveWidget(e,this);this._applyTheme(s.getColorTheme());this._disposables.add(s.onDidColorThemeChange(this._applyTheme,this));this._disposables.add(this._previewDisposable)}dispose(){dp.store(this._layoutInfo,this._storageService);this._splitView.dispose();this._tree.dispose();this._editor.dispose();super.dispose()}get direction(){return this._direction}_applyTheme(e){const t=e.getColor(Eg)||Bt.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(Tg)||Bt.transparent,primaryHeadingColor:e.getColor(Dg),secondaryHeadingColor:e.getColor(Ig)})}_fillHead(e){super._fillHead(e,true);const t=this._menuService.createMenu($c.TitleMenu,this._contextKeyService);const i=()=>{const s=Sa(t.getActions());this._actionbarWidget.clear();this._actionbarWidget.push(s,{label:false,icon:true})};this._disposables.add(t);this._disposables.add(t.onDidChange(i));i()}_fillBody(e){this._layoutInfo=dp.retrieve(this._storageService);this._dim=new Ft(0,0);this._parent=e;e.classList.add("type-hierarchy");const t=document.createElement("div");t.classList.add("message");e.appendChild(t);this._message=t;this._message.tabIndex=0;const i=document.createElement("div");i.classList.add("results");e.appendChild(i);this._splitView=new tn(i,{orientation:q.HORIZONTAL});const s=document.createElement("div");s.classList.add("editor");i.appendChild(s);const o={scrollBeyondLastLine:false,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:true,verticalHasArrows:false,horizontalHasArrows:false,alwaysConsumeMouseWheel:false},overviewRulerLanes:2,fixedOverflowWidgets:true,minimap:{enabled:false}};this._editor=this._instantiationService.createInstance(Ag,s,o,{},this.editor);const n=document.createElement("div");n.classList.add("tree");i.appendChild(n);const r={sorter:new SD,accessibilityProvider:new DD(()=>this._direction),identityProvider:new _D(()=>this._direction),expandOnlyOnTwistieClick:true,overrideStyles:{listBackground:xg}};this._tree=this._instantiationService.createInstance(TD,"TypeHierarchyPeek",n,new ID,[this._instantiationService.createInstance(Oa)],this._instantiationService.createInstance(CD,()=>this._direction),r);this._splitView.addView({onDidChange:x.None,element:s,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:d=>{if(this._dim.height){this._editor.layout({height:this._dim.height,width:d})}}},It.Distribute);this._splitView.addView({onDidChange:x.None,element:n,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:d=>{if(this._dim.height){this._tree.layout(this._dim.height,d)}}},It.Distribute);this._disposables.add(this._splitView.onDidSashChange(()=>{if(this._dim.width){this._layoutInfo.ratio=this._splitView.getViewSize(0)/this._dim.width}}));this._disposables.add(this._tree.onDidChangeFocus(this._updatePreview,this));this._disposables.add(this._editor.onMouseDown(d=>{const{event:l,target:u}=d;if(l.detail!==2){return}const[p]=this._tree.getFocus();if(!p){return}this.dispose();this._editorService.openEditor({resource:p.item.uri,options:{selection:u.range}})}));this._disposables.add(this._tree.onMouseDblClick(d=>{if(d.target===Rg.Twistie){return}if(d.element){this.dispose();this._editorService.openEditor({resource:d.element.item.uri,options:{selection:d.element.item.selectionRange,pinned:true}})}}));this._disposables.add(this._tree.onDidChangeSelection(d=>{const[l]=d.elements;if(l&&Vg(d.browserEvent)){this.dispose();this._editorService.openEditor({resource:l.item.uri,options:{selection:l.item.selectionRange,pinned:true}})}}))}async _updatePreview(){const[e]=this._tree.getFocus();if(!e){return}this._previewDisposable.clear();const t={description:"type-hierarchy-decoration",stickiness:kg.NeverGrowsWhenTypingAtEdges,className:"type-decoration",overviewRuler:{color:Pg(Mg),position:Dn.Center}};let i;if(this._direction===Xe.Supertypes){i=e.parent?e.parent.item.uri:e.model.root.uri}else{i=e.item.uri}const s=await this._textModelService.createModelReference(i);this._editor.setModel(s.object.textEditorModel);const o=[];let n;const r={uri:e.item.uri,range:e.item.selectionRange};if(r.uri.toString()===i.toString()){o.push({range:r.range,options:t});n=!n?r.range:me.plusRange(r.range,n)}if(n){this._editor.revealRangeInCenter(n,xt.Immediate);const l=this._editor.createDecorationsCollection(o);this._previewDisposable.add(de(()=>l.clear()))}this._previewDisposable.add(s);const d=this._direction===Xe.Supertypes?c(11168,"Supertypes of '{0}'",e.model.root.name):c(11169,"Subtypes of '{0}'",e.model.root.name);this.setTitle(d)}showLoading(){this._parent.dataset["state"]=en.Loading;this.setTitle(c(11170,"Loading..."));this._show()}showMessage(e){this._parent.dataset["state"]=en.Message;this.setTitle("");this.setMetaTitle("");this._message.innerText=e;this._show();this._message.focus()}async showModel(e){this._show();const t=this._treeViewStates.get(this._direction);await this._tree.setInput(e,t);const i=this._tree.getNode(e).children[0];await this._tree.expand(i.element);if(i.children.length===0){this.showMessage(this._direction===Xe.Supertypes?c(11171,"No supertypes of '{0}'",e.root.name):c(11172,"No subtypes of '{0}'",e.root.name))}else{this._parent.dataset["state"]=en.Data;if(!t||this._tree.getFocus().length===0){this._tree.setFocus([i.children[0].element])}this._tree.domFocus();this._updatePreview()}}getModel(){return this._tree.getInput()}getFocused(){return this._tree.getFocus()[0]}async updateDirection(e){const t=this._tree.getInput();if(t&&e!==this._direction){this._treeViewStates.set(this._direction,this._tree.getViewState());this._direction=e;await this.showModel(t)}}_show(){if(!this._isShowing){this.editor.revealLineInCenterIfOutsideViewport(this._where.lineNumber,xt.Smooth);super.show(me.fromPositions(this._where),this._layoutInfo.height)}}_onWidth(e){if(this._dim){this._doLayoutBody(this._dim.height,e)}}_doLayoutBody(e,t){if(this._dim.height!==e||this._dim.width!==t){super._doLayoutBody(e,t);this._dim=new Ft(t,e);this._layoutInfo.height=this._viewZone?this._viewZone.heightInLines:this._layoutInfo.height;this._splitView.layout(t);this._splitView.resizeView(0,t*this._layoutInfo.ratio)}}};po=$c=E([h(3,pe),h(4,Lg),h(5,Y),h(6,bo),h(7,le),h(8,Ki),h(9,ee),h(10,N)],po);var Hs;const qc=new U("editorHasTypeHierarchyProvider",false,c(11158,"Whether a type hierarchy provider is available"));const Nn=new U("typeHierarchyVisible",false,c(11159,"Whether type hierarchy peek is currently showing"));const gn=new U("typeHierarchyDirection",void 0,{type:"string",description:c(11160,"whether type hierarchy shows super types or subtypes")});function AD(a){return a===Xe.Subtypes||a===Xe.Supertypes?a:Xe.Subtypes}let Hi=class dR{static{Hs=this}static{this.Id="typeHierarchy"}static get(e){return e.getContribution(Hs.Id)}static{this._storageDirectionKey="typeHierarchy/defaultDirection"}constructor(e,t,i,s,o){this._editor=e;this._contextKeyService=t;this._storageService=i;this._editorService=s;this._instantiationService=o;this._disposables=new L;this._sessionDisposables=new L;this._ctxHasProvider=qc.bindTo(this._contextKeyService);this._ctxIsVisible=Nn.bindTo(this._contextKeyService);this._ctxDirection=gn.bindTo(this._contextKeyService);this._disposables.add(x.any(e.onDidChangeModel,e.onDidChangeModelLanguage,ed.onDidChange)(()=>{this._ctxHasProvider.set(e.hasModel()&&ed.has(e.getModel()))}));this._disposables.add(this._sessionDisposables)}dispose(){this._disposables.dispose()}async startTypeHierarchyFromEditor(){this._sessionDisposables.clear();if(!this._editor.hasModel()){return}const e=this._editor.getModel();const t=this._editor.getPosition();if(!ed.has(e)){return}const i=new es;const s=Og.create(e,t,i.token);const o=AD(this._storageService.get(Hs._storageDirectionKey,M.PROFILE,Xe.Subtypes));this._showTypeHierarchyWidget(t,o,s,i)}_showTypeHierarchyWidget(e,t,i,s){this._ctxIsVisible.set(true);this._ctxDirection.set(t);x.any(this._editor.onDidChangeModel,this._editor.onDidChangeModelLanguage)(this.endTypeHierarchy,this,this._sessionDisposables);this._widget=this._instantiationService.createInstance(po,this._editor,e,t);this._widget.showLoading();this._sessionDisposables.add(this._widget.onDidClose(()=>{this.endTypeHierarchy();this._storageService.store(Hs._storageDirectionKey,this._widget.direction,M.PROFILE,Ee.USER)}));this._sessionDisposables.add({dispose(){s.dispose(true)}});this._sessionDisposables.add(this._widget);i.then(o=>{if(s.token.isCancellationRequested){return}if(o){this._sessionDisposables.add(o);this._widget.showModel(o)}else{this._widget.showMessage(c(11161,"No results"))}}).catch(o=>{if(da(o)){this.endTypeHierarchy();return}this._widget.showMessage(c(11162,"Failed to show type hierarchy"))})}async startTypeHierarchyFromTypeHierarchy(){if(!this._widget){return}const e=this._widget.getModel();const t=this._widget.getFocused();if(!t||!e){return}const i=await this._editorService.openCodeEditor({resource:t.item.uri},this._editor);if(!i){return}const s=e.fork(t.item);this._sessionDisposables.clear();Hs.get(i)?._showTypeHierarchyWidget(me.lift(s.root.selectionRange).getStartPosition(),this._widget.direction,Promise.resolve(s),new es)}showSupertypes(){this._widget?.updateDirection(Xe.Supertypes);this._ctxDirection.set(Xe.Supertypes)}showSubtypes(){this._widget?.updateDirection(Xe.Subtypes);this._ctxDirection.set(Xe.Subtypes)}endTypeHierarchy(){this._sessionDisposables.clear();this._ctxIsVisible.set(false);this._editor.focus()}};Hi=Hs=E([h(1,ee),h(2,le),h(3,So),h(4,N)],Hi);Zl(Hi.Id,Hi,Jl.Eager);v(class cR extends _i{constructor(){super({id:"editor.showTypeHierarchy",title:I(11163,"Peek Type Hierarchy"),menu:{id:w.EditorContextPeek,group:"navigation",order:1e3,when:S.and(qc,_r.notInPeekEditor)},precondition:S.and(qc,_r.notInPeekEditor),f1:true})}async runEditorCommand(e,t){return Hi.get(t)?.startTypeHierarchyFromEditor()}});v(class extends _i{constructor(){super({id:"editor.showSupertypes",title:I(11164,"Show Supertypes"),icon:A.typeHierarchySuper,precondition:S.and(Nn,gn.isEqualTo(Xe.Subtypes)),keybinding:{weight:B.WorkbenchContrib,primary:O.Shift+O.Alt+T.KeyH},menu:{id:po.TitleMenu,when:gn.isEqualTo(Xe.Subtypes),order:1}})}runEditorCommand(a,e){return Hi.get(e)?.showSupertypes()}});v(class extends _i{constructor(){super({id:"editor.showSubtypes",title:I(11165,"Show Subtypes"),icon:A.typeHierarchySub,precondition:S.and(Nn,gn.isEqualTo(Xe.Supertypes)),keybinding:{weight:B.WorkbenchContrib,primary:O.Shift+O.Alt+T.KeyH},menu:{id:po.TitleMenu,when:gn.isEqualTo(Xe.Supertypes),order:1}})}runEditorCommand(a,e){return Hi.get(e)?.showSubtypes()}});v(class extends _i{constructor(){super({id:"editor.refocusTypeHierarchy",title:I(11166,"Refocus Type Hierarchy"),precondition:Nn,keybinding:{weight:B.WorkbenchContrib,primary:O.Shift+T.Enter}})}async runEditorCommand(a,e){return Hi.get(e)?.startTypeHierarchyFromTypeHierarchy()}});v(class extends _i{constructor(){super({id:"editor.closeTypeHierarchy",title:c(11167,"Close"),icon:A.close,precondition:Nn,keybinding:{weight:B.WorkbenchContrib+10,primary:T.Escape,when:S.not("config.editor.stablePeek")},menu:{id:po.TitleMenu,order:1e3}})}runEditorCommand(a,e){return Hi.get(e)?.endTypeHierarchy()}});function wh(a){const e=a?.getHTMLElement();if(e&&!ag(e)){a?.domFocus()}}async function xD(a,e){if(!Fg.getValue(a.contextKeyService)){return e(a)}const t=a.getFocus();const i=a.getSelection();await e(a);const s=a.getFocus();if(i.length>1||!_s(t,i)||_s(t,s)){return}const o=new KeyboardEvent("keydown");a.setSelection(s,o)}async function yt(a,e){if(!a){return}await xD(a,e);const t=a.getFocus();if(t.length){a.reveal(t[0])}a.setAnchor(t[0]);wh(a)}te.registerCommandAndKeybindingRule({id:"list.focusDown",weight:B.WorkbenchContrib,when:ge,primary:T.DownArrow,mac:{primary:T.DownArrow,secondary:[O.WinCtrl|T.KeyN]},handler:(a,e)=>{yt(a.get(re).lastFocusedList,async t=>{const i=new KeyboardEvent("keydown");await t.focusNext(typeof e==="number"?e:1,false,i)})}});te.registerCommandAndKeybindingRule({id:"list.focusUp",weight:B.WorkbenchContrib,when:ge,primary:T.UpArrow,mac:{primary:T.UpArrow,secondary:[O.WinCtrl|T.KeyP]},handler:(a,e)=>{yt(a.get(re).lastFocusedList,async t=>{const i=new KeyboardEvent("keydown");await t.focusPrevious(typeof e==="number"?e:1,false,i)})}});te.registerCommandAndKeybindingRule({id:"list.focusAnyDown",weight:B.WorkbenchContrib,when:ge,primary:O.Alt|T.DownArrow,mac:{primary:O.Alt|T.DownArrow,secondary:[O.WinCtrl|O.Alt|T.KeyN]},handler:(a,e)=>{yt(a.get(re).lastFocusedList,async t=>{const i=new KeyboardEvent("keydown",{altKey:true});await t.focusNext(typeof e==="number"?e:1,false,i)})}});te.registerCommandAndKeybindingRule({id:"list.focusAnyUp",weight:B.WorkbenchContrib,when:ge,primary:O.Alt|T.UpArrow,mac:{primary:O.Alt|T.UpArrow,secondary:[O.WinCtrl|O.Alt|T.KeyP]},handler:(a,e)=>{yt(a.get(re).lastFocusedList,async t=>{const i=new KeyboardEvent("keydown",{altKey:true});await t.focusPrevious(typeof e==="number"?e:1,false,i)})}});te.registerCommandAndKeybindingRule({id:"list.focusPageDown",weight:B.WorkbenchContrib,when:ge,primary:T.PageDown,handler:a=>{yt(a.get(re).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown");await e.focusNextPage(t)})}});te.registerCommandAndKeybindingRule({id:"list.focusPageUp",weight:B.WorkbenchContrib,when:ge,primary:T.PageUp,handler:a=>{yt(a.get(re).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown");await e.focusPreviousPage(t)})}});te.registerCommandAndKeybindingRule({id:"list.focusFirst",weight:B.WorkbenchContrib,when:ge,primary:T.Home,handler:a=>{yt(a.get(re).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown");await e.focusFirst(t)})}});te.registerCommandAndKeybindingRule({id:"list.focusLast",weight:B.WorkbenchContrib,when:ge,primary:T.End,handler:a=>{yt(a.get(re).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown");await e.focusLast(t)})}});te.registerCommandAndKeybindingRule({id:"list.focusAnyFirst",weight:B.WorkbenchContrib,when:ge,primary:O.Alt|T.Home,handler:a=>{yt(a.get(re).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown",{altKey:true});await e.focusFirst(t)})}});te.registerCommandAndKeybindingRule({id:"list.focusAnyLast",weight:B.WorkbenchContrib,when:ge,primary:O.Alt|T.End,handler:a=>{yt(a.get(re).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown",{altKey:true});await e.focusLast(t)})}});function mm(a,e){if(a instanceof Tn||a instanceof An||a instanceof xn){const t=a;const i=t.getFocus()?t.getFocus()[0]:void 0;const s=t.getSelection();if(s&&typeof i==="number"&&s.indexOf(i)>=0){t.setSelection(s.filter(o=>o!==e))}else{if(typeof i==="number"){t.setSelection(s.concat(i))}}}else if(a instanceof oi||a instanceof ni||a instanceof dt){const t=a;const i=t.getFocus()?t.getFocus()[0]:void 0;if(e===i){return}const s=t.getSelection();const o=new KeyboardEvent("keydown",{shiftKey:true});if(s&&s.indexOf(i)>=0){t.setSelection(s.filter(n=>n!==e),o)}else{t.setSelection(s.concat(i),o)}}}function vh(a,e){const t=a.getStickyScrollFocus();if(t.length===0){throw new Error(`StickyScroll has no focus`)}if(t.length>1){throw new Error(`StickyScroll can only have a single focused item`)}a.reveal(t[0]);a.getHTMLElement().focus();a.setFocus(t);e?.(t[0])}te.registerCommandAndKeybindingRule({id:"list.expandSelectionDown",weight:B.WorkbenchContrib,when:S.and(ge,Xl),primary:O.Shift|T.DownArrow,handler:(a,e)=>{const t=a.get(re).lastFocusedList;if(!t){return}const i=t.getFocus()?t.getFocus()[0]:void 0;const s=new KeyboardEvent("keydown");t.focusNext(typeof e==="number"?e:1,false,s);mm(t,i);const o=t.getFocus();if(o.length){t.reveal(o[0])}wh(t)}});te.registerCommandAndKeybindingRule({id:"list.expandSelectionUp",weight:B.WorkbenchContrib,when:S.and(ge,Xl),primary:O.Shift|T.UpArrow,handler:(a,e)=>{const t=a.get(re).lastFocusedList;if(!t){return}const i=t.getFocus()?t.getFocus()[0]:void 0;const s=new KeyboardEvent("keydown");t.focusPrevious(typeof e==="number"?e:1,false,s);mm(t,i);const o=t.getFocus();if(o.length){t.reveal(o[0])}wh(t)}});te.registerCommandAndKeybindingRule({id:"list.collapse",weight:B.WorkbenchContrib,when:S.and(ge,S.or(jy,Yy)),primary:T.LeftArrow,mac:{primary:T.LeftArrow,secondary:[O.CtrlCmd|T.UpArrow]},handler:a=>{const e=a.get(re).lastFocusedList;if(!e||!(e instanceof oi||e instanceof ni||e instanceof dt)){return}const t=e;const i=t.getFocus();if(i.length===0){return}const s=i[0];if(!t.collapse(s)){const o=t.getParentElement(s);if(o){yt(e,n=>{const r=new KeyboardEvent("keydown");n.setFocus([o],r)})}}}});te.registerCommandAndKeybindingRule({id:"list.stickyScroll.collapse",weight:B.WorkbenchContrib+50,when:Ql,primary:T.LeftArrow,mac:{primary:T.LeftArrow,secondary:[O.CtrlCmd|T.UpArrow]},handler:a=>{const e=a.get(re).lastFocusedList;if(!e||!(e instanceof oi||e instanceof ni||e instanceof dt)){return}vh(e,t=>e.collapse(t))}});te.registerCommandAndKeybindingRule({id:"list.collapseAll",weight:B.WorkbenchContrib,when:ge,primary:O.CtrlCmd|T.LeftArrow,mac:{primary:O.CtrlCmd|T.LeftArrow,secondary:[O.CtrlCmd|O.Shift|T.UpArrow]},handler:a=>{const e=a.get(re).lastFocusedList;if(e&&!(e instanceof Tn||e instanceof An||e instanceof xn)){e.collapseAll()}}});te.registerCommandAndKeybindingRule({id:"list.collapseAllToFocus",weight:B.WorkbenchContrib,when:ge,handler:a=>{const e=a.get(re).lastFocusedList;const t=Ng("keydown",true);if(e instanceof oi||e instanceof ni||e instanceof dt){const i=e;const s=i.getFocus();if(s.length>0){i.collapse(s[0],true)}i.setSelection(s,t);i.setAnchor(s[0])}}});te.registerCommandAndKeybindingRule({id:"list.focusParent",weight:B.WorkbenchContrib,when:ge,handler:a=>{const e=a.get(re).lastFocusedList;if(!e||!(e instanceof oi||e instanceof ni||e instanceof dt)){return}const t=e;const i=t.getFocus();if(i.length===0){return}const s=i[0];const o=t.getParentElement(s);if(o){yt(e,n=>{const r=new KeyboardEvent("keydown");n.setFocus([o],r)})}}});te.registerCommandAndKeybindingRule({id:"list.expand",weight:B.WorkbenchContrib,when:S.and(ge,S.or(Zy,Jy)),primary:T.RightArrow,handler:a=>{const e=a.get(re).lastFocusedList;if(!e){return}if(e instanceof oi||e instanceof ni){const t=e.getFocus();if(t.length===0){return}const i=t[0];if(!e.expand(i)){const s=e.getFirstElementChild(i);if(s){const o=e.getNode(s);if(o.visible){yt(e,n=>{const r=new KeyboardEvent("keydown");n.setFocus([s],r)})}}}}else if(e instanceof dt){const t=e.getFocus();if(t.length===0){return}const i=t[0];e.expand(i).then(s=>{if(i&&!s){const o=e.getFirstElementChild(i);if(o){const n=e.getNode(o);if(n.visible){yt(e,r=>{const d=new KeyboardEvent("keydown");r.setFocus([o],d)})}}}})}}});function yh(a,e){const t=a.get(re).lastFocusedList;const i=Ng("keydown",e);if(t instanceof Tn||t instanceof An||t instanceof xn){const s=t;s.setAnchor(s.getFocus()[0]);s.setSelection(s.getFocus(),i)}else if(t instanceof oi||t instanceof ni||t instanceof dt){const s=t;const o=s.getFocus();if(o.length>0){let n=true;if(s.expandOnlyOnTwistieClick===true){n=false}else if(typeof s.expandOnlyOnTwistieClick!=="boolean"&&s.expandOnlyOnTwistieClick(o[0])){n=false}if(n){s.toggleCollapsed(o[0])}}s.setAnchor(o[0]);s.setSelection(o,i)}}te.registerCommandAndKeybindingRule({id:"list.select",weight:B.WorkbenchContrib,when:ge,primary:T.Enter,mac:{primary:T.Enter,secondary:[O.CtrlCmd|T.DownArrow]},handler:a=>{yh(a,false)}});te.registerCommandAndKeybindingRule({id:"list.stickyScrollselect",weight:B.WorkbenchContrib+50,when:Ql,primary:T.Enter,mac:{primary:T.Enter,secondary:[O.CtrlCmd|T.DownArrow]},handler:a=>{const e=a.get(re).lastFocusedList;if(!e||!(e instanceof oi||e instanceof ni||e instanceof dt)){return}vh(e,t=>e.setSelection([t]))}});te.registerCommandAndKeybindingRule({id:"list.selectAndPreserveFocus",weight:B.WorkbenchContrib,when:ge,handler:a=>{yh(a,true)}});te.registerCommandAndKeybindingRule({id:"list.selectAll",weight:B.WorkbenchContrib,when:S.and(ge,Xl),primary:O.CtrlCmd|T.KeyA,handler:a=>{const e=a.get(re).lastFocusedList;if(e instanceof Tn||e instanceof An||e instanceof xn){const t=e;const i=new KeyboardEvent("keydown");t.setSelection(Xy(t.length),i)}else if(e instanceof oi||e instanceof ni||e instanceof dt){const t=e;const i=t.getFocus();const s=t.getSelection();let o=void 0;if(i.length>0&&(s.length===0||!s.includes(i[0]))){o=i[0]}if(!o&&s.length>0){o=s[0]}let n=void 0;if(!o){n=void 0}else{n=t.getParentElement(o)}const r=[];const d=u=>{for(const p of u.children){if(p.visible){r.push(p.element);if(!p.collapsed){d(p)}}}};d(t.getNode(n));if(n&&s.length===r.length){r.unshift(n)}const l=new KeyboardEvent("keydown");t.setSelection(r,l)}}});te.registerCommandAndKeybindingRule({id:"list.toggleSelection",weight:B.WorkbenchContrib,when:ge,primary:O.CtrlCmd|O.Shift|T.Enter,handler:a=>{const e=a.get(re).lastFocusedList;if(!e){return}const t=e.getFocus();if(t.length===0){return}const i=e.getSelection();const s=i.indexOf(t[0]);if(s>-1){e.setSelection([...i.slice(0,s),...i.slice(s+1)])}else{e.setSelection([...i,t[0]])}}});te.registerCommandAndKeybindingRule({id:"list.showHover",weight:B.WorkbenchContrib,primary:Bg(O.CtrlCmd|T.KeyK,O.CtrlCmd|T.KeyI),when:ge,handler:async(a,...e)=>{const t=a.get(re);const i=t.lastFocusedList;if(!i){return}const s=i.getFocus();if(!s||s.length===0){return}const o=i.getHTMLElement();const n=o.querySelector(".monaco-scrollable-element");const r=n?.querySelector(".monaco-list-rows");const d=r?.querySelector(".focused");if(!d){return}const l=RD(d);if(l){a.get(bt).showManagedHover(l)}}});function RD(a){if(a.matches('[custom-hover="true"]')){return a}const e=a.querySelector('[custom-hover="true"]:not([tabindex]):not(.action-item)');if(e){return e}return void 0}te.registerCommandAndKeybindingRule({id:"list.toggleExpand",weight:B.WorkbenchContrib,when:ge,primary:T.Space,handler:a=>{const e=a.get(re).lastFocusedList;if(e instanceof oi||e instanceof ni||e instanceof dt){const t=e;const i=t.getFocus();if(i.length>0&&t.isCollapsible(i[0])){t.toggleCollapsed(i[0]);return}}yh(a,true)}});te.registerCommandAndKeybindingRule({id:"list.stickyScrolltoggleExpand",weight:B.WorkbenchContrib+50,when:Ql,primary:T.Space,handler:a=>{const e=a.get(re).lastFocusedList;if(!e||!(e instanceof oi||e instanceof ni||e instanceof dt)){return}vh(e)}});te.registerCommandAndKeybindingRule({id:"list.clear",weight:B.WorkbenchContrib,when:S.and(ge,Qy),primary:T.Escape,handler:a=>{const e=a.get(re).lastFocusedList;if(!e){return}const t=e.getSelection();const i=new KeyboardEvent("keydown");if(t.length>1){const s=Fg.getValue(e.contextKeyService);if(s){const o=e.getFocus();e.setSelection([o[0]],i)}else{e.setSelection([],i)}}else{e.setSelection([],i);e.setFocus([],i)}e.setAnchor(void 0)}});Ne.registerCommand({id:"list.triggerTypeNavigation",handler:a=>{const e=a.get(re).lastFocusedList;e?.triggerTypeNavigation()}});Ne.registerCommand({id:"list.toggleFindMode",handler:a=>{const e=a.get(re).lastFocusedList;if(e instanceof _a||e instanceof dt){const t=e;t.findMode=t.findMode===td.Filter?td.Highlight:td.Filter}}});Ne.registerCommand({id:"list.toggleFindMatchType",handler:a=>{const e=a.get(re).lastFocusedList;if(e instanceof _a||e instanceof dt){const t=e;t.findMatchType=t.findMatchType===id.Contiguous?id.Fuzzy:id.Contiguous}}});Ne.registerCommandAlias("list.toggleKeyboardNavigation","list.triggerTypeNavigation");Ne.registerCommandAlias("list.toggleFilterOnType","list.toggleFindMode");te.registerCommandAndKeybindingRule({id:"list.find",weight:B.WorkbenchContrib,when:S.and(Gg,eb),primary:O.CtrlCmd|O.Alt|T.KeyF,secondary:[T.F3],handler:a=>{const e=a.get(re).lastFocusedList;if(e instanceof Tn||e instanceof An||e instanceof xn);else if(e instanceof _a||e instanceof dt){const t=e;t.openFind()}}});te.registerCommandAndKeybindingRule({id:"list.closeFind",weight:B.WorkbenchContrib,when:S.and(Gg,tb),primary:T.Escape,handler:a=>{const e=a.get(re).lastFocusedList;if(e instanceof _a||e instanceof dt){const t=e;t.closeFind()}}});te.registerCommandAndKeybindingRule({id:"list.scrollUp",weight:B.WorkbenchContrib,when:S.and(ge,ib?.negate()),primary:O.CtrlCmd|T.UpArrow,handler:a=>{const e=a.get(re).lastFocusedList;if(!e){return}e.scrollTop-=10}});te.registerCommandAndKeybindingRule({id:"list.scrollDown",weight:B.WorkbenchContrib,when:S.and(ge,sb?.negate()),primary:O.CtrlCmd|T.DownArrow,handler:a=>{const e=a.get(re).lastFocusedList;if(!e){return}e.scrollTop+=10}});te.registerCommandAndKeybindingRule({id:"list.scrollLeft",weight:B.WorkbenchContrib,when:ge,handler:a=>{const e=a.get(re).lastFocusedList;if(!e){return}e.scrollLeft-=10}});te.registerCommandAndKeybindingRule({id:"list.scrollRight",weight:B.WorkbenchContrib,when:ge,handler:a=>{const e=a.get(re).lastFocusedList;if(!e){return}e.scrollLeft+=10}});v(class lR extends j{constructor(){super({id:"tree.toggleStickyScroll",title:{...I(2747,"Toggle Tree Sticky Scroll"),mnemonicTitle:c(2748,"&&Toggle Tree Sticky Scroll")},category:"View",metadata:{description:c(2749,"Toggles Sticky Scroll widget at the top of tree structures such as the File Explorer and Debug variables View.")},f1:true})}run(e){const t=e.get(X);const i=!t.getValue("workbench.tree.enableStickyScroll");t.updateValue("workbench.tree.enableStickyScroll",i)}});const VD=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class kD extends ti{constructor(e,t){super("vs.tree.collapse",c(42,"Collapse All"),"collapse-all",t);this.viewer=e}async run(){this.viewer.collapseAll();this.viewer.setSelection([]);this.viewer.setFocus([])}}class PD extends k{constructor(){super(...arguments);this._onDidChangeCheckboxState=this._register(new _);this.onDidChangeCheckboxState=this._onDidChangeCheckboxState.event}setCheckboxState(e){this._onDidChangeCheckboxState.fire([e])}}class Na extends k{static{this.checkboxClass="custom-view-tree-node-item-checkbox"}constructor(e,t,i,s){super();this.checkboxStateHandler=t;this.hoverDelegate=i;this.hoverService=s;this.checkboxContainer=e}render(e){if(e.checkbox){if(!this.toggle){this.createCheckbox(e)}else{this.toggle.checked=e.checkbox.isChecked;this.toggle.setIcon(this.toggle.checked?A.check:void 0)}}}createCheckbox(e){if(e.checkbox){this.toggle=new Wg({isChecked:e.checkbox.isChecked,title:"",icon:e.checkbox.isChecked?A.check:void 0,...zl});this.setHover(e.checkbox);this.setAccessibilityInformation(e.checkbox);this.toggle.domNode.classList.add(Na.checkboxClass);this.toggle.domNode.tabIndex=1;Be(this.checkboxContainer,this.toggle.domNode);this.registerListener(e)}}registerListener(e){if(this.toggle){this._register({dispose:()=>this.removeCheckbox()});this._register(this.toggle);this._register(this.toggle.onChange(()=>{this.setCheckbox(e)}))}}setHover(e){if(this.toggle){if(!this.hover){this.hover=this._register(this.hoverService.setupManagedHover(this.hoverDelegate,this.toggle.domNode,this.checkboxHoverContent(e)))}else{this.hover.update(e.tooltip)}}}setCheckbox(e){if(this.toggle&&e.checkbox){e.checkbox.isChecked=this.toggle.checked;this.toggle.setIcon(this.toggle.checked?A.check:void 0);this.setHover(e.checkbox);this.setAccessibilityInformation(e.checkbox);this.checkboxStateHandler.setCheckboxState(e)}}checkboxHoverContent(e){return e.tooltip?e.tooltip:e.isChecked?c(3505,"Checked"):c(3506,"Unchecked")}setAccessibilityInformation(e){if(this.toggle&&e.accessibilityInformation){this.toggle.domNode.ariaLabel=e.accessibilityInformation.label;if(e.accessibilityInformation.role){this.toggle.domNode.role=e.accessibilityInformation.role}}}removeCheckbox(){const e=this.checkboxContainer.children;for(const t of e){t.remove()}}}var jc;Le(VD);let Yc=class hR extends ba{constructor(e,t,i,s,o,n,r,d,l,u,p,f){super({...e,titleMenuId:w.ViewTitle,donotForwardArgs:false},t,i,s,o,n,r,d,l,p,f);const{treeView:g}=W.as(it.ViewsRegistry).getView(e.id);this.treeView=g;this._register(this.treeView.onDidChangeActions(()=>this.updateActions(),this));this._register(this.treeView.onDidChangeTitle(m=>this.updateTitle(m)));this._register(this.treeView.onDidChangeDescription(m=>this.updateTitleDescription(m)));this._register(de(()=>{if(this._container&&this.treeView.container&&this._container===this.treeView.container){this.treeView.setVisibility(false)}}));this._register(this.onDidChangeBodyVisibility(()=>this.updateTreeVisibility()));this._register(this.treeView.onDidChangeWelcomeState(()=>this._onDidChangeViewWelcomeState.fire()));if(e.title!==this.treeView.title){this.updateTitle(this.treeView.title)}if(e.titleDescription!==this.treeView.description){this.updateTitleDescription(this.treeView.description)}this._actionRunner=this._register(new ym(u,()=>this.treeView.getSelection()));this.updateTreeVisibility()}focus(){super.focus();this.treeView.focus()}renderBody(e){this._container=e;super.renderBody(e);this.renderTreeView(e)}shouldShowWelcome(){return(this.treeView.dataProvider===void 0||!!this.treeView.dataProvider.isTreeEmpty)&&(this.treeView.message===void 0||this.treeView.message==="")}layoutBody(e,t){super.layoutBody(e,t);this.layoutTreeView(e,t)}getOptimalWidth(){return this.treeView.getOptimalWidth()}renderTreeView(e){this.treeView.show(e)}layoutTreeView(e,t){this.treeView.layout(e,t)}updateTreeVisibility(){this.treeView.setVisibility(this.isBodyVisible())}getActionRunner(){return this._actionRunner}getActionsContext(){return{$treeViewId:this.id,$focusedTreeItem:true,$selectedTreeItems:true}}};Yc=E([h(1,zt),h(2,ot),h(3,X),h(4,ee),h(5,We),h(6,N),h(7,St),h(8,pe),h(9,Qe),h(10,bt),h(11,ob)],Yc);class fd{constructor(){this.label={label:"root"};this.handle="0";this.parentHandle=void 0;this.collapsibleState=pi.Expanded;this.children=void 0}}function wm(a){const e=Ne.getCommand(a);if(e){const t=b.getCommand(e.id);return t&&t.precondition}return void 0}function vm(a,e){const t=a.originalId?a.originalId:a.id;const i=wm(t);if(i){return e.contextMatchesRules(i)}return true}function cp(a){return!!a&&typeof a!=="string"&&"element"in a&&"disposables"in a}const LD=c(3507,"There is no data provider registered that can provide view data.");const MD=new U("customTreeView",false);class OD extends Ca{}let Zc=class uR extends k{constructor(e,t,i,s,o,n,r,d,l,u,p,f,g,m,y,C){super();this.id=e;this._title=t;this.themeService=i;this.instantiationService=s;this.commandService=o;this.configurationService=n;this.progressService=r;this.contextMenuService=d;this.keybindingService=l;this.notificationService=u;this.viewDescriptorService=p;this.hoverService=f;this.contextKeyService=g;this.activityService=m;this.logService=y;this.openerService=C;this.isVisible=false;this._hasIconForParentNode=false;this._hasIconForLeafNode=false;this.focused=false;this._canSelectMany=false;this._manuallyManageCheckboxes=false;this.elementsToRefresh=[];this.lastSelection=[];this._onDidExpandItem=this._register(new _);this.onDidExpandItem=this._onDidExpandItem.event;this._onDidCollapseItem=this._register(new _);this.onDidCollapseItem=this._onDidCollapseItem.event;this._onDidChangeSelectionAndFocus=this._register(new _);this.onDidChangeSelectionAndFocus=this._onDidChangeSelectionAndFocus.event;this._onDidChangeVisibility=this._register(new _);this.onDidChangeVisibility=this._onDidChangeVisibility.event;this._onDidChangeActions=this._register(new _);this.onDidChangeActions=this._onDidChangeActions.event;this._onDidChangeWelcomeState=this._register(new _);this.onDidChangeWelcomeState=this._onDidChangeWelcomeState.event;this._onDidChangeTitle=this._register(new _);this.onDidChangeTitle=this._onDidChangeTitle.event;this._onDidChangeDescription=this._register(new _);this.onDidChangeDescription=this._onDidChangeDescription.event;this._onDidChangeCheckboxState=this._register(new _);this.onDidChangeCheckboxState=this._onDidChangeCheckboxState.event;this._onDidCompleteRefresh=this._register(new _);this._isInitialized=false;this._activity=this._register(new Ie);this.activated=false;this.treeDisposables=this._register(new L);this._height=0;this._width=0;this.refreshing=false;this.root=new fd;this.lastActive=this.root}initialize(){if(this._isInitialized){return}this._isInitialized=true;this.contextKeyService.bufferChangeEvents(()=>{this.initializeShowCollapseAllAction();this.initializeCollapseAllToggle();this.initializeShowRefreshAction()});this.treeViewDnd=this.instantiationService.createInstance(el,this.id);if(this._dragAndDropController){this.treeViewDnd.controller=this._dragAndDropController}this._register(this.configurationService.onDidChangeConfiguration(e=>{if(e.affectsConfiguration("explorer.decorations")){this.doRefresh([this.root])}}));this._register(this.viewDescriptorService.onDidChangeLocation(({views:e,from:t,to:i})=>{if(e.some(s=>s.id===this.id)){this.tree?.updateOptions({overrideStyles:vu(this.viewLocation).listOverrideStyles})}}));this.registerActions();this.create()}get viewContainer(){return this.viewDescriptorService.getViewContainerByViewId(this.id)}get viewLocation(){return this.viewDescriptorService.getViewLocationById(this.id)}get dragAndDropController(){return this._dragAndDropController}set dragAndDropController(e){this._dragAndDropController=e;if(this.treeViewDnd){this.treeViewDnd.controller=e}}get dataProvider(){return this._dataProvider}set dataProvider(e){if(e){if(this.visible){this.activate()}const t=this;this._dataProvider=new class{constructor(){this._isEmpty=true;this._onDidChangeEmpty=new _;this.onDidChangeEmpty=this._onDidChangeEmpty.event}get isTreeEmpty(){return this._isEmpty}async getChildren(i){const s=await this.getChildrenBatch(i?[i]:void 0);return s?.[0]}updateEmptyState(i,s){if(i.length===1&&i[0]instanceof fd){const o=this._isEmpty;this._isEmpty=s.length===0||s[0].length===0;if(o!==this._isEmpty){this._onDidChangeEmpty.fire()}}}findCheckboxesUpdated(i,s){if(s.length===0){return[]}const o=[];for(let n=0;n<i.length;n++){const r=i[n];const d=s[n];for(const l of d){l.parent=r;if(!t.manuallyManageCheckboxes&&r?.checkbox?.isChecked===true&&l.checkbox?.isChecked===false){l.checkbox.isChecked=true;o.push(l)}}}return o}async getChildrenBatch(i){let s;let o=[];if(i&&i.every(n=>!!n.children)){s=i.map(n=>n.children)}else{i=i??[t.root];const n=await(i.length===1&&i[0]instanceof fd?Jc(e,void 0):Jc(e,i));for(let r=0;r<i.length;r++){const d=i[r];d.children=n?n[r]:void 0}s=n??[];o=this.findCheckboxesUpdated(i,s)}this.updateEmptyState(i,s);if(o.length>0){t._onDidChangeCheckboxState.fire(o)}return s}};if(this._dataProvider.onDidChangeEmpty){this._register(this._dataProvider.onDidChangeEmpty(()=>{this.updateCollapseAllToggle();this._onDidChangeWelcomeState.fire()}))}this.updateMessage();this.refresh()}else{this._dataProvider=void 0;this.treeDisposables.clear();this.activated=false;this.updateMessage()}this._onDidChangeWelcomeState.fire()}get message(){return this._message}set message(e){this._message=e;this.updateMessage();this._onDidChangeWelcomeState.fire()}get title(){return this._title}set title(e){this._title=e;if(this.tree){this.tree.ariaLabel=this._title}this._onDidChangeTitle.fire(this._title)}get description(){return this._description}set description(e){this._description=e;this._onDidChangeDescription.fire(this._description)}get badge(){return this._badge}set badge(e){if(this._badge?.value===e?.value&&this._badge?.tooltip===e?.tooltip){return}this._badge=e;if(e){const t={badge:new eh(e.value,()=>e.tooltip),priority:50};this._activity.value=this.activityService.showViewActivity(this.id,t)}else{this._activity.clear()}}get canSelectMany(){return this._canSelectMany}set canSelectMany(e){const t=this._canSelectMany;this._canSelectMany=e;if(this._canSelectMany!==t){this.tree?.updateOptions({multipleSelectionSupport:this.canSelectMany})}}get manuallyManageCheckboxes(){return this._manuallyManageCheckboxes}set manuallyManageCheckboxes(e){this._manuallyManageCheckboxes=e}get hasIconForParentNode(){return this._hasIconForParentNode}get hasIconForLeafNode(){return this._hasIconForLeafNode}get visible(){return this.isVisible}initializeShowCollapseAllAction(e=false){if(!this.collapseAllContext){this.collapseAllContextKey=new U(`treeView.${this.id}.enableCollapseAll`,e,c(3508,"Whether the tree view with id {0} enables collapse all.",this.id));this.collapseAllContext=this.collapseAllContextKey.bindTo(this.contextKeyService)}return true}get showCollapseAllAction(){this.initializeShowCollapseAllAction();return!!this.collapseAllContext?.get()}set showCollapseAllAction(e){this.initializeShowCollapseAllAction(e);this.collapseAllContext?.set(e)}initializeShowRefreshAction(e=false){if(!this.refreshContext){this.refreshContextKey=new U(`treeView.${this.id}.enableRefresh`,e,c(3509,"Whether the tree view with id {0} enables refresh.",this.id));this.refreshContext=this.refreshContextKey.bindTo(this.contextKeyService)}}get showRefreshAction(){this.initializeShowRefreshAction();return!!this.refreshContext?.get()}set showRefreshAction(e){this.initializeShowRefreshAction(e);this.refreshContext?.set(e)}registerActions(){const e=this;this._register(v(class extends j{constructor(){super({id:`workbench.actions.treeView.${e.id}.refresh`,title:c(3510,"Refresh"),menu:{id:w.ViewTitle,when:S.and(S.equals("view",e.id),e.refreshContextKey),group:"navigation",order:Number.MAX_SAFE_INTEGER-1},icon:A.refresh})}async run(){return e.refresh()}}));this._register(v(class extends j{constructor(){super({id:`workbench.actions.treeView.${e.id}.collapseAll`,title:c(3511,"Collapse All"),menu:{id:w.ViewTitle,when:S.and(S.equals("view",e.id),e.collapseAllContextKey),group:"navigation",order:Number.MAX_SAFE_INTEGER},precondition:e.collapseAllToggleContextKey,icon:A.collapseAll})}async run(){if(e.tree){return new kD(e.tree,true).run()}}}))}setVisibility(e){this.initialize();e=!!e;if(this.isVisible===e){return}this.isVisible=e;if(this.tree){if(this.isVisible){sn(this.tree.getHTMLElement())}else{on(this.tree.getHTMLElement())}if(this.isVisible&&this.elementsToRefresh.length&&this.dataProvider){this.doRefresh(this.elementsToRefresh);this.elementsToRefresh=[]}}db(()=>{if(this.dataProvider){this._onDidChangeVisibility.fire(this.isVisible)}});if(this.visible){this.activate()}}focus(e=true,t){if(this.tree&&this.root.children&&this.root.children.length>0){const i=t??this.tree.getSelection()[0];if(i&&e){this.tree.reveal(i,.5)}this.tree.domFocus()}else if(this.tree&&this.treeContainer&&!this.treeContainer.classList.contains("hide")){this.tree.domFocus()}else{this.domNode.focus()}}show(e){this._container=e;Be(e,this.domNode)}create(){this.domNode=G(".tree-explorer-viewlet-tree-view");this.messageElement=Be(this.domNode,G(".message"));this.updateMessage();this.treeContainer=Be(this.domNode,G(".customview-tree"));this.treeContainer.classList.add("file-icon-themable-tree","show-file-icons");const e=this._register(lr(this.domNode));this._register(e.onDidFocus(()=>this.focused=true));this._register(e.onDidBlur(()=>this.focused=false))}createTree(){this.treeDisposables.clear();const e=xl.bind(void 0,this.instantiationService);const t=this.treeDisposables.add(this.instantiationService.createInstance(Xc,this.id));this.treeLabels=this.treeDisposables.add(this.instantiationService.createInstance(vg,this));const i=this.instantiationService.createInstance(FD,this,u=>this.progressService.withProgress({location:this.id},()=>u));const s=this.treeDisposables.add(new GD(this.themeService));const o=this.treeDisposables.add(new PD);const n=this.treeDisposables.add(this.instantiationService.createInstance(fn,this.id,t,this.treeLabels,e,s,o,()=>this.manuallyManageCheckboxes));this.treeDisposables.add(n.onDidChangeCheckboxState(u=>this._onDidChangeCheckboxState.fire(u)));const r=this._title;this.tree=this.treeDisposables.add(this.instantiationService.createInstance(OD,this.id,this.treeContainer,new BD,[n],i,{identityProvider:new ND,accessibilityProvider:{getAriaLabel(u){if(u.accessibilityInformation){return u.accessibilityInformation.label}if(br(u.tooltip)){return u.tooltip}else{if(u.resourceUri&&!u.label){return null}let p="";if(u.label){p+=u.label.label+" "}if(u.description){p+=u.description}return p}},getRole(u){return u.accessibilityInformation?.role??"treeitem"},getWidgetAriaLabel(){return r}},keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:u=>{return u.label?u.label.label:u.resourceUri?Oi(K.revive(u.resourceUri)):void 0}},expandOnlyOnTwistieClick:u=>{return!!u.command||!!u.checkbox||this.configurationService.getValue("workbench.tree.expandMode")==="doubleClick"},collapseByDefault:u=>{return u.collapsibleState!==pi.Expanded},multipleSelectionSupport:this.canSelectMany,dnd:this.treeViewDnd,overrideStyles:vu(this.viewLocation).listOverrideStyles}));this.treeDisposables.add(n.onDidChangeMenuContext(u=>u.forEach(p=>this.tree?.rerender(p))));this.treeDisposables.add(this.tree);t.setContextKeyService(this.tree.contextKeyService);s.tree=this.tree;const d=this.treeDisposables.add(new ym(this.notificationService,()=>this.tree.getSelection()));n.actionRunner=d;this.tree.contextKeyService.createKey(this.id,true);const l=MD.bindTo(this.tree.contextKeyService);l.set(true);this.treeDisposables.add(this.tree.onContextMenu(u=>this.onContextMenu(t,u,d)));this.treeDisposables.add(this.tree.onDidChangeSelection(u=>{this.lastSelection=u.elements;this.lastActive=this.tree?.getFocus()[0]??this.lastActive;this._onDidChangeSelectionAndFocus.fire({selection:this.lastSelection,focus:this.lastActive})}));this.treeDisposables.add(this.tree.onDidChangeFocus(u=>{if(u.elements.length&&u.elements[0]!==this.lastActive){this.lastActive=u.elements[0];this.lastSelection=this.tree?.getSelection()??this.lastSelection;this._onDidChangeSelectionAndFocus.fire({selection:this.lastSelection,focus:this.lastActive})}}));this.treeDisposables.add(this.tree.onDidChangeCollapseState(u=>{if(!u.node.element){return}const p=Array.isArray(u.node.element.element)?u.node.element.element[0]:u.node.element.element;if(u.node.collapsed){this._onDidCollapseItem.fire(p)}else{this._onDidExpandItem.fire(p)}}));this.tree.setInput(this.root).then(()=>this.updateContentAreas());this.treeDisposables.add(this.tree.onDidOpen(async u=>{if(!u.browserEvent){return}if(u.browserEvent.target&&u.browserEvent.target.classList.contains(Na.checkboxClass)){return}const p=this.tree.getSelection();const f=await this.resolveCommand(p.length===1?p[0]:void 0);if(f&&vm(f,this.contextKeyService)){let g=f.arguments||[];if(f.id===cb||f.id===lb){g=[...g,u]}try{await this.commandService.executeCommand(f.id,...g)}catch(m){this.notificationService.error(m)}}}));this.treeDisposables.add(t.onDidChange(u=>{if(this.tree?.hasNode(u)){this.tree?.rerender(u)}}))}async resolveCommand(e){let t=e?.command;if(e&&!t){if(e instanceof Hg&&e.hasResolve){await e.resolve(ei.None);t=e.command}}return t}onContextMenu(e,t,i){this.hoverService.hideHover();const s=t.element;if(s===null){return}const o=t.browserEvent;o.preventDefault();o.stopPropagation();this.tree.setFocus([s]);let n=this.canSelectMany?this.getSelection():[];if(!n.find(d=>d.handle===s.handle)){n=[s]}const r=e.getResourceContextActions(n);if(!r.length){return}this.contextMenuService.showContextMenu({getAnchor:()=>t.anchor,getActions:()=>r,getActionViewItem:d=>{const l=this.keybindingService.lookupKeybinding(d.id);if(l){return new Pl(d,d,{label:true,keybinding:l.getLabel()})}return void 0},onHide:d=>{if(d){this.tree.domFocus()}},getActionsContext:()=>({$treeViewId:this.id,$treeItemHandle:s.handle}),actionRunner:i})}updateMessage(){if(this._message){this.showMessage(this._message)}else if(!this.dataProvider){this.showMessage(LD)}else{this.hideMessage()}this.updateContentAreas()}processMessage(e,t){const i=e.value.split("\n");const s=[];let o=false;for(const r of i){const d=vr(r);if(d.nodes.length===1&&typeof d.nodes[0]!=="string"){const l=d.nodes[0];const u=document.createElement("div");u.classList.add("button-container");const p=new Ug(u,{title:l.title,secondary:o,supportIcons:true,...nn});p.label=l.label;p.onDidClick(g=>{this.openerService.open(l.href,{allowCommands:true})},null,t);const f=K.parse(l.href);if(f.scheme===fe.command){const g=wm(f.path);if(g){p.enabled=this.contextKeyService.contextMatchesRules(g);t.add(this.contextKeyService.onDidChangeContext(m=>{if(m.affectsSome(new Set(g.keys()))){p.enabled=this.contextKeyService.contextMatchesRules(g)}}))}}t.add(p);o=true;s.push(u)}else{o=false;const l=this.markdownRenderer.render(new Ia(r,{isTrusted:e.isTrusted,supportThemeIcons:e.supportThemeIcons,supportHtml:e.supportHtml}));s.push(l.element);t.add(l)}}const n=document.createElement("div");n.classList.add("rendered-message");for(const r of s){if(ao(r)){n.appendChild(r)}else{n.appendChild(r.element)}}return n}showMessage(e){if(cp(this._messageValue)){this._messageValue.disposables.dispose()}if(yu(e)&&!this.markdownRenderer){this.markdownRenderer=this.instantiationService.createInstance(hb,{})}if(yu(e)){const t=new L;const i=this.processMessage(e,t);this._messageValue={element:i,disposables:t}}else{this._messageValue=e}if(!this.messageElement){return}this.messageElement.classList.remove("hide");this.resetMessageElement();if(typeof this._messageValue==="string"&&!Vd(this._messageValue)){this.messageElement.textContent=this._messageValue}else if(cp(this._messageValue)){this.messageElement.appendChild(this._messageValue.element)}this.layout(this._height,this._width)}hideMessage(){this.resetMessageElement();this.messageElement?.classList.add("hide");this.layout(this._height,this._width)}resetMessageElement(){if(this.messageElement){jl(this.messageElement)}}layout(e,t){if(e&&t&&this.messageElement&&this.treeContainer){this._height=e;this._width=t;const i=e-ub(this.messageElement);this.treeContainer.style.height=i+"px";this.tree?.layout(i,t)}}getOptimalWidth(){if(this.tree){const e=this.tree.getHTMLElement();const t=[].slice.call(e.querySelectorAll(".outline-item-label > a"));return pb(e,t)}return 0}updateCheckboxes(e){return bm(e)}async refresh(e,t){if(this.dataProvider&&this.tree){if(this.refreshing){await x.toPromise(this._onDidCompleteRefresh.event)}if(!e){e=[this.root];this.elementsToRefresh=[]}for(const i of e){i.children=void 0}if(this.isVisible){const i=this.updateCheckboxes(t??[]);return this.doRefresh(e.concat(i))}else{if(this.elementsToRefresh.length){const i=new Set;this.elementsToRefresh.forEach(s=>i.add(s.handle));for(const s of e){if(!i.has(s.handle)){this.elementsToRefresh.push(s)}}}else{this.elementsToRefresh.push(...e)}}}return void 0}async expand(e){const t=this.tree;if(!t){return}try{e=Array.isArray(e)?e:[e];for(const i of e){await t.expand(i,false)}}catch(i){}}isCollapsed(e){return!!this.tree?.isCollapsed(e)}setSelection(e){this.tree?.setSelection(e)}getSelection(){return this.tree?.getSelection()??[]}setFocus(e){if(this.tree){if(e){this.focus(true,e);this.tree.setFocus([e])}else if(this.tree.getFocus().length===0){this.tree.setFocus([])}}}async reveal(e){if(this.tree){return this.tree.reveal(e)}}async doRefresh(e){const t=this.tree;if(t&&this.visible){this.refreshing=true;const i=t.getSelection();try{await Promise.all(e.map(o=>t.updateChildren(o,true,true)))}catch(o){this.logService.error(o)}const s=t.getSelection();if(i.length!==s.length||i.some((o,n)=>o.handle!==s[n].handle)){this.lastSelection=s;this._onDidChangeSelectionAndFocus.fire({selection:this.lastSelection,focus:this.lastActive})}this.refreshing=false;this._onDidCompleteRefresh.fire();this.updateContentAreas();if(this.focused){this.focus(false)}this.updateCollapseAllToggle()}}initializeCollapseAllToggle(){if(!this.collapseAllToggleContext){this.collapseAllToggleContextKey=new U(`treeView.${this.id}.toggleCollapseAll`,false,c(3512,"Whether collapse all is toggled for the tree view with id {0}.",this.id));this.collapseAllToggleContext=this.collapseAllToggleContextKey.bindTo(this.contextKeyService)}}updateCollapseAllToggle(){if(this.showCollapseAllAction){this.initializeCollapseAllToggle();this.collapseAllToggleContext?.set(!!this.root.children&&this.root.children.length>0&&this.root.children.some(e=>e.collapsibleState!==pi.None))}}updateContentAreas(){const e=!this.root.children||this.root.children.length===0;if(this._messageValue&&e&&!this.refreshing&&this.treeContainer){if(!this.dragAndDropController){this.treeContainer.classList.add("hide")}this.domNode.setAttribute("tabindex","0")}else if(this.treeContainer){this.treeContainer.classList.remove("hide");if(this.domNode===Rl()){this.focus()}this.domNode.removeAttribute("tabindex")}}get container(){return this._container}};Zc=E([h(2,pe),h(3,N),h(4,bi),h(5,X),h(6,Ea),h(7,ot),h(8,zt),h(9,Qe),h(10,We),h(11,bt),h(12,ee),h(13,ks),h(14,et),h(15,St)],Zc);class ND{getId(e){return e.handle}}class BD{getHeight(e){return fn.ITEM_HEIGHT}getTemplateId(e){return fn.TREE_TEMPLATE_ID}}async function Jc(a,e){if(a.getChildrenBatch){return a.getChildrenBatch(e)}else{if(e){return Promise.all(e.map(t=>a.getChildren(t).then(i=>i??[])))}else{return[await a.getChildren()].filter(t=>t!==void 0)}}}class FD{constructor(e,t){this.treeView=e;this.withProgress=t}hasChildren(e){return!!this.treeView.dataProvider&&e.collapsibleState!==pi.None}async getChildren(e){const t=this.treeView.dataProvider;if(!t){return[]}if(this.batch===void 0){this.batch=[e];this.batchPromise=void 0}else{this.batch.push(e)}const i=this.batch.length-1;return new Promise((s,o)=>{setTimeout(async()=>{const n=this.batch;this.batch=void 0;if(!this.batchPromise){this.batchPromise=this.withProgress(Jc(t,n))}try{const r=await this.batchPromise;s(r&&i<r.length?r[i]:[])}catch(r){if(!r.message.startsWith("Bad progress location:")){o(r)}}},0)})}}let fn=class pR extends k{static{jc=this}static{this.ITEM_HEIGHT=22}static{this.TREE_TEMPLATE_ID="treeExplorer"}constructor(e,t,i,s,o,n,r,d,l,u,p,f,g){super();this.treeViewId=e;this.menus=t;this.labels=i;this.actionViewItemProvider=s;this.aligner=o;this.checkboxStateHandler=n;this.manuallyManageCheckboxes=r;this.themeService=d;this.configurationService=l;this.labelService=u;this.contextKeyService=p;this.hoverService=f;this._onDidChangeCheckboxState=this._register(new _);this.onDidChangeCheckboxState=this._onDidChangeCheckboxState.event;this._onDidChangeMenuContext=this._register(new _);this.onDidChangeMenuContext=this._onDidChangeMenuContext.event;this._hasCheckbox=false;this._renderedElements=new Map;this._hoverDelegate=this._register(g.createInstance(nb,"mouse",void 0,{}));this._register(this.themeService.onDidFileIconThemeChange(()=>this.rerender()));this._register(this.themeService.onDidColorThemeChange(()=>this.rerender()));this._register(n.onDidChangeCheckboxState(m=>{this.updateCheckboxes(m)}));this._register(this.contextKeyService.onDidChangeContext(m=>this.onDidChangeContext(m)))}get templateId(){return jc.TREE_TEMPLATE_ID}set actionRunner(e){this._actionRunner=e}renderTemplate(e){e.classList.add("custom-view-tree-node-item");const t=Be(e,G(""));const i=this.labels.create(e,{supportHighlights:true,hoverDelegate:this._hoverDelegate});const s=Rp(i.element,G(".custom-view-tree-node-item-icon"));const o=Be(i.element,G(".actions"));const n=new En(o,{actionViewItemProvider:this.actionViewItemProvider});return{resourceLabel:i,icon:s,checkboxContainer:t,actionBar:n,container:e}}getHover(e,t,i){if(!(i instanceof Hg)||!i.hasResolve){if(t&&!i.tooltip){return void 0}else if(i.tooltip===void 0){return e}else if(!br(i.tooltip)){return{markdown:i.tooltip,markdownNotSupportedFallback:t?void 0:rb(i.tooltip)}}else if(i.tooltip!==""){return i.tooltip}else{return void 0}}return{markdown:typeof i.tooltip==="string"?i.tooltip:s=>{return new Promise(o=>{i.resolve(s).then(()=>o(i.tooltip))})},markdownNotSupportedFallback:t?void 0:e??""}}renderElement(e,t,i){const s=e.element;const o=s.resourceUri?K.revive(s.resourceUri):null;const n=s.label?s.label:o?{label:Oi(o)}:void 0;const r=br(s.description)?s.description:o&&s.description===true?this.labelService.getUriLabel(ab(o),{relative:true}):void 0;const d=n?n.label:void 0;const l=n&&n.highlights&&d?n.highlights.map(([C,D])=>{if(C<0){C=d.length+C}if(D<0){D=d.length+D}if(C>=d.length||D>d.length){return{start:0,end:0}}if(C>D){const F=C;C=D;D=F}return{start:C,end:D}}):void 0;const u=this.themeService.getColorTheme().type===Ks.LIGHT?s.icon:s.iconDark;const p=u?K.revive(u):void 0;const f=this.getHover(d,o,s);i.actionBar.clear();i.icon.style.color="";let g=true;if(s.command){g=vm(s.command,this.contextKeyService)}this.renderCheckbox(s,i);if(o){const C=this.configurationService.getValue("explorer.decorations");const D=o?o:K.parse("missing:_icon_resource");i.resourceLabel.setResource({name:d,description:r,resource:D},{fileKind:this.getFileKind(s),title:f,hideIcon:this.shouldHideResourceLabelIcon(p,s.themeIcon),fileDecorations:C,extraClasses:["custom-view-tree-node-item-resourceLabel"],matches:l?l:lo(e.filterData),strikethrough:n?.strikethrough,disabledCommand:!g,labelEscapeNewLines:true,forceLabel:!!s.label})}else{i.resourceLabel.setResource({name:d,description:r},{title:f,hideIcon:true,extraClasses:["custom-view-tree-node-item-resourceLabel"],matches:l?l:lo(e.filterData),strikethrough:n?.strikethrough,disabledCommand:!g,labelEscapeNewLines:true})}if(p){i.icon.className="custom-view-tree-node-item-icon";i.icon.style.backgroundImage=Vi(p)}else{let C;if(this.shouldShowThemeIcon(!!o,s.themeIcon)){C=ye.asClassName(s.themeIcon);if(s.themeIcon.color){i.icon.style.color=this.themeService.getColorTheme().getColor(s.themeIcon.color.id)?.toString()??""}}i.icon.className=C?`custom-view-tree-node-item-icon ${C}`:"";i.icon.style.backgroundImage=""}if(!g){i.icon.className=i.icon.className+" disabled";if(i.container.parentElement){i.container.parentElement.className=i.container.parentElement.className+" disabled"}}i.actionBar.context={$treeViewId:this.treeViewId,$treeItemHandle:s.handle};const m=this.menus.getResourceActions([s]);i.actionBar.push(m,{icon:true,label:false});if(this._actionRunner){i.actionBar.actionRunner=this._actionRunner}this.setAlignment(i.container,s);const y=this._renderedElements.get(e.element.handle)??[];this._renderedElements.set(e.element.handle,[...y,{original:e,rendered:i}])}rerender(){const e=new Set(this._renderedElements.keys());for(const t of e){const i=this._renderedElements.get(t)??[];for(const s of i){this.disposeElement(s.original,0,s.rendered);this.renderElement(s.original,0,s.rendered)}}}renderCheckbox(e,t){if(e.checkbox){if(!this._hasCheckbox){this._hasCheckbox=true;this.rerender()}if(!t.checkbox){const i=new Na(t.checkboxContainer,this.checkboxStateHandler,this._hoverDelegate,this.hoverService);t.checkbox=i}t.checkbox.render(e)}else if(t.checkbox){t.checkbox.dispose();t.checkbox=void 0}}setAlignment(e,t){e.parentElement.classList.toggle("align-icon-with-twisty",!this._hasCheckbox&&this.aligner.alignIconWithTwisty(t))}shouldHideResourceLabelIcon(e,t){return!!e||!!t&&!this.isFileKindThemeIcon(t)}shouldShowThemeIcon(e,t){if(!t){return false}return!(e&&this.isFileKindThemeIcon(t))}isFolderThemeIcon(e){return e?.id===Rd.id}isFileKindThemeIcon(e){if(e){return e.id===wu.id||this.isFolderThemeIcon(e)}else{return false}}getFileKind(e){if(e.themeIcon){switch(e.themeIcon.id){case wu.id:return Oo.FILE;case Rd.id:return Oo.FOLDER}}return e.collapsibleState===pi.Collapsed||e.collapsibleState===pi.Expanded?Oo.FOLDER:Oo.FILE}onDidChangeContext(e){const t=[];for(const[i,s]of this._renderedElements){for(const o of s){if(e.affectsSome(this.menus.getElementOverlayContexts(o.original.element))||e.affectsSome(this.menus.getEntireMenuContexts())){t.push(o.original.element)}}}if(t.length){this._onDidChangeMenuContext.fire(t)}}updateCheckboxes(e){let t=[];if(!this.manuallyManageCheckboxes()){t=bm(e)}else{t=e}t.forEach(i=>{const s=this._renderedElements.get(i.handle);if(s){s.forEach(o=>o.rendered.checkbox?.render(i))}});this._onDidChangeCheckboxState.fire(t)}disposeElement(e,t,i){const s=this._renderedElements.get(e.element.handle)??[];const o=s.findIndex(n=>i===n.rendered);if(s.length===1){this._renderedElements.delete(e.element.handle)}else if(s.length>0){s.splice(o,1)}i.checkbox?.dispose();i.checkbox=void 0}disposeTemplate(e){e.resourceLabel.dispose();e.actionBar.dispose()}};fn=jc=E([h(7,pe),h(8,X),h(9,os),h(10,ee),h(11,bt),h(12,N)],fn);class GD extends k{constructor(e){super();this.themeService=e}set tree(e){this._tree=e}alignIconWithTwisty(e){if(e.collapsibleState!==pi.None){return false}if(!this.hasIcon(e)){return false}if(this._tree){const t=this._tree.getParentElement(e)||this._tree.getInput();if(this.hasIcon(t)){return!!t.children&&t.children.some(i=>i.collapsibleState!==pi.None&&!this.hasIcon(i))}return!!t.children&&t.children.every(i=>i.collapsibleState===pi.None||!this.hasIcon(i))}else{return false}}hasIcon(e){const t=this.themeService.getColorTheme().type===Ks.LIGHT?e.icon:e.iconDark;if(t){return true}if(e.resourceUri||e.themeIcon){const i=this.themeService.getFileIconTheme();const s=e.themeIcon?e.themeIcon.id===Rd.id:e.collapsibleState!==pi.None;if(s){return i.hasFileIcons&&i.hasFolderIcons}return i.hasFileIcons}return false}}class ym extends Kg{constructor(e,t){super();this.getSelectedResources=t;this._register(this.onDidRun(i=>{if(i.error&&!da(i.error)){e.error(c(3513,"Error running command {1}: {0}. This is likely caused by the extension that contributes {1}.",i.error.message,i.action.id))}}))}async runAction(e,t){const i=this.getSelectedResources();let s=void 0;let o=false;if(i.length>1){s=i.map(n=>{if(n.handle===t.$treeItemHandle||t.$selectedTreeItems){o=true}return{$treeViewId:t.$treeViewId,$treeItemHandle:n.handle}})}if(!o&&s){s=void 0}await e.run(t,s)}}let Xc=class gR{constructor(e,t){this.id=e;this.menuService=t;this._onDidChange=new _;this.onDidChange=this._onDidChange.event}getResourceActions(e){const t=this.getActions(this.getMenuId(),e);return t.primary}getResourceContextActions(e){return this.getActions(this.getMenuId(),e).secondary}setContextKeyService(e){this.contextKeyService=e}filterNonUniversalActions(e,t){const i=new Set(t.map(s=>s.id));for(const s of e){const o=s.keys();for(const n of o){if(!i.has(n)){s.delete(n)}}}}buildMenu(e){const t=[];for(const i of e){if(i.size>0){if(t.length){t.push(new Mi)}t.push(...i.values())}}return t}createGroups(e){const t=[];let i=new Map;for(const s of e){if(s instanceof Mi){t.push(i);i=new Map}else{i.set(s.id,s)}}t.push(i);return t}getElementOverlayContexts(e){return new Map([["view",this.id],["viewItem",e.contextValue]])}getEntireMenuContexts(){return this.menuService.getMenuContexts(this.getMenuId())}getMenuId(){return w.ViewItemContext}getActions(e,t){if(!this.contextKeyService){return{primary:[],secondary:[]}}let i=[];let s=[];for(let o=0;o<t.length;o++){const n=t[o];const r=this.contextKeyService.createOverlay(this.getElementOverlayContexts(n));const d=this.menuService.getMenuActions(e,r,{shouldForwardArgs:true});const l=fr(d,"inline");if(o===0){i=this.createGroups(l.primary);s=this.createGroups(l.secondary)}else{this.filterNonUniversalActions(i,l.primary);this.filterNonUniversalActions(s,l.secondary)}}return{primary:this.buildMenu(i),secondary:this.buildMenu(s)}}dispose(){this.contextKeyService=void 0}};Xc=E([h(1,Ki)],Xc);let Qc=class fR extends Zc{constructor(e,t,i,s,o,n,r,d,l,u,p,f,g,m,y,C,D,F,P){super(e,t,s,o,n,r,d,l,u,p,f,m,g,C,F,P);this.extensionId=i;this.extensionService=y;this.telemetryService=D}activate(){if(!this.activated){this.telemetryService.publicLog2("Extension:ViewActivate",{extensionId:new gb(this.extensionId),id:this.id});this.createTree();this.progressService.withProgress({location:this.id},()=>this.extensionService.activateByEvent(`onView:${this.id}`)).then(()=>rn(2e3)).then(()=>{this.updateMessage()});this.activated=true}}};Qc=E([h(3,pe),h(4,N),h(5,bi),h(6,X),h(7,Ea),h(8,ot),h(9,zt),h(10,Qe),h(11,We),h(12,ee),h(13,bt),h(14,Kt),h(15,ks),h(16,si),h(17,et),h(18,St)],Qc);let el=class mR{constructor(e,t,i,s,o){this.treeId=e;this.labelService=t;this.instantiationService=i;this.treeViewsDragAndDropService=s;this.logService=o;this.treeItemsTransfer=Xs.getInstance();this.treeMimeType=`application/vnd.code.tree.${e.toLowerCase()}`}set controller(e){this.dndController=e}handleDragAndLog(e,t,i,s){return e.handleDrag(t,i,s).then(o=>{if(o){const n=[];for(const r of o){if(r[0]!==this.treeMimeType&&e.dragMimeTypes.findIndex(d=>d===r[0])<0){n.push(r[0])}}if(n.length){this.logService.warn(`Drag and drop controller for tree ${this.treeId} adds the following data transfer types but does not declare them in dragMimeTypes: ${n.join(", ")}`)}}return o})}addExtensionProvidedTransferTypes(e,t){if(!e.dataTransfer||!this.dndController){return}const i=yo();this.dragCancellationToken=new es;this.treeViewsDragAndDropService.addDragOperationTransfer(i,this.handleDragAndLog(this.dndController,t,i,this.dragCancellationToken.token));this.treeItemsTransfer.setData([new fs(i)],fs.prototype);e.dataTransfer.clearData(Uo.text);if(this.dndController.dragMimeTypes.find(s=>s===Uo.uriList)){e.dataTransfer?.setData(Go.RESOURCES,"")}this.dndController.dragMimeTypes.forEach(s=>{e.dataTransfer?.setData(s,"")})}addResourceInfoToTransfer(e,t){if(t.length&&e.dataTransfer){this.instantiationService.invokeFunction(s=>fb(s,t,e));const i=t.filter(s=>s.scheme===fe.file).map(s=>s.fsPath);if(i.length){e.dataTransfer.setData(Cd.FILES,JSON.stringify(i))}}}onDragStart(e,t){if(t.dataTransfer){const i=e.getData();const s=[];const o={id:this.treeId,itemHandles:[]};i.forEach(n=>{o.itemHandles.push(n.handle);if(n.resourceUri){s.push(K.revive(n.resourceUri))}});this.addResourceInfoToTransfer(t,s);this.addExtensionProvidedTransferTypes(t,o.itemHandles);t.dataTransfer.setData(this.treeMimeType,JSON.stringify(o))}}debugLog(e){if(e.size){this.logService.debug(`TreeView dragged mime types: ${Array.from(e).join(", ")}`)}else{this.logService.debug(`TreeView dragged with no supported mime types.`)}}onDragOver(e,t,i,s,o){const n=bu(o.dataTransfer);const r=new Set(Array.from(n,u=>u[0]));if(o.dataTransfer){for(const u of o.dataTransfer.items){if(u.kind==="file"||u.type===Go.RESOURCES.toLowerCase()){r.add(Uo.uriList);break}}}this.debugLog(r);const d=this.dndController;if(!d||!o.dataTransfer||d.dropMimeTypes.length===0){return false}const l=Array.from(r).some((u,p)=>{if(u===this.treeMimeType){return true}else{return d.dropMimeTypes.indexOf(u)>=0}});if(l){return{accept:true,bubble:mb.Down,autoExpand:true}}return false}getDragURI(e){if(!this.dndController){return null}return e.resourceUri?K.revive(e.resourceUri).toString():e.handle}getDragLabel(e){if(!this.dndController){return void 0}if(e.length>1){return String(e.length)}const t=e[0];return t.label?t.label.label:t.resourceUri?this.labelService.getUriLabel(K.revive(t.resourceUri)):void 0}async drop(e,t,i,s,o){const n=this.dndController;if(!o.dataTransfer||!n){return}let r;let d;if(this.treeItemsTransfer.hasData(fs.prototype)){d=this.treeItemsTransfer.getData(fs.prototype)[0].identifier}const l=bu(o.dataTransfer,true);const u=new wb;for(const[f,g]of l){if(f===this.treeMimeType||n.dropMimeTypes.includes(f)||g.asFile()&&n.dropMimeTypes.includes(Go.FILES.toLowerCase())){u.append(f,g);if(f===this.treeMimeType){try{r=JSON.parse(await g.asString())}catch{}}}}const p=await this.treeViewsDragAndDropService.removeDragOperationTransfer(d);if(p){for(const[f,g]of p){u.append(f,g)}}return n.handleDrop(u,t,ei.None,d,r?.id,r?.itemHandles)}onDragEnd(e){if(e.dataTransfer?.dropEffect==="none"){this.dragCancellationToken?.cancel()}}dispose(){}};el=E([h(1,os),h(2,N),h(3,qp),h(4,et)],el);function bm(a){const e=[];for(const t of a){if(t.checkbox!==void 0){const i=n=>{for(const r of n.children??[]){if(r.checkbox!==void 0&&n.checkbox!==void 0&&r.checkbox.isChecked!==n.checkbox.isChecked){r.checkbox.isChecked=n.checkbox.isChecked;e.push(r);i(r)}}};i(t);const s=new Set;const o=n=>{if(n.parent&&n.parent.checkbox!==void 0&&n.parent.children){if(s.has(n.parent)){return}else{s.add(n.parent)}let r=false;let d=false;for(const l of n.parent.children){if(r&&d){break}if(l.checkbox!==void 0){if(l.checkbox.isChecked){d=true}else{r=true}}}if(d&&!r&&n.parent.checkbox.isChecked!==true){n.parent.checkbox.isChecked=true;e.push(n.parent);o(n.parent)}else if(r&&n.parent.checkbox.isChecked!==false){n.parent.checkbox.isChecked=false;e.push(n.parent);o(n.parent)}}};o(t)}}return a.concat(e)}const WD=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ae("remote-explorer-get-started",A.star,c(8927,"Getting started icon in the remote explorer view."));Ae("remote-explorer-documentation",A.book,c(8928,"Documentation icon in the remote explorer view."));Ae("remote-explorer-feedback",A.twitter,c(8929,"Feedback icon in the remote explorer view."));Ae("remote-explorer-review-issues",A.issues,c(8930,"Review issue icon in the remote explorer view."));Ae("remote-explorer-report-issues",A.comment,c(8931,"Report issue icon in the remote explorer view."));Ae("remote-explorer-view-icon",A.remoteExplorer,c(8932,"View icon of the remote explorer view."));const Cm=Ae("ports-view-icon",A.plug,c(8933,"View icon of the remote ports view."));Ae("ports-view-icon",A.plug,c(8934,"Icon representing a remote port."));const Sm=Ae("private-ports-view-icon",A.lock,c(8935,"Icon representing a private remote port."));const HD=Ae("ports-forward-icon",A.plus,c(8936,"Icon for the forward action."));const UD=Ae("ports-stop-forward-icon",A.x,c(8937,"Icon for the stop forwarding action."));const KD=Ae("ports-open-browser-icon",A.globe,c(8938,"Icon for the open browser action."));const zD=Ae("ports-open-preview-icon",A.openPreview,c(8939,"Icon for the open preview action."));const $D=Ae("ports-copy-address-icon",A.clippy,c(8940,"Icon for the copy local address action."));const _m=Ae("ports-label-icon",A.tag,c(8941,"Icon for the label port action."));const qD=Ae("ports-forwarded-without-process-icon",A.circleOutline,c(8942,"Icon for forwarded ports that don't have a running process."));const jD=Ae("ports-forwarded-with-process-icon",A.circleFilled,c(8943,"Icon for forwarded ports that do have a running process."));var tl;Le(WD);const YD=new U("openPreviewEnabled",false);class ZD{constructor(e){this.remoteExplorerService=e;this.headerRowHeight=22}getHeight(e){return e.tunnelType===De.Add&&!this.remoteExplorerService.getEditableData(void 0)?30:22}}let il=class wR{constructor(e,t){this.remoteExplorerService=e;this.tunnelService=t;this._candidates=new Map;this.input={label:c(8973,"Add Port"),icon:void 0,tunnelType:De.Add,hasRunningProcess:false,remoteHost:"",remotePort:0,processDescription:"",tooltipPostfix:"",iconTooltip:"",portTooltip:"",processTooltip:"",originTooltip:"",privacyTooltip:"",source:{source:th.User,description:""},protocol:Li.Http,privacy:{id:Er.Private,themeIcon:Sm.id,label:c(8974,"Private")},strip:()=>void 0};this.model=e.tunnelModel;this.onForwardedPortsChanged=x.any(this.model.onForwardPort,this.model.onClosePort,this.model.onPortName,this.model.onCandidatesChanged)}get all(){const e=[];this._candidates=new Map;this.model.candidates.forEach(t=>{this._candidates.set(nt(t.host,t.port),t)});if(this.model.forwarded.size>0||this.remoteExplorerService.getEditableData(void 0)){e.push(...this.forwarded)}if(this.model.detected.size>0){e.push(...this.detected)}e.push(this.input);return e}addProcessInfoFromCandidate(e){const t=nt(e.remoteHost,e.remotePort);if(this._candidates.has(t)){e.processDescription=this._candidates.get(t).detail}}get forwarded(){const e=Array.from(this.model.forwarded.values()).map(t=>{const i=He.createFromTunnel(this.remoteExplorerService,this.tunnelService,t);this.addProcessInfoFromCandidate(i);return i}).sort((t,i)=>{if(t.remotePort===i.remotePort){return t.remoteHost<i.remoteHost?-1:1}else{return t.remotePort<i.remotePort?-1:1}});return e}get detected(){return Array.from(this.model.detected.values()).map(e=>{const t=He.createFromTunnel(this.remoteExplorerService,this.tunnelService,e,De.Detected,false);this.addProcessInfoFromCandidate(t);return t})}isEmpty(){return this.detected.length===0&&(this.forwarded.length===0||this.forwarded.length===1&&this.forwarded[0].tunnelType===De.Add&&!this.remoteExplorerService.getEditableData(void 0))}};il=E([h(0,Fe),h(1,Vt)],il);function Bn(a){return{label:"",tunnel:a,editId:rt.None,tooltip:""}}class JD{constructor(){this.label="";this.tooltip="";this.weight=1;this.minimumWidth=40;this.maximumWidth=40;this.templateId="actionbar"}project(e){if(e.tunnelType===De.Add){return Bn(e)}const t=e.processDescription?jD:qD;let i="";if(e instanceof He){i=`${e.iconTooltip} ${e.tooltipPostfix}`}return{label:"",icon:t,tunnel:e,editId:rt.None,tooltip:i}}}class XD{constructor(){this.label=c(8975,"Port");this.tooltip=c(8976,"The label and remote port number of the forwarded port.");this.weight=1;this.templateId="actionbar"}project(e){const t=e.tunnelType===De.Add;const i=e.label;let s="";if(e instanceof He&&!t){s=`${e.portTooltip} ${e.tooltipPostfix}`}else{s=i}return{label:i,tunnel:e,menuId:w.TunnelPortInline,editId:e.tunnelType===De.Add?rt.New:rt.Label,tooltip:s}}}class bh{constructor(){this.label=c(8977,"Forwarded Address");this.tooltip=c(8978,"The address that the forwarded port is available at.");this.weight=1;this.templateId="actionbar"}project(e){if(e.tunnelType===De.Add){return Bn(e)}const t=e.localAddress??"";let i=t;if(e instanceof He){i=e.tooltipPostfix}return{label:t,menuId:w.TunnelLocalAddressInline,tunnel:e,editId:rt.LocalPort,tooltip:i,markdownTooltip:t?bh.getHoverText(t):void 0}}static getHoverText(e){return function(t){const i=t.getValue("editor");let s="";if(i.multiCursorModifier==="ctrlCmd"){if(mt){s=c(8979,"option + click")}else{s=c(8980,"alt + click")}}else{if(mt){s=c(8981,"cmd + click")}else{s=c(8982,"ctrl + click")}}const o=new Ia("",true);const n=e.startsWith("http")?e:`http://${e}`;return o.appendLink(n,"Follow link").appendMarkdown(` (${s})`)}}}class QD{constructor(){this.label=c(8983,"Running Process");this.tooltip=c(8984,"The command line of the process that is using the port.");this.weight=2;this.templateId="actionbar"}project(e){if(e.tunnelType===De.Add){return Bn(e)}const t=e.processDescription??"";return{label:t,tunnel:e,editId:rt.None,tooltip:e instanceof He?e.processTooltip:""}}}class eT{constructor(){this.label=c(8985,"Origin");this.tooltip=c(8986,"The source that a forwarded port originates from. Can be an extension, user forwarded, statically forwarded, or automatically forwarded.");this.weight=1;this.templateId="actionbar"}project(e){if(e.tunnelType===De.Add){return Bn(e)}const t=e.source.description;const i=`${e instanceof He?e.originTooltip:""}. ${e instanceof He?e.tooltipPostfix:""}`;return{label:t,menuId:w.TunnelOriginInline,tunnel:e,editId:rt.None,tooltip:i}}}class tT{constructor(){this.label=c(8987,"Visibility");this.tooltip=c(8988,"The availability of the forwarded port.");this.weight=1;this.templateId="actionbar"}project(e){if(e.tunnelType===De.Add){return Bn(e)}const t=e.privacy?.label;let i="";if(e instanceof He){i=`${e.privacy.label} ${e.tooltipPostfix}`}return{label:t,tunnel:e,icon:{id:e.privacy.themeIcon},editId:rt.None,tooltip:i}}}let sl=class vR extends k{constructor(e,t,i,s,o,n,r){super();this.instantiationService=e;this.contextKeyService=t;this.menuService=i;this.contextViewService=s;this.remoteExplorerService=o;this.commandService=n;this.configurationService=r;this.templateId="actionbar";this._hoverDelegate=Tp("mouse")}set actionRunner(e){this._actionRunner=e}renderTemplate(e){const t=Be(e,G(".ports-view-actionbar-cell"));const i=Be(t,G(".ports-view-actionbar-cell-icon"));const s=new va(t,{supportHighlights:true,hoverDelegate:this._hoverDelegate});const o=Be(t,G(".actions"));const n=new En(o,{actionViewItemProvider:xl.bind(void 0,this.instantiationService),hoverDelegate:this._hoverDelegate});return{label:s,icon:i,actionBar:n,container:t,elementDisposable:k.None}}renderElement(e,t,i){i.actionBar.clear();i.icon.className="ports-view-actionbar-cell-icon";i.icon.style.display="none";i.label.setLabel("");i.label.element.style.display="none";i.container.style.height="22px";if(i.button){i.button.element.style.display="none";i.button.dispose()}i.container.style.paddingLeft="0px";i.elementDisposable.dispose();let s;if(e.editId===rt.New&&(s=this.remoteExplorerService.getEditableData(void 0))){this.renderInputBox(i.container,s)}else{s=this.remoteExplorerService.getEditableData(e.tunnel,e.editId);if(s){this.renderInputBox(i.container,s)}else if(e.tunnel.tunnelType===De.Add&&e.menuId===w.TunnelPortInline){this.renderButton(e,i)}else{this.renderActionBarItem(e,i)}}}renderButton(e,t){t.container.style.paddingLeft="7px";t.container.style.height="28px";t.button=this._register(new Ug(t.container,nn));t.button.label=e.label;t.button.element.title=e.tooltip;this._register(t.button.onDidClick(()=>{this.commandService.executeCommand(Ue.INLINE_ID)}))}tunnelContext(e){let t;if(e instanceof He){t=e.strip()}if(!t){t={tunnelType:e.tunnelType,remoteHost:e.remoteHost,remotePort:e.remotePort,localAddress:e.localAddress,protocol:e.protocol,localUri:e.localUri,localPort:e.localPort,name:e.name,closeable:e.closeable,source:e.source,privacy:e.privacy,processDescription:e.processDescription,label:e.label}}return t}renderActionBarItem(e,t){t.label.element.style.display="flex";t.label.setLabel(e.label,void 0,{title:e.markdownTooltip?{markdown:e.markdownTooltip(this.configurationService),markdownNotSupportedFallback:e.tooltip}:e.tooltip,extraClasses:e.menuId===w.TunnelLocalAddressInline?["ports-view-actionbar-cell-localaddress"]:void 0});t.actionBar.context=this.tunnelContext(e.tunnel);t.container.style.paddingLeft="10px";const i=[["view",ms],[Fn.key,e.tunnel.tunnelType],[Gn.key,e.tunnel.closeable],[ol.key,e.tunnel.privacy.id],[Ba.key,e.tunnel.protocol]];const s=this.contextKeyService.createOverlay(i);const o=new L;t.elementDisposable=o;if(e.menuId){const n=o.add(this.menuService.createMenu(e.menuId,s));let r=Sa(n.getActions({shouldForwardArgs:true}));if(r){const d=r.filter(l=>l.id.toLowerCase().indexOf("label")>=0);if(d.length>1){d.sort((l,u)=>l.label.length-u.label.length);d.pop();r=r.filter(l=>d.indexOf(l)<0)}t.actionBar.push(r,{icon:true,label:false});if(this._actionRunner){t.actionBar.actionRunner=this._actionRunner}}}if(e.icon){t.icon.className=`ports-view-actionbar-cell-icon ${ye.asClassName(e.icon)}`;t.icon.title=e.tooltip;t.icon.style.display="inline"}}renderInputBox(e,t){if(this.inputDone){this.inputDone(false,false);this.inputDone=void 0}e.style.paddingLeft="5px";const i=t.startingValue||"";const s=new ng(e,this.contextViewService,{ariaLabel:c(8989,"Press Enter to confirm or Escape to cancel."),validationOptions:{validation:r=>{const d=t.validationMessage(r);if(!d){return null}return{content:d.content,formatContent:true,type:d.severity===ve.Error?$n.ERROR:$n.INFO}}},placeholder:t.placeholder||"",inputBoxStyles:$l});s.value=i;s.focus();s.select({start:0,end:t.startingValue?t.startingValue.length:0});const o=Hl(async(r,d)=>{$e(n);if(this.inputDone){this.inputDone=void 0}s.element.style.display="none";const l=s.value;if(d){return t.onFinish(l,r)}});this.inputDone=o;const n=[s,bb(s.inputElement,se.KEY_DOWN,async r=>{if(r.equals(T.Enter)){r.stopPropagation();if(s.validate()!==$n.ERROR){return o(true,true)}else{return o(false,true)}}else if(r.equals(T.Escape)){r.preventDefault();r.stopPropagation();return o(false,true)}}),J(s.inputElement,se.BLUR,()=>{return o(s.validate()!==$n.ERROR,true)})];return de(()=>{o(false,false)})}disposeElement(e,t,i,s){i.elementDisposable.dispose()}disposeTemplate(e){e.label.dispose();e.actionBar.dispose();e.elementDisposable.dispose();e.button?.dispose()}};sl=E([h(0,N),h(1,ee),h(2,Ki),h(3,ha),h(4,Fe),h(5,bi),h(6,X)],sl);class He{static createFromTunnel(e,t,i,s=De.Forwarded,o){return new He(s,i.remoteHost,i.remotePort,i.source,!!i.hasRunningProcess,i.protocol,i.localUri,i.localAddress,i.localPort,o===void 0?i.closeable:o,i.name,i.runningProcess,i.pid,i.privacy,e,t)}strip(){return new He(this.tunnelType,this.remoteHost,this.remotePort,this.source,this.hasRunningProcess,this.protocol,this.localUri,this.localAddress,this.localPort,this.closeable,this.name,this.runningProcess,this.pid,this._privacy)}constructor(e,t,i,s,o,n,r,d,l,u,p,f,g,m,y,C){this.tunnelType=e;this.remoteHost=t;this.remotePort=i;this.source=s;this.hasRunningProcess=o;this.protocol=n;this.localUri=r;this.localAddress=d;this.localPort=l;this.closeable=u;this.name=p;this.runningProcess=f;this.pid=g;this._privacy=m;this.remoteExplorerService=y;this.tunnelService=C}get label(){if(this.tunnelType===De.Add&&this.name){return this.name}const e=Cb(this.remoteHost)||Sb(this.remoteHost)?`${this.remotePort}`:`${this.remoteHost}:${this.remotePort}`;if(this.name){return`${this.name} (${e})`}else{return e}}set processDescription(e){this.runningProcess=e}get processDescription(){let e="";if(this.runningProcess){if(this.pid&&this.remoteExplorerService?.namedProcesses.has(this.pid)){e=this.remoteExplorerService.namedProcesses.get(this.pid)}else{e=this.runningProcess.replace(/\0/g," ").trim()}if(this.pid){e+=` (${this.pid})`}}else if(this.hasRunningProcess){e=c(8990,"Process information unavailable")}return e}get tooltipPostfix(){let e;if(this.localAddress){e=c(8991,"Remote port {0}:{1} forwarded to local address {2}. ",this.remoteHost,this.remotePort,this.localAddress)}else{e=c(8992,"Remote port {0}:{1} not forwarded. ",this.remoteHost,this.remotePort)}return e}get iconTooltip(){const e=this.tunnelType===De.Add;if(!e){return`${this.processDescription?c(8993,"Port has running process."):c(8994,"No running process.")}`}else{return this.label}}get portTooltip(){const e=this.tunnelType===De.Add;if(!e){return`${this.name?c(8995,"Port labeled {0}. ",this.name):""}`}else{return""}}get processTooltip(){return this.processDescription??""}get originTooltip(){return this.source.description}get privacy(){if(this.tunnelService?.privacyOptions){return this.tunnelService?.privacyOptions.find(e=>e.id===this._privacy)??{id:"",themeIcon:A.question.id,label:c(8996,"Unknown")}}else{return{id:Er.Private,themeIcon:Sm.id,label:c(8974,"Private")}}}}const Fn=new U("tunnelType",De.Add,true);const Gn=new U("tunnelCloseable",false,true);const ol=new U("tunnelPrivacy",void 0,true);const Em=new U("tunnelPrivacyEnabled",false,true);const Ba=new U("tunnelProtocol",Li.Http,true);const Fa=new U("tunnelViewFocus",false,c(8997,"Whether the Ports view has focus."));const Wn="tunnelViewSelection";const iT=new U(Wn,void 0,true);const Im="tunnelViewMultiSelection";const Dm=new U(Im,void 0,true);const Tm=new U("portChangable",false,true);const Am=new U("protocolChangable",true,true);let Cs=class yR extends ba{static{tl=this}static{this.ID=ms}static{this.TITLE=I(8998,"Ports")}constructor(e,t,i,s,o,n,r,d,l,u,p,f,g,m,y,C,D){super(t,i,s,n,o,d,r,l,g,y);this.viewModel=e;this.quickInputService=u;this.commandService=p;this.menuService=f;this.remoteExplorerService=m;this.tunnelService=C;this.contextViewService=D;this.tableDisposables=this._register(new L);this.isEditing=false;this.titleActions=[];this.lastFocus=[];this.height=0;this.width=0;this.tunnelTypeContext=Fn.bindTo(o);this.tunnelCloseableContext=Gn.bindTo(o);this.tunnelPrivacyContext=ol.bindTo(o);this.tunnelPrivacyEnabledContext=Em.bindTo(o);this.tunnelPrivacyEnabledContext.set(C.canChangePrivacy);this.protocolChangableContextKey=Am.bindTo(o);this.protocolChangableContextKey.set(C.canChangeProtocol);this.tunnelProtocolContext=Ba.bindTo(o);this.tunnelViewFocusContext=Fa.bindTo(o);this.tunnelViewSelectionContext=iT.bindTo(o);this.tunnelViewMultiSelectionContext=Dm.bindTo(o);this.portChangableContextKey=Tm.bindTo(o);const F=this.contextKeyService.createOverlay([["view",tl.ID]]);const P=this._register(this.menuService.createMenu(w.TunnelTitle,F));const R=()=>{this.titleActions=Sa(P.getActions());this.updateActions()};this._register(P.onDidChange(R));R();this._register(de(()=>{this.titleActions=[]}));this.registerPrivacyActions();this._register(x.once(this.tunnelService.onAddedTunnelProvider)(()=>{let z=false;if(this.tunnelPrivacyEnabledContext.get()===false){this.tunnelPrivacyEnabledContext.set(C.canChangePrivacy);z=true}if(this.protocolChangableContextKey.get()===true){this.protocolChangableContextKey.set(C.canChangeProtocol);z=true}if(z){R();this.registerPrivacyActions();this.createTable();this.table?.layout(this.height,this.width)}}))}registerPrivacyActions(){for(const e of this.tunnelService.privacyOptions){const t=`remote.tunnel.privacy${e.id}`;Ne.registerCommand(t,nl.handler(e.id));b.appendMenuItem(w.TunnelPrivacy,{order:0,command:{id:t,title:e.label,toggled:ol.isEqualTo(e.id)}})}}get portCount(){return this.remoteExplorerService.tunnelModel.forwarded.size+this.remoteExplorerService.tunnelModel.detected.size}createTable(){if(!this.panelContainer){return}this.tableDisposables.clear();jl(this.panelContainer);const e=Be(this.panelContainer,G(".customview-tree"));e.classList.add("ports-view");e.classList.add("file-icon-themable-tree","show-file-icons");const t=new sl(this.instantiationService,this.contextKeyService,this.menuService,this.contextViewService,this.remoteExplorerService,this.commandService,this.configurationService);const i=[new JD,new XD,new bh,new QD];if(this.tunnelService.canChangePrivacy){i.push(new tT)}i.push(new eT);this.table=this.instantiationService.createInstance(vb,"RemoteTunnels",e,new ZD(this.remoteExplorerService),i,[t],{keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:r=>{return r.label}},multipleSelectionSupport:true,accessibilityProvider:{getAriaLabel:r=>{if(r instanceof He){return`${r.tooltipPostfix} ${r.portTooltip} ${r.iconTooltip} ${r.processTooltip} ${r.originTooltip} ${this.tunnelService.canChangePrivacy?r.privacy.label:""}`}else{return r.label}},getWidgetAriaLabel:()=>c(8999,"Tunnel View")},openOnSingleClick:true});const s=this.tableDisposables.add(new Kg);t.actionRunner=s;this.tableDisposables.add(this.table);this.tableDisposables.add(this.table.onContextMenu(r=>this.onContextMenu(r,s)));this.tableDisposables.add(this.table.onMouseDblClick(r=>this.onMouseDblClick(r)));this.tableDisposables.add(this.table.onDidChangeFocus(r=>this.onFocusChanged(r)));this.tableDisposables.add(this.table.onDidChangeSelection(r=>this.onSelectionChanged(r)));this.tableDisposables.add(this.table.onDidFocus(()=>this.tunnelViewFocusContext.set(true)));this.tableDisposables.add(this.table.onDidBlur(()=>this.tunnelViewFocusContext.set(false)));const o=()=>this.table?.splice(0,Number.POSITIVE_INFINITY,this.viewModel.all);o();let n=this.portCount;this.tableDisposables.add(x.debounce(this.viewModel.onForwardedPortsChanged,(r,d)=>d,50)(()=>{const r=this.portCount;if((n===0||r===0)&&n!==r){this._onDidChangeViewWelcomeState.fire()}n=r;o()}));this.tableDisposables.add(this.table.onMouseClick(r=>{if(this.hasOpenLinkModifier(r.browserEvent)&&this.table){const d=this.table.getSelectedElements();if(d.length===0||d.length===1&&d[0]===r.element){this.commandService.executeCommand(Rt.ID,r.element)}}}));this.tableDisposables.add(this.table.onDidOpen(r=>{if(!r.element||r.element.tunnelType!==De.Forwarded){return}if(r.browserEvent?.type==="dblclick"){this.commandService.executeCommand(Ui.ID)}}));this.tableDisposables.add(this.remoteExplorerService.onDidChangeEditable(r=>{this.isEditing=!!this.remoteExplorerService.getEditableData(r?.tunnel,r?.editId);this._onDidChangeViewWelcomeState.fire();if(!this.isEditing){e.classList.remove("highlight")}o();if(this.isEditing){e.classList.add("highlight");if(!r){this.table?.reveal(this.table.indexOf(this.viewModel.input))}}else{if(r&&r.tunnel.tunnelType!==De.Add){this.table?.setFocus(this.lastFocus)}this.focus()}}))}renderBody(e){super.renderBody(e);this.panelContainer=Be(e,G(".tree-explorer-viewlet-tree-view"));this.createTable()}shouldShowWelcome(){return this.viewModel.isEmpty()&&!this.isEditing}focus(){super.focus();this.table?.domFocus()}onFocusChanged(e){if(e.indexes.length>0&&e.elements.length>0){this.lastFocus=[...e.indexes]}const t=e.elements;const i=t&&t.length?t[0]:void 0;if(i){this.tunnelViewSelectionContext.set(nt(i.remoteHost,i.remotePort));this.tunnelTypeContext.set(i.tunnelType);this.tunnelCloseableContext.set(!!i.closeable);this.tunnelPrivacyContext.set(i.privacy.id);this.tunnelProtocolContext.set(i.protocol===Li.Https?Li.Https:Li.Https);this.portChangableContextKey.set(!!i.localPort)}else{this.tunnelTypeContext.reset();this.tunnelViewSelectionContext.reset();this.tunnelCloseableContext.reset();this.tunnelPrivacyContext.reset();this.tunnelProtocolContext.reset();this.portChangableContextKey.reset()}}hasOpenLinkModifier(e){const t=this.configurationService.getValue("editor");let i=false;if(t.multiCursorModifier==="ctrlCmd"){i=e.altKey}else{if(mt){i=e.metaKey}else{i=e.ctrlKey}}return i}onSelectionChanged(e){const t=e.elements;if(t.length>1){this.tunnelViewMultiSelectionContext.set(t.map(i=>nt(i.remoteHost,i.remotePort)))}else{this.tunnelViewMultiSelectionContext.set(void 0)}}onContextMenu(e,t){if(e.element!==void 0&&!(e.element instanceof He)){return}e.browserEvent.preventDefault();e.browserEvent.stopPropagation();const i=e.element;if(i){this.table?.setFocus([this.table.indexOf(i)]);this.tunnelTypeContext.set(i.tunnelType);this.tunnelCloseableContext.set(!!i.closeable);this.tunnelPrivacyContext.set(i.privacy.id);this.tunnelProtocolContext.set(i.protocol);this.portChangableContextKey.set(!!i.localPort)}else{this.tunnelTypeContext.set(De.Add);this.tunnelCloseableContext.set(false);this.tunnelPrivacyContext.set(void 0);this.tunnelProtocolContext.set(void 0);this.portChangableContextKey.set(false)}this.contextMenuService.showContextMenu({menuId:w.TunnelContext,menuActionOptions:{shouldForwardArgs:true},contextKeyService:this.table?.contextKeyService,getAnchor:()=>e.anchor,getActionViewItem:s=>{const o=this.keybindingService.lookupKeybinding(s.id);if(o){return new Pl(s,s,{label:true,keybinding:o.getLabel()})}return void 0},onHide:s=>{if(s){this.table?.domFocus()}},getActionsContext:()=>i?.strip(),actionRunner:t})}onMouseDblClick(e){if(!e.element){this.commandService.executeCommand(Ue.INLINE_ID)}}layoutBody(e,t){this.height=e;this.width=t;super.layoutBody(e,t);this.table?.layout(e,t)}};Cs=tl=E([h(2,zt),h(3,ot),h(4,ee),h(5,X),h(6,N),h(7,We),h(8,St),h(9,kt),h(10,bi),h(11,Ki),h(12,pe),h(13,Fe),h(14,bt),h(15,Vt),h(16,ha)],Cs);class sT{constructor(e,t){this.id=Cs.ID;this.name=Cs.TITLE;this.canToggleVisibility=true;this.hideByDefault=false;this.group="details@0";this.order=-500;this.canMoveView=true;this.containerIcon=Cm;this.ctorDescriptor=new Q(Cs,[e]);this.remoteAuthority=t.remoteAuthority?t.remoteAuthority.split("+")[0]:void 0}}function ns(a){return a&&a.tunnelType&&a.remoteHost&&a.source}var Ui;(function(a){a.ID="remote.tunnel.label";a.LABEL=c(9e3,"Set Port Label");a.COMMAND_ID_KEYWORD="label";function e(){return async(t,i)=>{const s=t.get(Fe);let o;if(ns(i)){o=i}else{const n=t.get(ee).getContextKeyValue(Wn);const r=n?s.tunnelModel.forwarded.get(n):void 0;if(r){const d=t.get(Vt);o=He.createFromTunnel(s,d,r)}}if(o){const n=o;return new Promise(r=>{const d=n.name?n.name:`${n.remotePort}`;s.setEditable(n,rt.Label,{onFinish:async(l,u)=>{l=l.trim();s.setEditable(n,rt.Label,null);const p=u&&l!==d;if(p){await s.tunnelModel.name(n.remoteHost,n.remotePort,l)}r(p?{port:n.remotePort,label:l}:void 0)},validationMessage:()=>null,placeholder:c(9001,"Port label"),startingValue:d})})}return void 0}}a.handler=e})(Ui||(Ui={}));const oT=c(9002,"Forwarded port should be a number or a host:port.");const Ch=65536;const xm=c(9003,"Port number must be ≥ 0 and < {0}.",Ch);const Rm=c(9004,"May Require Sudo");const nT=c(9005,"Port is already forwarded");var Ue;(function(a){a.INLINE_ID="remote.tunnel.forwardInline";a.COMMANDPALETTE_ID="remote.tunnel.forwardCommandPalette";a.LABEL=I(9006,"Forward a Port");a.TREEITEM_LABEL=c(9007,"Forward Port");const e=c(9008,"Port number or address (eg. 3000 or 10.10.10.10:2000).");function t(n,r,d,l){const u=sd(d);if(!u){return{content:oT,severity:ve.Error}}else if(u.port>=Ch){return{content:xm,severity:ve.Error}}else if(l&&r.isPortPrivileged(u.port)){return{content:Rm,severity:ve.Info}}else if(eo(n.tunnelModel.forwarded,u.host,u.port)){return{content:nT,severity:ve.Error}}return null}function i(n,r,d,l){if(!r){n.warn(c(9009,"Unable to forward {0}:{1}. The host may not be available or that remote port may already be forwarded",d,l))}else if(typeof r==="string"){n.warn(c(9010,"Unable to forward {0}:{1}. {2}",d,l,r))}}function s(){return async(n,r)=>{const d=n.get(Fe);const l=n.get(Qe);const u=n.get(Vt);d.setEditable(void 0,rt.New,{onFinish:async(p,f)=>{d.setEditable(void 0,rt.New,null);let g;if(f&&(g=sd(p))){d.forward({remote:{host:g.host,port:g.port},elevateIfNeeded:true}).then(m=>i(l,m,g.host,g.port))}},validationMessage:p=>t(d,u,p,u.canElevate),placeholder:e})}}a.inlineHandler=s;function o(){return async(n,r)=>{const d=n.get(Fe);const l=n.get(Qe);const u=n.get(st);const p=n.get(kt);const f=n.get(Vt);await u.openView(Cs.ID,true);const g=await p.input({prompt:e,validateInput:y=>Promise.resolve(t(d,f,y,f.canElevate))});let m;if(g&&(m=sd(g))){d.forward({remote:{host:m.host,port:m.port},elevateIfNeeded:true}).then(y=>i(l,y,m.host,m.port))}}}a.commandPaletteHandler=o})(Ue||(Ue={}));function Vm(a,e,t){const i=a.map(s=>{const o=He.createFromTunnel(e,t,s);return{label:o.label,description:o.processDescription,tunnel:o}});if(i.length===0){i.push({label:c(9011,"No ports currently forwarded. Try running the {0} command",Ue.LABEL.value)})}return i}var Ht;(function(a){a.INLINE_ID="remote.tunnel.closeInline";a.COMMANDPALETTE_ID="remote.tunnel.closeCommandPalette";a.LABEL=I(9012,"Stop Forwarding Port");function e(){return async(i,s)=>{const o=i.get(ee);const n=i.get(Fe);let r=[];const d=o.getContextKeyValue(Im);if(d){d.forEach(l=>{const u=n.tunnelModel.forwarded.get(l);if(u){r?.push(u)}})}else if(ns(s)){r=[s]}else{const l=o.getContextKeyValue(Wn);const u=l?n.tunnelModel.forwarded.get(l):void 0;if(u){r=[u]}}if(!r||r.length===0){return}return Promise.all(r.map(l=>n.close({host:l.remoteHost,port:l.remotePort},As.User)))}}a.inlineHandler=e;function t(){return async i=>{const s=i.get(kt);const o=i.get(Fe);const n=i.get(Vt);const r=i.get(bi);const d=Vm(Array.from(o.tunnelModel.forwarded.values()).filter(u=>u.closeable),o,n);const l=await s.pick(d,{placeHolder:c(9013,"Choose a port to stop forwarding")});if(l&&l.tunnel){await o.close({host:l.tunnel.remoteHost,port:l.tunnel.remotePort},As.User)}else if(l){await r.executeCommand(Ue.COMMANDPALETTE_ID)}}}a.commandPaletteHandler=t})(Ht||(Ht={}));var Rt;(function(a){a.ID="remote.tunnel.open";a.LABEL=c(9014,"Open in Browser");function e(){return async(i,s)=>{let o;if(ns(s)){o=nt(s.remoteHost,s.remotePort)}else if(s.tunnelRemoteHost&&s.tunnelRemotePort){o=nt(s.tunnelRemoteHost,s.tunnelRemotePort)}if(o){const n=i.get(Fe).tunnelModel;const r=i.get(St);return t(n,r,o)}}}a.handler=e;function t(i,s,o){const n=i.forwarded.get(o)||i.detected.get(o);if(n){return s.open(n.localUri,{allowContributedOpeners:false})}return Promise.resolve()}a.run=t})(Rt||(Rt={}));var Xt;(function(a){a.ID="remote.tunnel.openPreview";a.LABEL=c(9015,"Preview in Editor");function e(){return async(i,s)=>{let o;if(ns(s)){o=nt(s.remoteHost,s.remotePort)}else if(s.tunnelRemoteHost&&s.tunnelRemotePort){o=nt(s.tunnelRemoteHost,s.tunnelRemotePort)}if(o){const n=i.get(Fe).tunnelModel;const r=i.get(St);const d=i.get(zg);return t(n,r,d,o)}}}a.handler=e;async function t(i,s,o,n){const r=i.forwarded.get(n)||i.detected.get(n);if(r){const d=r.remoteHost.includes(":")?`[${r.remoteHost}]`:r.remoteHost;const l=K.parse(`http://${d}:${r.remotePort}`);const u=await o.getOpener(r.localUri,{sourceUri:l},ei.None);if(u){return u.openExternalUri(r.localUri,{sourceUri:l},ei.None)}return s.open(r.localUri)}return Promise.resolve()}a.run=t})(Xt||(Xt={}));var go;(function(a){a.ID="remote.tunnel.openCommandPalette";a.LABEL=c(9016,"Open Port in Browser");function e(){return async(t,i)=>{const s=t.get(Fe);const o=t.get(Vt);const n=s.tunnelModel;const r=t.get(kt);const d=t.get(St);const l=t.get(bi);const u=[...n.forwarded,...n.detected].map(f=>{const g=He.createFromTunnel(s,o,f[1]);return{label:g.label,description:g.processDescription,tunnel:g}});if(u.length===0){u.push({label:c(9017,"No ports currently forwarded. Open the Ports view to get started.")})}else{u.push({label:c(9018,"Open the Ports view...")})}const p=await r.pick(u,{placeHolder:c(9019,"Choose the port to open")});if(p&&p.tunnel){return Rt.run(n,d,nt(p.tunnel.remoteHost,p.tunnel.remotePort))}else if(p){return l.executeCommand(`${ms}.focus`)}}}a.handler=e})(go||(go={}));var Ut;(function(a){a.INLINE_ID="remote.tunnel.copyAddressInline";a.COMMANDPALETTE_ID="remote.tunnel.copyAddressCommandPalette";a.INLINE_LABEL=c(9020,"Copy Local Address");a.COMMANDPALETTE_LABEL=c(9021,"Copy Forwarded Port Address");async function e(s,o,n){const r=s.tunnelModel.address(n.remoteHost,n.remotePort);if(r){await o.writeText(r.toString())}}function t(){return async(s,o)=>{const n=s.get(Fe);let r;if(ns(o)){r=o}else{const d=s.get(ee).getContextKeyValue(Wn);r=d?n.tunnelModel.forwarded.get(d):void 0}if(r){return e(n,s.get(kd),r)}}}a.inlineHandler=t;function i(){return async(s,o)=>{const n=s.get(kt);const r=s.get(Fe);const d=s.get(Vt);const l=s.get(bi);const u=s.get(kd);const p=Array.from(r.tunnelModel.forwarded.values()).concat(Array.from(r.tunnelModel.detected.values()));const f=await n.pick(Vm(p,r,d),{placeHolder:c(9022,"Choose a forwarded port")});if(f&&f.tunnel){await e(r,u,f.tunnel)}else if(f){await l.executeCommand(Ue.COMMANDPALETTE_ID)}}}a.commandPaletteHandler=i})(Ut||(Ut={}));var fo;(function(a){a.ID="remote.tunnel.changeLocalPort";a.LABEL=c(9023,"Change Local Address Port");function e(i,s,o){if(!s.match(/^[0-9]+$/)){return{content:c(9024,"Local port should be a number."),severity:ve.Error}}else if(Number(s)>=Ch){return{content:xm,severity:ve.Error}}else if(o&&i.isPortPrivileged(Number(s))){return{content:Rm,severity:ve.Info}}return null}function t(){return async(i,s)=>{const o=i.get(Fe);const n=i.get(Qe);const r=i.get(Vt);let d;if(ns(s)){d=s}else{const l=i.get(ee).getContextKeyValue(Wn);const u=l?o.tunnelModel.forwarded.get(l):void 0;if(u){const p=i.get(Vt);d=He.createFromTunnel(o,p,u)}}if(d){const l=d;o.setEditable(l,rt.LocalPort,{onFinish:async(u,p)=>{o.setEditable(l,rt.LocalPort,null);if(p){await o.close({host:l.remoteHost,port:l.remotePort},As.Other);const f=Number(u);const g=await o.forward({remote:{host:l.remoteHost,port:l.remotePort},local:f,name:l.name,elevateIfNeeded:true,source:l.source});if(g&&typeof g!=="string"&&g.tunnelLocalPort!==f){n.warn(c(9025,"The local port {0} is not available. Port number {1} has been used instead",u,g.tunnelLocalPort??g.localAddress))}}},validationMessage:u=>e(r,u,r.canElevate),placeholder:c(9026,"New local port")})}}}a.handler=t})(fo||(fo={}));var nl;(function(a){function e(t){return async(i,s)=>{if(ns(s)){const o=i.get(Fe);await o.close({host:s.remoteHost,port:s.remotePort},As.Other);return o.forward({remote:{host:s.remoteHost,port:s.remotePort},local:s.localPort,name:s.name,elevateIfNeeded:true,privacy:t,source:s.source})}return void 0}}a.handler=e})(nl||(nl={}));var yi;(function(a){a.ID_HTTP="remote.tunnel.setProtocolHttp";a.ID_HTTPS="remote.tunnel.setProtocolHttps";a.LABEL_HTTP=c(9027,"HTTP");a.LABEL_HTTPS=c(9028,"HTTPS");async function e(s,o,n,r){if(ns(s)){const d={protocol:o};const l=r.remoteAuthority?vs.USER_REMOTE:vs.USER_LOCAL;return n.tunnelModel.configPortsAttributes.addAttributes(s.remotePort,d,l)}}function t(){return async(s,o)=>{return e(o,Li.Http,s.get(Fe),s.get(Qt))}}a.handlerHttp=t;function i(){return async(s,o)=>{return e(o,Li.Https,s.get(Fe),s.get(Qt))}}a.handlerHttps=i})(yi||(yi={}));const Sh=10;const Os=Fn.isEqualTo(De.Forwarded);const Ns=S.or(Os,Fn.isEqualTo(De.Detected));const rs=Dm.isEqualTo(void 0);te.registerCommandAndKeybindingRule({id:Ui.ID,weight:B.WorkbenchContrib+Sh,when:S.and(Fa,Os,rs),primary:T.F2,mac:{primary:T.Enter},handler:Ui.handler()});Ne.registerCommand(Ue.INLINE_ID,Ue.inlineHandler());Ne.registerCommand(Ue.COMMANDPALETTE_ID,Ue.commandPaletteHandler());te.registerCommandAndKeybindingRule({id:Ht.INLINE_ID,weight:B.WorkbenchContrib+Sh,when:S.and(Gn,Fa),primary:T.Delete,mac:{primary:O.CtrlCmd|T.Backspace,secondary:[T.Delete]},handler:Ht.inlineHandler()});Ne.registerCommand(Ht.COMMANDPALETTE_ID,Ht.commandPaletteHandler());Ne.registerCommand(Rt.ID,Rt.handler());Ne.registerCommand(Xt.ID,Xt.handler());Ne.registerCommand(go.ID,go.handler());te.registerCommandAndKeybindingRule({id:Ut.INLINE_ID,weight:B.WorkbenchContrib+Sh,when:S.and(Fa,Ns,rs),primary:O.CtrlCmd|T.KeyC,handler:Ut.inlineHandler()});Ne.registerCommand(Ut.COMMANDPALETTE_ID,Ut.commandPaletteHandler());Ne.registerCommand(fo.ID,fo.handler());Ne.registerCommand(yi.ID_HTTP,yi.handlerHttp());Ne.registerCommand(yi.ID_HTTPS,yi.handlerHttps());b.appendMenuItem(w.CommandPalette,{command:{id:Ht.COMMANDPALETTE_ID,title:Ht.LABEL},when:ws});b.appendMenuItem(w.CommandPalette,{command:{id:Ue.COMMANDPALETTE_ID,title:Ue.LABEL},when:ws});b.appendMenuItem(w.CommandPalette,{command:{id:Ut.COMMANDPALETTE_ID,title:Ut.COMMANDPALETTE_LABEL},when:ws});b.appendMenuItem(w.CommandPalette,{command:{id:go.ID,title:go.LABEL},when:ws});b.appendMenuItem(w.TunnelContext,{group:"._open",order:0,command:{id:Rt.ID,title:Rt.LABEL},when:S.and(Ns,rs)});b.appendMenuItem(w.TunnelContext,{group:"._open",order:1,command:{id:Xt.ID,title:Xt.LABEL},when:S.and(Ns,rs)});b.appendMenuItem(w.TunnelContext,{group:"0_manage",order:1,command:{id:Ui.ID,title:Ui.LABEL,icon:_m},when:S.and(Os,rs)});b.appendMenuItem(w.TunnelContext,{group:"2_localaddress",order:0,command:{id:Ut.INLINE_ID,title:Ut.INLINE_LABEL},when:S.and(Ns,rs)});b.appendMenuItem(w.TunnelContext,{group:"2_localaddress",order:1,command:{id:fo.ID,title:fo.LABEL},when:S.and(Os,Tm,rs)});b.appendMenuItem(w.TunnelContext,{group:"2_localaddress",order:2,submenu:w.TunnelPrivacy,title:c(9029,"Port Visibility"),when:S.and(Os,Em)});b.appendMenuItem(w.TunnelContext,{group:"2_localaddress",order:3,submenu:w.TunnelProtocol,title:c(9030,"Change Port Protocol"),when:S.and(Os,rs,Am)});b.appendMenuItem(w.TunnelContext,{group:"3_forward",order:0,command:{id:Ht.INLINE_ID,title:Ht.LABEL},when:Gn});b.appendMenuItem(w.TunnelContext,{group:"3_forward",order:1,command:{id:Ue.INLINE_ID,title:Ue.LABEL}});b.appendMenuItem(w.TunnelProtocol,{order:0,command:{id:yi.ID_HTTP,title:yi.LABEL_HTTP,toggled:Ba.isEqualTo(Li.Http)}});b.appendMenuItem(w.TunnelProtocol,{order:1,command:{id:yi.ID_HTTPS,title:yi.LABEL_HTTPS,toggled:Ba.isEqualTo(Li.Https)}});b.appendMenuItem(w.TunnelPortInline,{group:"0_manage",order:0,command:{id:Ue.INLINE_ID,title:Ue.TREEITEM_LABEL,icon:HD},when:Fn.isEqualTo(De.Candidate)});b.appendMenuItem(w.TunnelPortInline,{group:"0_manage",order:4,command:{id:Ui.ID,title:Ui.LABEL,icon:_m},when:Os});b.appendMenuItem(w.TunnelPortInline,{group:"0_manage",order:5,command:{id:Ht.INLINE_ID,title:Ht.LABEL,icon:UD},when:Gn});b.appendMenuItem(w.TunnelLocalAddressInline,{order:-1,command:{id:Ut.INLINE_ID,title:Ut.INLINE_LABEL,icon:$D},when:Ns});b.appendMenuItem(w.TunnelLocalAddressInline,{order:0,command:{id:Rt.ID,title:Rt.LABEL,icon:KD},when:Ns});b.appendMenuItem(w.TunnelLocalAddressInline,{order:1,command:{id:Xt.ID,title:Xt.LABEL,icon:zD},when:Ns});ne("ports.iconRunningProcessForeground",yb,c(9031,"The color of the icon for a port that has an associated running process."));class js extends k{static{this.localUrlRegex=/\b\w{0,20}(?::\/\/)?(?:localhost|127\.0\.0\.1|0\.0\.0\.0|:\d{2,5})[\w\-\.\~:\/\?\#[\]\@!\$&\(\)\*\+\,\;\=]*/gim}static{this.extractPortRegex=/(localhost|127\.0\.0\.1|0\.0\.0\.0):(\d{1,5})/}static{this.localPythonServerRegex=/HTTP\son\s(127\.0\.0\.1|0\.0\.0\.0)\sport\s(\d+)/}static{this.excludeTerminals=["Dev Containers"]}constructor(e,t){super();this._onDidMatchLocalUrl=new _;this.onDidMatchLocalUrl=this._onDidMatchLocalUrl.event;this.listeners=new Map;this.replPositions=new Map;e.instances.forEach(i=>{this.registerTerminalInstance(i)});this._register(e.onDidCreateInstance(i=>{this.registerTerminalInstance(i)}));this._register(e.onDidDisposeInstance(i=>{this.listeners.get(i)?.dispose();this.listeners.delete(i)}));this._register(t.onDidNewSession(i=>{if(!i.parentSession||i.parentSession&&i.hasSeparateRepl()){this.listeners.set(i.getId(),i.onDidChangeReplElements(()=>{this.processNewReplElements(i)}))}}));this._register(t.onDidEndSession(({session:i})=>{if(this.listeners.has(i.getId())){this.listeners.get(i.getId())?.dispose();this.listeners.delete(i.getId())}}))}registerTerminalInstance(e){if(!js.excludeTerminals.includes(e.title)){this.listeners.set(e,e.onData(t=>{this.processData(t)}))}}processNewReplElements(e){const t=this.replPositions.get(e.getId());const i=e.getReplElements();this.replPositions.set(e.getId(),{position:i.length-1,tail:i[i.length-1]});if(!t&&i.length>0){i.forEach(s=>this.processData(s.toString()))}else if(t&&i.length-1!==t.position){for(let s=i.length-1;s>=0;s--){const o=i[s];if(o===t.tail){break}else{this.processData(o.toString())}}}}dispose(){super.dispose();const e=this.listeners.values();for(const t of e){t.dispose()}}processData(e){e=_b(e);const t=e.match(js.localUrlRegex)||[];if(t&&t.length>0){t.forEach(i=>{let s;try{s=new URL(i)}catch(o){}if(s){const o=i.match(js.extractPortRegex);const n=parseFloat(s.port?s.port:o?o[2]:"NaN");if(!isNaN(n)&&Number.isInteger(n)&&n>0&&n<=65535){let r=s.hostname;if(r!=="0.0.0.0"&&r!=="127.0.0.1"){r="localhost"}if(n!==9229&&e.startsWith("Debugger listening on")){return}this._onDidMatchLocalUrl.fire({port:n,host:r})}}})}else{const i=e.match(js.localPythonServerRegex);if(i&&i.length===3){this._onDidMatchLocalUrl.fire({host:i[1],port:Number(i[2])})}}}}const md="workbench.view.remote";let lp=class bR extends k{constructor(e,t,i,s,o,n){super();this.contextKeyService=e;this.environmentService=t;this.remoteExplorerService=i;this.tunnelService=s;this.activityService=o;this.statusbarService=n;this.contextKeyListener=this._register(new Ie);this.activityBadge=this._register(new Ie);this.hasPortsInSession=false;this._register(W.as(it.ViewsRegistry).registerViewWelcomeContent(ms,{content:this.environmentService.remoteAuthority?c(8911,"No forwarded ports. Forward a port to access your running services locally.\n[Forward a Port]({0})",`command:${Ue.INLINE_ID}`):c(8912,"No forwarded ports. Forward a port to access your locally running services over the internet.\n[Forward a Port]({0})",`command:${Ue.INLINE_ID}`)}));this.enableBadgeAndStatusBar();this.enableForwardedPortsFeatures();if(!this.environmentService.remoteAuthority){this._register(x.once(this.tunnelService.onTunnelOpened)(()=>{this.hasPortsInSession=true}))}}async getViewContainer(){return W.as(it.ViewContainersRegistry).registerViewContainer({id:od,title:I(8913,"Ports"),icon:Cm,ctorDescriptor:new Q(Cn,[od,{mergeViewWithContainerWhenSingleView:true}]),storageId:od,hideIfEmpty:true,order:5},$.Panel)}async enableForwardedPortsFeatures(){this.contextKeyListener.clear();const e=!!Cu.getValue(this.contextKeyService);const t=!!ws.getValue(this.contextKeyService);if(e||t){if(!t){this.contextKeyService.createKey(ws.key,true)}const i=await this.getViewContainer();const s=new sT(new il(this.remoteExplorerService,this.tunnelService),this.environmentService);const o=W.as(it.ViewsRegistry);if(i){this.remoteExplorerService.enablePortsFeatures(!e);o.registerViews([s],i)}}else{this.contextKeyListener.value=this.contextKeyService.onDidChangeContext(i=>{if(i.affectsSome(new Set([...Cu.keys(),...ws.keys()]))){this.enableForwardedPortsFeatures()}})}}enableBadgeAndStatusBar(){const e=W.as(it.ViewsRegistry).onViewsRegistered(t=>{if(t.find(i=>i.views.find(s=>s.id===ms))){this._register(x.debounce(this.remoteExplorerService.tunnelModel.onForwardPort,(i,s)=>s,50)(()=>{this.updateActivityBadge();this.updateStatusBar()}));this._register(x.debounce(this.remoteExplorerService.tunnelModel.onClosePort,(i,s)=>s,50)(()=>{this.updateActivityBadge();this.updateStatusBar()}));this.updateActivityBadge();this.updateStatusBar();e.dispose()}})}async updateActivityBadge(){if(this.remoteExplorerService.tunnelModel.forwarded.size>0){this.activityBadge.value=this.activityService.showViewActivity(ms,{badge:new eh(this.remoteExplorerService.tunnelModel.forwarded.size,e=>e===1?c(8914,"1 forwarded port"):c(8915,"{0} forwarded ports",e))})}else{this.activityBadge.clear()}}updateStatusBar(){if(!this.environmentService.remoteAuthority&&!this.hasPortsInSession){return}if(!this.entryAccessor){this._register(this.entryAccessor=this.statusbarService.addEntry(this.entry,"status.forwardedPorts",Ke.LEFT,40))}else{this.entryAccessor.update(this.entry)}}get entry(){let e;const t=this.remoteExplorerService.tunnelModel.forwarded.size+this.remoteExplorerService.tunnelModel.detected.size;const i=`${t}`;if(t===0){e=c(8916,"No Ports Forwarded")}else{const s=Array.from(this.remoteExplorerService.tunnelModel.forwarded.values());s.push(...Array.from(this.remoteExplorerService.tunnelModel.detected.values()));e=c(8917,"Forwarded Ports: {0}",s.map(o=>o.remotePort).join(", "))}return{name:c(8918,"Forwarded Ports"),text:`$(radio-tower) ${i}`,ariaLabel:e,tooltip:e,command:`${ms}.focus`}}};lp=E([h(0,ee),h(1,Qt),h(2,Fe),h(3,Vt),h(4,ks),h(5,ss)],lp);let hp=class CR{constructor(e,t){this.remoteExplorerService=e;this.logService=t;if(!this.remoteExplorerService.tunnelModel.environmentTunnelsSet){x.once(this.remoteExplorerService.tunnelModel.onEnvironmentTunnelsSet)(async()=>{await this.restore()})}else{this.restore()}}async restore(){this.logService.trace("ForwardedPorts: Doing first restore.");return this.remoteExplorerService.restore()}};hp=E([h(0,Fe),h(1,et)],hp);let up=class SR extends k{constructor(e,t,i,s,o,n,r,d,l,u,p,f,g,m,y){super();this.terminalService=e;this.notificationService=t;this.openerService=i;this.externalOpenerService=s;this.remoteExplorerService=o;this.contextKeyService=r;this.configurationService=d;this.debugService=l;this.tunnelService=p;this.hostService=f;this.logService=g;this.storageService=m;this.preferencesService=y;if(!n.remoteAuthority){return}d.whenRemoteConfigurationLoaded().then(()=>u.getEnvironment()).then(C=>{this.setup(C);this._register(d.onDidChangeConfiguration(D=>{if(D.affectsConfiguration(Di)){this.setup(C)}else if(D.affectsConfiguration(qn)&&!this.portListener){this.listenForPorts()}}))});if(!this.storageService.getBoolean("processPortForwardingFallback",M.WORKSPACE,true)){this.configurationService.updateValue(qn,0,vs.WORKSPACE)}}getPortAutoFallbackNumber(){const e=this.configurationService.inspect(qn);if(e.value!==void 0&&(e.value===0||e.value!==e.defaultValue)){return e.value}const t=this.configurationService.inspect(Di);if(t.applicationValue===Ii||t.userValue===Ii||t.userLocalValue===Ii||t.userRemoteValue===Ii||t.workspaceFolderValue===Ii||t.workspaceValue===Ii){return 0}return e.value??20}listenForPorts(){let e=this.getPortAutoFallbackNumber();if(e===0){this.portListener?.dispose();return}if(this.procForwarder&&!this.portListener&&this.configurationService.getValue(Di)===Ii){this.portListener=this._register(this.remoteExplorerService.tunnelModel.onForwardPort(async()=>{e=this.getPortAutoFallbackNumber();if(e===0){this.portListener?.dispose();return}if(Array.from(this.remoteExplorerService.tunnelModel.forwarded.values()).filter(t=>t.source.source===th.Auto).length>e){await this.configurationService.updateValue(Di,Pd);this.notificationService.notify({message:c(8919,"Over 20 ports have been automatically forwarded. The `process` based automatic port forwarding has been switched to `hybrid` in settings. Some ports may no longer be detected."),severity:ve.Warning,actions:{primary:[new ti("switchBack",c(8920,"Undo"),void 0,true,async()=>{await this.configurationService.updateValue(Di,Ii);await this.configurationService.updateValue(qn,0,vs.WORKSPACE);this.portListener?.dispose();this.portListener=void 0}),new ti("showPortSourceSetting",c(8921,"Show Setting"),void 0,true,async()=>{await this.preferencesService.openSettings({query:"remote.autoForwardPortsSource"})})]}})}}))}else{this.portListener?.dispose();this.portListener=void 0}}setup(e){const t=this.procForwarder?.forwarded;const i=this.outputForwarder||this.procForwarder;this.procForwarder?.dispose();this.procForwarder=void 0;this.outputForwarder?.dispose();this.outputForwarder=void 0;if(e?.os!==Ab.Linux){if(this.configurationService.inspect(Di).default?.value!==Su){W.as(Co.Configuration).registerDefaultConfigurations([{overrides:{"remote.autoForwardPortsSource":Su}}])}this.outputForwarder=this._register(new pp(this.terminalService,this.notificationService,this.openerService,this.externalOpenerService,this.remoteExplorerService,this.configurationService,this.debugService,this.tunnelService,this.hostService,this.logService,this.contextKeyService,()=>false))}else{const s=()=>this.configurationService.getValue(Di)===Ii;if(s()){this.procForwarder=this._register(new gp(false,t,!i,this.configurationService,this.remoteExplorerService,this.notificationService,this.openerService,this.externalOpenerService,this.tunnelService,this.hostService,this.logService,this.contextKeyService))}else if(this.configurationService.getValue(Di)===Pd){this.procForwarder=this._register(new gp(true,t,!i,this.configurationService,this.remoteExplorerService,this.notificationService,this.openerService,this.externalOpenerService,this.tunnelService,this.hostService,this.logService,this.contextKeyService))}this.outputForwarder=this._register(new pp(this.terminalService,this.notificationService,this.openerService,this.externalOpenerService,this.remoteExplorerService,this.configurationService,this.debugService,this.tunnelService,this.hostService,this.logService,this.contextKeyService,s))}this.listenForPorts()}};up=E([h(0,Eb),h(1,Qe),h(2,St),h(3,zg),h(4,Fe),h(5,Qt),h(6,ee),h(7,Ib),h(8,Db),h(9,Tb),h(10,Vt),h(11,is),h(12,et),h(13,le),h(14,ih)],up);class Ga extends k{static{this.NOTIFY_COOL_DOWN=5e3}constructor(e,t,i,s,o,n,r,d){super();this.notificationService=e;this.remoteExplorerService=t;this.openerService=i;this.externalOpenerService=s;this.tunnelService=o;this.hostService=n;this.logService=r;this.contextKeyService=d;this.alreadyOpenedOnce=new Set;this.lastNotifyTime=new Date;this.lastNotifyTime.setFullYear(this.lastNotifyTime.getFullYear()-1)}async doAction(e){this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) Starting action for ${e[0]?.tunnelRemotePort}`);this.doActionTunnels=e;const t=await this.portNumberHeuristicDelay();this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) Heuristic chose ${t?.tunnelRemotePort}`);if(t){const i=await this.remoteExplorerService.tunnelModel.getAttributes([{port:t.tunnelRemotePort,host:t.tunnelRemoteHost}]);const s=i?.get(t.tunnelRemotePort)?.onAutoForward;this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) onAutoForward action is ${s}`);switch(s){case zs.OpenBrowserOnce:{if(this.alreadyOpenedOnce.has(t.localAddress)){break}this.alreadyOpenedOnce.add(t.localAddress)}case zs.OpenBrowser:{const o=nt(t.tunnelRemoteHost,t.tunnelRemotePort);await Rt.run(this.remoteExplorerService.tunnelModel,this.openerService,o);break}case zs.OpenPreview:{const o=nt(t.tunnelRemoteHost,t.tunnelRemotePort);await Xt.run(this.remoteExplorerService.tunnelModel,this.openerService,this.externalOpenerService,o);break}case zs.Silent:break;default:{const o=new Date().getTime()-this.lastNotifyTime.getTime();this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) time elapsed since last notification ${o} ms`);if(o>Ga.NOTIFY_COOL_DOWN){await this.showNotification(t)}}}}}hide(e){if(this.doActionTunnels){this.doActionTunnels=this.doActionTunnels.filter(t=>!e.includes(t.tunnelRemotePort))}if(this.lastShownPort&&e.indexOf(this.lastShownPort)>=0){this.lastNotification?.close()}}async portNumberHeuristicDelay(){this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) Starting heuristic delay`);if(!this.doActionTunnels||this.doActionTunnels.length===0){return}this.doActionTunnels=this.doActionTunnels.sort((t,i)=>t.tunnelRemotePort-i.tunnelRemotePort);const e=this.doActionTunnels.shift();if(e.tunnelRemotePort%1e3===0){this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) Heuristic chose tunnel because % 1000: ${e.tunnelRemotePort}`);this.newerTunnel=e;return e}else if(e.tunnelRemotePort<1e4&&e.tunnelRemotePort!==9229){this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) Heuristic chose tunnel because < 10000: ${e.tunnelRemotePort}`);this.newerTunnel=e;return e}this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) Waiting for "better" tunnel than ${e.tunnelRemotePort}`);this.newerTunnel=void 0;return new Promise(t=>{setTimeout(()=>{if(this.newerTunnel){t(void 0)}else if(this.doActionTunnels?.includes(e)){t(e)}else{t(void 0)}},3e3)})}async basicMessage(e){const t=await this.remoteExplorerService.tunnelModel.getAttributes([{host:e.tunnelRemoteHost,port:e.tunnelRemotePort}],false);const i=t?.get(e.tunnelRemotePort)?.label;return c(8922,"Your application{0} running on port {1} is available.  ",i?` (${i})`:"",e.tunnelRemotePort)}linkMessage(){return c(8923,"[See all forwarded ports]({0})",`command:${Cs.ID}.focus`)}async showNotification(e){if(!await this.hostService.hadLastFocus()){return}this.lastNotification?.close();let t=await this.basicMessage(e);const i=[this.openBrowserChoice(e)];if(!Is||YD.getValue(this.contextKeyService)){i.push(this.openPreviewChoice(e))}if(e.tunnelLocalPort!==e.tunnelRemotePort&&this.tunnelService.canElevate&&this.tunnelService.isPortPrivileged(e.tunnelRemotePort)){t+=c(8924,"You'll need to run as superuser to use port {0} locally.  ",e.tunnelRemotePort);i.unshift(this.elevateChoice(e))}if(e.privacy===Er.Private&&Is&&this.tunnelService.canChangePrivacy){i.push(this.makePublicChoice(e))}t+=this.linkMessage();this.lastNotification=this.notificationService.prompt(ve.Info,t,i,{neverShowAgain:{id:"remote.tunnelsView.autoForwardNeverShow",isSecondary:true}});this.lastShownPort=e.tunnelRemotePort;this.lastNotifyTime=new Date;this.lastNotification.onDidClose(()=>{this.lastNotification=void 0;this.lastShownPort=void 0})}makePublicChoice(e){return{label:c(8925,"Make Public"),run:async()=>{const t=eo(this.remoteExplorerService.tunnelModel.forwarded,e.tunnelRemoteHost,e.tunnelRemotePort);await this.remoteExplorerService.close({host:e.tunnelRemoteHost,port:e.tunnelRemotePort},As.Other);return this.remoteExplorerService.forward({remote:{host:e.tunnelRemoteHost,port:e.tunnelRemotePort},local:e.tunnelLocalPort,name:t?.name,elevateIfNeeded:true,privacy:Er.Public,source:t?.source})}}}openBrowserChoice(e){const t=nt(e.tunnelRemoteHost,e.tunnelRemotePort);return{label:Rt.LABEL,run:()=>Rt.run(this.remoteExplorerService.tunnelModel,this.openerService,t)}}openPreviewChoice(e){const t=nt(e.tunnelRemoteHost,e.tunnelRemotePort);return{label:Xt.LABEL,run:()=>Xt.run(this.remoteExplorerService.tunnelModel,this.openerService,this.externalOpenerService,t)}}elevateChoice(e){return{label:c(8926,"Use Port {0} as Sudo...",e.tunnelRemotePort),run:async()=>{await this.remoteExplorerService.close({host:e.tunnelRemoteHost,port:e.tunnelRemotePort},As.Other);const t=await this.remoteExplorerService.forward({remote:{host:e.tunnelRemoteHost,port:e.tunnelRemotePort},local:e.tunnelRemotePort,elevateIfNeeded:true,source:sh});if(!t||typeof t==="string"){return}this.lastNotification?.close();this.lastShownPort=t.tunnelRemotePort;this.lastNotification=this.notificationService.prompt(ve.Info,await this.basicMessage(t)+this.linkMessage(),[this.openBrowserChoice(t),this.openPreviewChoice(e)],{neverShowAgain:{id:"remote.tunnelsView.autoForwardNeverShow",isSecondary:true}});this.lastNotification.onDidClose(()=>{this.lastNotification=void 0;this.lastShownPort=void 0})}}}}class pp extends k{constructor(e,t,i,s,o,n,r,d,l,u,p,f){super();this.terminalService=e;this.notificationService=t;this.openerService=i;this.externalOpenerService=s;this.remoteExplorerService=o;this.configurationService=n;this.debugService=r;this.tunnelService=d;this.hostService=l;this.logService=u;this.contextKeyService=p;this.privilegedOnly=f;this.notifier=new Ga(t,o,i,s,d,l,u,p);this._register(n.onDidChangeConfiguration(g=>{if(g.affectsConfiguration($o)){this.tryStartStopUrlFinder()}}));this.portsFeatures=this._register(this.remoteExplorerService.onEnabledPortsFeatures(()=>{this.tryStartStopUrlFinder()}));this.tryStartStopUrlFinder();if(n.getValue(Di)===Pd){this._register(this.tunnelService.onTunnelClosed(g=>this.notifier.hide([g.port])))}}tryStartStopUrlFinder(){if(this.configurationService.getValue($o)){this.startUrlFinder()}else{this.stopUrlFinder()}}startUrlFinder(){if(!this.urlFinder&&this.remoteExplorerService.portsFeaturesEnabled!==$g.AdditionalFeatures){return}this.portsFeatures?.dispose();this.urlFinder=this._register(new js(this.terminalService,this.debugService));this._register(this.urlFinder.onDidMatchLocalUrl(async e=>{if(eo(this.remoteExplorerService.tunnelModel.detected,e.host,e.port)){return}const t=(await this.remoteExplorerService.tunnelModel.getAttributes([e]))?.get(e.port);if(t?.onAutoForward===zs.Ignore){return}if(this.privilegedOnly()&&!this.tunnelService.isPortPrivileged(e.port)){return}const i=await this.remoteExplorerService.forward({remote:e,source:sh},t??null);if(i&&typeof i!=="string"){this.notifier.doAction([i])}}))}stopUrlFinder(){if(this.urlFinder){this.urlFinder.dispose();this.urlFinder=void 0}}}class gp extends k{constructor(e,t,i,s,o,n,r,d,l,u,p,f){super();this.unforwardOnly=e;this.alreadyAutoForwarded=t;this.needsInitialCandidates=i;this.configurationService=s;this.remoteExplorerService=o;this.notificationService=n;this.openerService=r;this.externalOpenerService=d;this.tunnelService=l;this.hostService=u;this.logService=p;this.contextKeyService=f;this.autoForwarded=new Set;this.notifiedOnly=new Set;this.initialCandidates=new Set;this.notifier=new Ga(n,o,r,d,l,u,p,f);t?.forEach(g=>this.autoForwarded.add(g));this.initialize()}get forwarded(){return this.autoForwarded}async initialize(){if(!this.remoteExplorerService.tunnelModel.environmentTunnelsSet){await new Promise(e=>this.remoteExplorerService.tunnelModel.onEnvironmentTunnelsSet(()=>e()))}this._register(this.configurationService.onDidChangeConfiguration(async e=>{if(e.affectsConfiguration($o)){await this.startStopCandidateListener()}}));this.portsFeatures=this._register(this.remoteExplorerService.onEnabledPortsFeatures(async()=>{await this.startStopCandidateListener()}));this.startStopCandidateListener()}async startStopCandidateListener(){if(this.configurationService.getValue($o)){await this.startCandidateListener()}else{this.stopCandidateListener()}}stopCandidateListener(){if(this.candidateListener){this.candidateListener.dispose();this.candidateListener=void 0}}async startCandidateListener(){if(this.candidateListener||this.remoteExplorerService.portsFeaturesEnabled!==$g.AdditionalFeatures){return}this.portsFeatures?.dispose();await this.setInitialCandidates();if(this.configurationService.getValue($o)){this.candidateListener=this._register(this.remoteExplorerService.tunnelModel.onCandidatesChanged(this.handleCandidateUpdate,this))}}async setInitialCandidates(){if(!this.needsInitialCandidates){this.logService.debug(`ForwardedPorts: (ProcForwarding) Not setting initial candidates`);return}let e=this.remoteExplorerService.tunnelModel.candidatesOrUndefined;if(!e){await new Promise(t=>this.remoteExplorerService.tunnelModel.onCandidatesChanged(()=>t()));e=this.remoteExplorerService.tunnelModel.candidates}for(const t of e){this.initialCandidates.add(nt(t.host,t.port))}this.logService.debug(`ForwardedPorts: (ProcForwarding) Initial candidates set to ${e.map(t=>t.port).join(", ")}`)}async forwardCandidates(){let e;const t=[];this.logService.trace(`ForwardedPorts: (ProcForwarding) Attempting to forward ${this.remoteExplorerService.tunnelModel.candidates.length} candidates`);for(const i of this.remoteExplorerService.tunnelModel.candidates){if(!i.detail){this.logService.trace(`ForwardedPorts: (ProcForwarding) Port ${i.port} missing detail`);continue}if(!e){e=await this.remoteExplorerService.tunnelModel.getAttributes(this.remoteExplorerService.tunnelModel.candidates)}const s=e?.get(i.port);const o=nt(i.host,i.port);if(this.initialCandidates.has(o)&&s?.onAutoForward===void 0){continue}if(this.notifiedOnly.has(o)||this.autoForwarded.has(o)){continue}const n=eo(this.remoteExplorerService.tunnelModel.forwarded,i.host,i.port);if(eo(this.remoteExplorerService.tunnelModel.detected,i.host,i.port)){continue}if(s?.onAutoForward===zs.Ignore){this.logService.trace(`ForwardedPorts: (ProcForwarding) Port ${i.port} is ignored`);continue}const r=await this.remoteExplorerService.forward({remote:i,source:sh},s??null);if(!n&&r){this.logService.trace(`ForwardedPorts: (ProcForwarding) Port ${i.port} has been forwarded`);this.autoForwarded.add(o)}else if(r){this.logService.trace(`ForwardedPorts: (ProcForwarding) Port ${i.port} has been notified`);this.notifiedOnly.add(o)}if(r&&typeof r!=="string"){t.push(r)}}this.logService.trace(`ForwardedPorts: (ProcForwarding) Forwarded ${t.length} candidates`);if(t.length===0){return void 0}return t}async handleCandidateUpdate(e){const t=[];let i;if(this.unforwardOnly){i=new Map;for(const o of this.remoteExplorerService.tunnelModel.forwarded.entries()){if(o[1].source.source===th.Auto){i.set(o[0],o[1])}}}else{i=new Map(this.autoForwarded.entries())}for(const o of e){const n=o[0];let r=o[1];const d=eo(i,r.host,r.port);if(d){if(typeof d==="string"){this.autoForwarded.delete(n)}else{r={host:d.remoteHost,port:d.remotePort}}await this.remoteExplorerService.close(r,As.AutoForwardEnd);t.push(r.port)}else if(this.notifiedOnly.has(n)){this.notifiedOnly.delete(n);t.push(r.port)}else if(this.initialCandidates.has(n)){this.initialCandidates.delete(n)}}if(this.unforwardOnly){return}if(t.length>0){await this.notifier.hide(t)}const s=await this.forwardCandidates();if(s){await this.notifier.doAction(s)}}}const fp="workbench.view.scm";var mp;(function(a){a[a["Error"]=0]="Error";a[a["Warning"]=1]="Warning";a[a["Information"]=2]="Information"})(mp||(mp={}));var wp;(function(a){a[a["HistoryPrevious"]=0]="HistoryPrevious";a[a["HistoryNext"]=1]="HistoryNext"})(wp||(wp={}));var vp;(function(a){a["DiscoveryTime"]="discoveryTime";a["Name"]="name";a["Path"]="path"})(vp||(vp={}));var rl;const wd={webviewState:"webviewState"};let al=class _R extends ba{static{rl=this}static getOriginStore(e){this._originStore??=new xb("webviewViews.origins",e);return this._originStore}constructor(e,t,i,s,o,n,r,d,l,u,p,f,g,m,y,C,D){super({...e,titleMenuId:w.ViewTitle,showActions:Rb.WhenExpanded},n,s,t,i,u,o,r,l,d);this.activityService=p;this.extensionService=f;this.progressService=g;this.storageService=m;this.viewService=y;this.webviewService=C;this.webviewViewService=D;this._webview=this._register(new Ie);this._webviewDisposables=this._register(new L);this._activated=false;this.activity=this._register(new Ie);this._onDidChangeVisibility=this._register(new _);this.onDidChangeVisibility=this._onDidChangeVisibility.event;this._onDispose=this._register(new _);this.onDispose=this._onDispose.event;this.extensionId=e.fromExtensionId;this.defaultTitle=this.title;this.memento=new Xp(`webviewView.${this.id}`,m);this.viewState=this.memento.getMemento(M.WORKSPACE,Ee.MACHINE);this._register(this.onDidChangeBodyVisibility(()=>this.updateTreeVisibility()));this._register(this.webviewViewService.onNewResolverRegistered(F=>{if(F.viewType===this.id){this.updateTreeVisibility()}}));this.updateTreeVisibility()}dispose(){this._onDispose.fire();clearTimeout(this._repositionTimeout);super.dispose()}focus(){super.focus();this._webview.value?.focus()}renderBody(e){super.renderBody(e);this._container=e;this._rootContainer=void 0;if(!this._resizeObserver){this._resizeObserver=new ResizeObserver(()=>{setTimeout(()=>{this.layoutWebview()},0)});this._register(de(()=>{this._resizeObserver.disconnect()}));this._resizeObserver.observe(e)}}saveState(){if(this._webview.value){this.viewState[wd.webviewState]=this._webview.value.state}this.memento.saveMemento();super.saveState()}layoutBody(e,t){super.layoutBody(e,t);this.layoutWebview(new Ft(t,e))}updateTreeVisibility(){if(this.isBodyVisible()){this.activate();this._webview.value?.claim(this,wt(this.element),void 0)}else{this._webview.value?.release(this)}}activate(){if(this._activated){return}this._activated=true;const e=this.extensionId?rl.getOriginStore(this.storageService).getOrigin(this.id,this.extensionId):void 0;const t=this.webviewService.createWebviewOverlay({origin:e,providedViewType:this.id,title:this.title,options:{purpose:jg.WebviewView},contentOptions:{},extension:this.extensionId?{id:this.extensionId}:void 0});t.state=this.viewState[wd.webviewState];this._webview.value=t;if(this._container){this.layoutWebview()}this._webviewDisposables.add(de(()=>{this._webview.value?.release(this)}));this._webviewDisposables.add(t.onDidUpdateState(()=>{this.viewState[wd.webviewState]=t.state}));for(const s of[se.DRAG,se.DRAG_END,se.DRAG_ENTER,se.DRAG_LEAVE,se.DRAG_START]){this._webviewDisposables.add(J(this._webview.value.container,s,o=>{o.preventDefault();o.stopImmediatePropagation();this.dropTargetElement.dispatchEvent(new DragEvent(o.type,o))}))}this._webviewDisposables.add(new Vb(wt(this.element),()=>this._webview.value));const i=this._webviewDisposables.add(new es);this.withProgress(async()=>{await this.extensionService.activateByEvent(`onView:${this.id}`);const s=this;const o={webview:t,onDidChangeVisibility:this.onDidChangeBodyVisibility,onDispose:this.onDispose,get title(){return s.setTitle},set title(n){s.updateTitle(n)},get description(){return s.titleDescription},set description(n){s.updateTitleDescription(n)},get badge(){return s.badge},set badge(n){s.updateBadge(n)},dispose:()=>{this._activated=false;this._webview.clear();this._webviewDisposables.clear()},show:n=>{this.viewService.openView(this.id,!n)}};await this.webviewViewService.resolve(this.id,o,i.token)})}updateTitle(e){this.setTitle=e;super.updateTitle(typeof e==="string"?e:this.defaultTitle)}updateBadge(e){if(this.badge?.value===e?.value&&this.badge?.tooltip===e?.tooltip){return}this.badge=e;if(e){const t={badge:new eh(e.value,()=>e.tooltip),priority:150};this.activity.value=this.activityService.showViewActivity(this.id,t)}}async withProgress(e){return this.progressService.withProgress({location:this.id,delay:500},e)}onDidScrollRoot(){this.layoutWebview()}doLayoutWebview(e){const t=this._webview.value;if(!this._container||!t){return}if(!this._rootContainer||!this._rootContainer.isConnected){this._rootContainer=this.findRootContainer(this._container)}t.layoutWebviewOverElement(this._container,e,this._rootContainer)}layoutWebview(e){this.doLayoutWebview(e);clearTimeout(this._repositionTimeout);this._repositionTimeout=setTimeout(()=>this.doLayoutWebview(e),200)}findRootContainer(e){return kb(e,"monaco-scrollable-element")??void 0}};al=rl=E([h(1,X),h(2,ee),h(3,ot),h(4,N),h(5,zt),h(6,St),h(7,bt),h(8,pe),h(9,We),h(10,ks),h(11,Kt),h(12,Ea),h(13,le),h(14,st),h(15,Ps),h(16,qg)],al);const yp={type:"object",properties:{id:{description:c(2459,"Unique id used to identify the container in which views can be contributed using 'views' contribution point"),type:"string",pattern:"^[a-zA-Z0-9_-]+$"},title:{description:c(2460,"Human readable string used to render the container"),type:"string"},icon:{description:c(2461,"Path to the container icon. Icons are 24x24 centered on a 50x40 block and have a fill color of 'rgb(215, 218, 224)' or '#d7dae0'. It is recommended that icons be in SVG, though any image file type is accepted."),type:"string"}},required:["id","title","icon"]};const rT={description:c(2462,"Contributes views containers to the editor"),type:"object",properties:{"activitybar":{description:c(2463,"Contribute views containers to Activity Bar"),type:"array",items:yp},"panel":{description:c(2464,"Contribute views containers to Panel"),type:"array",items:yp}},additionalProperties:false};var Zi;(function(a){a["Tree"]="tree";a["Webview"]="webview"})(Zi||(Zi={}));var Ys;(function(a){a["Visible"]="visible";a["Hidden"]="hidden";a["Collapsed"]="collapsed"})(Ys||(Ys={}));const Po={type:"object",required:["id","name","icon"],defaultSnippets:[{body:{id:"${1:id}",name:"${2:name}",icon:"${3:icon}"}}],properties:{type:{markdownDescription:c(2465,"Type of the view. This can either be `tree` for a tree view based view or `webview` for a webview based view. The default is `tree`."),type:"string",enum:["tree","webview"],markdownEnumDescriptions:[c(2466,"The view is backed by a `TreeView` created by `createTreeView`."),c(2467,"The view is backed by a `WebviewView` registered by `registerWebviewViewProvider`.")]},id:{markdownDescription:c(2468,"Identifier of the view. This should be unique across all views. It is recommended to include your extension id as part of the view id. Use this to register a data provider through `vscode.window.registerTreeDataProviderForView` API. Also to trigger activating your extension by registering `onView:${id}` event to `activationEvents`."),type:"string"},name:{description:c(2469,"The human-readable name of the view. Will be shown"),type:"string"},when:{description:c(2470,"Condition which must be true to show this view"),type:"string"},icon:{description:c(2471,"Path to the view icon. View icons are displayed when the name of the view cannot be shown. It is recommended that icons be in SVG, though any image file type is accepted."),type:"string"},contextualTitle:{description:c(2472,"Human-readable context for when the view is moved out of its original location. By default, the view's container name will be used."),type:"string"},visibility:{description:c(2473,"Initial state of the view when the extension is first installed. Once the user has changed the view state by collapsing, moving, or hiding the view, the initial state will not be used again."),type:"string",enum:["visible","hidden","collapsed"],default:"visible",enumDescriptions:[c(2474,"The default initial state for the view. In most containers the view will be expanded, however; some built-in containers (explorer, scm, and debug) show all contributed views collapsed regardless of the `visibility`."),c(2475,"The view will not be shown in the view container, but will be discoverable through the views menu and other view entry points and can be un-hidden by the user."),c(2476,"The view will show in the view container, but will be collapsed.")]},initialSize:{type:"number",description:c(2477,"The initial size of the view. The size will behave like the css 'flex' property, and will set the initial size when the view is first shown. In the side bar, this is the height of the view. This value is only respected when the same extension owns both the view and the view container.")},accessibilityHelpContent:{type:"string",markdownDescription:c(2478,"When the accessibility help dialog is invoked in this view, this content will be presented to the user as a markdown string. Keybindings will be resolved when provided in the format of <keybinding:commandId>. If there is no keybinding, that will be indicated and this command will be included in a quickpick for easy configuration.")}}};const aT={type:"object",required:["id","name"],properties:{id:{description:c(2468,"Identifier of the view. This should be unique across all views. It is recommended to include your extension id as part of the view id. Use this to register a data provider through `vscode.window.registerTreeDataProviderForView` API. Also to trigger activating your extension by registering `onView:${id}` event to `activationEvents`."),type:"string"},name:{description:c(2469,"The human-readable name of the view. Will be shown"),type:"string"},when:{description:c(2470,"Condition which must be true to show this view"),type:"string"},group:{description:c(2479,"Nested group in the viewlet"),type:"string"},remoteName:{description:c(2480,"The name of the remote type associated with this view"),type:["string","array"],items:{type:"string"}}}};const dT={description:c(2481,"Contributes views to the editor"),type:"object",properties:{"explorer":{description:c(2482,"Contributes views to Explorer container in the Activity bar"),type:"array",items:Po,default:[]},"debug":{description:c(2483,"Contributes views to Debug container in the Activity bar"),type:"array",items:Po,default:[]},"scm":{description:c(2484,"Contributes views to SCM container in the Activity bar"),type:"array",items:Po,default:[]},"test":{description:c(2485,"Contributes views to Test container in the Activity bar"),type:"array",items:Po,default:[]},"remote":{description:c(2486,"Contributes views to Remote container in the Activity bar. To contribute to this container, enableProposedApi needs to be turned on"),type:"array",items:aT,default:[]}},additionalProperties:{description:c(2487,"Contributes views to contributed views container"),type:"array",items:Po,default:[]}};const km=Ul.registerExtensionPoint({extensionPoint:"viewsContainers",jsonSchema:rT});const cT=Ul.registerExtensionPoint({extensionPoint:"views",deps:[km],jsonSchema:dT,activationEventsGenerator:(a,e)=>{for(const t of a){for(const i of Object.values(t)){for(const s of i){if(s.id){e.push(`onView:${s.id}`)}}}}}});const lT=7;let Wr=class ER{static{this.ID="workbench.contrib.viewsExtensionHandler"}constructor(e,t){this.instantiationService=e;this.logService=t;this.viewContainersRegistry=W.as(it.ViewContainersRegistry);this.viewsRegistry=W.as(it.ViewsRegistry);this.handleAndRegisterCustomViewContainers();this.handleAndRegisterCustomViews()}handleAndRegisterCustomViewContainers(){km.setHandler((e,{added:t,removed:i})=>{if(i.length){this.removeCustomViewContainers(i)}if(t.length){this.addCustomViewContainers(t,this.viewContainersRegistry.all)}})}addCustomViewContainers(e,t){const i=W.as(it.ViewContainersRegistry);let s=lT+i.all.filter(n=>!!n.extensionId&&i.getViewContainerLocation(n)===$.Sidebar).length;let o=5+i.all.filter(n=>!!n.extensionId&&i.getViewContainerLocation(n)===$.Panel).length+1;for(const{value:n,collector:r,description:d}of e){Object.entries(n).forEach(([l,u])=>{if(!this.isValidViewsContainer(u,r)){return}switch(l){case"activitybar":s=this.registerCustomViewContainers(u,d,s,t,$.Sidebar);break;case"panel":o=this.registerCustomViewContainers(u,d,o,t,$.Panel);break}})}}removeCustomViewContainers(e){const t=W.as(it.ViewContainersRegistry);const i=e.reduce((s,o)=>{s.add(o.description.identifier);return s},new _u);for(const s of t.all){if(s.extensionId&&i.has(s.extensionId)){const o=this.viewsRegistry.getViews(s);if(o.length){this.viewsRegistry.moveViews(o,this.getDefaultViewContainer())}this.deregisterCustomViewContainer(s)}}}isValidViewsContainer(e,t){if(!Array.isArray(e)){t.error(c(2488,"views containers must be an array"));return false}for(const i of e){if(typeof i.id!=="string"&&Vd(i.id)){t.error(c(2489,"property `{0}` is mandatory and must be of type `string` with non-empty value. Only alphanumeric characters, '_', and '-' are allowed.","id"));return false}if(!/^[a-z0-9_-]+$/i.test(i.id)){t.error(c(2489,"property `{0}` is mandatory and must be of type `string` with non-empty value. Only alphanumeric characters, '_', and '-' are allowed.","id"));return false}if(typeof i.title!=="string"){t.error(c(2490,"property `{0}` is mandatory and must be of type `string`","title"));return false}if(typeof i.icon!=="string"){t.error(c(2490,"property `{0}` is mandatory and must be of type `string`","icon"));return false}if(Vd(i.title)){t.warn(c(2491,"property `{0}` is mandatory and must be of type `string` with non-empty value","title"));return true}}return true}registerCustomViewContainers(e,t,i,s,o){e.forEach(n=>{const r=ye.fromString(n.icon);const d=r||Eu(t.extensionLocation,n.icon);const l=`workbench.view.extension.${n.id}`;const u=n.title||l;const p=this.registerCustomViewContainer(l,u,d,i++,t.identifier,o);if(s.length){const f=[];for(const g of s){if(p!==g){f.push(...this.viewsRegistry.getViews(g).filter(m=>m.originalContainerId===n.id))}}if(f.length){this.viewsRegistry.moveViews(f,p)}}});return i}registerCustomViewContainer(e,t,i,s,o,n){let r=this.viewContainersRegistry.get(e);if(!r){r=this.viewContainersRegistry.registerViewContainer({id:e,title:{value:t,original:t},extensionId:o,ctorDescriptor:new Q(Cn,[e,{mergeViewWithContainerWhenSingleView:true}]),hideIfEmpty:true,order:s,icon:i},n)}return r}deregisterCustomViewContainer(e){this.viewContainersRegistry.deregisterViewContainer(e);W.as(wi.Viewlets).deregisterPaneComposite(e.id)}handleAndRegisterCustomViews(){cT.setHandler((e,{added:t,removed:i})=>{if(i.length){this.removeViews(i)}if(t.length){this.addViews(t)}})}addViews(e){const t=new Set;const i=[];for(const s of e){const{value:o,collector:n}=s;Object.entries(o).forEach(([r,d])=>{if(!this.isValidViewDescriptors(d,n)){return}if(r==="remote"&&!Iu(s.description,"contribViewsRemote")){n.warn(c(2492,`View container '{0}' requires 'enabledApiProposals: ["contribViewsRemote"]' to be added to 'Remote'.`,r));return}const l=this.getViewContainer(r);if(!l){n.warn(c(2493,"View container '{0}' does not exist and all views registered to it will be added to 'Explorer'.",r))}const u=l||this.getDefaultViewContainer();const p=[];for(let f=0;f<d.length;f++){const g=d[f];if(t.has(g.id)){n.error(c(2494,"Cannot register multiple views with same id `{0}`",g.id));continue}if(this.viewsRegistry.getView(g.id)!==null){n.error(c(2495,"A view with id `{0}` is already registered.",g.id));continue}const m=Yg.equals(s.description.identifier,u.extensionId)?f+1:u.viewOrderDelegate?u.viewOrderDelegate.getOrder(g.group):void 0;let y;if(typeof g.icon==="string"){y=ye.fromString(g.icon)||Eu(s.description.extensionLocation,g.icon)}const C=this.convertInitialVisibility(g.visibility);const D=this.getViewType(g.type);if(!D){n.error(c(2496,"Unknown view type `{0}`.",g.type));continue}let F=void 0;if(typeof g.initialSize==="number"){if(u.extensionId?.value===s.description.identifier.value){F=g.initialSize}else{this.logService.warn(`${s.description.identifier.value} tried to set the view size of ${g.id} but it was ignored because the view container does not belong to it.`)}}let P;if(Iu(s.description,"contribAccessibilityHelpContent")&&g.accessibilityHelpContent){P=new Ia(g.accessibilityHelpContent)}const R={type:D,ctorDescriptor:D===Zi.Tree?new Q(Yc):new Q(al),id:g.id,name:{value:g.name,original:g.name},when:S.deserialize(g.when),containerIcon:y||l?.icon,containerTitle:g.contextualTitle||l&&(typeof l.title==="string"?l.title:l.title.value),canToggleVisibility:true,canMoveView:l?.id!==md,treeView:D===Zi.Tree?this.instantiationService.createInstance(Qc,g.id,g.name,s.description.identifier.value):void 0,collapsed:this.showCollapsed(u)||C===Ys.Collapsed,order:m,extensionId:s.description.identifier,originalContainerId:r,group:g.group,remoteAuthority:g.remoteName||g.remoteAuthority,virtualWorkspace:g.virtualWorkspace,hideByDefault:C===Ys.Hidden,workspace:l?.id===md?true:void 0,weight:F,accessibilityHelpContent:P};t.add(R.id);p.push(R)}i.push({viewContainer:u,views:p})})}this.viewsRegistry.registerViews2(i)}getViewType(e){if(e===Zi.Webview){return Zi.Webview}if(!e||e===Zi.Tree){return Zi.Tree}return void 0}getDefaultViewContainer(){return this.viewContainersRegistry.get(nd)}removeViews(e){const t=e.reduce((i,s)=>{i.add(s.description.identifier);return i},new _u);for(const i of this.viewContainersRegistry.all){const s=this.viewsRegistry.getViews(i).filter(o=>o.extensionId&&t.has(o.extensionId));if(s.length){this.viewsRegistry.deregisterViews(s,i);for(const o of s){const n=o;if(n.treeView){n.treeView.dispose()}}}}}convertInitialVisibility(e){if(Object.values(Ys).includes(e)){return e}return void 0}isValidViewDescriptors(e,t){if(!Array.isArray(e)){t.error(c(2497,"views must be an array"));return false}for(const i of e){if(typeof i.id!=="string"){t.error(c(2490,"property `{0}` is mandatory and must be of type `string`","id"));return false}if(typeof i.name!=="string"){t.error(c(2490,"property `{0}` is mandatory and must be of type `string`","name"));return false}if(i.when&&typeof i.when!=="string"){t.error(c(2498,"property `{0}` can be omitted or must be of type `string`","when"));return false}if(i.icon&&typeof i.icon!=="string"){t.error(c(2498,"property `{0}` can be omitted or must be of type `string`","icon"));return false}if(i.contextualTitle&&typeof i.contextualTitle!=="string"){t.error(c(2498,"property `{0}` can be omitted or must be of type `string`","contextualTitle"));return false}if(i.visibility&&!this.convertInitialVisibility(i.visibility)){t.error(c(2499,"property `{0}` can be omitted or must be one of {1}","visibility",Object.values(Ys).join(", ")));return false}}return true}getViewContainer(e){switch(e){case"explorer":return this.viewContainersRegistry.get(nd);case"debug":return this.viewContainersRegistry.get(Du);case"scm":return this.viewContainersRegistry.get(fp);case"remote":return this.viewContainersRegistry.get(md);default:return this.viewContainersRegistry.get(`workbench.view.extension.${e}`)}}showCollapsed(e){switch(e.id){case nd:case fp:case Du:return true}return false}};Wr=E([h(0,N),h(1,et)],Wr);class hT extends k{constructor(){super(...arguments);this.type="table"}shouldRender(e){return!!e.contributes?.viewsContainers}render(e){const t=e.contributes?.viewsContainers||{};const i=Object.keys(t).reduce((n,r)=>{const d=t[r];n.push(...d.map(l=>({...l,location:r})));return n},[]);if(!i.length){return{data:{headers:[],rows:[]},dispose:()=>{}}}const s=[c(2500,"ID"),c(2501,"Title"),c(2502,"Where")];const o=i.sort((n,r)=>n.id.localeCompare(r.id)).map(n=>{return[n.id,n.title,n.location]});return{data:{headers:s,rows:o},dispose:()=>{}}}}class uT extends k{constructor(){super(...arguments);this.type="table"}shouldRender(e){return!!e.contributes?.views}render(e){const t=e.contributes?.views||{};const i=Object.keys(t).reduce((n,r)=>{const d=t[r];n.push(...d.map(l=>({...l,location:r})));return n},[]);if(!i.length){return{data:{headers:[],rows:[]},dispose:()=>{}}}const s=[c(2503,"ID"),c(2504,"Name"),c(2502,"Where")];const o=i.sort((n,r)=>n.id.localeCompare(r.id)).map(n=>{return[n.id,n.name,n.location]});return{data:{headers:s,rows:o},dispose:()=>{}}}}W.as(Kl.ExtensionFeaturesRegistry).registerExtensionFeature({id:"viewsContainers",label:c(2505,"View Containers"),access:{canToggle:false},renderer:new Q(hT)});W.as(Kl.ExtensionFeaturesRegistry).registerExtensionFeature({id:"views",label:c(2506,"Views"),access:{canToggle:false},renderer:new Q(uT)});Ci(Wr.ID,Wr,Si.BlockStartup);var dl;let cl=class IR extends Lb{constructor(e,t,i,s,o,n,r,d,l,u){super(e,t,i,s,o,n,r,l,d,u)}async setInput(e,t,i,s){await super.setInput(e,t,i,s);const o=await e.resolve();if(s.isCancellationRequested){return void 0}if(!(o instanceof Mb)){throw new Error("Unable to open file as text")}const n=Se(this.editorControl);const r=o.textEditorModel;n.setModel(r);if(!Ob(t?.viewState)){const d=this.loadEditorViewState(e,i);if(d){if(t?.selection){d.cursorState=[]}n.restoreViewState(d)}}if(t){oh(t,n,xt.Immediate)}n.updateOptions(this.getReadonlyConfiguration(o.isReadonly()))}revealLastLine(){const e=this.editorControl;if(!e){return}const t=e.getModel();if(t){const i=t.getLineCount();e.revealPosition({lineNumber:i,column:t.getLineMaxColumn(i)},xt.Smooth)}}clearInput(){super.clearInput();this.editorControl?.setModel(null)}tracksEditorViewState(e){return e instanceof Fi||e instanceof Zg}};cl=E([h(2,si),h(3,N),h(4,le),h(5,Rn),h(6,pe),h(7,qe),h(8,Y),h(9,je)],cl);let Hr=class DR extends cl{static{dl=this}static{this.ID="workbench.editors.textResourceEditor"}constructor(e,t,i,s,o,n,r,d,l,u,p){super(dl.ID,e,t,i,s,o,n,d,r,p);this.modelService=l;this.languageService=u}createEditorControl(e,t){super.createEditorControl(e,t);const i=this.editorControl;if(i){this._register(i.onDidPaste(s=>this.onDidEditorPaste(s,i)))}}onDidEditorPaste(e,t){if(this.input instanceof Fi&&this.input.hasLanguageSetExplicitly){return}if(e.range.startLineNumber!==1||e.range.startColumn!==1){return}if(t.getOption(pt.readOnly)){return}const i=t.getModel();if(!i){return}const s=i.getLineCount()===e.range.endLineNumber&&i.getLineMaxColumn(e.range.endLineNumber)===e.range.endColumn;if(!s){return}const o=i.getLanguageId();if(o!==Sr){return}let n=void 0;if(e.languageId){n={id:e.languageId,source:"event"}}else{const r=this.languageService.guessLanguageIdByFilepathOrFirstLine(i.uri,i.getLineContent(1).substr(0,Pb.FIRST_LINE_DETECTION_LENGTH_LIMIT))??void 0;if(r){n={id:r,source:"guess"}}}if(n&&n.id!==Sr){if(this.input instanceof Fi&&n.source==="event"){this.input.setLanguageId(n.id)}else{i.setLanguage(this.languageService.createById(n.id))}const r=this.modelService.getCreationOptions(i.getLanguageId(),i.uri,i.isForSimpleWidget);i.detectIndentation(r.insertSpaces,r.tabSize)}}};Hr=dl=E([h(1,si),h(2,N),h(3,le),h(4,Rn),h(5,pe),h(6,Y),h(7,qe),h(8,wa),h(9,In),h(10,je)],Hr);let Ss=class TR extends Ld{static{this.ID=Nb}constructor(e,t,i,s,o,n,r,d,l){super(e,t,i,s,o,n,r,d,l)}getMetadata(){const e=this.getPrimaryEditorPane();const t=this.getSecondaryEditorPane();if(e instanceof $s&&t instanceof $s){return c(2884,"{0} ↔ {1}",t.getMetadata(),e.getMetadata())}return void 0}};Ss=E([h(1,si),h(2,N),h(3,pe),h(4,le),h(5,X),h(6,Rn),h(7,Y),h(8,qe)],Ss);const pT=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var ll;Le(pT);class gT{constructor(e,t){this.primary=e;this.secondary=t}getEncoding(){return this.primary.getEncoding()}async setEncoding(e,t){await Yp.settled([this.primary,this.secondary].map(i=>i.setEncoding(e,t)))}}class fT{constructor(e,t){this.primary=e;this.secondary=t}setLanguageId(e,t){[this.primary,this.secondary].forEach(i=>i.setLanguageId(e,t))}}function mn(a){if(a instanceof Fi){return a}if(a instanceof Sn){const t=mn(a.primary);const i=mn(a.secondary);if(t&&i){return new gT(t,i)}return t}const e=a;if(Xb(e.setEncoding,e.getEncoding)){return e}return null}function Ur(a){if(a instanceof Fi){return a}if(a instanceof Sn){const t=Ur(a.primary);const i=Ur(a.secondary);if(t&&i){return new fT(t,i)}return t}const e=a;if(typeof e.setLanguageId==="function"){return e}return null}class mT{constructor(){this.indentation=false;this.selectionStatus=false;this.languageId=false;this.languageStatus=false;this.encoding=false;this.EOL=false;this.tabFocusMode=false;this.inputMode=false;this.columnSelectionMode=false;this.metadata=false}combine(e){this.indentation=this.indentation||e.indentation;this.selectionStatus=this.selectionStatus||e.selectionStatus;this.languageId=this.languageId||e.languageId;this.languageStatus=this.languageStatus||e.languageStatus;this.encoding=this.encoding||e.encoding;this.EOL=this.EOL||e.EOL;this.tabFocusMode=this.tabFocusMode||e.tabFocusMode;this.inputMode=this.inputMode||e.inputMode;this.columnSelectionMode=this.columnSelectionMode||e.columnSelectionMode;this.metadata=this.metadata||e.metadata}hasChanges(){return this.indentation||this.selectionStatus||this.languageId||this.languageStatus||this.encoding||this.EOL||this.tabFocusMode||this.inputMode||this.columnSelectionMode||this.metadata}}class wT{get selectionStatus(){return this._selectionStatus}get languageId(){return this._languageId}get encoding(){return this._encoding}get EOL(){return this._EOL}get indentation(){return this._indentation}get tabFocusMode(){return this._tabFocusMode}get inputMode(){return this._inputMode}get columnSelectionMode(){return this._columnSelectionMode}get metadata(){return this._metadata}update(e){const t=new mT;switch(e.type){case"selectionStatus":if(this._selectionStatus!==e.selectionStatus){this._selectionStatus=e.selectionStatus;t.selectionStatus=true}break;case"indentation":if(this._indentation!==e.indentation){this._indentation=e.indentation;t.indentation=true}break;case"languageId":if(this._languageId!==e.languageId){this._languageId=e.languageId;t.languageId=true}break;case"encoding":if(this._encoding!==e.encoding){this._encoding=e.encoding;t.encoding=true}break;case"EOL":if(this._EOL!==e.EOL){this._EOL=e.EOL;t.EOL=true}break;case"tabFocusMode":if(this._tabFocusMode!==e.tabFocusMode){this._tabFocusMode=e.tabFocusMode;t.tabFocusMode=true}break;case"inputMode":if(this._inputMode!==e.inputMode){this._inputMode=e.inputMode;t.inputMode=true}break;case"columnSelectionMode":if(this._columnSelectionMode!==e.columnSelectionMode){this._columnSelectionMode=e.columnSelectionMode;t.columnSelectionMode=true}break;case"metadata":if(this._metadata!==e.metadata){this._metadata=e.metadata;t.metadata=true}break}return t}}let hl=class AR extends k{constructor(e){super();this.configurationService=e;this._onDidChange=this._register(new _);this.onDidChange=this._onDidChange.event;this.registerListeners();const t=e.getValue("editor.tabFocusMode")===true?true:false;rd.setTabFocusMode(t)}registerListeners(){this._register(rd.onDidChangeTabFocus(e=>this._onDidChange.fire(e)));this._register(this.configurationService.onDidChangeConfiguration(e=>{if(e.affectsConfiguration("editor.tabFocusMode")){const t=this.configurationService.getValue("editor.tabFocusMode")===true?true:false;rd.setTabFocusMode(t);this._onDidChange.fire(t)}}))}};hl=E([h(0,X)],hl);class vT extends k{constructor(){super();this._onDidChange=this._register(new _);this.onDidChange=this._onDidChange.event;Ru.setInputMode("insert");this._register(Ru.onDidChangeInputMode(e=>this._onDidChange.fire(e)))}}const yT=c(3264,"Ln {0}, Col {1} ({2} selected)");const bT=c(3265,"Ln {0}, Col {1}");const CT=c(3266,"{0} selections ({1} characters selected)");const ST=c(3267,"{0} selections");const Pm=c(3268,"LF");const Lm=c(3269,"CRLF");let ul=class xR extends k{constructor(e,t,i,s,o,n,r,d){super();this.targetWindowId=e;this.editorService=t;this.quickInputService=i;this.languageService=s;this.textFileService=o;this.statusbarService=n;this.configurationService=d;this.tabFocusModeElement=this._register(new Ie);this.inputModeElement=this._register(new Ie);this.columnSelectionModeElement=this._register(new Ie);this.indentationElement=this._register(new Ie);this.selectionElement=this._register(new Ie);this.encodingElement=this._register(new Ie);this.eolElement=this._register(new Ie);this.languageElement=this._register(new Ie);this.metadataElement=this._register(new Ie);this.state=new wT;this.toRender=void 0;this.activeEditorListeners=this._register(new L);this.delayedRender=this._register(new Ie);this.currentMarkerStatus=this._register(r.createInstance(pl));this.tabFocusMode=this._register(r.createInstance(hl));this.inputMode=this._register(r.createInstance(vT));this.registerCommands();this.registerListeners()}registerListeners(){this._register(this.editorService.onDidActiveEditorChange(()=>this.updateStatusBar()));this._register(this.textFileService.untitled.onDidChangeEncoding(e=>this.onResourceEncodingChange(e.resource)));this._register(this.textFileService.files.onDidChangeEncoding(e=>this.onResourceEncodingChange(e.resource)));this._register(x.runAndSubscribe(this.tabFocusMode.onDidChange,e=>{if(e!==void 0){this.onTabFocusModeChange(e)}else{this.onTabFocusModeChange(this.configurationService.getValue("editor.tabFocusMode"))}}));this._register(x.runAndSubscribe(this.inputMode.onDidChange,e=>this.onInputModeChange(e??"insert")))}registerCommands(){this._register(Ne.registerCommand({id:`changeEditorIndentation${this.targetWindowId}`,handler:()=>this.showIndentationPicker()}))}async showIndentationPicker(){const e=Jt(this.editorService.activeTextEditorControl);if(!e){return this.quickInputService.pick([{label:c(3270,"No text editor active at this time")}])}if(this.editorService.activeEditor?.isReadonly()){return this.quickInputService.pick([{label:c(3271,"The active code editor is read-only.")}])}const t=[Se(e.getAction(Ub.ID)),Se(e.getAction(Kb.ID)),Se(e.getAction(zb.ID)),Se(e.getAction($b.ID)),Se(e.getAction(qb.ID)),Se(e.getAction(jb.ID)),Se(e.getAction(Yb.ID))].map(s=>{return{id:s.id,label:s.label,detail:Jg.isDefaultVariant()||s.label===s.alias?void 0:s.alias,run:()=>{e.focus();s.run()}}});t.splice(3,0,{type:"separator",label:c(3272,"convert file")});t.unshift({type:"separator",label:c(3273,"change view")});const i=await this.quickInputService.pick(t,{placeHolder:c(3274,"Select Action"),matchOnDetail:true});return i?.run()}updateTabFocusModeElement(e){if(e){if(!this.tabFocusModeElement.value){const t=c(3275,"Tab Moves Focus");this.tabFocusModeElement.value=this.statusbarService.addEntry({name:c(3276,"Accessibility Mode"),text:t,ariaLabel:t,tooltip:c(3277,"Disable Accessibility Mode"),command:"editor.action.toggleTabFocusMode",kind:"prominent"},"status.editor.tabFocusMode",Ke.RIGHT,100.7)}}else{this.tabFocusModeElement.clear()}}updateInputModeElement(e){if(e==="overtype"){if(!this.inputModeElement.value){const t=c(3278,"OVR");const i=c(3279,"Enable Insert Mode");this.inputModeElement.value=this.statusbarService.addEntry({name:i,text:t,ariaLabel:t,tooltip:i,command:"editor.action.toggleOvertypeInsertMode",kind:"prominent"},"status.editor.inputMode",Ke.RIGHT,100.6)}}else{this.inputModeElement.clear()}}updateColumnSelectionModeElement(e){if(e){if(!this.columnSelectionModeElement.value){const t=c(3280,"Column Selection");this.columnSelectionModeElement.value=this.statusbarService.addEntry({name:c(3281,"Column Selection Mode"),text:t,ariaLabel:t,tooltip:c(3282,"Disable Column Selection Mode"),command:"editor.action.toggleColumnSelection",kind:"prominent"},"status.editor.columnSelectionMode",Ke.RIGHT,100.8)}}else{this.columnSelectionModeElement.clear()}}updateSelectionElement(e){if(!e){this.selectionElement.clear();return}const t=Jt(this.editorService.activeTextEditorControl)?.getModel()?.uri;if(t?.scheme===fe.vscodeNotebookCell){this.selectionElement.clear();return}const i={name:c(3283,"Editor Selection"),text:e,ariaLabel:e,tooltip:c(3284,"Go to Line/Column"),command:"workbench.action.gotoLine"};this.updateElement(this.selectionElement,i,"status.editor.selection",Ke.RIGHT,100.5)}updateIndentationElement(e){if(!e){this.indentationElement.clear();return}const t=Jt(this.editorService.activeTextEditorControl)?.getModel()?.uri;if(t?.scheme===fe.vscodeNotebookCell){this.indentationElement.clear();return}const i={name:c(3285,"Editor Indentation"),text:e,ariaLabel:e,tooltip:c(3286,"Select Indentation"),command:`changeEditorIndentation${this.targetWindowId}`};this.updateElement(this.indentationElement,i,"status.editor.indentation",Ke.RIGHT,100.4)}updateEncodingElement(e){if(!e){this.encodingElement.clear();return}const t={name:c(3287,"Editor Encoding"),text:e,ariaLabel:e,tooltip:c(3288,"Select Encoding"),command:"workbench.action.editor.changeEncoding"};this.updateElement(this.encodingElement,t,"status.editor.encoding",Ke.RIGHT,100.3)}updateEOLElement(e){if(!e){this.eolElement.clear();return}const t={name:c(3289,"Editor End of Line"),text:e,ariaLabel:e,tooltip:c(3290,"Select End of Line Sequence"),command:"workbench.action.editor.changeEOL"};this.updateElement(this.eolElement,t,"status.editor.eol",Ke.RIGHT,100.2)}updateLanguageIdElement(e){if(!e){this.languageElement.clear();return}const t={name:c(3291,"Editor Language"),text:e,ariaLabel:e,tooltip:c(3292,"Select Language Mode"),command:"workbench.action.editor.changeLanguageMode"};this.updateElement(this.languageElement,t,"status.editor.mode",Ke.RIGHT,100.1)}updateMetadataElement(e){if(!e){this.metadataElement.clear();return}const t={name:c(3293,"File Information"),text:e,ariaLabel:e,tooltip:c(3294,"File Information")};this.updateElement(this.metadataElement,t,"status.editor.info",Ke.RIGHT,100)}updateElement(e,t,i,s,o){if(!e.value){e.value=this.statusbarService.addEntry(t,i,s,o)}else{e.value.update(t)}}updateState(e){const t=this.state.update(e);if(!t.hasChanges()){return}if(!this.toRender){this.toRender=t;this.delayedRender.value=Zb(ua(this.targetWindowId,true).window,()=>{this.delayedRender.clear();const i=this.toRender;this.toRender=void 0;if(i){this.doRenderNow()}})}else{this.toRender.combine(t)}}doRenderNow(){this.updateTabFocusModeElement(!!this.state.tabFocusMode);this.updateInputModeElement(this.state.inputMode);this.updateColumnSelectionModeElement(!!this.state.columnSelectionMode);this.updateIndentationElement(this.state.indentation);this.updateSelectionElement(this.state.selectionStatus);this.updateEncodingElement(this.state.encoding);this.updateEOLElement(this.state.EOL?this.state.EOL==="\r\n"?Lm:Pm:void 0);this.updateLanguageIdElement(this.state.languageId);this.updateMetadataElement(this.state.metadata)}getSelectionLabel(e){if(!e||!e.selections){return void 0}if(e.selections.length===1){if(e.charactersSelected){return Mo(yT,e.selections[0].positionLineNumber,e.selections[0].positionColumn,e.charactersSelected)}return Mo(bT,e.selections[0].positionLineNumber,e.selections[0].positionColumn)}if(e.charactersSelected){return Mo(CT,e.selections.length,e.charactersSelected)}if(e.selections.length>0){return Mo(ST,e.selections.length)}return void 0}updateStatusBar(){const e=this.editorService.activeEditor;const t=this.editorService.activeEditorPane;const i=t?Jt(t.getControl())??void 0:void 0;this.onColumnSelectionModeChange(i);this.onSelectionChange(i);this.onLanguageChange(i,e);this.onEOLChange(i);this.onEncodingChange(t,i);this.onIndentationChange(i);this.onMetadataChange(t);this.currentMarkerStatus.update(i);this.activeEditorListeners.clear();if(t){this.activeEditorListeners.add(t.onDidChangeControl(()=>{this.updateStatusBar()}))}if(i){this.activeEditorListeners.add(i.onDidChangeConfiguration(s=>{if(s.hasChanged(pt.columnSelection)){this.onColumnSelectionModeChange(i)}}));this.activeEditorListeners.add(x.defer(i.onDidChangeCursorPosition)(()=>{this.onSelectionChange(i);this.currentMarkerStatus.update(i)}));this.activeEditorListeners.add(i.onDidChangeModelLanguage(()=>{this.onLanguageChange(i,e)}));this.activeEditorListeners.add(x.accumulate(i.onDidChangeModelContent)(s=>{this.onEOLChange(i);this.currentMarkerStatus.update(i);const o=i.getSelections();if(o){for(const n of s){for(const r of n.changes){if(o.some(d=>me.areIntersecting(d,r.range))){this.onSelectionChange(i);break}}}}}));this.activeEditorListeners.add(i.onDidChangeModelOptions(()=>{this.onIndentationChange(i)}))}else if(t instanceof $s||t instanceof Ss){const s=[];if(t instanceof Ss){const o=t.getPrimaryEditorPane();if(o instanceof $s){s.push(o)}const n=t.getSecondaryEditorPane();if(n instanceof $s){s.push(n)}}else{s.push(t)}for(const o of s){this.activeEditorListeners.add(o.onDidChangeMetadata(()=>{this.onMetadataChange(t)}));this.activeEditorListeners.add(o.onDidOpenInPlace(()=>{this.updateStatusBar()}))}}}onLanguageChange(e,t){const i={type:"languageId",languageId:void 0};if(e&&t&&Ur(t)){const s=e.getModel();if(s){const o=s.getLanguageId();i.languageId=this.languageService.getLanguageName(o)??void 0}}this.updateState(i)}onIndentationChange(e){const t={type:"indentation",indentation:void 0};if(e){const i=e.getModel();if(i){const s=i.getOptions();t.indentation=s.insertSpaces?s.tabSize===s.indentSize?c(3295,"Spaces: {0}",s.indentSize):c(3296,"Spaces: {0} (Tab Size: {1})",s.indentSize,s.tabSize):c(3297,"Tab Size: {0}",s.tabSize)}}this.updateState(t)}onMetadataChange(e){const t={type:"metadata",metadata:void 0};if(e instanceof $s||e instanceof Ss){t.metadata=e.getMetadata()}this.updateState(t)}onColumnSelectionModeChange(e){const t={type:"columnSelectionMode",columnSelectionMode:false};if(e?.getOption(pt.columnSelection)){t.columnSelectionMode=true}this.updateState(t)}onSelectionChange(e){const t=Object.create(null);if(e){t.selections=e.getSelections()||[];t.charactersSelected=0;const i=e.getModel();if(i){for(const s of t.selections){if(typeof t.charactersSelected!=="number"){t.charactersSelected=0}t.charactersSelected+=i.getCharacterCountInRange(s)}}if(t.selections.length===1){const s=e.getPosition();const o=new Xg(t.selections[0].selectionStartLineNumber,t.selections[0].selectionStartColumn,t.selections[0].positionLineNumber,s?e.getStatusbarColumn(s):t.selections[0].positionColumn);t.selections[0]=o}}this.updateState({type:"selectionStatus",selectionStatus:this.getSelectionLabel(t)})}onEOLChange(e){const t={type:"EOL",EOL:void 0};if(e&&!e.getOption(pt.readOnly)){const i=e.getModel();if(i){t.EOL=i.getEOL()}}this.updateState(t)}onEncodingChange(e,t){if(e&&!this.isActiveEditor(e)){return}const i={type:"encoding",encoding:void 0};if(e&&t?.hasModel()){const s=e.input?mn(e.input):null;if(s){const o=s.getEncoding();const n=typeof o==="string"?Ti[o]:void 0;if(n){i.encoding=n.labelShort}else{i.encoding=o}}}this.updateState(i)}onResourceEncodingChange(e){const t=this.editorService.activeEditorPane;if(t){const i=vt.getCanonicalUri(t.input,{supportSideBySide:ui.PRIMARY});if(i&&vi(i,e)){const s=Jt(t.getControl())??void 0;return this.onEncodingChange(t,s)}}}onTabFocusModeChange(e){const t={type:"tabFocusMode",tabFocusMode:e};this.updateState(t)}onInputModeChange(e){const t={type:"inputMode",inputMode:e};this.updateState(t)}isActiveEditor(e){const t=this.editorService.activeEditorPane;return!!t&&t===e}};ul=E([h(1,Y),h(2,kt),h(3,In),h(4,fa),h(5,ss),h(6,N),h(7,X)],ul);let Kr=class RR extends k{static{this.ID="workbench.contrib.editorStatus"}constructor(e){super();this.editorGroupService=e;for(const t of e.parts){this.createEditorStatus(t)}this._register(e.onDidCreateAuxiliaryEditorPart(t=>this.createEditorStatus(t)))}createEditorStatus(e){const t=new L;x.once(e.onWillDispose)(()=>t.dispose());const i=this.editorGroupService.getScopedInstantiationService(e);t.add(i.createInstance(ul,e.windowId))}};Kr=E([h(0,qe)],Kr);let pl=class VR extends k{constructor(e,t,i){super();this.statusbarService=e;this.markerService=t;this.configurationService=i;this.editor=void 0;this.markers=[];this.currentMarker=null;this.statusBarEntryAccessor=this._register(new Ie);this._register(t.onMarkerChanged(s=>this.onMarkerChanged(s)));this._register(x.filter(i.onDidChangeConfiguration,s=>s.affectsConfiguration("problems.showCurrentInStatus"))(()=>this.updateStatus()))}update(e){this.editor=e;this.updateMarkers();this.updateStatus()}updateStatus(){const e=this.currentMarker;this.currentMarker=this.getMarker();if(this.hasToUpdateStatus(e,this.currentMarker)){if(this.currentMarker){const t=Jb(this.currentMarker.message)[0];const i=`${this.getType(this.currentMarker)} ${t}`;if(!this.statusBarEntryAccessor.value){this.statusBarEntryAccessor.value=this.statusbarService.addEntry({name:c(3298,"Current Problem"),text:i,ariaLabel:i},"statusbar.currentProblem",Ke.LEFT)}else{this.statusBarEntryAccessor.value.update({name:c(3298,"Current Problem"),text:i,ariaLabel:i})}}else{this.statusBarEntryAccessor.clear()}}}hasToUpdateStatus(e,t){if(!t){return true}if(!e){return true}return xu.makeKey(e)!==xu.makeKey(t)}getType(e){switch(e.severity){case cs.Error:return"$(error)";case cs.Warning:return"$(warning)";case cs.Info:return"$(info)"}return""}getMarker(){if(!this.configurationService.getValue("problems.showCurrentInStatus")){return null}if(!this.editor){return null}const e=this.editor.getModel();if(!e){return null}const t=this.editor.getPosition();if(!t){return null}return this.markers.find(i=>me.containsPosition(i,t))||null}onMarkerChanged(e){if(!this.editor){return}const t=this.editor.getModel();if(!t){return}if(t&&!e.some(i=>vi(t.uri,i))){return}this.updateMarkers()}updateMarkers(){if(!this.editor){return}const e=this.editor.getModel();if(!e){return}if(e){this.markers=this.markerService.read({resource:e.uri,severities:cs.Error|cs.Warning|cs.Info});this.markers.sort(this.compareMarker)}else{this.markers=[]}this.updateStatus()}compareMarker(e,t){let i=ya(e.resource.toString(),t.resource.toString());if(i===0){i=cs.compare(e.severity,t.severity)}if(i===0){i=me.compareRangesUsingStarts(e,t)}return i}};pl=E([h(0,ss),h(1,Bb),h(2,X)],pl);let gl=class kR extends ti{static{ll=this}static{this.ID="workbench.action.showLanguageExtensions"}constructor(e,t,i){super(ll.ID,c(3299,"Search Marketplace Extensions for '{0}'...",e));this.fileExtension=e;this.commandService=t;this.enabled=i.isEnabled()}async run(){await this.commandService.executeCommand("workbench.extensions.action.showExtensionsForLanguage",this.fileExtension)}};gl=ll=E([h(1,bi),h(2,Fb)],gl);class zr extends j{static{this.ID="workbench.action.editor.changeLanguageMode"}constructor(){super({id:zr.ID,title:I(3300,"Change Language Mode"),f1:true,keybinding:{weight:B.WorkbenchContrib,primary:Bg(O.CtrlCmd|T.KeyK,T.KeyM)},precondition:S.not("notebookEditorFocused"),metadata:{description:c(3301,"Change the language mode of the active text editor."),args:[{name:c(3302,"The name of the language mode to change to."),constraint:e=>typeof e==="string"}]}})}async run(e,t){const i=e.get(kt);const s=e.get(Y);const o=e.get(In);const n=e.get(Gb);const r=e.get(fa);const d=e.get(ih);const l=e.get(N);const u=e.get(X);const p=e.get(si);const f=Jt(s.activeTextEditorControl);if(!f){await i.pick([{label:c(3270,"No text editor active at this time")}]);return}const g=f.getModel();const m=vt.getOriginalUri(s.activeEditor,{supportSideBySide:ui.PRIMARY});let y;let C;if(g){C=g.getLanguageId();y=o.getLanguageName(C)??void 0}let D=!!m;if(m?.scheme===fe.untitled&&!r.untitled.get(m)?.hasAssociatedFilePath){D=false}const F=o.getSortedRegisteredLanguageNames();const P=F.map(({languageName:qt,languageId:_t})=>{const as=o.getExtensions(_t).join(" ");let lt;if(y===qt){lt=c(3303,"({0}) - Configured Language",_t)}else{lt=c(3304,"({0})",_t)}return{label:qt,meta:as,iconClasses:Tu(_t),description:lt}});P.unshift({type:"separator",label:c(3305,"languages (identifier)")});let R;let z;let H;if(D&&m){const qt=hi(m)||Oi(m);H=l.createInstance(gl,qt);if(H.enabled){P.unshift(H)}z={label:c(3306,"Configure '{0}' language based settings...",y)};P.unshift(z);R={label:c(3307,"Configure File Association for '{0}'...",qt)};P.unshift(R)}const Z={label:c(3308,"Auto Detect")};P.unshift(Z);const ie=typeof t==="string"?{label:t}:await i.pick(P,{placeHolder:c(3309,"Select Language Mode"),matchOnDescription:true});if(!ie){return}if(ie===H){H.run();return}if(ie===R){if(m){this.configureFileAssociation(m,o,i,u)}return}if(ie===z){d.openUserSettings({jsonEditor:true,revealSetting:{key:`[${C??null}]`,edit:true}});return}const Ye=s.activeEditor;if(Ye){const qt=Ur(Ye);if(qt){let _t;let as;if(ie===Z){if(g){const lt=vt.getOriginalUri(Ye,{supportSideBySide:ui.PRIMARY});if(lt){let Pt=o.guessLanguageIdByFilepathOrFirstLine(lt,g.getLineContent(1))??void 0;if(!Pt||Pt==="unknown"){as=await n.detectLanguage(lt);Pt=as}if(Pt){_t=o.createById(Pt)}}}}else{const lt=o.getLanguageIdByLanguageName(ie.label);_t=o.createById(lt);if(m){n.detectLanguage(m).then(Pt=>{const Ze=o.getLanguageIdByLanguageName(ie.label)||"unknown";if(Pt===C&&C!==Ze){const Um=u.getValue("workbench.editor.preferHistoryBasedLanguageDetection")?"history":"classic";p.publicLog2(Wb,{currentLanguageId:y??"unknown",nextLanguageId:ie.label,lineCount:g?.getLineCount()??-1,modelPreference:Um})}})}}if(typeof _t!=="undefined"){qt.setLanguageId(_t.languageId,zr.ID);if(m?.scheme===fe.untitled){const lt=u.getValue("workbench.editor.preferHistoryBasedLanguageDetection")?"history":"classic";p.publicLog2("setUntitledDocumentLanguage",{to:_t.languageId,from:C??"none",modelPreference:lt})}}}f.focus()}}configureFileAssociation(e,t,i,s){const o=hi(e);const n=Oi(e);const r=t.guessLanguageIdByFilepathOrFirstLine(K.file(n));const d=t.getSortedRegisteredLanguageNames();const l=d.map(({languageName:u,languageId:p})=>{return{id:p,label:u,iconClasses:Tu(p),description:p===r?c(3310,"Current Association"):void 0}});setTimeout(async()=>{const u=await i.pick(l,{placeHolder:c(3311,"Select Language Mode to Associate with '{0}'",o||n)});if(u){const p=s.inspect(Au);let f;if(o&&n[0]!=="."){f=`*${o}`}else{f=n}let g=vs.USER;if(p.workspaceValue&&!!p.workspaceValue[f]){g=vs.WORKSPACE}const m=Hb(g===vs.WORKSPACE?p.workspaceValue:p.userValue)||Object.create(null);m[f]=u.id;s.updateValue(Au,m,g)}},50)}}class _T extends j{constructor(){super({id:"workbench.action.editor.changeEOL",title:I(3312,"Change End of Line Sequence"),f1:true})}async run(e){const t=e.get(Y);const i=e.get(kt);const s=Jt(t.activeTextEditorControl);if(!s){await i.pick([{label:c(3270,"No text editor active at this time")}]);return}if(t.activeEditor?.isReadonly()){await i.pick([{label:c(3271,"The active code editor is read-only.")}]);return}let o=s.getModel();const n=[{label:Pm,eol:Vu.LF},{label:Lm,eol:Vu.CRLF}];const r=o?.getEOL()==="\n"?0:1;const d=await i.pick(n,{placeHolder:c(3313,"Select End of Line Sequence"),activeItem:n[r]});if(d){const l=Jt(t.activeTextEditorControl);if(l?.hasModel()&&!t.activeEditor?.isReadonly()){o=l.getModel();o.pushStackElement();o.pushEOL(d.eol);o.pushStackElement()}}s.focus()}}class ET extends j{constructor(){super({id:"workbench.action.editor.changeEncoding",title:I(3314,"Change File Encoding"),f1:true})}async run(e){const t=e.get(Y);const i=e.get(kt);const s=e.get(je);const o=e.get(fa);const n=e.get(Rn);const r=Jt(t.activeTextEditorControl);if(!r){await i.pick([{label:c(3270,"No text editor active at this time")}]);return}const d=t.activeEditorPane;if(!d){await i.pick([{label:c(3270,"No text editor active at this time")}]);return}const l=mn(d.input);if(!l){await i.pick([{label:c(3315,"No file active at this time")}]);return}const u={label:c(3316,"Save with Encoding")};const p={label:c(3317,"Reopen with Encoding")};if(!Jg.isDefaultVariant()){const Z="Save with Encoding";if(Z!==u.label){u.detail=Z}const ie="Reopen with Encoding";if(ie!==p.label){p.detail=ie}}let f;if(l instanceof Fi){f=u}else if(d.input.isReadonly()){f=p}else{f=await i.pick([p,u],{placeHolder:c(3274,"Select Action"),matchOnDetail:true})}if(!f){return}await rn(50);const g=vt.getOriginalUri(d.input,{supportSideBySide:ui.PRIMARY});if(!g||!s.hasProvider(g)&&g.scheme!==fe.untitled){return}let m=void 0;if(s.hasProvider(g)){const Z=await o.readStream(g,{autoGuessEncoding:true,candidateGuessEncodings:n.getValue(g,"files.candidateGuessEncodings")});m=Z.encoding}const y=f===p;const C=n.getValue(g,"files.encoding");let D;let F;const P=Object.keys(Ti).sort((Z,ie)=>{if(Z===C){return-1}else if(ie===C){return 1}return Ti[Z].order-Ti[ie].order}).filter(Z=>{if(Z===m&&m!==C){return false}return!y||!Ti[Z].encodeOnly}).map((Z,ie)=>{if(Z===l.getEncoding()){D=ie}else if(Ti[Z].alias===l.getEncoding()){F=ie}return{id:Z,label:Ti[Z].labelLong,description:Z}});const R=P.slice();if(m&&C!==m&&Ti[m]){P.unshift({type:"separator"});P.unshift({id:m,label:Ti[m].labelLong,description:c(3318,"Guessed from content")})}const z=await i.pick(P,{placeHolder:y?c(3319,"Select File Encoding to Reopen File"):c(3320,"Select File Encoding to Save with"),activeItem:R[typeof D==="number"?D:typeof F==="number"?F:-1]});if(!z){return}if(!t.activeEditorPane){return}const H=mn(t.activeEditorPane.input);if(typeof z.id!=="undefined"&&H){await H.setEncoding(z.id,y?ku.Decode:ku.Encode)}r.focus()}}let fl=class PR{constructor(e,t,i){this.filesConfigurationService=e;this.environmentService=t;this.pathService=i}canSerialize(e){return this.filesConfigurationService.isHotExitEnabled&&!e.isDisposed()}serialize(e){if(!this.canSerialize(e)){return void 0}const t=e;let i=t.resource;if(t.hasAssociatedFilePath){i=Qg(i,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme)}let s;const o=t.getLanguageId();if(o!==Sr){s=o}else if(t.hasLanguageSetExplicitly){s=o}const n={resourceJSON:i.toJSON(),modeId:s,encoding:t.getEncoding()};return JSON.stringify(n)}deserialize(e,t){return e.invokeFunction(i=>{const s=JSON.parse(t);const o=K.revive(s.resourceJSON);const n=s.modeId;const r=s.encoding;return i.get(nh).createTextEditor({resource:o,languageId:n,encoding:r,forceUntitled:true})})}};fl=E([h(0,Qb),h(1,Qt),h(2,Wl)],fl);let $r=class LR extends k{static{this.ID="workbench.contrib.untitledTextEditorWorkingCopyEditorHandler"}constructor(e,t,i,s,o){super();this.environmentService=t;this.pathService=i;this.textEditorService=s;this.untitledTextEditorService=o;this._register(e.registerHandler(this))}handles(e){return e.resource.scheme===fe.untitled&&e.typeId===eC}isOpen(e,t){if(!this.handles(e)){return false}return t instanceof Fi&&vi(e.resource,t.resource)}createEditor(e){let t;if(this.untitledTextEditorService.isUntitledWithAssociatedResource(e.resource)){t=Qg(e.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme)}else{t=e.resource}return this.textEditorService.createTextEditor({resource:t,forceUntitled:true})}};$r=E([h(0,ef),h(1,Qt),h(2,Wl),h(3,nh),h(4,tf)],$r);var Us;let qr=class MR extends k{static{Us=this}static{this.ID="workbench.contrib.dynamicEditorConfigurations"}static{this.AUTO_LOCK_DEFAULT_ENABLED=new Set(["terminalEditor","mainThreadWebview-simpleBrowser.view","mainThreadWebview-browserPreview","workbench.editor.chatSession"])}static{this.AUTO_LOCK_EXTRA_EDITORS=[{id:"workbench.input.interactive",label:c(3218,"Interactive Window"),priority:be.builtin},{id:"mainThreadWebview-markdown.preview",label:c(3219,"Markdown Preview"),priority:be.builtin},{id:"mainThreadWebview-simpleBrowser.view",label:c(3220,"Simple Browser"),priority:be.builtin},{id:"mainThreadWebview-browserPreview",label:c(3221,"Live Preview"),priority:be.builtin}]}static{this.AUTO_LOCK_REMOVE_EDITORS=new Set(["vscode-interactive-input","interactive","vscode.markdown.preview.editor"])}constructor(e,t,i){super();this.editorResolverService=e;this.environmentService=i;this.configurationRegistry=W.as(Co.Configuration);(async()=>{await t.whenInstalledExtensionsRegistered();this.updateDynamicEditorConfigurations();this.registerListeners()})()}registerListeners(){this._register(x.debounce(this.editorResolverService.onDidChangeEditorRegistrations,(e,t)=>t)(()=>this.updateDynamicEditorConfigurations()))}updateDynamicEditorConfigurations(){const e=[...this.editorResolverService.getEditors(),...Us.AUTO_LOCK_EXTRA_EDITORS].filter(l=>!Us.AUTO_LOCK_REMOVE_EDITORS.has(l.id));const t=this.editorResolverService.getEditors().filter(l=>l.priority!==be.exclusive).map(l=>l.id);const i=Object.create(null);for(const l of e){i[l.id]={type:"boolean",default:Us.AUTO_LOCK_DEFAULT_ENABLED.has(l.id),description:l.label}}const s=Object.create(null);for(const l of e){s[l.id]=Us.AUTO_LOCK_DEFAULT_ENABLED.has(l.id)}const o=this.autoLockConfigurationNode;this.autoLockConfigurationNode={...No,properties:{"workbench.editor.autoLockGroups":{type:"object",description:c(3222,"If an editor matching one of the listed types is opened as the first in an editor group and more than one group is open, the group is automatically locked. Locked groups will only be used for opening editors when explicitly chosen by a user gesture (for example drag and drop), but not by default. Consequently, the active editor in a locked group is less likely to be replaced accidentally with a different editor."),properties:i,default:s,additionalProperties:false}}};const n=this.defaultBinaryEditorConfigurationNode;this.defaultBinaryEditorConfigurationNode={...No,properties:{"workbench.editor.defaultBinaryEditor":{type:"string",default:"",enum:[...t,""],description:c(3223,"The default editor for files detected as binary. If undefined, the user will be presented with a picker.")}}};const r=this.editorAssociationsConfigurationNode;this.editorAssociationsConfigurationNode={...No,properties:{"workbench.editorAssociations":{type:"object",markdownDescription:c(3224,'Configure [glob patterns](https://aka.ms/vscode-glob-patterns) to editors (for example `"*.hex": "hexEditor.hexedit"`). These have precedence over the default behavior.'),patternProperties:{".*":{type:"string",enum:t}}}}};const d=this.editorLargeFileConfirmationConfigurationNode;this.editorLargeFileConfirmationConfigurationNode={...No,properties:{"workbench.editorLargeFileConfirmation":{type:"number",default:iC(this.environmentService.remoteAuthority)/sC.MB,minimum:1,scope:tC.RESOURCE,markdownDescription:c(3225,"Controls the minimum size of a file in MB before asking for confirmation when opening in the editor. Note that this setting may not apply to all editor types and environments.")}}};this.configurationRegistry.updateConfigurations({add:[this.autoLockConfigurationNode,this.defaultBinaryEditorConfigurationNode,this.editorAssociationsConfigurationNode,this.editorLargeFileConfirmationConfigurationNode],remove:ts([o,n,r,d])})}};qr=Us=E([h(0,la),h(1,Kt),h(2,Qt)],qr);W.as(Ct.EditorPane).registerEditorPane(Ni.create(Hr,Hr.ID,c(2946,"Text Editor")),[new Q(Fi),new Q(Zg)]);W.as(Ct.EditorPane).registerEditorPane(Ni.create(Pu,Pu.ID,c(2947,"Text Diff Editor")),[new Q(ca)]);W.as(Ct.EditorPane).registerEditorPane(Ni.create(Ss,Ss.ID,c(2948,"Binary Diff Editor")),[new Q(ca)]);W.as(Ct.EditorPane).registerEditorPane(Ni.create(Ld,Ld.ID,c(2949,"Side by Side Editor")),[new Q(Sn)]);W.as(Ct.EditorFactory).registerEditorSerializer(Fi.ID,fl);W.as(Ct.EditorFactory).registerEditorSerializer(Sn.ID,oC);W.as(Ct.EditorFactory).registerEditorSerializer(ca.ID,nC);Ci(Kr.ID,Kr,Si.BlockRestore);Ci($r.ID,$r,Si.BlockRestore);Ci(qr.ID,qr,Si.BlockRestore);Zl(Lu.ID,Lu,Jl.AfterFirstRender);const _h=W.as(rC.Quickaccess);const Wa="inEditorsPicker";const Mm=S.and(aC,S.has(Wa));_h.registerQuickAccessProvider({ctor:Mu,prefix:Mu.PREFIX,contextKey:Wa,placeholder:c(2950,"Type the name of an editor to open it."),helpEntries:[{description:c(2951,"Show Editors in Active Group by Most Recently Used"),commandId:sf.ID}]});_h.registerQuickAccessProvider({ctor:Ou,prefix:Ou.PREFIX,contextKey:Wa,placeholder:c(2950,"Type the name of an editor to open it."),helpEntries:[{description:c(2952,"Show All Opened Editors By Appearance"),commandId:of.ID}]});_h.registerQuickAccessProvider({ctor:Nu,prefix:Nu.PREFIX,contextKey:Wa,placeholder:c(2950,"Type the name of an editor to open it."),helpEntries:[{description:c(2953,"Show All Opened Editors By Most Recently Used"),commandId:nf.ID}]});v(zr);v(_T);v(ET);v(Md);v(Od);v(dC);v(cC);v(lC);v(hC);v(uC);v(pC);v(gC);v(fC);v(mC);v(wC);v(rf);v(af);v(of);v(nf);v(sf);v(vC);v(yC);v(bC);v(CC);v(SC);v(_C);v(EC);v(IC);v(DC);v(TC);v(AC);v(xC);v(RC);v(VC);v(kC);v(PC);v(LC);v(MC);v(OC);v(NC);v(BC);v(FC);v(GC);v(WC);v(HC);v(UC);v(KC);v(zC);v($C);v(qC);v(jC);v(YC);v(ZC);v(JC);v(XC);v(QC);v(eS);v(tS);v(iS);v(sS);v(oS);v(nS);v(rS);v(aS);v(dS);v(cS);v(lS);v(hS);v(uS);v(pS);v(gS);v(fS);v(mS);v(wS);v(vS);v(yS);v(bS);v(CS);v(SS);v(_S);v(ES);v(IS);v(DS);v(TS);v(AS);v(xS);v(RS);v(VS);v(kS);v(PS);v(df);v(cf);v(lf);v(hf);v(uf);v(pf);v(gf);v(ff);v(LS);v(MS);v(OS);v(NS);v(BS);v(FS);v(GS);v(WS);v(HS);v(US);v(KS);v(zS);v($S);const bp="workbench.action.quickOpenNavigateNextInEditorPicker";te.registerCommandAndKeybindingRule({id:bp,weight:B.WorkbenchContrib+50,handler:mf(bp,true),when:Mm,primary:O.CtrlCmd|T.Tab,mac:{primary:O.WinCtrl|T.Tab}});const Cp="workbench.action.quickOpenNavigatePreviousInEditorPicker";te.registerCommandAndKeybindingRule({id:Cp,weight:B.WorkbenchContrib+50,handler:mf(Cp,false),when:Mm,primary:O.CtrlCmd|O.Shift|T.Tab,mac:{primary:O.WinCtrl|O.Shift|T.Tab}});qS();if(mt){b.appendMenuItem(w.TouchBarContext,{command:{id:Od.ID,title:Od.LABEL,icon:{dark:Ko.asFileUri("vs/workbench/browser/parts/editor/media/back-tb.png")}},group:"navigation",order:0});b.appendMenuItem(w.TouchBarContext,{command:{id:Md.ID,title:Md.LABEL,icon:{dark:Ko.asFileUri("vs/workbench/browser/parts/editor/media/forward-tb.png")}},group:"navigation",order:1})}b.appendMenuItem(w.EmptyEditorGroup,{command:{id:wf,title:c(2954,"Lock Group"),icon:A.unlock},group:"navigation",order:10,when:S.and(vo,_o.toNegated())});b.appendMenuItem(w.EmptyEditorGroup,{command:{id:vf,title:c(2955,"Unlock Group"),icon:A.lock,toggled:S.true()},group:"navigation",order:10,when:_o});b.appendMenuItem(w.EmptyEditorGroup,{command:{id:yf,title:c(2956,"Close Group"),icon:A.close},group:"navigation",order:20,when:S.or(vo,Vl)});b.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:Da,title:c(2957,"Split Up")},group:"2_split",order:10});b.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:Vn,title:c(2958,"Split Down")},group:"2_split",order:20});b.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:Ta,title:c(2959,"Split Left")},group:"2_split",order:30});b.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:kn,title:c(2960,"Split Right")},group:"2_split",order:40});b.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:jS,title:c(2961,"New Window")},group:"3_window",order:10});b.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:bf,title:c(2962,"Lock Group"),toggled:_o},group:"4_lock",order:10,when:vo.toNegated()});b.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:yf,title:c(2963,"Close")},group:"5_close",order:10,when:ri});b.appendMenuItem(w.EditorTabsBarContext,{command:{id:Da,title:c(2957,"Split Up")},group:"2_split",order:10});b.appendMenuItem(w.EditorTabsBarContext,{command:{id:Vn,title:c(2958,"Split Down")},group:"2_split",order:20});b.appendMenuItem(w.EditorTabsBarContext,{command:{id:Ta,title:c(2959,"Split Left")},group:"2_split",order:30});b.appendMenuItem(w.EditorTabsBarContext,{command:{id:kn,title:c(2960,"Split Right")},group:"2_split",order:40});b.appendMenuItem(w.EditorTabsBarContext,{command:{id:YS,title:c(2964,"Move into New Window")},group:"3_window",order:10});b.appendMenuItem(w.EditorTabsBarContext,{command:{id:ZS,title:c(2965,"Copy into New Window")},group:"3_window",order:20});b.appendMenuItem(w.EditorTabsBarContext,{submenu:w.EditorTabsBarShowTabsSubmenu,title:c(2966,"Tab Bar"),group:"4_config",order:10,when:Cf.negate()});b.appendMenuItem(w.EditorTabsBarShowTabsSubmenu,{command:{id:JS.ID,title:c(2967,"Multiple Tabs"),toggled:S.equals("config.workbench.editor.showTabs","multiple")},group:"1_config",order:10});b.appendMenuItem(w.EditorTabsBarShowTabsSubmenu,{command:{id:XS.ID,title:c(2968,"Single Tab"),toggled:S.equals("config.workbench.editor.showTabs","single")},group:"1_config",order:20});b.appendMenuItem(w.EditorTabsBarShowTabsSubmenu,{command:{id:QS.ID,title:c(2969,"Hidden"),toggled:S.equals("config.workbench.editor.showTabs","none")},group:"1_config",order:30});b.appendMenuItem(w.EditorTabsBarContext,{submenu:w.EditorTabsBarShowTabsZenModeSubmenu,title:c(2966,"Tab Bar"),group:"4_config",order:10,when:Cf});b.appendMenuItem(w.EditorTabsBarShowTabsZenModeSubmenu,{command:{id:e_.ID,title:c(2967,"Multiple Tabs"),toggled:S.equals("config.zenMode.showTabs","multiple")},group:"1_config",order:10});b.appendMenuItem(w.EditorTabsBarShowTabsZenModeSubmenu,{command:{id:t_.ID,title:c(2968,"Single Tab"),toggled:S.equals("config.zenMode.showTabs","single")},group:"1_config",order:20});b.appendMenuItem(w.EditorTabsBarShowTabsZenModeSubmenu,{command:{id:i_.ID,title:c(2969,"Hidden"),toggled:S.equals("config.zenMode.showTabs","none")},group:"1_config",order:30});b.appendMenuItem(w.EditorTabsBarContext,{submenu:w.EditorActionsPositionSubmenu,title:c(2970,"Editor Actions Position"),group:"4_config",order:20});b.appendMenuItem(w.EditorActionsPositionSubmenu,{command:{id:s_.ID,title:c(2966,"Tab Bar"),toggled:S.equals("config.workbench.editor.editorActionsLocation","default")},group:"1_config",order:10,when:S.equals("config.workbench.editor.showTabs","none").negate()});b.appendMenuItem(w.EditorActionsPositionSubmenu,{command:{id:o_.ID,title:c(2971,"Title Bar"),toggled:S.or(S.equals("config.workbench.editor.editorActionsLocation","titleBar"),S.and(S.equals("config.workbench.editor.showTabs","none"),S.equals("config.workbench.editor.editorActionsLocation","default")))},group:"1_config",order:20});b.appendMenuItem(w.EditorActionsPositionSubmenu,{command:{id:n_.ID,title:c(2972,"Hidden"),toggled:S.equals("config.workbench.editor.editorActionsLocation","hidden")},group:"1_config",order:30});b.appendMenuItem(w.EditorTabsBarContext,{command:{id:r_.ID,title:c(2973,"Configure Tabs")},group:"9_configure",order:10});b.appendMenuItem(w.EditorTitleContext,{command:{id:Eo,title:c(2963,"Close")},group:"1_close",order:10});b.appendMenuItem(w.EditorTitleContext,{command:{id:Sf,title:c(2974,"Close Others"),precondition:a_.notEqualsTo("1")},group:"1_close",order:20});b.appendMenuItem(w.EditorTitleContext,{command:{id:_f,title:c(2975,"Close to the Right"),precondition:S.and(Ef.toNegated(),Aa.negate())},group:"1_close",order:30,when:Pn});b.appendMenuItem(w.EditorTitleContext,{command:{id:rh,title:c(2976,"Close Saved")},group:"1_close",order:40});b.appendMenuItem(w.EditorTitleContext,{command:{id:Ln,title:c(2977,"Close All")},group:"1_close",order:50});b.appendMenuItem(w.EditorTitleContext,{command:{id:Df,title:c(2978,"Reopen Editor With...")},group:"1_open",order:10,when:If});b.appendMenuItem(w.EditorTitleContext,{command:{id:Tf,title:c(2979,"Keep Open"),precondition:d_.toNegated()},group:"3_preview",order:10,when:S.has("config.workbench.editor.enablePreview")});b.appendMenuItem(w.EditorTitleContext,{command:{id:Af,title:c(2980,"Pin")},group:"3_preview",order:20,when:Io.toNegated()});b.appendMenuItem(w.EditorTitleContext,{command:{id:xa,title:c(2981,"Unpin")},group:"3_preview",order:20,when:Io});b.appendMenuItem(w.EditorTitleContext,{command:{id:Da,title:c(2957,"Split Up")},group:"5_split",order:10});b.appendMenuItem(w.EditorTitleContext,{command:{id:Vn,title:c(2958,"Split Down")},group:"5_split",order:20});b.appendMenuItem(w.EditorTitleContext,{command:{id:Ta,title:c(2959,"Split Left")},group:"5_split",order:30});b.appendMenuItem(w.EditorTitleContext,{command:{id:kn,title:c(2960,"Split Right")},group:"5_split",order:40});b.appendMenuItem(w.EditorTitleContext,{command:{id:Rf,title:c(2982,"Split in Group"),precondition:Aa.negate()},group:"6_split_in_group",order:10,when:xf});b.appendMenuItem(w.EditorTitleContext,{command:{id:Vf,title:c(2983,"Join in Group"),precondition:Aa.negate()},group:"6_split_in_group",order:10,when:Mn});b.appendMenuItem(w.EditorTitleContext,{command:{id:kf,title:c(2984,"Move into New Window")},group:"7_new_window",order:10});b.appendMenuItem(w.EditorTitleContext,{command:{id:Pf,title:c(2985,"Copy into New Window")},group:"7_new_window",order:20});b.appendMenuItem(w.EditorTitleContext,{submenu:w.EditorTitleContextShare,title:c(2986,"Share"),group:"11_share",order:-1,when:Aa.negate()});b.appendMenuItem(w.EditorTitle,{command:{id:c_,title:c(2987,"Inline View"),toggled:S.equals("config.diffEditor.renderSideBySide",false)},group:"1_diff",order:10,when:S.has("isInDiffEditor")});b.appendMenuItem(w.EditorTitle,{command:{id:l_,title:c(2988,"Show Opened Editors")},group:"3_open",order:10});b.appendMenuItem(w.EditorTitle,{command:{id:Ln,title:c(2977,"Close All")},group:"5_close",order:10});b.appendMenuItem(w.EditorTitle,{command:{id:rh,title:c(2976,"Close Saved")},group:"5_close",order:20});b.appendMenuItem(w.EditorTitle,{command:{id:h_,title:c(2989,"Enable Preview Editors"),toggled:S.has("config.workbench.editor.enablePreview")},group:"7_settings",order:10});b.appendMenuItem(w.EditorTitle,{command:{id:Lf,title:c(2990,"Maximize Group")},group:"8_group_operations",order:5,when:S.and(kl.negate(),Vl)});b.appendMenuItem(w.EditorTitle,{command:{id:Lf,title:c(2991,"Unmaximize Group")},group:"8_group_operations",order:5,when:kl});b.appendMenuItem(w.EditorTitle,{command:{id:bf,title:c(2992,"Lock Group"),toggled:_o},group:"8_group_operations",order:10,when:vo.toNegated()});b.appendMenuItem(w.EditorTitle,{command:{id:u_.ID,title:c(2993,"Configure Editors")},group:"9_configure",order:10});function $t(a,e,t,i,s){const o={command:{id:a.id,title:a.title,icon:a.icon,toggled:a.toggled,precondition:s},group:"navigation",when:e,order:t};if(i){o.alt={id:i.id,title:i.title,icon:i.icon}}b.appendMenuItem(w.EditorTitle,o)}const Eh=1e5;const To=1e6;$t({id:Mf,title:c(2994,"Split Editor Right"),icon:A.splitHorizontal},S.not("splitEditorsVertically"),Eh,{id:Vn,title:c(2995,"Split Editor Down"),icon:A.splitVertical});$t({id:Mf,title:c(2995,"Split Editor Down"),icon:A.splitVertical},S.has("splitEditorsVertically"),Eh,{id:kn,title:c(2994,"Split Editor Right"),icon:A.splitHorizontal});$t({id:b_,title:c(2996,"Toggle Layout"),icon:A.editorLayout},Mn,Eh-1);$t({id:Eo,title:c(2963,"Close"),icon:A.close},S.and(Pn.toNegated(),Ra.toNegated(),Io.toNegated()),To,{id:Ln,title:c(2977,"Close All"),icon:A.closeAll});$t({id:Eo,title:c(2963,"Close"),icon:A.closeDirty},S.and(Pn.toNegated(),Ra,Io.toNegated()),To,{id:Ln,title:c(2977,"Close All"),icon:A.closeAll});$t({id:xa,title:c(2981,"Unpin"),icon:A.pinned},S.and(Pn.toNegated(),Ra.toNegated(),Io),To,{id:Eo,title:c(2963,"Close"),icon:A.close});$t({id:xa,title:c(2981,"Unpin"),icon:A.pinnedDirty},S.and(Pn.toNegated(),Ra,Io),To,{id:Eo,title:c(2963,"Close"),icon:A.close});$t({id:wf,title:c(2997,"Lock Group"),icon:A.unlock},S.and(vo,_o.toNegated()),To-1);$t({id:vf,title:c(2998,"Unlock Group"),icon:A.lock,toggled:S.true()},_o,To-1);const IT=Ae("diff-editor-previous-change",A.arrowUp,c(2999,"Icon for the previous change action in the diff editor."));$t({id:C_,title:c(3e3,"Previous Change"),icon:IT},xs,10,void 0,an.hasChanges);const DT=Ae("diff-editor-next-change",A.arrowDown,c(3001,"Icon for the next change action in the diff editor."));$t({id:S_,title:c(3002,"Next Change"),icon:DT},xs,11,void 0,an.hasChanges);$t({id:__,title:c(3003,"Swap Left and Right Side"),icon:A.arrowSwap},S.and(xs,p_),15,void 0,void 0);const TT=Ae("diff-editor-toggle-whitespace",A.whitespace,c(3004,"Icon for the toggle whitespace action in the diff editor."));b.appendMenuItem(w.EditorTitle,{command:{id:g_,title:c(3005,"Show Leading/Trailing Whitespace Differences"),icon:TT,precondition:xs,toggled:S.equals("config.diffEditor.ignoreTrimWhitespace",false)},group:"navigation",when:xs,order:20});b.appendMenuItem(w.CommandPalette,{command:{id:Tf,title:I(3006,"Keep Editor"),category:_e.View},when:S.has("config.workbench.editor.enablePreview")});b.appendMenuItem(w.CommandPalette,{command:{id:Af,title:I(3007,"Pin Editor"),category:_e.View}});b.appendMenuItem(w.CommandPalette,{command:{id:xa,title:I(3008,"Unpin Editor"),category:_e.View}});b.appendMenuItem(w.CommandPalette,{command:{id:Eo,title:I(3009,"Close Editor"),category:_e.View}});b.appendMenuItem(w.CommandPalette,{command:{id:f_,title:I(3010,"Close Pinned Editor"),category:_e.View}});b.appendMenuItem(w.CommandPalette,{command:{id:Ln,title:I(3011,"Close All Editors in Group"),category:_e.View}});b.appendMenuItem(w.CommandPalette,{command:{id:rh,title:I(3012,"Close Saved Editors in Group"),category:_e.View}});b.appendMenuItem(w.CommandPalette,{command:{id:Sf,title:I(3013,"Close Other Editors in Group"),category:_e.View}});b.appendMenuItem(w.CommandPalette,{command:{id:_f,title:I(3014,"Close Editors to the Right in Group"),category:_e.View},when:Ef.toNegated()});b.appendMenuItem(w.CommandPalette,{command:{id:m_,title:I(3015,"Close Editor Group"),category:_e.View},when:ri});b.appendMenuItem(w.CommandPalette,{command:{id:Df,title:I(2978,"Reopen Editor With..."),category:_e.View},when:If});b.appendMenuItem(w.MenubarRecentMenu,{group:"1_editor",command:{id:rf.ID,title:c(3016,"&&Reopen Closed Editor"),precondition:S.has("canReopenClosedEditor")},order:1});b.appendMenuItem(w.MenubarRecentMenu,{group:"z_clear",command:{id:af.ID,title:c(3017,"&&Clear Recently Opened...")},order:1});b.appendMenuItem(w.MenubarFileMenu,{title:c(3018,"Share"),submenu:w.MenubarShare,group:"45_share",order:1});b.appendMenuItem(w.MenubarViewMenu,{group:"2_appearance",title:c(3019,"Editor &&Layout"),submenu:w.MenubarLayoutMenu,order:2});b.appendMenuItem(w.MenubarLayoutMenu,{group:"1_split",command:{id:Da,title:{...I(3020,"Split Up"),mnemonicTitle:c(3021,"Split &&Up")}},order:1});b.appendMenuItem(w.MenubarLayoutMenu,{group:"1_split",command:{id:Vn,title:{...I(3022,"Split Down"),mnemonicTitle:c(3023,"Split &&Down")}},order:2});b.appendMenuItem(w.MenubarLayoutMenu,{group:"1_split",command:{id:Ta,title:{...I(3024,"Split Left"),mnemonicTitle:c(3025,"Split &&Left")}},order:3});b.appendMenuItem(w.MenubarLayoutMenu,{group:"1_split",command:{id:kn,title:{...I(3026,"Split Right"),mnemonicTitle:c(3027,"Split &&Right")}},order:4});b.appendMenuItem(w.MenubarLayoutMenu,{group:"2_split_in_group",command:{id:Rf,title:{...I(3028,"Split in Group"),mnemonicTitle:c(3029,"Split in &&Group")}},when:xf,order:1});b.appendMenuItem(w.MenubarLayoutMenu,{group:"2_split_in_group",command:{id:Vf,title:{...I(3030,"Join in Group"),mnemonicTitle:c(3031,"Join in &&Group")}},when:Mn,order:1});b.appendMenuItem(w.MenubarLayoutMenu,{group:"3_new_window",command:{id:kf,title:{...I(3032,"Move Editor into New Window"),mnemonicTitle:c(3033,"&&Move Editor into New Window")}},order:1});b.appendMenuItem(w.MenubarLayoutMenu,{group:"3_new_window",command:{id:Pf,title:{...I(3034,"Copy Editor into New Window"),mnemonicTitle:c(3035,"&&Copy Editor into New Window")}},order:2});b.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:df.ID,title:{...I(3036,"Single"),mnemonicTitle:c(3037,"&&Single")}},order:1});b.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:cf.ID,title:{...I(3038,"Two Columns"),mnemonicTitle:c(3039,"&&Two Columns")}},order:3});b.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:lf.ID,title:{...I(3040,"Three Columns"),mnemonicTitle:c(3041,"T&&hree Columns")}},order:4});b.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:hf.ID,title:{...I(3042,"Two Rows"),mnemonicTitle:c(3043,"T&&wo Rows")}},order:5});b.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:uf.ID,title:{...I(3044,"Three Rows"),mnemonicTitle:c(3045,"Three &&Rows")}},order:6});b.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:pf.ID,title:{...I(3046,"Grid (2x2)"),mnemonicTitle:c(3047,"&&Grid (2x2)")}},order:7});b.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:gf.ID,title:{...I(3048,"Two Rows Right"),mnemonicTitle:c(3049,"Two R&&ows Right")}},order:8});b.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:ff.ID,title:{...I(3050,"Two Columns Bottom"),mnemonicTitle:c(3051,"Two &&Columns Bottom")}},order:9});b.appendMenuItem(w.MenubarGoMenu,{group:"1_history_nav",command:{id:"workbench.action.navigateToLastEditLocation",title:c(3052,"&&Last Edit Location"),precondition:S.has("canNavigateToLastEditLocation")},order:3});b.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"1_sideBySide",command:{id:w_,title:c(3053,"&&First Side in Editor")},when:S.or(Mn,xs),order:1});b.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"1_sideBySide",command:{id:v_,title:c(3054,"&&Second Side in Editor")},when:S.or(Mn,xs),order:2});b.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"2_any",command:{id:"workbench.action.nextEditor",title:c(3055,"&&Next Editor")},order:1});b.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"2_any",command:{id:"workbench.action.previousEditor",title:c(3056,"&&Previous Editor")},order:2});b.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"3_any_used",command:{id:"workbench.action.openNextRecentlyUsedEditor",title:c(3057,"&&Next Used Editor")},order:1});b.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"3_any_used",command:{id:"workbench.action.openPreviousRecentlyUsedEditor",title:c(3058,"&&Previous Used Editor")},order:2});b.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"4_group",command:{id:"workbench.action.nextEditorInGroup",title:c(3059,"&&Next Editor in Group")},order:1});b.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"4_group",command:{id:"workbench.action.previousEditorInGroup",title:c(3060,"&&Previous Editor in Group")},order:2});b.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"5_group_used",command:{id:"workbench.action.openNextRecentlyUsedEditorInGroup",title:c(3061,"&&Next Used Editor in Group")},order:1});b.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"5_group_used",command:{id:"workbench.action.openPreviousRecentlyUsedEditorInGroup",title:c(3062,"&&Previous Used Editor in Group")},order:2});b.appendMenuItem(w.MenubarGoMenu,{group:"2_editor_nav",title:c(3063,"Switch &&Editor"),submenu:w.MenubarSwitchEditorMenu,order:1});b.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"1_focus_index",command:{id:"workbench.action.focusFirstEditorGroup",title:c(3064,"Group &&1")},order:1});b.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"1_focus_index",command:{id:"workbench.action.focusSecondEditorGroup",title:c(3065,"Group &&2")},order:2});b.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"1_focus_index",command:{id:"workbench.action.focusThirdEditorGroup",title:c(3066,"Group &&3"),precondition:ri},order:3});b.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"1_focus_index",command:{id:"workbench.action.focusFourthEditorGroup",title:c(3067,"Group &&4"),precondition:ri},order:4});b.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"1_focus_index",command:{id:"workbench.action.focusFifthEditorGroup",title:c(3068,"Group &&5"),precondition:ri},order:5});b.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"2_next_prev",command:{id:"workbench.action.focusNextGroup",title:c(3069,"&&Next Group"),precondition:ri},order:1});b.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"2_next_prev",command:{id:"workbench.action.focusPreviousGroup",title:c(3070,"&&Previous Group"),precondition:ri},order:2});b.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"3_directional",command:{id:"workbench.action.focusLeftGroup",title:c(3071,"Group &&Left"),precondition:ri},order:1});b.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"3_directional",command:{id:"workbench.action.focusRightGroup",title:c(3072,"Group &&Right"),precondition:ri},order:2});b.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"3_directional",command:{id:"workbench.action.focusAboveGroup",title:c(3073,"Group &&Above"),precondition:ri},order:3});b.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"3_directional",command:{id:"workbench.action.focusBelowGroup",title:c(3074,"Group &&Below"),precondition:ri},order:4});b.appendMenuItem(w.MenubarGoMenu,{group:"2_editor_nav",title:c(3075,"Switch &&Group"),submenu:w.MenubarSwitchGroupMenu,order:2});y_(E_);let wn=class OR{static{this.ID=ho.typeId}constructor(e){this._webviewWorkbenchService=e}canSerialize(e){return this._webviewWorkbenchService.shouldPersist(e)}serialize(e){if(!this.canSerialize(e)){return void 0}const t=this.toJson(e);try{return JSON.stringify(t)}catch{return void 0}}deserialize(e,t){const i=this.fromJson(JSON.parse(t));return this._webviewWorkbenchService.openRevivedWebview({webviewInitInfo:{providedViewType:i.providedId,origin:i.origin,title:i.title,options:i.webviewOptions,contentOptions:i.contentOptions,extension:i.extension},viewType:i.viewType,title:i.title,iconPath:i.iconPath,state:i.state,group:i.group})}fromJson(e){return{...e,extension:Om(e.extensionId,e.extensionLocation),iconPath:AT(e.iconPath),state:xT(e.state),webviewOptions:Nm(e.options),contentOptions:Bm(e.options)}}toJson(e){return{origin:e.webview.origin,viewType:e.viewType,providedId:e.providedId,title:e.getName(),options:{...e.webview.options,...e.webview.contentOptions},extensionLocation:e.extension?.location,extensionId:e.extension?.id.value,state:e.webview.state,iconPath:e.iconPath?{light:e.iconPath.light,dark:e.iconPath.dark}:void 0,group:e.group}}};wn=E([h(0,ah)],wn);function Om(a,e){if(!a){return void 0}const t=jr(e);if(!t){return void 0}return{id:new Yg(a),location:t}}function AT(a){if(!a){return void 0}const e=jr(a.light);const t=jr(a.dark);return e&&t?{light:e,dark:t}:void 0}function jr(a){if(!a){return void 0}try{if(typeof a==="string"){return K.parse(a)}return K.from(a)}catch{return void 0}}function xT(a){return typeof a==="string"?a:void 0}function Nm(a){return a}function Bm(a){return{...a,localResourceRoots:a.localResourceRoots?.map(e=>jr(e))}}let Yr=class NR extends wn{static{this.ID=ut.typeId}constructor(e,t,i){super(e);this._instantiationService=t;this._webviewService=i}serialize(e){const t=e.isDirty();const i={...this.toJson(e),editorResource:e.resource.toJSON(),dirty:t,backupId:t?e.backupId:void 0};try{return JSON.stringify(i)}catch{return void 0}}fromJson(e){return{...super.fromJson(e),editorResource:K.from(e.editorResource),dirty:e.dirty}}deserialize(e,t){const i=this.fromJson(JSON.parse(t));const s=Fm(this._webviewService,i);const o=this._instantiationService.createInstance(ut,{resource:i.editorResource,viewType:i.viewType},s,{startsDirty:i.dirty,backupId:i.backupId});if(typeof i.group==="number"){o.updateGroup(i.group)}return o}};Yr=E([h(0,ah),h(1,N),h(2,Ps)],Yr);function Fm(a,e){const t=a.createWebviewOverlay({providedViewType:e.viewType,origin:e.origin,title:void 0,options:{purpose:jg.CustomEditor,enableFindWidget:e.webviewOptions.enableFindWidget,retainContextWhenHidden:e.webviewOptions.retainContextWhenHidden},contentOptions:e.contentOptions,extension:e.extension});t.state=e.state;return t}let Zr=class BR extends k{static{this.ID="workbench.contrib.complexCustomWorkingCopyEditorHandler"}constructor(e,t,i,s,o){super();this._instantiationService=e;this._workingCopyBackupService=i;this._webviewService=s;this._register(t.registerHandler(this))}handles(e){return e.resource.scheme===fe.vscodeCustomEditor}isOpen(e,t){if(!this.handles(e)){return false}if(e.resource.authority==="jupyter-notebook-ipynb"&&t instanceof I_){try{const i=JSON.parse(e.resource.query);const s=K.from(i);return vi(s,t.resource)}catch{return false}}if(!(t instanceof ut)){return false}if(e.resource.authority!==t.viewType.replace(/[^a-z0-9\-_]/gi,"-").toLowerCase()){return false}try{const i=JSON.parse(e.resource.query);const s=K.from(i);return vi(s,t.resource)}catch{return false}}async createEditor(e){const t=await this._workingCopyBackupService.resolve(e);if(!t?.meta){throw new Error(`No backup found for custom editor: ${e.resource}`)}const i=t.meta;const s=Om(i.extension?.id,i.extension?.location);const o=Fm(this._webviewService,{viewType:i.viewType,origin:i.webview.origin,webviewOptions:Nm(i.webview.options),contentOptions:Bm(i.webview.options),state:i.webview.state,extension:s});const n=this._instantiationService.createInstance(ut,{resource:K.revive(i.editorResource),viewType:i.viewType},o,{backupId:i.backupId});n.updateGroup(0);return n}};Zr=E([h(0,N),h(1,ef),h(2,D_),h(3,Ps),h(4,Of)],Zr);W.as(Ct.EditorPane).registerEditorPane(Ni.create(dn,dn.ID,"Webview Editor"),[new Q(ut)]);W.as(Ct.EditorFactory).registerEditorSerializer(Yr.ID,Yr);Ci(Zr.ID,Zr,Si.BlockStartup);const Ha=S.and(S.equals("activeEditor",dn.ID),an.focus.toNegated());class Jr extends j{static{this.ID="editor.action.webvieweditor.showFind"}static{this.LABEL=c(11475,"Show find")}constructor(){super({id:Jr.ID,title:Jr.LABEL,keybinding:{when:S.and(Ha,og),primary:O.CtrlCmd|T.KeyF,weight:B.EditorContrib}})}run(e){Ua(e)?.showFind()}}class Xr extends j{static{this.ID="editor.action.webvieweditor.hideFind"}static{this.LABEL=c(11476,"Stop find")}constructor(){super({id:Xr.ID,title:Xr.LABEL,keybinding:{when:S.and(Ha,sg),primary:T.Escape,weight:B.EditorContrib}})}run(e){Ua(e)?.hideFind()}}class Qr extends j{static{this.ID="editor.action.webvieweditor.findNext"}static{this.LABEL=c(11477,"Find next")}constructor(){super({id:Qr.ID,title:Qr.LABEL,keybinding:{when:S.and(Ha,ql),primary:T.Enter,weight:B.EditorContrib}})}run(e){Ua(e)?.runFindAction(false)}}class ea extends j{static{this.ID="editor.action.webvieweditor.findPrevious"}static{this.LABEL=c(11478,"Find previous")}constructor(){super({id:ea.ID,title:ea.LABEL,keybinding:{when:S.and(Ha,ql),primary:O.Shift|T.Enter,weight:B.EditorContrib}})}run(e){Ua(e)?.runFindAction(true)}}class ta extends j{static{this.ID="workbench.action.webview.reloadWebviewAction"}static{this.LABEL=I(11479,"Reload Webviews")}constructor(){super({id:ta.ID,title:ta.LABEL,category:_e.Developer,menu:[{id:w.CommandPalette}]})}async run(e){const t=e.get(Ps);for(const i of t.webviews){i.reload()}}}function Ua(a){const e=a.get(Y);const t=e.activeEditor;return t instanceof ho?t.webview:void 0}W.as(Ct.EditorPane).registerEditorPane(Ni.create(dn,dn.ID,c(11481,"webview editor")),[new Q(ho)]);let ia=class FR extends k{static{this.ID="workbench.contrib.webviewPanel"}constructor(e,t){super();this.editorGroupService=t;this._register(e.onWillOpenEditor(i=>{const s=t.getGroup(i.groupId);if(s){this.onEditorOpening(i.editor,s)}}))}onEditorOpening(e,t){if(!(e instanceof ho)||e.typeId!==ho.typeId){return}if(t.contains(e)){return}let i;const s=this.editorGroupService.groups;for(const o of s){if(o.contains(e)){i=o;break}}if(!i){return}i.closeEditor(e)}};ia=E([h(0,Y),h(1,qe)],ia);Ci(ia.ID,ia,Si.BlockStartup);W.as(Ct.EditorFactory).registerEditorSerializer(wn.ID,wn);v(Jr);v(Xr);v(Qr);v(ea);v(ta);let Sp=class GR extends k{constructor(e,t,i,s,o){super();this.configurationService=t;this.logService=i;this.preferencesService=s;this.quickInputService=o;this._providers=new wg;this._register(e.registerExternalOpener(this))}registerExternalOpenerProvider(e){const t=this._providers.push(e);return{dispose:t}}async getOpeners(e,t,i,s){const o=await this.getAllOpenersForUri(e);if(o.size===0){return[]}if(i.preferredOpenerId){if(i.preferredOpenerId===ad){return[]}const l=o.get(i.preferredOpenerId);if(l){return[l]}}const n=this.getConfiguredOpenerForUri(o,e);if(n){return n===ad?[]:[n]}const r=[];await Promise.all(Array.from(o.values()).map(async l=>{let u;try{u=await l.canOpen(i.sourceUri,s)}catch(p){this.logService.error(p);return}switch(u){case Vo.Option:case Vo.Default:case Vo.Preferred:r.push({opener:l,priority:u});break}}));if(r.length===0){return[]}const d=r.filter(l=>l.priority===Vo.Preferred).at(0);if(d){return[d.opener]}if(!t&&r.every(l=>l.priority===Vo.Option)){return[]}return r.map(l=>l.opener)}async openExternal(e,t,i){const s=typeof e==="string"?K.parse(e):e;const o=await this.getOpeners(s,false,t,i);if(o.length===0){return false}else if(o.length===1){return o[0].openExternalUri(s,t,i)}return this.showOpenerPrompt(o,s,t,i)}async getOpener(e,t,i){const s=await this.getOpeners(e,true,t,i);if(s.length>=1){return s[0]}return void 0}async getAllOpenersForUri(e){const t=new Map;await Promise.all(T_.map(this._providers,async i=>{for await(const s of i.getOpeners(e)){t.set(s.id,s)}}));return t}getConfiguredOpenerForUri(e,t){const i=this.configurationService.getValue(Bu)||{};for(const[s,o]of Object.entries(i)){if(A_(t,s)){if(o===ad){return"default"}const n=e.get(o);if(n){return n}}}return void 0}async showOpenerPrompt(e,t,i,s){const o=e.map(r=>{return{label:r.label,opener:r}});o.push({label:Is?c(6808,"Open in new browser window"):c(6809,"Open in default browser"),opener:void 0},{type:"separator"},{label:c(6810,"Configure default opener..."),opener:"configureDefault"});const n=await this.quickInputService.pick(o,{placeHolder:c(6811,"How would you like to open: {0}",t.toString())});if(!n){return true}if(typeof n.opener==="undefined"){return false}else if(n.opener==="configureDefault"){await this.preferencesService.openUserSettings({jsonEditor:true,revealSetting:{key:Bu,edit:true}});return true}else{return n.opener.openExternalUri(t,i,s)}}};Sp=E([h(0,St),h(1,X),h(2,et),h(3,ih),h(4,kt)],Sp);W.as(Co.Configuration).registerConfiguration(x_);const RT=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Mt;Le(RT);class _p{constructor(e,t){this.combined=e;this.dedicated=t}isEqual(e){return _s(this.combined,e.combined)&&_s(this.dedicated,e.dedicated)}}let ml=class WR{constructor(e,t){this._storageService=e;this._key=t}get value(){return this._storageService.getNumber(this._key,M.PROFILE,0)}increment(){const e=this.value+1;this._storageService.store(this._key,e,M.PROFILE,Ee.MACHINE);return e}};ml=E([h(0,le)],ml);let sa=class HR extends k{static{this.Id="status.languageStatus"}constructor(e){super();this.editorGroupService=e;for(const t of e.parts){this.createLanguageStatus(t)}this._register(e.onDidCreateAuxiliaryEditorPart(t=>this.createLanguageStatus(t)))}createLanguageStatus(e){const t=new L;x.once(e.onWillDispose)(()=>t.dispose());const i=this.editorGroupService.getScopedInstantiationService(e);t.add(i.createInstance(wl))}};sa=E([h(0,qe)],sa);let wl=class UR{static{Mt=this}static{this._id="status.languageStatus"}static{this._keyDedicatedItems="languageStatus.dedicated"}constructor(e,t,i,s,o,n){this._languageStatusService=e;this._statusBarService=t;this._editorService=i;this._hoverService=s;this._openerService=o;this._storageService=n;this._disposables=new L;this._dedicated=new Set;this._dedicatedEntries=new Map;this._renderDisposables=new L;this._combinedEntryTooltip=document.createElement("div");n.onDidChangeValue(M.PROFILE,Mt._keyDedicatedItems,this._disposables)(this._handleStorageChange,this,this._disposables);this._restoreState();this._interactionCounter=new ml(n,"languageStatus.interactCount");e.onDidChange(this._update,this,this._disposables);i.onDidActiveEditorChange(this._update,this,this._disposables);this._update();t.onDidChangeEntryVisibility(r=>{if(!r.visible&&this._dedicated.has(r.id)){this._dedicated.delete(r.id);this._update();this._storeState()}},void 0,this._disposables)}dispose(){this._disposables.dispose();this._combinedEntry?.dispose();$e(this._dedicatedEntries.values());this._renderDisposables.dispose()}_handleStorageChange(){this._restoreState();this._update()}_restoreState(){const e=this._storageService.get(Mt._keyDedicatedItems,M.PROFILE,"[]");try{const t=JSON.parse(e);this._dedicated=new Set(t)}catch{this._dedicated.clear()}}_storeState(){if(this._dedicated.size===0){this._storageService.remove(Mt._keyDedicatedItems,M.PROFILE)}else{const e=JSON.stringify(Array.from(this._dedicated.keys()));this._storageService.store(Mt._keyDedicatedItems,e,M.PROFILE,Ee.USER)}}_createViewModel(e){if(!e?.hasModel()){return new _p([],[])}const t=this._languageStatusService.getLanguageStatus(e.getModel());const i=[];const s=[];for(const o of t){if(this._dedicated.has(o.id)){s.push(o)}i.push(o)}return new _p(i,s)}_update(){const e=Jt(this._editorService.activeTextEditorControl);const t=this._createViewModel(e);if(this._model?.isEqual(t)){return}this._renderDisposables.clear();this._model=t;e?.onDidChangeModelLanguage(this._update,this,this._renderDisposables);if(t.combined.length===0){this._combinedEntry?.dispose();this._combinedEntry=void 0}else{const[s]=t.combined;const o=s.severity>=ve.Warning;const n=Mt._severityToComboCodicon(s.severity);let r=false;const d=[];for(const m of t.combined){const y=t.dedicated.includes(m);this._renderStatus(this._combinedEntryTooltip,m,o,y,this._renderDisposables);d.push(Mt._accessibilityInformation(m).label);r=r||!y&&m.busy}const l={name:c(7426,"Editor Language Status"),ariaLabel:c(7427,"Editor Language Status: {0}",d.join(", next: ")),tooltip:this._combinedEntryTooltip,command:R_,text:r?"$(loading~spin)":n};if(!this._combinedEntry){this._combinedEntry=this._statusBarService.addEntry(l,Mt._id,Ke.RIGHT,{location:{id:"status.editor.mode",priority:100.1},alignment:Ke.LEFT,compact:true})}else{this._combinedEntry.update(l)}const u=this._interactionCounter.value>=3;const p=wt(e?.getContainerDomNode());const f=p.document.querySelector(".monaco-workbench .statusbar DIV#status\\.languageStatus A>SPAN.codicon");const g=p.document.querySelector(".monaco-workbench .statusbar DIV#status\\.languageStatus");if(ao(f)&&g){const m="wiggle";const y="flash";if(!r){f.classList.toggle(m,o||!u);this._renderDisposables.add(J(f,"animationend",C=>f.classList.remove(m)));g.classList.toggle(y,o);this._renderDisposables.add(J(g,"animationend",C=>g.classList.remove(y)))}else{f.classList.remove(m);g.classList.remove(y)}}if(!u){const m=p.document.querySelector(".monaco-workbench .context-view");if(ao(m)){const y=new MutationObserver(()=>{if(p.document.contains(this._combinedEntryTooltip)){this._interactionCounter.increment();y.disconnect()}});y.observe(m,{childList:true,subtree:true});this._renderDisposables.add(de(()=>y.disconnect()))}}}const i=new Map;for(const s of t.dedicated){const o=Mt._asStatusbarEntry(s);let n=this._dedicatedEntries.get(s.id);if(!n){n=this._statusBarService.addEntry(o,s.id,Ke.RIGHT,{location:{id:"status.editor.mode",priority:100.1},alignment:Ke.RIGHT})}else{n.update(o);this._dedicatedEntries.delete(s.id)}i.set(s.id,n)}$e(this._dedicatedEntries.values());this._dedicatedEntries=i}_renderStatus(e,t,i,s,o){const n=document.createElement("div");n.classList.add("hover-language-status");e.appendChild(n);o.add(de(()=>n.remove()));const r=document.createElement("div");r.classList.add("severity",`sev${t.severity}`);r.classList.toggle("show",i);const d=Mt._severityToSingleCodicon(t.severity);Be(r,...fi(d));n.appendChild(r);const l=document.createElement("div");l.classList.add("element");n.appendChild(l);const u=document.createElement("div");u.classList.add("left");l.appendChild(u);const p=typeof t.label==="string"?t.label:t.label.value;Be(u,...fi(Ep(p,t.busy)));this._renderTextPlus(u,t.detail,o);const f=document.createElement("div");f.classList.add("right");l.appendChild(f);const{command:g}=t;if(g){o.add(new Fu(f,{label:g.title,title:g.tooltip,href:K.from({scheme:"command",path:g.id,query:g.arguments&&JSON.stringify(g.arguments)}).toString()},{hoverDelegate:Gu},this._hoverService,this._openerService))}const m=new En(f,{hoverDelegate:Gu});const y=s?c(7428,"Remove from Status Bar"):c(7429,"Add to Status Bar");m.setAriaLabel(y);o.add(m);let C;if(!s){C=new ti("pin",y,ye.asClassName(A.pin),true,()=>{this._dedicated.add(t.id);this._statusBarService.updateEntryVisibility(t.id,true);this._update();this._storeState()})}else{C=new ti("unpin",y,ye.asClassName(A.pinned),true,()=>{this._dedicated.delete(t.id);this._statusBarService.updateEntryVisibility(t.id,false);this._update();this._storeState()})}m.push(C,{icon:true,label:false});o.add(C);return n}static _severityToComboCodicon(e){switch(e){case ve.Error:return"$(bracket-error)";case ve.Warning:return"$(bracket-dot)";default:return"$(bracket)"}}static _severityToSingleCodicon(e){switch(e){case ve.Error:return"$(error)";case ve.Warning:return"$(info)";default:return"$(check)"}}_renderTextPlus(e,t,i){let s=false;for(const o of vr(t).nodes){if(!s){Be(e,G("span.separator"));s=true}if(typeof o==="string"){const n=fi(o);Be(e,...n)}else{i.add(new Fu(e,o,void 0,this._hoverService,this._openerService))}}}static _accessibilityInformation(e){if(e.accessibilityInfo){return e.accessibilityInfo}const t=typeof e.label==="string"?e.label:e.label.value;if(e.detail){return{label:c(7430,"{0}, {1}",t,e.detail)}}else{return{label:c(7431,"{0}",t)}}}static _asStatusbarEntry(e){let t;if(e.severity===ve.Warning){t="warning"}else if(e.severity===ve.Error){t="error"}const i=typeof e.label==="string"?e.label:e.label.shortValue;return{name:c(7432,"{0} (Language Status)",e.name),text:Ep(i,e.busy),ariaLabel:Mt._accessibilityInformation(e).label,role:e.accessibilityInfo?.role,tooltip:e.command?.tooltip||new Ia(e.detail,{isTrusted:true,supportThemeIcons:true}),kind:t,command:e.command}}};wl=Mt=E([h(0,Nf),h(1,ss),h(2,Y),h(3,bt),h(4,St),h(5,le)],wl);class VT extends j{constructor(){super({id:"editor.inlayHints.Reset",title:I(7433,"Reset Language Status Interaction Counter"),category:_e.View,f1:true})}run(e){e.get(le).remove("languageStatus.interactCount",M.PROFILE)}}function Ep(a,e){return V_([a!==""&&a,e&&"$(loading~spin)"],"  ")}Ci(sa.Id,sa,Si.AfterRestored);v(VT);const kT=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));ne("mergeEditor.change.background","#9bb95533",c(7843,"The background color for changes."));ne("mergeEditor.change.word.background",{dark:"#9ccc2c33",light:"#9ccc2c66",hcDark:"#9ccc2c33",hcLight:"#9ccc2c66"},c(7844,"The background color for word changes."));ne("mergeEditor.changeBase.background",{dark:"#4B1818FF",light:"#FFCCCCFF",hcDark:"#4B1818FF",hcLight:"#FFCCCCFF"},c(7845,"The background color for changes in base."));ne("mergeEditor.changeBase.word.background",{dark:"#6F1313FF",light:"#FFA3A3FF",hcDark:"#6F1313FF",hcLight:"#FFA3A3FF"},c(7846,"The background color for word changes in base."));ne("mergeEditor.conflict.unhandledUnfocused.border",{dark:"#ffa6007a",light:"#ffa600FF",hcDark:"#ffa6007a",hcLight:"#ffa6007a"},c(7847,"The border color of unhandled unfocused conflicts."));ne("mergeEditor.conflict.unhandledFocused.border","#ffa600",c(7848,"The border color of unhandled focused conflicts."));ne("mergeEditor.conflict.handledUnfocused.border","#86868649",c(7849,"The border color of handled unfocused conflicts."));ne("mergeEditor.conflict.handledFocused.border","#c1c1c1cc",c(7850,"The border color of handled focused conflicts."));const mo=ne("mergeEditor.conflict.handled.minimapOverViewRuler","#adaca8ee",c(7851,"The foreground color for changes in input 1."));const wo=ne("mergeEditor.conflict.unhandled.minimapOverViewRuler","#fcba03FF",c(7852,"The foreground color for changes in input 1."));ne("mergeEditor.conflictingLines.background","#ffea0047",c(7853,'The background of the "Conflicting Lines" text.'));const Gm=.4;ne("mergeEditor.conflict.input1.background",Rs(k_,Gm),c(7854,"The background color of decorations in input 1."));ne("mergeEditor.conflict.input2.background",Rs(P_,Gm),c(7855,"The background color of decorations in input 2."));class Ih extends k{constructor(e,t,i){super();this._editor=e;this._domNode=t;this.itemProvider=i;this.scrollTop=qo(this,this._editor.onDidScrollChange,n=>this._editor.getScrollTop());this.isScrollTopZero=this.scrollTop.map(n=>n===0);this.modelAttached=qo(this,this._editor.onDidChangeModel,n=>this._editor.hasModel());this.editorOnDidChangeViewZones=Wu("onDidChangeViewZones",this._editor.onDidChangeViewZones);this.editorOnDidContentSizeChange=Wu("onDidContentSizeChange",this._editor.onDidContentSizeChange);this.domNodeSizeChanged=L_("domNodeSizeChanged");this.views=new Map;this._domNode.className="gutter monaco-editor";const s=this._domNode.appendChild(tt("div.scroll-decoration",{role:"presentation",ariaHidden:"true",style:{width:"100%"}}).root);const o=new ResizeObserver(()=>{Ce(n=>{this.domNodeSizeChanged.trigger(n)})});o.observe(this._domNode);this._register(de(()=>o.disconnect()));this._register(ii(n=>{s.className=this.isScrollTopZero.read(n)?"":"scroll-decoration"}));this._register(ii(n=>this.render(n)))}dispose(){super.dispose();mi(this._domNode)}render(e){if(!this.modelAttached.read(e)){return}this.domNodeSizeChanged.read(e);this.editorOnDidChangeViewZones.read(e);this.editorOnDidContentSizeChange.read(e);const t=this.scrollTop.read(e);const i=this._editor.getVisibleRanges();const s=new Set(this.views.keys());if(i.length>0){const o=i[0];const n=new Va(o.startLineNumber,o.endLineNumber-o.startLineNumber).deltaEnd(1);const r=this.itemProvider.getIntersectingGutterItems(n,e);for(const d of r){if(!d.range.touches(n)){continue}s.delete(d.id);let l=this.views.get(d.id);if(!l){const g=document.createElement("div");this._domNode.appendChild(g);const m=this.itemProvider.createView(d,g);l=new PT(m,g);this.views.set(d.id,l)}else{l.gutterItemView.update(d)}const u=d.range.startLineNumber<=this._editor.getModel().getLineCount()?this._editor.getTopForLineNumber(d.range.startLineNumber,true)-t:this._editor.getBottomForLineNumber(d.range.startLineNumber-1,false)-t;const p=this._editor.getBottomForLineNumber(d.range.endLineNumberExclusive-1,true)-t;const f=p-u;l.domNode.style.top=`${u}px`;l.domNode.style.height=`${f}px`;l.gutterItemView.layout(u,f,0,this._domNode.clientHeight)}}for(const o of s){const n=this.views.get(o);n.gutterItemView.dispose();n.domNode.remove();this.views.delete(o)}}}class PT{constructor(e,t){this.gutterItemView=e;this.domNode=t}}class Dh extends k{updateOptions(e){this.editor.updateOptions(e)}constructor(e,t,i){super();this.instantiationService=e;this.viewModel=t;this.configurationService=i;this.model=this.viewModel.map(s=>s?.model);this.htmlElements=tt("div.code-view",[tt("div.header@header",[tt("span.title@title"),tt("span.description@description"),tt("span.detail@detail"),tt("span.toolbar@toolbar")]),tt("div.container",[tt("div.gutter@gutterDiv"),tt("div@editor")])]);this._onDidViewChange=new _;this.view={element:this.htmlElements.root,minimumWidth:Uu.width,maximumWidth:Hu.width,minimumHeight:Uu.height,maximumHeight:Hu.height,onDidChange:this._onDidViewChange.event,layout:(s,o,n,r)=>{O_(this.htmlElements.root,{width:s,height:o,top:n,left:r});this.editor.layout({width:s-this.htmlElements.gutterDiv.clientWidth,height:o-this.htmlElements.header.clientHeight})}};this.checkboxesVisible=nr("mergeEditor.showCheckboxes",false,this.configurationService);this.showDeletionMarkers=nr("mergeEditor.showDeletionMarkers",true,this.configurationService);this.useSimplifiedDecorations=nr("mergeEditor.useSimplifiedDecorations",false,this.configurationService);this.editor=this.instantiationService.createInstance(N_,this.htmlElements.editor,{},{contributions:this.getEditorContributions()});this.isFocused=qo(this,x.any(this.editor.onDidBlurEditorWidget,this.editor.onDidFocusEditorWidget),()=>this.editor.hasWidgetFocus());this.cursorPosition=qo(this,this.editor.onDidChangeCursorPosition,()=>this.editor.getPosition());this.selection=qo(this,this.editor.onDidChangeCursorSelection,()=>this.editor.getSelections());this.cursorLineNumber=this.cursorPosition.map(s=>s?.lineNumber)}getEditorContributions(){return B_.getEditorContributions().filter(e=>e.id!==Bf.ID&&e.id!==F_.ID)}}function Th(a,e){const t=Tt(i=>{const s=a.viewModel.read(i);if(!s){return[]}const o=s.selectionInBase.read(i);if(!o||o.sourceEditor===a){return[]}return o.rangesInBase.map(n=>e(n,s))});return ii(i=>{const s=t.read(i);if(s.length===0){return}a.editor.setSelections(s.map(o=>new Xg(o.startLineNumber,o.startColumn,o.endLineNumber,o.endColumn)))})}let vn=class KR extends k{constructor(e,t,i){super();const s=i.createInstance(M_,t,e,{menuOptions:{renderShortTitle:true},toolbarOptions:{primaryGroup:o=>o==="primary"}});this._store.add(s)}};vn=E([h(2,N)],vn);let vl=class zR extends Dh{constructor(e,t,i){super(t,e,i);this.decorations=Tt(this,s=>{const o=this.viewModel.read(s);if(!o){return[]}const n=o.model;const r=n.base;const d=o.activeModifiedBaseRange.read(s);const l=o.showNonConflictingChanges.read(s);const u=this.showDeletionMarkers.read(s);const p=[];for(const f of n.modifiedBaseRanges.read(s)){const g=f.baseRange;if(!g){continue}const m=n.isHandled(f).read(s);if(!f.isConflicting&&m&&!l){continue}const y=["merge-editor-block"];let C=[0,0,0,0];if(m){y.push("handled")}if(f===d){y.push("focused");C=[0,2,0,2]}y.push("base");const D=o.baseShowDiffAgainst.read(s);if(D){for(const F of f.getInputDiffs(D)){const P=F.inputRange.toInclusiveRange();if(P){p.push({range:P,options:{className:`merge-editor-diff base`,description:"Merge Editor",isWholeLine:true}})}for(const R of F.rangeMappings){if(u||!R.inputRange.isEmpty()){p.push({range:R.inputRange,options:{className:R.inputRange.isEmpty()?`merge-editor-diff-empty-word base`:`merge-editor-diff-word base`,description:"Merge Editor",showIfCollapsed:true}})}}}}p.push({range:g.toInclusiveRangeOrEmpty(),options:{showIfCollapsed:true,blockClassName:y.join(" "),blockPadding:C,blockIsAfterEnd:g.startLineNumber>r.getLineCount(),description:"Merge Editor",minimap:{position:dh.Gutter,color:{id:m?mo:wo}},overviewRuler:f.isConflicting?{position:Dn.Center,color:{id:m?mo:wo}}:void 0}})}return p});this._register(Th(this,(s,o)=>s));this._register(t.createInstance(vn,w.MergeBaseToolbar,this.htmlElements.title));this._register(ch((s,o)=>{if(this.checkboxesVisible.read(s)){o.add(new Ih(this.editor,this.htmlElements.gutterDiv,{getIntersectingGutterItems:(n,r)=>[],createView:(n,r)=>{throw new ka}}))}}));this._register(ii(s=>{const o=this.viewModel.read(s);if(!o){return}this.editor.setModel(o.model.base);mi(this.htmlElements.title,...fi(c(7874,"Base")));const n=o.baseShowDiffAgainst.read(s);let r=void 0;if(n){const d=c(7875,"Comparing with {0}",n===1?o.model.input1.title:o.model.input2.title);const l=c(7876,"Differences are highlighted with a background color.");r=tt("span",{title:l},[d]).root}mi(this.htmlElements.description,...r?[r]:[])}));this._register(lh(this.editor,this.decorations))}};vl=E([h(1,N),h(2,X)],vl);class LT extends k{get model(){return this.viewModel.get()?.model}get lockResultWithInputs(){return this.layout.get().kind==="columns"}get lockBaseWithInputs(){return this.layout.get().kind==="mixed"&&!this.layout.get().showBaseAtTop}constructor(e,t,i,s,o,n){super();this.viewModel=e;this.input1View=t;this.input2View=i;this.baseView=s;this.inputResultView=o;this.layout=n;this.reentrancyBarrier=new G_;this._isSyncing=true;const r=W_((d,l)=>{const u=this.baseView.read(d);const p=[this.input1View,this.input2View,this.inputResultView,u].filter(ki);const f=(g,m,y)=>{this.reentrancyBarrier.runExclusivelyOrSkip(()=>{if(m){const C=g.editor.getScrollLeft();for(const D of p){if(D!==g){D.editor.setScrollLeft(C,xt.Immediate)}}}if(y){const C=g.editor.getScrollTop();for(const D of p){if(D!==g){if(this._shouldLock(g,D)){D.editor.setScrollTop(C,xt.Immediate)}else{const F=this._getMapping(g,D);if(F){this._synchronizeScrolling(g.editor,D.editor,F)}}}}}})};for(const g of p){l.add(g.editor.onDidScrollChange(m=>{if(!this._isSyncing){return}f(g,m.scrollLeftChanged,m.scrollTopChanged)}))}return{update:()=>{f(this.inputResultView,true,true)}}}).recomputeInitiallyAndOnChange(this._store);this.updateScrolling=()=>{r.get().update()}}stopSync(){this._isSyncing=false}startSync(){this._isSyncing=true}_shouldLock(e,t){const i=s=>s===this.input1View||s===this.input2View;if(i(e)&&t===this.inputResultView||i(t)&&e===this.inputResultView){return this.lockResultWithInputs}if(i(e)&&t===this.baseView.get()||i(t)&&e===this.baseView.get()){return this.lockBaseWithInputs}if(i(e)&&i(t)){return true}return false}_getMapping(e,t){if(e===this.input1View){if(t===this.input2View){return void 0}else if(t===this.inputResultView){return this.model?.input1ResultMapping.get()}else if(t===this.baseView.get()){const i=this.model?.baseInput1Diffs.get();if(!i){return void 0}return new jn(i,-1).reverse()}}else if(e===this.input2View){if(t===this.input1View){return void 0}else if(t===this.inputResultView){return this.model?.input2ResultMapping.get()}else if(t===this.baseView.get()){const i=this.model?.baseInput2Diffs.get();if(!i){return void 0}return new jn(i,-1).reverse()}}else if(e===this.inputResultView){if(t===this.input1View){return this.model?.resultInput1Mapping.get()}else if(t===this.input2View){return this.model?.resultInput2Mapping.get()}else if(t===this.baseView.get()){const i=this.model?.resultBaseMapping.get();if(!i){return void 0}return i}}else if(e===this.baseView.get()){if(t===this.input1View){const i=this.model?.baseInput1Diffs.get();if(!i){return void 0}return new jn(i,-1)}else if(t===this.input2View){const i=this.model?.baseInput2Diffs.get();if(!i){return void 0}return new jn(i,-1)}else if(t===this.inputResultView){const i=this.model?.baseResultMapping.get();if(!i){return void 0}return i}}throw new ka}_synchronizeScrolling(e,t,i){if(!i){return}const s=e.getVisibleRanges();if(s.length===0){return}const o=s[0].startLineNumber-1;const n=i.project(o);const r=n.inputRange;const d=n.outputRange;const l=t.getTopForLineNumber(d.startLineNumber);const u=t.getTopForLineNumber(d.endLineNumberExclusive);const p=e.getTopForLineNumber(r.startLineNumber);const f=e.getTopForLineNumber(r.endLineNumberExclusive);const g=Math.min((e.getScrollTop()-p)/(f-p),1);const m=l+(u-l)*g;t.setScrollTop(m,xt.Immediate)}}let yl=class $R extends k{constructor(e,t,i,s,o,n,r,d){super();this.model=e;this.inputCodeEditorView1=t;this.inputCodeEditorView2=i;this.resultCodeEditorView=s;this.baseCodeEditorView=o;this.showNonConflictingChanges=n;this.configurationService=r;this.notificationService=d;this.manuallySetActiveModifiedBaseRange=Ri(this,{range:void 0,counter:0});this.attachedHistory=this._register(new MT(this.model.resultTextModel));this.shouldUseAppendInsteadOfAccept=nr("mergeEditor.shouldUseAppendInsteadOfAccept",false,this.configurationService);this.counter=0;this.lastFocusedEditor=H_(this,(l,u)=>{const p=[this.inputCodeEditorView1,this.inputCodeEditorView2,this.resultCodeEditorView,this.baseCodeEditorView.read(l)];const f=p.find(g=>g&&g.isFocused.read(l));return f?{view:f,counter:this.counter++}:u||{view:void 0,counter:this.counter++}});this.baseShowDiffAgainst=Tt(this,l=>{const u=this.lastFocusedEditor.read(l);if(u.view===this.inputCodeEditorView1){return 1}else if(u.view===this.inputCodeEditorView2){return 2}return void 0});this.focusedEditorType=Tt(this,l=>{const u=this.lastFocusedEditor.read(l);if(!u.view){return void 0}if(u.view===this.inputCodeEditorView1){return"input1"}else if(u.view===this.inputCodeEditorView2){return"input2"}else if(u.view===this.resultCodeEditorView){return"result"}else if(u.view===this.baseCodeEditorView.read(l)){return"base"}return void 0});this.selectionInBase=Tt(this,l=>{const u=this.lastFocusedEditor.read(l).view;if(!u){return void 0}const p=u.selection.read(l)||[];const f=p.map(g=>{if(u===this.inputCodeEditorView1){return this.model.translateInputRangeToBase(1,g)}else if(u===this.inputCodeEditorView2){return this.model.translateInputRangeToBase(2,g)}else if(u===this.resultCodeEditorView){return this.model.translateResultRangeToBase(g)}else if(u===this.baseCodeEditorView.read(l)){return g}else{return g}});return{rangesInBase:f,sourceEditor:u}});this.activeModifiedBaseRange=Tt(this,l=>{const u=this.lastFocusedEditor.read(l);const p=this.manuallySetActiveModifiedBaseRange.read(l);if(p.counter>u.counter){return p.range}if(!u.view){return}const f=u.view.cursorLineNumber.read(l);if(!f){return void 0}const g=this.model.modifiedBaseRanges.read(l);return g.find(m=>{const y=this.getRangeOfModifiedBaseRange(u.view,m,l);return y.isEmpty?y.startLineNumber===f:y.contains(f)})});this._register(s.editor.onDidChangeModelContent(l=>{if(this.model.isApplyingEditInResult||l.isRedoing||l.isUndoing){return}const u=[];for(const f of l.changes){const g=this.model.translateResultRangeToBase(me.lift(f.range));const m=this.model.findModifiedBaseRangesInRange(new Va(g.startLineNumber,g.endLineNumber-g.startLineNumber));if(m.length===1){const y=this.model.isHandled(m[0]).get();if(!y){u.push(m[0])}}}if(u.length===0){return}const p={model:this.model,redo(){Ce(f=>{for(const g of u){this.model.setHandled(g,true,f)}})},undo(){Ce(f=>{for(const g of u){this.model.setHandled(g,false,f)}})}};this.attachedHistory.pushAttachedHistoryElement(p);p.redo()}))}getRangeOfModifiedBaseRange(e,t,i){if(e===this.resultCodeEditorView){return this.model.getLineRangeInResult(t.baseRange,i)}else if(e===this.baseCodeEditorView.get()){return t.baseRange}else{const s=e===this.inputCodeEditorView1?1:2;return t.getInputRange(s)}}setActiveModifiedBaseRange(e,t){this.manuallySetActiveModifiedBaseRange.set({range:e,counter:this.counter++},t)}setState(e,t,i,s){this.manuallySetActiveModifiedBaseRange.set({range:e,counter:this.counter++},i);this.model.setState(e,t,s,i);this.lastFocusedEditor.clearCache(i)}goToConflict(e){let t=this.lastFocusedEditor.get().view;if(!t){t=this.resultCodeEditorView}const i=t.editor.getPosition()?.lineNumber;if(i===void 0){return}const s=e(t,i);if(s){const o=this.getRangeOfModifiedBaseRange(t,s,void 0);t.editor.focus();let n=o.startLineNumber;let r=o.endLineNumberExclusive;if(o.startLineNumber>t.editor.getModel().getLineCount()){Ce(d=>{this.setActiveModifiedBaseRange(s,d)});n=r=t.editor.getModel().getLineCount()}t.editor.setPosition({lineNumber:n,column:t.editor.getModel().getLineFirstNonWhitespaceColumn(n)});t.editor.revealLinesNearTop(n,r,xt.Smooth)}}goToNextModifiedBaseRange(e){this.goToConflict((t,i)=>this.model.modifiedBaseRanges.get().find(s=>e(s)&&this.getRangeOfModifiedBaseRange(t,s,void 0).startLineNumber>i)||this.model.modifiedBaseRanges.get().find(s=>e(s)))}goToPreviousModifiedBaseRange(e){this.goToConflict((t,i)=>Ku(this.model.modifiedBaseRanges.get(),s=>e(s)&&this.getRangeOfModifiedBaseRange(t,s,void 0).endLineNumberExclusive<i)||Ku(this.model.modifiedBaseRanges.get(),s=>e(s)))}toggleActiveConflict(e){const t=this.activeModifiedBaseRange.get();if(!t){this.notificationService.error(c(7893,"There is currently no conflict focused that can be toggled."));return}Ce(i=>{this.setState(t,this.model.getState(t).get().toggle(e),i,e)})}acceptAll(e){Ce(t=>{for(const i of this.model.modifiedBaseRanges.get()){this.setState(i,this.model.getState(i).get().withInputValue(e,true),t,e)}})}};yl=E([h(6,X),h(7,Qe)],yl);class MT extends k{constructor(e){super();this.model=e;this.attachedHistory=[];this.previousAltId=this.model.getAlternativeVersionId();this._register(e.onDidChangeContent(t=>{const i=e.getAlternativeVersionId();if(t.isRedoing){for(const s of this.attachedHistory){if(this.previousAltId<s.altId&&s.altId<=i){s.element.redo()}}}else if(t.isUndoing){for(let s=this.attachedHistory.length-1;s>=0;s--){const o=this.attachedHistory[s];if(i<o.altId&&o.altId<=this.previousAltId){o.element.undo()}}}else{while(this.attachedHistory.length>0&&this.attachedHistory[this.attachedHistory.length-1].altId>this.previousAltId){this.attachedHistory.pop()}}this.previousAltId=i}))}pushAttachedHistoryElement(e){this.attachedHistory.push({altId:this.model.getAlternativeVersionId(),element:e})}}class Ah extends k{static{this.counter=0}constructor(e,t,i,s,o){super();this.editor=e;this.overlayWidgetId=`fixedZoneWidget-${Ah.counter++}`;this.widgetDomNode=tt("div.fixed-zone-widget").root;this.overlayWidget={getId:()=>this.overlayWidgetId,getDomNode:()=>this.widgetDomNode,getPosition:()=>null};this.viewZoneId=t.addZone({domNode:document.createElement("div"),afterLineNumber:i,heightInPx:s,ordinal:5e4+1,onComputedHeight:n=>{this.widgetDomNode.style.height=`${n}px`},onDomNodeTop:n=>{this.widgetDomNode.style.top=`${n}px`}});o.push(this.viewZoneId);this._register(x.runAndSubscribe(this.editor.onDidLayoutChange,()=>{this.widgetDomNode.style.left=this.editor.getLayoutInfo().contentLeft+"px"}));this.editor.addOverlayWidget(this.overlayWidget);this._register({dispose:()=>{this.editor.removeOverlayWidget(this.overlayWidget)}})}}class vd extends k{constructor(e){super();this._editor=e;this._register(this._editor.onDidChangeConfiguration(t=>{if(t.hasChanged(pt.fontInfo)||t.hasChanged(pt.codeLensFontSize)||t.hasChanged(pt.codeLensFontFamily)){this._updateLensStyle()}}));this._styleClassName="_conflictActionsFactory_"+U_(this._editor.getId()).toString(16);this._styleElement=K_(z_(this._editor.getContainerDomNode())?this._editor.getContainerDomNode():void 0,void 0,this._store);this._updateLensStyle()}_updateLensStyle(){const{codeLensHeight:e,fontSize:t}=this._getLayoutInfo();const i=this._editor.getOption(pt.codeLensFontFamily);const s=this._editor.getOption(pt.fontInfo);const o=`--codelens-font-family${this._styleClassName}`;const n=`--codelens-font-features${this._styleClassName}`;let r=`
		.${this._styleClassName} { line-height: ${e}px; font-size: ${t}px; padding-right: ${Math.round(t*.5)}px; font-feature-settings: var(${n}) }
		.monaco-workbench .${this._styleClassName} span.codicon { line-height: ${e}px; font-size: ${t}px; }
		`;if(i){r+=`${this._styleClassName} { font-family: var(${o}), ${sr.fontFamily}}`}this._styleElement.textContent=r;this._editor.getContainerDomNode().style?.setProperty(o,i??"inherit");this._editor.getContainerDomNode().style?.setProperty(n,s.fontFeatureSettings)}_getLayoutInfo(){const e=Math.max(1.3,this._editor.getOption(pt.lineHeight)/this._editor.getOption(pt.fontSize));let t=this._editor.getOption(pt.codeLensFontSize);if(!t||t<5){t=this._editor.getOption(pt.fontSize)*.9|0}return{fontSize:t,codeLensHeight:t*e|0}}createWidget(e,t,i,s){const o=this._getLayoutInfo();return new NT(this._editor,e,t,o.codeLensHeight+2,this._styleClassName,i,s)}}class OT{constructor(e,t){this.viewModel=e;this.modifiedBaseRange=t;this.itemsInput1=this.getItemsInput(1);this.itemsInput2=this.getItemsInput(2);this.resultItems=Tt(this,i=>{const s=this.viewModel;const o=this.modifiedBaseRange;const n=s.model.getState(o).read(i);const r=s.model;const d=[];if(n.kind===hs.unrecognized){d.push({text:c(7856,"Manual Resolution"),tooltip:c(7857,"This conflict has been resolved manually.")})}else if(n.kind===hs.base){d.push({text:c(7858,"No Changes Accepted"),tooltip:c(7859,"The current resolution of this conflict equals the common ancestor of both the right and left changes.")})}else{const u=[];if(n.includesInput1){u.push(r.input1.title)}if(n.includesInput2){u.push(r.input2.title)}if(n.kind===hs.both&&n.firstInput===2){u.reverse()}d.push({text:`${u.join(" + ")}`})}const l=[];if(n.includesInput1){l.push(qi(c(7860,"Remove {0}",r.input1.title),async()=>{Ce(u=>{r.setState(o,n.withInputValue(1,false),true,u);r.telemetry.reportRemoveInvoked(1,n.includesInput(2))})},c(7861,"Remove {0} from the result document.",r.input1.title)))}if(n.includesInput2){l.push(qi(c(7860,"Remove {0}",r.input2.title),async()=>{Ce(u=>{r.setState(o,n.withInputValue(2,false),true,u);r.telemetry.reportRemoveInvoked(2,n.includesInput(1))})},c(7861,"Remove {0} from the result document.",r.input2.title)))}if(n.kind===hs.both&&n.firstInput===2){l.reverse()}d.push(...l);if(n.kind===hs.unrecognized){d.push(qi(c(7862,"Reset to base"),async()=>{Ce(u=>{r.setState(o,zu.base,true,u);r.telemetry.reportResetToBaseInvoked()})},c(7863,"Reset this conflict to the common ancestor of both the right and left changes.")))}return d});this.isEmpty=Tt(this,i=>{return this.itemsInput1.read(i).length+this.itemsInput2.read(i).length+this.resultItems.read(i).length===0});this.inputIsEmpty=Tt(this,i=>{return this.itemsInput1.read(i).length+this.itemsInput2.read(i).length===0})}getItemsInput(e){return Tt(t=>{const i=this.viewModel;const s=this.modifiedBaseRange;if(!i.model.hasBaseRange(s)){return[]}const o=i.model.getState(s).read(t);const n=i.model.isHandled(s).read(t);const r=i.model;const d=[];const l=e===1?i.model.input1:i.model.input2;const u=i.showNonConflictingChanges.read(t);if(!s.isConflicting&&n&&!u){return[]}const p=e===1?2:1;if(o.kind!==hs.unrecognized&&!o.isInputIncluded(e)){if(!o.isInputIncluded(p)||!this.viewModel.shouldUseAppendInsteadOfAccept.read(t)){d.push(qi(c(7864,"Accept {0}",l.title),async()=>{Ce(f=>{r.setState(s,o.withInputValue(e,true,false),e,f);r.telemetry.reportAcceptInvoked(e,o.includesInput(p))})},c(7865,"Accept {0} in the result document.",l.title)));if(s.canBeCombined){const f=s.isOrderRelevant?c(7866,"Accept Combination ({0} First)",l.title):c(7867,"Accept Combination");d.push(qi(f,async()=>{Ce(g=>{r.setState(s,zu.base.withInputValue(e,true).withInputValue(p,true,true),true,g);r.telemetry.reportSmartCombinationInvoked(o.includesInput(p))})},c(7868,"Accept an automatic combination of both sides in the result document.")))}}else{d.push(qi(c(7869,"Append {0}",l.title),async()=>{Ce(f=>{r.setState(s,o.withInputValue(e,true,false),e,f);r.telemetry.reportAcceptInvoked(e,o.includesInput(p))})},c(7870,"Append {0} to the result document.",l.title)));if(s.canBeCombined){d.push(qi(c(7871,"Accept Combination",l.title),async()=>{Ce(f=>{r.setState(s,o.withInputValue(e,true,true),e,f);r.telemetry.reportSmartCombinationInvoked(o.includesInput(p))})},c(7868,"Accept an automatic combination of both sides in the result document.")))}}if(!r.isInputHandled(s,e).read(t)){d.push(qi(c(7872,"Ignore"),async()=>{Ce(f=>{r.setInputHandled(s,e,true,f)})},c(7873,"Don't take this side of the conflict.")))}}return d})}}function qi(a,e,t){return{text:a,action:e,tooltip:t}}class NT extends Ah{constructor(e,t,i,s,o,n,r){super(e,t,i,s,r);this._domNode=tt("div.merge-editor-conflict-actions").root;this.widgetDomNode.appendChild(this._domNode);this._domNode.classList.add(o);this._register(ii(d=>{const l=n.read(d);this.setState(l)}))}setState(e){const t=[];let i=true;for(const s of e){if(i){i=false}else{t.push(G("span",void 0," | "))}const o=fi(s.text);if(s.action){t.push(G("a",{title:s.tooltip,role:"button",onclick:()=>s.action()},...o))}else{t.push(G("span",{title:s.tooltip},...o))}}mi(this._domNode,...t)}}function BT(a){const e=Ip(a.input1Diffs.flatMap(r=>r.rangeMappings),a.baseRange.toRange(),a.input1Range.toRange());const t=Ip(a.input2Diffs.flatMap(r=>r.rangeMappings),a.baseRange.toRange(),a.input2Range.toRange());const i=FT(e,t);let s=[];s.push([a.input1Range.startLineNumber-1,a.baseRange.startLineNumber-1,a.input2Range.startLineNumber-1]);function o(r){return r.every(d=>d!==void 0)}for(const r of i){const d=[r.output1Pos?.lineNumber,r.inputPos.lineNumber,r.output2Pos?.lineNumber];const l=o(d);let u=true;if(l){const p=!s.some(f=>o(f)&&f.some((g,m)=>g!==void 0&&g===d[m]));if(p){s=s.filter(f=>!f.some((g,m)=>g!==void 0&&g===d[m]))}u=p}else{const p=!s.some(f=>f.some((g,m)=>g!==void 0&&g===d[m]));u=p}if(u){s.push(d)}else{if(r.length.isGreaterThan(new $_(1,0))){s.push([r.output1Pos?r.output1Pos.lineNumber+1:void 0,r.inputPos.lineNumber+1,r.output2Pos?r.output2Pos.lineNumber+1:void 0])}}}const n=[a.input1Range.endLineNumberExclusive,a.baseRange.endLineNumberExclusive,a.input2Range.endLineNumberExclusive];s=s.filter(r=>r.every((d,l)=>d!==n[l]));s.push(n);Nd(()=>dd(s.map(r=>r[0]).filter(ki),(r,d)=>r<d)&&dd(s.map(r=>r[1]).filter(ki),(r,d)=>r<=d)&&dd(s.map(r=>r[2]).filter(ki),(r,d)=>r<d)&&s.every(r=>r.filter(ki).length>=2));return s}function Ip(a,e,t){const i=[];let s=e.getStartPosition();let o=t.getStartPosition();for(const r of a){const d=new $u(me.fromPositions(s,r.inputRange.getStartPosition()),me.fromPositions(o,r.outputRange.getStartPosition()));Nd(()=>Yn(d.inputRange).equals(Yn(d.outputRange)));if(!d.inputRange.isEmpty()){i.push(d)}s=r.inputRange.getEndPosition();o=r.outputRange.getEndPosition()}const n=new $u(me.fromPositions(s,e.getEndPosition()),me.fromPositions(o,t.getEndPosition()));Nd(()=>Yn(n.inputRange).equals(Yn(n.outputRange)));if(!n.inputRange.isEmpty()){i.push(n)}return i}function FT(a,e){const t=[];const i=[];for(const[n,r]of[[0,a],[1,e]]){for(const d of r){i.push({input:n,start:true,inputPos:d.inputRange.getStartPosition(),outputPos:d.outputRange.getStartPosition()});i.push({input:n,start:false,inputPos:d.inputRange.getEndPosition(),outputPos:d.outputRange.getEndPosition()})}}i.sort(q_(n=>n.inputPos,j_.compare));const s=[void 0,void 0];let o;for(const n of i){if(o&&s.some(r=>!!r)){const r=Y_(o,n.inputPos);if(!r.isZero()){t.push({inputPos:o,length:r,output1Pos:s[0],output2Pos:s[1]});if(s[0]){s[0]=qu(s[0],r)}if(s[1]){s[1]=qu(s[1],r)}}}s[n.input]=n.start?n.outputPos:void 0;o=n.inputPos}return t}class GT{constructor(e,t,i){this.input1Editor=e;this.input2Editor=t;this.resultEditor=i;this.conflictActionsFactoryInput1=new vd(this.input1Editor);this.conflictActionsFactoryInput2=new vd(this.input2Editor);this.conflictActionsFactoryResult=new vd(this.resultEditor)}computeViewZones(e,t,i){let s=0;let o=0;let n=0;let r=0;const d=[];const l=[];const u=[];const p=[];const f=t.model;const g=f.baseResultDiffs.read(e);const m=Ff(f.modifiedBaseRanges.read(e),g,(P,R)=>P.baseRange.touches(R.inputRange)?Gf.neitherLessOrGreaterThan:Va.compareByStart(P.baseRange,R.inputRange));const y=i.codeLensesVisible;const C=i.showNonConflictingChanges;let D=void 0;let F=void 0;for(const P of m){if(y&&P.left&&(P.left.isConflicting||C||!f.isHandled(P.left).read(e))){const H=new OT(t,P.left);if(i.shouldAlignResult||!H.inputIsEmpty.read(e)){d.push(new yd(this.conflictActionsFactoryInput1,P.left.input1Range.startLineNumber-1,H.itemsInput1));l.push(new yd(this.conflictActionsFactoryInput2,P.left.input2Range.startLineNumber-1,H.itemsInput2));if(i.shouldAlignBase){u.push(new HT(P.left.baseRange.startLineNumber-1,16))}}const Z=P.left.baseRange.startLineNumber+(F?.resultingDeltaFromOriginalToModified??0)-1;p.push(new yd(this.conflictActionsFactoryResult,Z,H.resultItems))}const R=P.rights.at(-1);if(R){F=R}let z;if(P.left){z=BT(P.left).map(H=>({input1Line:H[0],baseLine:H[1],input2Line:H[2],resultLine:void 0}));D=P.left;z[z.length-1].resultLine=P.left.baseRange.endLineNumberExclusive+(F?F.resultingDeltaFromOriginalToModified:0)}else{z=[{baseLine:R.inputRange.endLineNumberExclusive,input1Line:R.inputRange.endLineNumberExclusive+(D?D.input1Range.endLineNumberExclusive-D.baseRange.endLineNumberExclusive:0),input2Line:R.inputRange.endLineNumberExclusive+(D?D.input2Range.endLineNumberExclusive-D.baseRange.endLineNumberExclusive:0),resultLine:R.outputRange.endLineNumberExclusive}]}for(const{input1Line:H,baseLine:Z,input2Line:ie,resultLine:Ye}of z){if(!i.shouldAlignBase&&(H===void 0||ie===void 0)){continue}const qt=H!==void 0?H+s:-1;const _t=ie!==void 0?ie+o:-1;const as=Z+n;const lt=Ye!==void 0?Ye+r:-1;const Pt=Math.max(i.shouldAlignBase?as:0,qt,_t,i.shouldAlignResult?lt:0);if(H!==void 0){const Ze=Pt-qt;if(Ze>0){d.push(new er(H-1,Ze));s+=Ze}}if(ie!==void 0){const Ze=Pt-_t;if(Ze>0){l.push(new er(ie-1,Ze));o+=Ze}}if(i.shouldAlignBase){const Ze=Pt-as;if(Ze>0){u.push(new er(Z-1,Ze));n+=Ze}}if(i.shouldAlignResult&&Ye!==void 0){const Ze=Pt-lt;if(Ze>0){p.push(new er(Ye-1,Ze));r+=Ze}}}}return new WT(d,l,u,p)}}class WT{constructor(e,t,i,s){this.input1ViewZones=e;this.input2ViewZones=t;this.baseViewZones=i;this.resultViewZones=s}}class xh{}class er extends xh{constructor(e,t){super();this.afterLineNumber=e;this.heightInLines=t}create(e,t,i){t.push(e.addZone({afterLineNumber:this.afterLineNumber,heightInLines:this.heightInLines,domNode:G("div.diagonal-fill")}))}}class HT extends xh{constructor(e,t){super();this.afterLineNumber=e;this.heightPx=t}create(e,t,i){t.push(e.addZone({afterLineNumber:this.afterLineNumber,heightInPx:this.heightPx,domNode:G("div.conflict-actions-placeholder")}))}}class yd extends xh{constructor(e,t,i){super();this.conflictActionsFactory=e;this.lineNumber=t;this.items=i}create(e,t,i){i.add(this.conflictActionsFactory.createWidget(e,this.lineNumber,this.items,t))}}const UT=ne("settings.headerForeground",{light:"#444444",dark:"#e7e7e7",hcDark:"#ffffff",hcLight:"#292929"},c(8829,"The foreground color for a section header or active title."));ne("settings.settingsHeaderHoverForeground",Rs(UT,.7),c(8830,"The foreground color for a section header or hovered title."));ne("settings.modifiedItemIndicator",{light:new Bt(new Zn(102,175,224)),dark:new Bt(new Zn(12,125,157)),hcDark:new Bt(new Zn(0,73,122)),hcLight:new Bt(new Zn(102,175,224))},c(8831,"The color of the modified setting indicator."));ne("settings.headerBorder",gr,c(8832,"The color of the header container border."));const KT=ne("settings.sashBorder",gr,c(8833,"The color of the Settings editor splitview sash border."));ne(`settings.dropdownBackground`,Z_,c(8834,"Settings editor dropdown background."));ne("settings.dropdownForeground",J_,c(8835,"Settings editor dropdown foreground."));ne("settings.dropdownBorder",X_,c(8836,"Settings editor dropdown border."));ne("settings.dropdownListBorder",Q_,c(8837,"Settings editor dropdown list border. This surrounds the options and separates the options from the description."));ne("settings.checkboxBackground",eE,c(8838,"Settings editor checkbox background."));ne("settings.checkboxForeground",tE,c(8839,"Settings editor checkbox foreground."));ne("settings.checkboxBorder",iE,c(8840,"Settings editor checkbox border."));ne("settings.textInputBackground",Wf,c(8841,"Settings editor text input box background."));ne("settings.textInputForeground",Hf,c(8842,"Settings editor text input box foreground."));ne("settings.textInputBorder",Uf,c(8843,"Settings editor text input box border."));ne("settings.numberInputBackground",Wf,c(8844,"Settings editor number input box background."));ne("settings.numberInputForeground",Hf,c(8845,"Settings editor number input box foreground."));ne("settings.numberInputBorder",Uf,c(8846,"Settings editor number input box border."));ne("settings.focusedRowBackground",{dark:Rs(Ir,.6),light:Rs(Ir,.6),hcDark:null,hcLight:null},c(8847,"The background color of a settings row when focused."));ne("settings.rowHoverBackground",{dark:Rs(Ir,.3),light:Rs(Ir,.3),hcDark:null,hcLight:null},c(8848,"The background color of a settings row when hovered."));ne("settings.focusedRowBorder",sE,c(8849,"The color of the row's top and bottom border when the row is focused."));let oa=class qR extends Dh{constructor(e,t,i,s,o){super(i,t,o);this.inputNumber=e;this.otherInputNumber=this.inputNumber===1?2:1;this.modifiedBaseRangeGutterItemInfos=ju({debugName:`input${this.inputNumber}.modifiedBaseRangeGutterItemInfos`},n=>{const r=this.viewModel.read(n);if(!r){return[]}const d=r.model;const l=this.inputNumber;const u=r.showNonConflictingChanges.read(n);return d.modifiedBaseRanges.read(n).filter(p=>p.getInputDiffs(this.inputNumber).length>0&&(u||p.isConflicting||!d.isHandled(p).read(n))).map((p,f)=>new zT(f.toString(),p,l,r))});this.decorations=ju({debugName:`input${this.inputNumber}.decorations`},n=>{const r=this.viewModel.read(n);if(!r){return[]}const d=r.model;const l=(this.inputNumber===1?d.input1:d.input2).textModel;const u=r.activeModifiedBaseRange.read(n);const p=new Array;const f=r.showNonConflictingChanges.read(n);const g=this.showDeletionMarkers.read(n);const m=r.baseCodeEditorView.read(n)!==void 0&&r.baseShowDiffAgainst.read(n)===this.inputNumber;const y=!m&&this.useSimplifiedDecorations.read(n);for(const C of d.modifiedBaseRanges.read(n)){const D=C.getInputRange(this.inputNumber);if(!D){continue}const F=["merge-editor-block"];let P=[0,0,0,0];const R=d.isInputHandled(C,this.inputNumber).read(n);if(R){F.push("handled")}if(C===u){F.push("focused");P=[0,2,0,2]}if(C.isConflicting){F.push("conflicting")}const z=this.inputNumber===1?"input i1":"input i2";F.push(z);if(!C.isConflicting&&!f&&R){continue}if(y&&!R){F.push("use-simplified-decorations")}p.push({range:D.toInclusiveRangeOrEmpty(),options:{showIfCollapsed:true,blockClassName:F.join(" "),blockPadding:P,blockIsAfterEnd:D.startLineNumber>l.getLineCount(),description:"Merge Editor",minimap:{position:dh.Gutter,color:{id:R?mo:wo}},overviewRuler:C.isConflicting?{position:Dn.Center,color:{id:R?mo:wo}}:void 0}});if(!y&&(C.isConflicting||!d.isHandled(C).read(n))){const H=C.getInputDiffs(this.inputNumber);for(const Z of H){const ie=Z.outputRange.toInclusiveRange();if(ie){p.push({range:ie,options:{className:`merge-editor-diff ${z}`,description:"Merge Editor",isWholeLine:true}})}if(Z.rangeMappings){for(const Ye of Z.rangeMappings){if(g||!Ye.outputRange.isEmpty()){p.push({range:Ye.outputRange,options:{className:Ye.outputRange.isEmpty()?`merge-editor-diff-empty-word ${z}`:`merge-editor-diff-word ${z}`,description:"Merge Editor",showIfCollapsed:true}})}}}}}}return p});this.htmlElements.root.classList.add(`input`);this._register(new Ih(this.editor,this.htmlElements.gutterDiv,{getIntersectingGutterItems:(n,r)=>{if(this.checkboxesVisible.read(r)){return this.modifiedBaseRangeGutterItemInfos.read(r)}else{return[]}},createView:(n,r)=>new $T(n,r,s)}));this._register(Th(this,(n,r)=>r.model.translateBaseRangeToInput(this.inputNumber,n)));this._register(i.createInstance(vn,e===1?w.MergeInput1Toolbar:w.MergeInput2Toolbar,this.htmlElements.toolbar));this._register(oE({debugName:`input${this.inputNumber}: update labels & text model`},n=>{const r=this.viewModel.read(n);if(!r){return}this.editor.setModel(this.inputNumber===1?r.model.input1.textModel:r.model.input2.textModel);const d=this.inputNumber===1?r.model.input1.title||c(7877,"Input 1"):r.model.input2.title||c(7878,"Input 2");const l=this.inputNumber===1?r.model.input1.description:r.model.input2.description;const u=this.inputNumber===1?r.model.input1.detail:r.model.input2.detail;mi(this.htmlElements.title,...fi(d));mi(this.htmlElements.description,...l?fi(l):[]);mi(this.htmlElements.detail,...u?fi(u):[])}));this._register(lh(this.editor,this.decorations))}};oa=E([h(2,N),h(3,ot),h(4,X)],oa);class zT{constructor(e,t,i,s){this.id=e;this.baseRange=t;this.inputNumber=i;this.viewModel=s;this.model=this.viewModel.model;this.range=this.baseRange.getInputRange(this.inputNumber);this.enabled=this.model.isUpToDate;this.toggleState=Tt(this,o=>{const n=this.model.getState(this.baseRange).read(o).getInput(this.inputNumber);return n===qs.second&&!this.baseRange.isOrderRelevant?qs.first:n});this.state=Tt(this,o=>{const n=this.viewModel.activeModifiedBaseRange.read(o);if(!this.model.hasBaseRange(this.baseRange)){return{handled:false,focused:false}}return{handled:this.model.isHandled(this.baseRange).read(o),focused:this.baseRange===n}})}setState(e,t){this.viewModel.setState(this.baseRange,this.model.getState(this.baseRange).get().withInputValue(this.inputNumber,e),t,this.inputNumber)}toggleBothSides(){Ce(e=>{const t=this.model.getState(this.baseRange).get();this.model.setState(this.baseRange,t.toggle(this.inputNumber).toggle(this.inputNumber===1?2:1),true,e)})}getContextMenuActions(){const e=this.model.getState(this.baseRange).get();const t=this.model.isHandled(this.baseRange).get();const i=n=>{Ce(r=>{return this.viewModel.setState(this.baseRange,n,r,this.inputNumber)})};function s(n,r,d,l){const u=new ti(n,r,void 0,true,()=>{i(d)});u.checked=l;return u}const o=e.includesInput1&&e.includesInput2;return[this.baseRange.input1Diffs.length>0?s("mergeEditor.acceptInput1",c(7879,"Accept {0}",this.model.input1.title),e.toggle(1),e.includesInput1):void 0,this.baseRange.input2Diffs.length>0?s("mergeEditor.acceptInput2",c(7879,"Accept {0}",this.model.input2.title),e.toggle(2),e.includesInput2):void 0,this.baseRange.isConflicting?cd(s("mergeEditor.acceptBoth",c(7880,"Accept Both"),e.withInputValue(1,!o).withInputValue(2,!o),o),{enabled:this.baseRange.canBeCombined}):void 0,new Mi,this.baseRange.isConflicting?cd(s("mergeEditor.swap",c(7881,"Swap"),e.swap(),false),{enabled:!e.kind&&(!o||this.baseRange.isOrderRelevant)}):void 0,cd(new ti("mergeEditor.markAsHandled",c(7882,"Mark as Handled"),void 0,true,()=>{Ce(n=>{this.model.setHandled(this.baseRange,!t,n)})}),{checked:t})].filter(ki)}}class $T extends k{constructor(e,t,i){super();this.isMultiLine=Ri(this,false);this.item=Ri(this,e);const s=new Wg({isChecked:false,title:"",icon:A.check,...zl});s.domNode.classList.add("accept-conflict-group");this._register(J(s.domNode,se.MOUSE_DOWN,o=>{const n=this.item.get();if(!n){return}if(o.button===2){o.stopPropagation();o.preventDefault();i.showContextMenu({getAnchor:()=>s.domNode,getActions:()=>n.getContextMenuActions()})}else if(o.button===1){o.stopPropagation();o.preventDefault();n.toggleBothSides()}}));this._register(ii(o=>{const n=this.item.read(o);const r=n.toggleState.read(o);const d={[qs.excluded]:{icon:void 0,checked:false,title:c(7883,"Accept")},[qs.unrecognized]:{icon:A.circleFilled,checked:false,title:c(7884,"Accept (result is dirty)")},[qs.first]:{icon:A.check,checked:true,title:c(7885,"Undo accept")},[qs.second]:{icon:A.checkAll,checked:true,title:c(7886,"Undo accept (currently second)")}};const l=d[r];s.setIcon(l.icon);s.checked=l.checked;s.setTitle(l.title);if(!n.enabled.read(o)){s.disable()}else{s.enable()}}));this._register(ii(o=>{const n=this.item.read(o).state.read(o);const r=["merge-accept-gutter-marker",n.handled&&"handled",n.focused&&"focused",this.isMultiLine.read(o)?"multi-line":"single-line"];t.className=r.filter(d=>typeof d==="string").join(" ")}));this._register(s.onChange(()=>{Ce(o=>{this.item.get().setState(s.checked,o)})}));t.appendChild(tt("div.background",[nE]).root);t.appendChild(this.checkboxDiv=tt("div.checkbox",[tt("div.checkbox-background",[s.domNode])]).root)}layout(e,t,i,s){const o=this.checkboxDiv.clientHeight;const n=t/2-o/2;const r=o;let d=e+n;const l=[r,i+s-r-o];const u=[e+r,e+t-o-r];if(u[0]<u[1]){d=Dr(d,l[0],l[1]);d=Dr(d,u[0],u[1])}this.checkboxDiv.style.top=`${d-e}px`;Ce(p=>{this.isMultiLine.set(t>30,p)})}update(e){Ce(t=>{this.item.set(e,t)})}}let bl=class jR extends Dh{constructor(e,t,i,s){super(t,e,s);this._labelService=i;this.decorations=Tt(this,n=>{const r=this.viewModel.read(n);if(!r){return[]}const d=r.model;const l=d.resultTextModel;const u=new Array;const p=Ff(d.modifiedBaseRanges.read(n),d.baseResultDiffs.read(n),(m,y)=>m.baseRange.touches(y.inputRange)?Gf.neitherLessOrGreaterThan:Va.compareByStart(m.baseRange,y.inputRange));const f=r.activeModifiedBaseRange.read(n);const g=r.showNonConflictingChanges.read(n);for(const m of p){const y=m.left;if(y){const C=["merge-editor-block"];let D=[0,0,0,0];const F=d.isHandled(y).read(n);if(F){C.push("handled")}if(y===f){C.push("focused");D=[0,2,0,2]}if(y.isConflicting){C.push("conflicting")}C.push("result");if(!y.isConflicting&&!g&&F){continue}const P=d.getLineRangeInResult(y.baseRange,n);u.push({range:P.toInclusiveRangeOrEmpty(),options:{showIfCollapsed:true,blockClassName:C.join(" "),blockPadding:D,blockIsAfterEnd:P.startLineNumber>l.getLineCount(),description:"Result Diff",minimap:{position:dh.Gutter,color:{id:F?mo:wo}},overviewRuler:y.isConflicting?{position:Dn.Center,color:{id:F?mo:wo}}:void 0}})}if(!y||y.isConflicting){for(const C of m.rights){const D=C.outputRange.toInclusiveRange();if(D){u.push({range:D,options:{className:`merge-editor-diff result`,description:"Merge Editor",isWholeLine:true}})}if(C.rangeMappings){for(const F of C.rangeMappings){u.push({range:F.outputRange,options:{className:`merge-editor-diff-word result`,description:"Merge Editor"}})}}}}}return u});this.editor.invokeWithinContext(n=>{const r=n.get(ee);const d=rE.bindTo(r);d.set(true);this._register(de(()=>d.reset()))});this.htmlElements.gutterDiv.style.width="5px";this.htmlElements.root.classList.add(`result`);this._register(ch((n,r)=>{if(this.checkboxesVisible.read(n)){r.add(new Ih(this.editor,this.htmlElements.gutterDiv,{getIntersectingGutterItems:(d,l)=>[],createView:(d,l)=>{throw new ka}}))}}));this._register(ii(n=>{const r=this.viewModel.read(n);if(!r){return}this.editor.setModel(r.model.resultTextModel);mi(this.htmlElements.title,...fi(c(7887,"Result")));mi(this.htmlElements.description,...fi(this._labelService.getUriLabel(r.model.resultTextModel.uri,{relative:true})))}));const o=this._register(new En(this.htmlElements.detail));this._register(ii(n=>{const r=this.viewModel.read(n);if(!r){return}const d=r.model;if(!d){return}const l=d.unhandledConflictsCount.read(n);const u=l===1?c(7888,"{0} Conflict Remaining",l):c(7889,"{0} Conflicts Remaining ",l);o.clear();o.push({class:void 0,enabled:l>0,id:"nextConflict",label:u,run(){r.model.telemetry.reportConflictCounterClicked();r.goToNextModifiedBaseRange(p=>!d.isHandled(p).get())},tooltip:l>0?c(7890,"Go to next conflict"):c(7891,"All conflicts handled, the merge can be completed now.")})}));this._register(lh(this.editor,this.decorations));this._register(Th(this,(n,r)=>r.model.translateBaseRangeToResult(n)));this._register(t.createInstance(vn,w.MergeInputResultToolbar,this.htmlElements.toolbar))}};bl=E([h(1,N),h(2,os),h(3,X)],bl);var Cl;var dr;Le(kT);let at=class YR extends aE{static{Cl=this}static{this.ID="mergeEditor"}get viewModel(){return this._viewModel}get inputModel(){return this._inputModel}get model(){return this.inputModel.get()?.model}constructor(e,t,i,s,o,n,r,d,l,u,p){super(Cl.ID,e,s,t,o,r,n,d,l,u);this.contextKeyService=i;this._codeEditorService=p;this._sessionDisposables=new L;this._viewModel=Ri(this,void 0);this._grid=this._register(new Ie);this.input1View=this._register(this.instantiationService.createInstance(oa,1,this._viewModel));this.baseView=Ri(this,void 0);this.baseViewOptions=Ri(this,void 0);this.input2View=this._register(this.instantiationService.createInstance(oa,2,this._viewModel));this.inputResultView=this._register(this.instantiationService.createInstance(bl,this._viewModel));this._layoutMode=this.instantiationService.createInstance(Sl);this._layoutModeObs=Ri(this,this._layoutMode.value);this._ctxIsMergeEditor=ue.bindTo(this.contextKeyService);this._ctxUsesColumnLayout=Do.bindTo(this.contextKeyService);this._ctxShowBase=Pa.bindTo(this.contextKeyService);this._ctxShowBaseAtTop=hh.bindTo(this.contextKeyService);this._ctxResultUri=dE.bindTo(this.contextKeyService);this._ctxBaseUri=cE.bindTo(this.contextKeyService);this._ctxShowNonConflictingChanges=Kf.bindTo(this.contextKeyService);this._inputModel=Ri(this,void 0);this.viewZoneComputer=new GT(this.input1View.editor,this.input2View.editor,this.inputResultView.editor);this.scrollSynchronizer=this._register(new LT(this._viewModel,this.input1View,this.input2View,this.baseView,this.inputResultView,this._layoutModeObs));this._onDidChangeSizeConstraints=new _;this.onDidChangeSizeConstraints=this._onDidChangeSizeConstraints.event;this.baseViewDisposables=this._register(new L);this.showNonConflictingChangesStore=this.instantiationService.createInstance(lE,"mergeEditor/showNonConflictingChanges");this.showNonConflictingChanges=Ri(this,this.showNonConflictingChangesStore.get()??false)}dispose(){this._sessionDisposables.dispose();this._ctxIsMergeEditor.reset();this._ctxUsesColumnLayout.reset();this._ctxShowNonConflictingChanges.reset();super.dispose()}get minimumWidth(){return this._layoutMode.value.kind==="mixed"?this.input1View.view.minimumWidth+this.input2View.view.minimumWidth:this.input1View.view.minimumWidth+this.input2View.view.minimumWidth+this.inputResultView.view.minimumWidth}getTitle(){if(this.input){return this.input.getName()}return c(7892,"Text Merge Editor")}createEditorControl(e,t){this.rootHtmlElement=e;e.classList.add("merge-editor");this.applyLayout(this._layoutMode.value);this.applyOptions(t)}updateEditorControlOptions(e){this.applyOptions(e)}applyOptions(e){const t=Yu(e,{minimap:{enabled:false},glyphMargin:false,lineNumbersMinChars:2});const i=Yu(t,{readOnly:true,readOnlyMessage:void 0});this.input1View.updateOptions(i);this.input2View.updateOptions(i);this.baseViewOptions.set({...this.input2View.editor.getRawOptions()},void 0);this.inputResultView.updateOptions(t)}getMainControl(){return this.inputResultView.editor}layout(e){this._grid.value?.layout(e.width,e.height)}async setInput(e,t,i,s){if(!(e instanceof Qi)){throw new ka("ONLY MergeEditorInput is supported")}await super.setInput(e,t,i,s);this._sessionDisposables.clear();Ce(f=>{this._viewModel.set(void 0,f);this._inputModel.set(void 0,f)});const o=await e.resolve();const n=o.model;const r=this.instantiationService.createInstance(yl,n,this.input1View,this.input2View,this.inputResultView,this.baseView,this.showNonConflictingChanges);n.telemetry.reportMergeEditorOpened({combinableConflictCount:n.combinableConflictCount,conflictCount:n.conflictCount,baseTop:this._layoutModeObs.get().showBaseAtTop,baseVisible:this._layoutModeObs.get().showBase,isColumnView:this._layoutModeObs.get().kind==="columns"});Ce(f=>{this._viewModel.set(r,f);this._inputModel.set(o,f)});this._sessionDisposables.add(r);this._sessionDisposables.add(ii(f=>{const g=r.focusedEditorType.read(f);if(!(e instanceof Qi)){return}e.updateFocusedEditor(g||"result")}));this._ctxResultUri.set(o.resultUri.toString());this._ctxBaseUri.set(n.base.uri.toString());this._sessionDisposables.add(de(()=>{this._ctxBaseUri.reset();this._ctxResultUri.reset()}));const d=new L;this._sessionDisposables.add(d);this._sessionDisposables.add(ch(f=>{const g=this.baseView.read(f);const m=this.inputResultView.editor.getScrollTop();this.scrollSynchronizer.stopSync();d.clear();this.inputResultView.editor.changeViewZones(y=>{const C=this._layoutModeObs.read(f);const D=C.kind==="columns";const F=C.kind==="mixed"&&!C.showBaseAtTop;this.input1View.editor.changeViewZones(P=>{this.input2View.editor.changeViewZones(R=>{if(g){g.editor.changeViewZones(z=>{d.add(this.setViewZones(f,r,this.input1View.editor,P,this.input2View.editor,R,g.editor,z,F,this.inputResultView.editor,y,D))})}else{d.add(this.setViewZones(f,r,this.input1View.editor,P,this.input2View.editor,R,void 0,void 0,false,this.inputResultView.editor,y,D))}})})});this.inputResultView.editor.setScrollTop(m,xt.Smooth);this.scrollSynchronizer.startSync();this.scrollSynchronizer.updateScrolling()}));const l=this.loadEditorViewState(e,i);if(l){this._applyViewState(l)}else{this._sessionDisposables.add(hE(n.onInitialized,()=>{const f=n.modifiedBaseRanges.get().find(g=>g.isConflicting);if(!f){return}this.input1View.editor.revealLineInCenter(f.input1Range.startLineNumber);Ce(g=>{r.setActiveModifiedBaseRange(f,g)})}))}const u=f=>{const g=uE(f,this._codeEditorService);Jn(n.input2.textModel,g,this._codeEditorService);Jn(n.input1.textModel,g,this._codeEditorService);Jn(n.resultTextModel,g,this._codeEditorService);const m=this.baseView.get()?.editor.getModel();if(m){Jn(m,g,this._codeEditorService)}};this._sessionDisposables.add(this._codeEditorService.onDidChangeTransientModelProperty(f=>{u(f)}));u(this.inputResultView.editor.getModel());const p=this;this._sessionDisposables.add(new class{constructor(){this._disposable=new L;for(const f of this.baseInput1Input2()){this._disposable.add(f.onDidChangeContent(()=>this._checkBaseInput1Input2AllEmpty()))}}dispose(){this._disposable.dispose()}*baseInput1Input2(){yield n.base;yield n.input1.textModel;yield n.input2.textModel}_checkBaseInput1Input2AllEmpty(){for(const f of this.baseInput1Input2()){if(f.getValueLength()>0){return}}p.editorService.replaceEditors([{editor:e,replacement:{resource:e.result,options:{preserveFocus:true}},forceReplaceDirty:true}],p.group)}})}setViewZones(e,t,i,s,o,n,r,d,l,u,p,f){const g=[];const m=[];const y=[];const C=[];const D=this.viewZoneComputer.computeViewZones(e,t,{codeLensesVisible:true,showNonConflictingChanges:this.showNonConflictingChanges.read(e),shouldAlignBase:l,shouldAlignResult:f});const F=new L;if(d){for(const P of D.baseViewZones){P.create(d,y,F)}}for(const P of D.resultViewZones){P.create(p,C,F)}for(const P of D.input1ViewZones){P.create(s,g,F)}for(const P of D.input2ViewZones){P.create(n,m,F)}F.add({dispose:()=>{i.changeViewZones(P=>{for(const R of g){P.removeZone(R)}});o.changeViewZones(P=>{for(const R of m){P.removeZone(R)}});r?.changeViewZones(P=>{for(const R of y){P.removeZone(R)}});u.changeViewZones(P=>{for(const R of C){P.removeZone(R)}})}});return F}setOptions(e){super.setOptions(e);if(e){oh(e,this.inputResultView.editor,xt.Smooth)}}clearInput(){super.clearInput();this._sessionDisposables.clear();for(const{editor:e}of[this.input1View,this.input2View,this.inputResultView]){e.setModel(null)}}focus(){super.focus();(this.getControl()??this.inputResultView.editor).focus()}hasFocus(){for(const{editor:e}of[this.input1View,this.input2View,this.inputResultView]){if(e.hasTextFocus()){return true}}return super.hasFocus()}setEditorVisible(e){super.setEditorVisible(e);for(const{editor:t}of[this.input1View,this.input2View,this.inputResultView]){if(e){t.onVisible()}else{t.onHide()}}this._ctxIsMergeEditor.set(e)}getControl(){return this.inputResultView.editor}get scopedContextKeyService(){const e=this.getControl();return e?.invokeWithinContext(t=>t.get(ee))}toggleBase(){this.setLayout({...this._layoutMode.value,showBase:!this._layoutMode.value.showBase})}toggleShowBaseTop(){const e=this._layoutMode.value.showBase&&this._layoutMode.value.showBaseAtTop;this.setLayout({...this._layoutMode.value,showBaseAtTop:true,showBase:!e})}toggleShowBaseCenter(){const e=this._layoutMode.value.showBase&&!this._layoutMode.value.showBaseAtTop;this.setLayout({...this._layoutMode.value,showBaseAtTop:false,showBase:!e})}setLayoutKind(e){this.setLayout({...this._layoutMode.value,kind:e})}setLayout(e){const t=this._layoutMode.value;if(JSON.stringify(t)===JSON.stringify(e)){return}this.model?.telemetry.reportLayoutChange({baseTop:e.showBaseAtTop,baseVisible:e.showBase,isColumnView:e.kind==="columns"});this.applyLayout(e)}applyLayout(e){Ce(t=>{if(e.showBase&&!this.baseView.get()){this.baseViewDisposables.clear();const i=this.baseViewDisposables.add(this.instantiationService.createInstance(vl,this.viewModel));this.baseViewDisposables.add(ii(s=>{const o=this.baseViewOptions.read(s);if(o){i.updateOptions(o)}}));this.baseView.set(i,t)}else if(!e.showBase&&this.baseView.get()){this.baseView.set(void 0,t);this.baseViewDisposables.clear()}if(e.kind==="mixed"){this.setGrid([e.showBaseAtTop&&e.showBase?{size:38,data:this.baseView.get().view}:void 0,{size:38,groups:[{data:this.input1View.view},!e.showBaseAtTop&&e.showBase?{data:this.baseView.get().view}:void 0,{data:this.input2View.view}].filter(ki)},{size:62,data:this.inputResultView.view}].filter(ki))}else if(e.kind==="columns"){this.setGrid([e.showBase?{size:40,data:this.baseView.get().view}:void 0,{size:60,groups:[{data:this.input1View.view},{data:this.inputResultView.view},{data:this.input2View.view}]}].filter(ki))}this._layoutMode.value=e;this._ctxUsesColumnLayout.set(e.kind);this._ctxShowBase.set(e.showBase);this._ctxShowBaseAtTop.set(e.showBaseAtTop);this._onDidChangeSizeConstraints.fire();this._layoutModeObs.set(e,t)})}setGrid(e){let t=-1;let i=-1;if(this._grid.value){t=this._grid.value.width;i=this._grid.value.height}this._grid.value=Ji.from({orientation:q.VERTICAL,size:100,groups:e},{styles:{separatorBorder:this.theme.getColor(KT)??Bt.transparent},proportionalLayout:true});mi(this.rootHtmlElement,this._grid.value.element);if(t!==-1){this._grid.value.layout(t,i)}}_applyViewState(e){if(!e){return}this.inputResultView.editor.restoreViewState(e);if(e.input1State){this.input1View.editor.restoreViewState(e.input1State)}if(e.input2State){this.input2View.editor.restoreViewState(e.input2State)}if(e.focusIndex>=0){[this.input1View.editor,this.input2View.editor,this.inputResultView.editor][e.focusIndex].focus()}}computeEditorViewState(e){if(!vi(this.inputModel.get()?.resultUri,e)){return void 0}const t=this.inputResultView.editor.saveViewState();if(!t){return void 0}const i=this.input1View.editor.saveViewState()??void 0;const s=this.input2View.editor.saveViewState()??void 0;const o=[this.input1View.editor,this.input2View.editor,this.inputResultView.editor].findIndex(n=>n.hasWidgetFocus());return{...t,input1State:i,input2State:s,focusIndex:o}}tracksEditorViewState(e){return e instanceof Qi}toggleShowNonConflictingChanges(){this.showNonConflictingChanges.set(!this.showNonConflictingChanges.get(),void 0);this.showNonConflictingChangesStore.set(this.showNonConflictingChanges.get());this._ctxShowNonConflictingChanges.set(this.showNonConflictingChanges.get())}};at=Cl=E([h(1,N),h(2,ee),h(3,si),h(4,le),h(5,pe),h(6,Rn),h(7,Y),h(8,qe),h(9,je),h(10,So)],at);let Sl=class ZR{static{dr=this}static{this._key="mergeEditor/layout"}constructor(e){this._storageService=e;this._value={kind:"mixed",showBase:false,showBaseAtTop:true};const t=e.get(dr._key,M.PROFILE,"mixed");if(t==="mixed"||t==="columns"){this._value={kind:t,showBase:false,showBaseAtTop:true}}else if(t){try{this._value=JSON.parse(t)}catch(i){co(i)}}}get value(){return this._value}set value(e){if(this._value!==e){this._value=e;this._storageService.store(dr._key,JSON.stringify(this._value),M.PROFILE,Ee.USER)}}};Sl=dr=E([h(0,le)],Sl);let _l=class JR extends k{constructor(e,t){super();this._editorService=e;this._store.add(t.registerCodeEditorOpenHandler(this.openCodeEditorFromMergeEditor.bind(this)))}async openCodeEditorFromMergeEditor(e,t,i){const s=this._editorService.activeEditorPane;if(!i&&e.options&&s instanceof at&&s.getControl()&&s.input instanceof Qi&&vi(e.resource,s.input.result)){const o=s.getControl();oh(e.options,o,xt.Smooth);return o}return null}};_l=E([h(0,Y),h(1,So)],_l);let na=class XR extends k{static{this.ID="workbench.contrib.mergeEditorResolver"}constructor(e,t){super();const i=s=>{return{editor:t.createInstance(Qi,s.base.resource,{uri:s.input1.resource,title:s.input1.label??Oi(s.input1.resource),description:s.input1.description??"",detail:s.input1.detail},{uri:s.input2.resource,title:s.input2.label??Oi(s.input2.resource),description:s.input2.description??"",detail:s.input2.detail},s.result.resource)}};this._register(e.registerEditor(`*`,{id:Ot.id,label:Ot.displayName,detail:Ot.providerDisplayName,priority:be.builtin},{},{createMergeEditorInput:i}))}};na=E([h(0,la),h(1,N)],na);class ai extends j{constructor(e){super(e)}run(e){const{activeEditorPane:t}=e.get(Y);if(t instanceof at){const i=t.viewModel.get();if(!i){return}this.runWithViewModel(i,e)}}}class Rh extends j{constructor(e){super(e)}run(e,...t){const{activeEditorPane:i}=e.get(Y);if(i instanceof at){const s=i.viewModel.get();if(!s){return}return this.runWithMergeEditor({viewModel:s,inputModel:i.inputModel.get(),input:i.input,editorIdentifier:{editor:i.input,groupId:i.group.id}},e,...t)}}}class qT extends j{constructor(){super({id:"_open.mergeEditor",title:I(7763,"Open Merge Editor")})}run(e,...t){const i=El.validate(t[0]);const s={base:{resource:i.base},input1:{resource:i.input1.uri,label:i.input1.title,description:i.input1.description,detail:i.input1.detail},input2:{resource:i.input2.uri,label:i.input2.title,description:i.input2.description,detail:i.input2.detail},result:{resource:i.output},options:{preserveFocus:true}};e.get(Y).openEditor(s)}}var El;(function(a){function e(o){if(!o||typeof o!=="object"){throw new TypeError("invalid argument")}const n=o;const r=i(n.base);const d=i(n.output);const l=t(n.input1);const u=t(n.input2);return{base:r,input1:l,input2:u,output:d}}a.validate=e;function t(o){if(typeof o==="string"){return new jo(K.parse(o,true),void 0,void 0,void 0)}if(!o||typeof o!=="object"){throw new TypeError("invalid argument")}if(s(o)){return new jo(K.revive(o),void 0,void 0,void 0)}const n=o;const r=n.title;const d=i(n.uri);const l=n.detail;const u=n.description;return new jo(d,r,l,u)}function i(o){if(typeof o==="string"){return K.parse(o,true)}else if(o&&typeof o==="object"){return K.revive(o)}throw new TypeError("invalid argument")}function s(o){if(!o||typeof o!=="object"){return false}const n=o;return typeof n.scheme==="string"&&typeof n.authority==="string"&&typeof n.path==="string"&&typeof n.query==="string"&&typeof n.fragment==="string"}})(El||(El={}));class jT extends j{constructor(){super({id:"merge.mixedLayout",title:I(7764,"Mixed Layout"),toggled:Do.isEqualTo("mixed"),menu:[{id:w.EditorTitle,when:ue,group:"1_merge",order:9}],precondition:ue})}run(e){const{activeEditorPane:t}=e.get(Y);if(t instanceof at){t.setLayoutKind("mixed")}}}class YT extends j{constructor(){super({id:"merge.columnLayout",title:I(7765,"Column Layout"),toggled:Do.isEqualTo("columns"),menu:[{id:w.EditorTitle,when:ue,group:"1_merge",order:10}],precondition:ue})}run(e){const{activeEditorPane:t}=e.get(Y);if(t instanceof at){t.setLayoutKind("columns")}}}class ZT extends j{constructor(){super({id:"merge.showNonConflictingChanges",title:I(7766,"Show Non-Conflicting Changes"),toggled:Kf.isEqualTo(true),menu:[{id:w.EditorTitle,when:ue,group:"3_merge",order:9}],precondition:ue})}run(e){const{activeEditorPane:t}=e.get(Y);if(t instanceof at){t.toggleShowNonConflictingChanges()}}}class JT extends j{constructor(){super({id:"merge.showBase",title:I(7767,"Show Base"),toggled:Pa.isEqualTo(true),menu:[{id:w.EditorTitle,when:S.and(ue,Do.isEqualTo("columns")),group:"2_merge",order:9}]})}run(e){const{activeEditorPane:t}=e.get(Y);if(t instanceof at){t.toggleBase()}}}class XT extends j{constructor(){super({id:"merge.showBaseTop",title:I(7768,"Show Base Top"),toggled:S.and(Pa,hh),menu:[{id:w.EditorTitle,when:S.and(ue,Do.isEqualTo("mixed")),group:"2_merge",order:10}]})}run(e){const{activeEditorPane:t}=e.get(Y);if(t instanceof at){t.toggleShowBaseTop()}}}class QT extends j{constructor(){super({id:"merge.showBaseCenter",title:I(7769,"Show Base Center"),toggled:S.and(Pa,hh.negate()),menu:[{id:w.EditorTitle,when:S.and(ue,Do.isEqualTo("mixed")),group:"2_merge",order:11}]})}run(e){const{activeEditorPane:t}=e.get(Y);if(t instanceof at){t.toggleShowBaseCenter()}}}const ct=I(7770,"Merge Editor");class eA extends ai{constructor(){super({id:"merge.openResult",icon:A.goToFile,title:I(7771,"Open File"),category:ct,menu:[{id:w.EditorTitle,when:ue,group:"navigation",order:1}],precondition:ue})}runWithViewModel(e,t){const i=t.get(Y);i.openEditor({resource:e.model.resultTextModel.uri})}}class tA extends ai{constructor(){super({id:"merge.goToNextUnhandledConflict",category:ct,title:I(7772,"Go to Next Unhandled Conflict"),icon:A.arrowDown,menu:[{id:w.EditorTitle,when:ue,group:"navigation",order:3}],f1:true,precondition:ue})}runWithViewModel(e){e.model.telemetry.reportNavigationToNextConflict();e.goToNextModifiedBaseRange(t=>!e.model.isHandled(t).get())}}class iA extends ai{constructor(){super({id:"merge.goToPreviousUnhandledConflict",category:ct,title:I(7773,"Go to Previous Unhandled Conflict"),icon:A.arrowUp,menu:[{id:w.EditorTitle,when:ue,group:"navigation",order:2}],f1:true,precondition:ue})}runWithViewModel(e){e.model.telemetry.reportNavigationToPreviousConflict();e.goToPreviousModifiedBaseRange(t=>!e.model.isHandled(t).get())}}class sA extends ai{constructor(){super({id:"merge.toggleActiveConflictInput1",category:ct,title:I(7774,"Toggle Current Conflict from Left"),f1:true,precondition:ue})}runWithViewModel(e){e.toggleActiveConflict(1)}}class oA extends ai{constructor(){super({id:"merge.toggleActiveConflictInput2",category:ct,title:I(7775,"Toggle Current Conflict from Right"),f1:true,precondition:ue})}runWithViewModel(e){e.toggleActiveConflict(2)}}class nA extends ai{constructor(){super({id:"mergeEditor.compareInput1WithBase",category:ct,title:I(7776,"Compare Input 1 With Base"),shortTitle:c(7777,"Compare With Base"),f1:true,precondition:ue,menu:{id:w.MergeInput1Toolbar,group:"primary"},icon:A.compareChanges})}runWithViewModel(e,t){const i=t.get(Y);Wm(e,i,1)}}class rA extends ai{constructor(){super({id:"mergeEditor.compareInput2WithBase",category:ct,title:I(7778,"Compare Input 2 With Base"),shortTitle:c(7777,"Compare With Base"),f1:true,precondition:ue,menu:{id:w.MergeInput2Toolbar,group:"primary"},icon:A.compareChanges})}runWithViewModel(e,t){const i=t.get(Y);Wm(e,i,2)}}async function Wm(a,e,t){e.openEditor(e.activeEditor,{pinned:true});const i=a.model;const s=i.base;const o=t===1?a.inputCodeEditorView1.editor:a.inputCodeEditorView2.editor;const n=o.getPosition().lineNumber;await e.openEditor({original:{resource:s.uri},modified:{resource:o.getModel().uri},options:{selection:{startLineNumber:n,startColumn:1},revealIfOpened:true,revealIfVisible:true}})}class aA extends ai{constructor(){super({id:"merge.openBaseEditor",category:ct,title:I(7779,"Open Base File"),f1:true,precondition:ue})}runWithViewModel(e,t){const i=t.get(St);i.open(e.model.base.uri)}}class dA extends ai{constructor(){super({id:"merge.acceptAllInput1",category:ct,title:I(7780,"Accept All Incoming Changes from Left"),f1:true,precondition:ue,menu:{id:w.MergeInput1Toolbar,group:"primary"},icon:A.checkAll})}runWithViewModel(e){e.acceptAll(1)}}class cA extends ai{constructor(){super({id:"merge.acceptAllInput2",category:ct,title:I(7781,"Accept All Current Changes from Right"),f1:true,precondition:ue,menu:{id:w.MergeInput2Toolbar,group:"primary"},icon:A.checkAll})}runWithViewModel(e){e.acceptAll(2)}}class lA extends ai{constructor(){super({id:"mergeEditor.resetResultToBaseAndAutoMerge",category:ct,title:I(7782,"Reset Result"),shortTitle:c(7783,"Reset"),f1:true,precondition:ue,menu:{id:w.MergeInputResultToolbar,group:"primary"},icon:A.discard})}runWithViewModel(e,t){e.model.reset()}}class hA extends j{constructor(){super({id:"mergeEditor.resetCloseWithConflictsChoice",category:ct,title:I(7784,"Reset Choice for 'Close with Conflicts'"),f1:true})}run(e){e.get(le).remove(pE,M.PROFILE)}}class uA extends Rh{constructor(){super({id:"mergeEditor.acceptAllCombination",category:ct,title:I(7785,"Accept All Combination"),f1:true})}runWithMergeEditor(e,t,...i){const{viewModel:s}=e;const o=s.model.modifiedBaseRanges.get();const n=s.model;Ce(r=>{for(const d of o){const l=n.getState(d).get();if(l.kind!==hs.unrecognized&&!l.isInputIncluded(1)&&(!l.isInputIncluded(2)||!s.shouldUseAppendInsteadOfAccept.get())&&d.canBeCombined){n.setState(d,l.withInputValue(1,true).withInputValue(2,true,true),true,r);n.telemetry.reportSmartCombinationInvoked(l.includesInput(2))}}});return{success:true}}}class pA extends Rh{constructor(){super({id:"mergeEditor.acceptMerge",category:ct,title:I(7786,"Complete Merge"),f1:true,precondition:ue,keybinding:[{primary:O.CtrlCmd|T.Enter,weight:B.EditorContrib,when:ue}]})}async runWithMergeEditor({inputModel:e,editorIdentifier:t,viewModel:i},s){const o=s.get(Ls);const n=s.get(Y);if(i.model.unhandledConflictsCount.get()>0){const{confirmed:r}=await o.confirm({message:c(7787,"Do you want to complete the merge of {0}?",Oi(e.resultUri)),detail:c(7788,"The file contains unhandled conflicts."),primaryButton:c(7789,"&&Complete with Conflicts")});if(!r){return{successful:false}}}await e.accept();await n.closeEditor(t);return{successful:true}}}class gA extends Rh{constructor(){super({id:"mergeEditor.toggleBetweenInputs",category:ct,title:I(7790,"Toggle Between Merge Editor Inputs"),f1:true,precondition:ue,keybinding:[{primary:O.CtrlCmd|O.Shift|T.KeyT,weight:B.WorkbenchContrib+10,when:ue}]})}runWithMergeEditor({viewModel:e},t){const i=e.inputCodeEditorView1.editor.hasWidgetFocus();if(i){e.inputCodeEditorView2.editor.focus()}else{e.inputCodeEditorView1.editor.focus()}}}const Vh=I(7791,"Merge Editor (Dev)");class fA extends j{constructor(){super({id:"merge.dev.copyContentsJson",category:Vh,title:I(7792,"Copy Merge Editor State as JSON"),icon:A.layoutCentered,f1:true,precondition:ue})}run(e){const{activeEditorPane:t}=e.get(Y);const i=e.get(kd);const s=e.get(Qe);if(!(t instanceof at)){s.info({name:c(7793,"Merge Editor"),message:c(7794,"No active merge editor")});return}const o=t.model;if(!o){return}const n={languageId:o.resultTextModel.getLanguageId(),base:o.base.getValue(),input1:o.input1.textModel.getValue(),input2:o.input2.textModel.getValue(),result:o.resultTextModel.getValue(),initialResult:o.getInitialResultValue()};const r=JSON.stringify(n,void 0,4);i.writeText(r);s.info({name:c(7793,"Merge Editor"),message:c(7795,"Successfully copied merge editor state")})}}class mA extends j{constructor(){super({id:"merge.dev.saveContentsToFolder",category:Vh,title:I(7796,"Save Merge Editor State to Folder"),icon:A.layoutCentered,f1:true,precondition:ue})}async run(e){const{activeEditorPane:t}=e.get(Y);const i=e.get(Qe);const s=e.get(zf);const o=e.get(je);const n=e.get(In);if(!(t instanceof at)){i.info({name:c(7793,"Merge Editor"),message:c(7794,"No active merge editor")});return}const r=t.model;if(!r){return}const d=await s.showOpenDialog({canSelectFiles:false,canSelectFolders:true,canSelectMany:false,title:c(7797,"Select folder to save to")});if(!d){return}const l=d[0];const u=n.getExtensions(r.resultTextModel.getLanguageId())[0]||"";async function p(f,g){await o.writeFile(K.joinPath(l,f+u),$f.fromString(g),{})}await Promise.all([p("base",r.base.getValue()),p("input1",r.input1.textModel.getValue()),p("input2",r.input2.textModel.getValue()),p("result",r.resultTextModel.getValue()),p("initialResult",r.getInitialResultValue())]);i.info({name:c(7793,"Merge Editor"),message:c(7798,"Successfully saved merge editor state to folder")})}}class wA extends j{constructor(){super({id:"merge.dev.loadContentsFromFolder",category:Vh,title:I(7799,"Load Merge Editor State from Folder"),icon:A.layoutCentered,f1:true})}async run(e,t){const i=e.get(zf);const s=e.get(Y);const o=e.get(je);const n=e.get(kt);if(!t){t={}}let r;if(!t.folderUri){const C=await i.showOpenDialog({canSelectFiles:false,canSelectFolders:true,canSelectMany:false,title:c(7797,"Select folder to save to")});if(!C){return}r=C[0]}else{r=t.folderUri}const d=await o.resolve(r);function l(C){return d.children.find(D=>D.name.startsWith(C))?.resource}const u=await vA(n,t.resultState);const p=l("base");const f=l("input1");const g=l("input2");const m=l(u?"initialResult":"result");const y={base:{resource:p},input1:{resource:f,label:"Input 1",description:"Input 1",detail:"(from file)"},input2:{resource:g,label:"Input 2",description:"Input 2",detail:"(from file)"},result:{resource:m}};s.openEditor(y)}}async function vA(a,e){if(e){return e==="initial"}const t=await a.pick([{label:"result",result:false},{label:"initial result",result:true}],{canPickMany:false});return t?.result}class yA{canSerialize(){return true}serialize(e){return JSON.stringify(this.toJSON(e))}toJSON(e){return{base:e.base,input1:e.input1,input2:e.input2,result:e.result}}deserialize(e,t){try{const i=gE(t);return e.createInstance(Qi,i.base,new jo(i.input1.uri,i.input1.title,i.input1.detail,i.input1.description),new jo(i.input2.uri,i.input2.title,i.input2.detail,i.input2.description),i.result)}catch(i){co(i);return void 0}}}class bA{constructor(){this.name="mergeEditor";this.type=Zu.Help;this.priority=125;this.when=fE.create("isMergeEditor",true)}getProvider(e){const t=e.get(So);const i=t.getActiveCodeEditor()||t.getFocusedCodeEditor();if(!i){return}const s=[c(7803,"You are in a merge editor."),c(7804,"Navigate between merge conflicts using the commands Go to Next Unhandled Conflict{0} and Go to Previous Unhandled Conflict{1}.","<keybinding:merge.goToNextUnhandledConflict>","<keybinding:merge.goToPreviousUnhandledConflict>"),c(7805,"Run the command Merge Editor: Accept All Incoming Changes from the Left{0} and Merge Editor: Accept All Current Changes from the Right{1}","<keybinding:merge.acceptAllInput1>","<keybinding:merge.acceptAllInput2>"),c(7806,"Complete the Merge{0}.","<keybinding:mergeEditor.acceptMerge>"),c(7807,"Toggle between merge editor inputs, incoming and current changes {0}.","<keybinding:mergeEditor.toggleBetweenInputs>")];return new mE(wE.MergeEditor,{type:Zu.Help},()=>s.join("\n"),()=>i.focus(),vE.MergeEditor)}}W.as(Ct.EditorPane).registerEditorPane(Ni.create(at,at.ID,c(7800,"Merge Editor")),[new Q(Qi)]);W.as(Ct.EditorFactory).registerEditorSerializer(Qi.ID,yA);W.as(Co.Configuration).registerConfiguration({properties:{"mergeEditor.diffAlgorithm":{type:"string",enum:["legacy","advanced"],default:"advanced",markdownEnumDescriptions:[c(7801,"Uses the legacy diffing algorithm."),c(7802,"Uses the advanced diffing algorithm.")]},"mergeEditor.showDeletionMarkers":{type:"boolean",default:true,description:"Controls if deletions in base or one of the inputs should be indicated by a vertical bar."}}});v(eA);v(jT);v(YT);v(qT);v(aA);v(ZT);v(JT);v(XT);v(QT);v(tA);v(iA);v(sA);v(oA);v(nA);v(rA);v(dA);v(cA);v(lA);v(pA);v(hA);v(uA);v(gA);v(fA);v(mA);v(wA);W.as(pa.Workbench).registerWorkbenchContribution(_l,_n.Restored);Ci(na.ID,na,Si.BlockStartup);yE.register(new bA);const CA=100;function Ao(a,e){a?.addImplementation(CA,"webview",t=>{const i=t.get(Ps);const s=i.activeWebview;if(s?.isFocused){e(s);return true}if(Rl()?.classList.contains("action-menu-item")){const o=t.get(Y);if(o.activeEditor instanceof ho){e(o.activeEditor.webview);return true}}return false})}Ao(Qp,a=>a.undo());Ao(eg,a=>a.redo());Ao(bE,a=>a.selectAll());Ao(Fd,a=>a.copy());Ao(Gd,a=>a.paste());Ao(Bd,a=>a.cut());const kh="preventDefaultContextMenuItems";if(Bd){b.appendMenuItem(w.WebviewContext,{command:{id:Bd.id,title:c(11471,"Cut")},group:"5_cutcopypaste",order:1,when:S.not(kh)})}if(Fd){b.appendMenuItem(w.WebviewContext,{command:{id:Fd.id,title:c(11472,"Copy")},group:"5_cutcopypaste",order:2,when:S.not(kh)})}if(Gd){b.appendMenuItem(w.WebviewContext,{command:{id:Gd.id,title:c(11473,"Paste")},group:"5_cutcopypaste",order:3,when:S.not(kh)})}const SA="workbench.action.openSettings";const _A=c(7434,"Configure");let Il=class QR extends k{constructor(e,t){super();const i=[new EA,new IA];const s=i.map(r=>new DA(t,r));s.forEach(r=>this._register(r));let o;const n=()=>{const r=e.activeTextEditorControl;if(r===o){return}o=r;const d=Jt(r);s.forEach(l=>l.onActiveEditorChanged(d))};this._register(e.onDidActiveEditorChange(n));n()}};Il=E([h(0,Y),h(1,Nf)],Il);class EA{constructor(){this.id="decoratorsLimitInfo";this.name=c(7435,"Color Decorator Status");this.label=c(7436,"Color decorators");this.source=c(7437,"Color Decorators");this.settingsId="editor.colorDecoratorsLimit"}getLimitReporter(e){return CE.get(e)?.limitReporter}}class IA{constructor(){this.id="foldingLimitInfo";this.name=c(7438,"Folding Status");this.label=c(7439,"Folding ranges");this.source=c(7440,"Folding");this.settingsId="editor.foldingMaximumRegions"}getLimitReporter(e){return Bf.get(e)?.limitReporter}}class DA{constructor(e,t){this.languageStatusService=e;this.accessor=t}onActiveEditorChanged(e){if(this._indicatorChangeListener){this._indicatorChangeListener.dispose();this._indicatorChangeListener=void 0}let t;if(e){t=this.accessor.getLimitReporter(e)}this.updateStatusItem(t);if(t){this._indicatorChangeListener=t.onDidChange(i=>{this.updateStatusItem(t)});return true}return false}updateStatusItem(e){if(this._limitStatusItem){this._limitStatusItem.dispose();this._limitStatusItem=void 0}if(e&&e.limited!==false){const t={id:this.accessor.id,selector:"*",name:this.accessor.name,severity:ve.Warning,label:this.accessor.label,detail:c(7441,"only {0} shown for performance reasons",e.limited),command:{id:SA,arguments:[this.accessor.settingsId],title:_A},accessibilityInfo:void 0,source:this.accessor.source,busy:false};this._limitStatusItem=this.languageStatusService.addStatus(t)}}dispose(){this._limitStatusItem=void 0;this._indicatorChangeListener=void 0}}W.as(pa.Workbench).registerWorkbenchContribution(Il,_n.Restored);let Dl=class eV{constructor(e,t){this.configurationService=e;this.layoutService=t;this.disposables=new L;const i=x.filter(e.onDidChangeConfiguration,o=>o.affectsConfiguration("workbench.sash.size"));i(this.onDidChangeSize,this,this.disposables);this.onDidChangeSize();const s=x.filter(e.onDidChangeConfiguration,o=>o.affectsConfiguration("workbench.sash.hoverDelay"));s(this.onDidChangeHoverDelay,this,this.disposables);this.onDidChangeHoverDelay()}onDidChangeSize(){const e=this.configurationService.getValue("workbench.sash.size");const t=Dr(e,4,20);const i=Dr(e,1,8);this.layoutService.mainContainer.style.setProperty("--vscode-sash-size",t+"px");this.layoutService.mainContainer.style.setProperty("--vscode-sash-hover-size",i+"px");SE(t)}onDidChangeHoverDelay(){_E(this.configurationService.getValue("workbench.sash.hoverDelay"))}dispose(){this.disposables.dispose()}};Dl=E([h(0,X),h(1,lg)],Dl);W.as(pa.Workbench).registerWorkbenchContribution(Dl,_n.Restored);W.as(Co.Configuration).registerConfiguration({...No,properties:{"workbench.sash.size":{type:"number",default:yr?20:4,minimum:1,maximum:20,description:c(9069,"Controls the feedback area size in pixels of the dragging area in between views/editors. Set it to a larger value if you feel it's hard to resize views using the mouse.")},"workbench.sash.hoverDelay":{type:"number",default:300,minimum:0,maximum:2e3,description:c(9070,"Controls the hover feedback delay in milliseconds of the dragging area in between views/editors.")}}});new U("inSettingsEditor",false);new U("inSettingsJSONEditor",false);new U("inSettingsSearch",false);new U("settingsTocRowFocus",false);new U("settingRowFocus",false);new U("inKeybindings",false);new U("inKeybindingsSearch",false);new U("keybindingFocus",false);new U("whenFocus",false);const cr="workbench.action.openKeyboardLayoutPicker";c(8822,"Preview setting: this setting controls a new feature that is still under refinement yet ready to use. Feedback is welcome.");c(8823,"Experimental setting: this setting controls a new feature that is actively being developed and may be unstable. It is subject to change or removal.");const TA=new Set;["css","html","scss","less","json","js","ts","ie","id","php","scm"].forEach(a=>TA.add(a));const Hn=new Map;Hn.set("power shell","PowerShell");Hn.set("powershell","PowerShell");Hn.set("javascript","JavaScript");Hn.set("typescript","TypeScript");Hn.set("github","GitHub");let ra=class tV extends k{static{this.ID="workbench.contrib.keyboardLayoutPicker"}constructor(e,t){super();this.keyboardLayoutService=e;this.statusbarService=t;this.pickerElement=this._register(new Ie);const i=c(8576,"Keyboard Layout");const s=this.keyboardLayoutService.getCurrentKeyboardLayout();if(s){const o=Tr(s);const n=c(8577,"Layout: {0}",o.label);this.pickerElement.value=this.statusbarService.addEntry({name:i,text:n,ariaLabel:n,command:cr},"status.workbench.keyboardLayout",Ke.RIGHT)}this._register(this.keyboardLayoutService.onDidChangeKeyboardLayout(()=>{const o=this.keyboardLayoutService.getCurrentKeyboardLayout();const n=Tr(o);if(this.pickerElement.value){const r=c(8577,"Layout: {0}",n.label);this.pickerElement.value.update({name:i,text:r,ariaLabel:r,command:cr})}else{const r=c(8577,"Layout: {0}",n.label);this.pickerElement.value=this.statusbarService.addEntry({name:i,text:r,ariaLabel:r,command:cr},"status.workbench.keyboardLayout",Ke.RIGHT)}}))}};ra=E([h(0,qf),h(1,ss)],ra);Ci(ra.ID,ra,Si.BlockStartup);const AA=[`// ${c(8578,"Defines the keyboard layout used in VS Code in the browser environment.")}`,`// ${c(8579,'Open VS Code and run "Developer: Inspect Key Mappings (JSON)" from Command Palette.')}`,``,`// Once you have the keyboard layout info, please paste it below.`,"\n"].join("\n");v(class extends j{constructor(){super({id:cr,title:I(8580,"Change Keyboard Layout"),f1:true})}async run(a){const e=a.get(qf);const t=a.get(kt);const i=a.get(X);const s=a.get(hg);const o=a.get(Y);const n=a.get(je);const r=e.getAllKeyboardLayouts();const d=e.getCurrentKeyboardLayout();const l=i.getValue("keyboard.layout");const u=l==="autodetect";const p=r.map(y=>{const C=!u&&Ju(d,y);const D=Tr(y);return{layout:y,label:[D.label,y&&y.isUserKeyboardLayout?"(User configured layout)":""].join(" "),id:y.text||y.lang||y.layout,description:D.description+(C?" (Current layout)":""),picked:!u&&Ju(d,y)}}).sort((y,C)=>{return y.label<C.label?-1:y.label>C.label?1:0});if(p.length>0){const y=mt?"Mac":dg?"Win":"Linux";p.unshift({type:"separator",label:c(8581,"Keyboard Layouts ({0})",y)})}const f={label:c(8582,"Configure Keyboard Layout")};p.unshift(f);const g={label:c(8583,"Auto Detect"),description:u?`Current: ${Tr(d).label}`:void 0,picked:u?true:void 0};p.unshift(g);const m=await t.pick(p,{placeHolder:c(8584,"Select Keyboard Layout"),matchOnDescription:true});if(!m){return}if(m===g){i.updateValue("keyboard.layout","autodetect");return}if(m===f){const y=s.keyboardLayoutResource;await n.stat(y).then(void 0,()=>{return n.createFile(y,$f.fromString(AA))}).then(C=>{if(!C){return void 0}return o.openEditor({resource:C.resource,languageId:"jsonc",options:{pinned:true}})},C=>{throw new Error(c(8585,"Unable to create '{0}' ({1}).",y.toString(),C))});return Promise.resolve()}i.updateValue("keyboard.layout",EE(m.layout))}});class Ka extends j{constructor(e,t){super(e);this.direction=t}run(e){const t=e.get(Te);const i=e.get(qe);const s=e.get(Vs);const o=t.hasFocus(V.EDITOR_PART);const n=t.hasFocus(V.PANEL_PART);const r=t.hasFocus(V.SIDEBAR_PART);const d=t.hasFocus(V.AUXILIARYBAR_PART);let l;if(o){const u=this.navigateAcrossEditorGroup(this.toGroupDirection(this.direction),i);if(u){return}l=t.getVisibleNeighborPart(V.EDITOR_PART,this.direction)}if(n){l=t.getVisibleNeighborPart(V.PANEL_PART,this.direction)}if(r){l=t.getVisibleNeighborPart(V.SIDEBAR_PART,this.direction)}if(d){l=l=t.getVisibleNeighborPart(V.AUXILIARYBAR_PART,this.direction)}if(l===V.EDITOR_PART){if(!this.navigateBackToEditorGroup(this.toGroupDirection(this.direction),i)){this.navigateToEditorGroup(this.direction===oe.Right?ft.FIRST:ft.LAST,i)}}else if(l===V.SIDEBAR_PART){this.navigateToSidebar(t,s)}else if(l===V.PANEL_PART){this.navigateToPanel(t,s)}else if(l===V.AUXILIARYBAR_PART){this.navigateToAuxiliaryBar(t,s)}}async navigateToPanel(e,t){if(!e.isVisible(V.PANEL_PART)){return false}const i=t.getActivePaneComposite($.Panel);if(!i){return false}const s=i.getId();const o=await t.openPaneComposite(s,$.Panel,true);if(!o){return false}return o}async navigateToSidebar(e,t){if(!e.isVisible(V.SIDEBAR_PART)){return false}const i=t.getActivePaneComposite($.Sidebar);if(!i){return false}const s=i.getId();const o=await t.openPaneComposite(s,$.Sidebar,true);return!!o}async navigateToAuxiliaryBar(e,t){if(!e.isVisible(V.AUXILIARYBAR_PART)){return false}const i=t.getActivePaneComposite($.AuxiliaryBar);if(!i){return false}const s=i.getId();const o=await t.openPaneComposite(s,$.AuxiliaryBar,true);if(!o){return false}return o}navigateAcrossEditorGroup(e,t){return this.doNavigateToEditorGroup({direction:e},t)}navigateToEditorGroup(e,t){return this.doNavigateToEditorGroup({location:e},t)}navigateBackToEditorGroup(e,t){if(!t.activeGroup){return false}const i=this.toOppositeDirection(e);const s=t.findGroup({direction:i},t.activeGroup);if(!s){t.activeGroup.focus();return true}return false}toGroupDirection(e){switch(e){case oe.Down:return he.DOWN;case oe.Left:return he.LEFT;case oe.Right:return he.RIGHT;case oe.Up:return he.UP}}toOppositeDirection(e){switch(e){case he.UP:return he.DOWN;case he.RIGHT:return he.LEFT;case he.LEFT:return he.RIGHT;case he.DOWN:return he.UP}}doNavigateToEditorGroup(e,t){const i=t.findGroup(e,t.activeGroup);if(i){i.focus();return true}return false}}v(class extends Ka{constructor(){super({id:"workbench.action.navigateLeft",title:I(2750,"Navigate to the View on the Left"),category:_e.View,f1:true},oe.Left)}});v(class extends Ka{constructor(){super({id:"workbench.action.navigateRight",title:I(2751,"Navigate to the View on the Right"),category:_e.View,f1:true},oe.Right)}});v(class extends Ka{constructor(){super({id:"workbench.action.navigateUp",title:I(2752,"Navigate to the View Above"),category:_e.View,f1:true},oe.Up)}});v(class extends Ka{constructor(){super({id:"workbench.action.navigateDown",title:I(2753,"Navigate to the View Below"),category:_e.View,f1:true},oe.Down)}});class Hm extends j{constructor(e,t){super(e);this.focusNext=t}run(e){const t=e.get(Te);const i=e.get(Y);this.focusNextOrPreviousPart(t,i,this.focusNext)}findVisibleNeighbour(e,t,i){const s=Ds();const o=pg(s);let n;if(o){switch(t){case V.EDITOR_PART:n=V.STATUSBAR_PART;break;default:n=V.EDITOR_PART}}else{switch(t){case V.EDITOR_PART:n=i?V.PANEL_PART:V.SIDEBAR_PART;break;case V.PANEL_PART:n=i?V.AUXILIARYBAR_PART:V.EDITOR_PART;break;case V.AUXILIARYBAR_PART:n=i?V.STATUSBAR_PART:V.PANEL_PART;break;case V.STATUSBAR_PART:n=i?V.ACTIVITYBAR_PART:V.AUXILIARYBAR_PART;break;case V.ACTIVITYBAR_PART:n=i?V.SIDEBAR_PART:V.STATUSBAR_PART;break;case V.SIDEBAR_PART:n=i?V.EDITOR_PART:V.ACTIVITYBAR_PART;break;default:n=V.EDITOR_PART}}if(e.isVisible(n,s)||n===V.EDITOR_PART){return n}return this.findVisibleNeighbour(e,n,i)}focusNextOrPreviousPart(e,t,i){let s;if(t.activeEditorPane?.hasFocus()||e.hasFocus(V.EDITOR_PART)){s=V.EDITOR_PART}else if(e.hasFocus(V.ACTIVITYBAR_PART)){s=V.ACTIVITYBAR_PART}else if(e.hasFocus(V.STATUSBAR_PART)){s=V.STATUSBAR_PART}else if(e.hasFocus(V.SIDEBAR_PART)){s=V.SIDEBAR_PART}else if(e.hasFocus(V.AUXILIARYBAR_PART)){s=V.AUXILIARYBAR_PART}else if(e.hasFocus(V.PANEL_PART)){s=V.PANEL_PART}e.focusPart(s?this.findVisibleNeighbour(e,s,i):V.EDITOR_PART,Ds())}}v(class extends Hm{constructor(){super({id:"workbench.action.focusNextPart",title:I(2754,"Focus Next Part"),category:_e.View,f1:true,keybinding:{primary:T.F6,weight:B.WorkbenchContrib}},true)}});v(class extends Hm{constructor(){super({id:"workbench.action.focusPreviousPart",title:I(2755,"Focus Previous Part"),category:_e.View,f1:true,keybinding:{primary:O.Shift|T.F6,weight:B.WorkbenchContrib}},false)}});const xA=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Le(xA);tg((a,e)=>{const t=IE(a);e.addRule(`.monaco-workbench-part { background-color: ${t}; }`);const i=a.getColor(DE);if(i){e.addRule(`.monaco-workbench-part ::selection { background-color: ${i}; }`)}if(Is){const s=a.getColor(TE);if(s){const o="monaco-workbench-meta-theme-color";let n=ae.document.getElementById(o);if(!n){n=fg();n.name="theme-color";n.id=o}n.content=s.toString()}}if(gg){e.addRule(`
			.monaco-workbench-part.web {
				touch-action: none;
			}
			.monaco-workbench-part .monaco-editor .view-lines {
				user-select: text;
				-webkit-user-select: text;
			}
		`)}if(yr&&AE()){e.addRule(`.monaco-workbench-part { background-color: ${t}; }`)}});var RA={"vs/workbench/contrib/debug/browser/media/continue-tb.png":new URL(""+new URL("continue-tb-CCAR00jP.png",import.meta.url).href,import.meta.url).href,"vs/workbench/contrib/debug/browser/media/pause-tb.png":new URL(""+new URL("pause-tb-BSL-SyaF.png",import.meta.url).href,import.meta.url).href,"vs/workbench/contrib/debug/browser/media/restart-tb.png":new URL(""+new URL("restart-tb-DWcD2W1P.png",import.meta.url).href,import.meta.url).href,"vs/workbench/contrib/debug/browser/media/run-with-debugging-tb.png":new URL(""+new URL("run-with-debugging-tb-DvexD5f4.png",import.meta.url).href,import.meta.url).href,"vs/workbench/contrib/debug/browser/media/stepinto-tb.png":new URL(""+new URL("stepinto-tb-C49RvdeT.png",import.meta.url).href,import.meta.url).href,"vs/workbench/contrib/debug/browser/media/stepout-tb.png":new URL(""+new URL("stepout-tb-cxFT37Js.png",import.meta.url).href,import.meta.url).href,"vs/workbench/contrib/debug/browser/media/stepover-tb.png":new URL(""+new URL("stepover-tb-ImghZE20.png",import.meta.url).href,import.meta.url).href,"vs/workbench/contrib/debug/browser/media/stop-tb.png":new URL(""+new URL("stop-tb-iTRHm2B-.png",import.meta.url).href,import.meta.url).href};jf(RA);let Fo;jf({"vs/workbench/contrib/webview/browser/pre/service-worker.js":()=>Xn(new URL(""+new URL("service-worker-DsB6cQ40.js",import.meta.url).href,import.meta.url).href,Fo),"vs/workbench/contrib/webview/browser/pre/index.html":()=>Xn(new URL(""+new URL("index-Cg3XqiaZ.html",import.meta.url).href,import.meta.url).href,Fo),"vs/workbench/contrib/webview/browser/pre/index-no-csp.html":()=>Xn(new URL(""+new URL("index-no-csp-DMfG5HRS.html",import.meta.url).href,import.meta.url).href,Fo),"vs/workbench/contrib/webview/browser/pre/fake.html":()=>Xn(new URL(""+new URL("fake-DXkbmQ09.html",import.meta.url).href,import.meta.url).href,Fo)});BE(async a=>{a.get(Gl)});function iV(a){if(a!=null){Fo=a}return{...lD(),[st.toString()]:new Q(Ec,[],false),[We.toString()]:new Q(rc,[],true),[ks.toString()]:new Q(qd,[],true),[Vs.toString()]:new Q(vc,[],true),[So.toString()]:new Q(NE,[],true),[nh.toString()]:new Q(FE,[],false),[la.toString()]:new Q(ac,[],false),[ME.toString()]:new Q(OE,[],true),[ha.toString()]:new Q(LE,[],true),[tf.toString()]:new Q(cc,[],true),[Gl.toString()]:new Q(xr,[],false),[Of.toString()]:new Q(hc,[],true),[Ps.toString()]:new Q(mc,[],true),[qg.toString()]:new Q(LI,[],true),[ah.toString()]:new Q(PE,[],true),[Ea.toString()]:new Q(wc,[],true),[Ll.toString()]:new Q(Sc,[],true),[kE.toString()]:new Q(jI,[],true),[RE.toString()]:new Q(VE,[],true),[xE.toString()]:new Q(YI,[],true)}}W.as(it.ViewContainersRegistry);W.as(it.ViewsRegistry);function sV(a){return uh.get(Te).isVisible(a,window)}const oV=a=>{return uh.get(Te).onDidChangeSideBarPosition(a)};function nV(){return uh.get(Te).getSideBarPosition()}export{ec as A,op as B,oe as D,ep as E,Yd as P,zd as S,qd as a,nV as b,Ji as c,io as d,iV as g,sV as i,oV as o};
