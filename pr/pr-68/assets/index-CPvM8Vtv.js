const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./main-Cu5NKsWX.js","./index-CnoaTDJx.js","./index-Bg8tF5dg.css","./main-DwcT7xgt.js"])))=>i.map(i=>d[i]);
import{bE as _e,bF as Ce,bG as Ee,bH as M,bI as ke,bJ as te,bK as ne,D as E,b as Ie,bL as xe,bM as le,X as z,bN as Te,a4 as ze,bO as Pe,bP as Me,bQ as De,bR as Ne,bS as Ae,bT as ue,bU as Re,bV as Oe,bW as X,bB as V,bX as je,_ as H,c as m,aX as ye,f as ie,U as re,bY as Fe,bs as oe,aV as Se,bZ as $e,aJ as q,b_ as Ve,l as g,b3 as We,P as K,aD as be,b2 as Be,b$ as Ge,c0 as Ue,aN as He,bm as we,aZ as qe,be as Je,c1 as Ke,d as ve,C as j,au as ge,aL as Ye,c2 as Xe,c3 as Ze,c4 as Qe,O as et,c5 as se,c6 as tt,c7 as nt,bz as it,c8 as rt,c9 as ot,V as he,W as p,ca as st,cb as at,Y as ct,Z as dt,$ as lt,a0 as ut,cc as gt,bC as ht,H as mt,cd as ft,ce as pt,S as _t}from"./index-CnoaTDJx.js";import{a as R,g as kt,S as Tt}from"./tokenClassificationRegistry-BtLKAqlm.js";class yt{constructor(e,t,n){this.id=e;this.dependencies=t;this.callback=n}}var C;(function(u){u[u["Uninitialized"]=1]="Uninitialized";u[u["InitializedInternal"]=2]="InitializedInternal";u[u["InitializedExternal"]=3]="InitializedExternal"})(C||(C={}));class Le{static{this.INSTANCE=new Le}constructor(){this._isWebWorker=typeof self==="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope";this._isRenderer=typeof document==="object";this._defineCalls=[];this._state=C.Uninitialized}_initialize(){if(this._state===C.Uninitialized){if(globalThis.define){this._state=C.InitializedExternal;return}}else{return}this._state=C.InitializedInternal;globalThis.define=(e,t,n)=>{if(typeof e!=="string"){n=t;t=e;e=null}if(typeof t!=="object"||!Array.isArray(t)){n=t;t=null}this._defineCalls.push(new yt(e,t,n))};globalThis.define.amd=true;if(this._isRenderer){this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??window.trustedTypes?.createPolicy("amdLoader",{createScriptURL(e){if(e.startsWith(window.location.origin)){return e}if(e.startsWith(`${_e.vscodeFileResource}://${Ce}`)){return e}throw new Error(`[trusted_script_src] Invalid script url: ${e}`)}})}else if(this._isWebWorker){this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??globalThis.trustedTypes?.createPolicy("amdLoader",{createScriptURL(e){return e}})}}async load(e){this._initialize();if(this._state===C.InitializedExternal){return new Promise(s=>{const o=Ee();globalThis.define(o,[e],function(c){s(c)})})}const t=await(this._isWebWorker?this._workerLoadScript(e):this._isRenderer?this._rendererLoadScript(e):this._nodeJSLoadScript(e));if(!t){console.warn(`Did not receive a define call from script ${e}`);return void 0}const n={};const r=[];const i=[];if(Array.isArray(t.dependencies)){for(const s of t.dependencies){if(s==="exports"){r.push(n)}else{i.push(s)}}}if(i.length>0){throw new Error(`Cannot resolve dependencies for script ${e}. The dependencies are: ${i.join(", ")}`)}if(typeof t.callback==="function"){return t.callback(...r)??n}else{return t.callback}}_rendererLoadScript(e){return new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("async","async");r.setAttribute("type","text/javascript");const i=()=>{r.removeEventListener("load",s);r.removeEventListener("error",o)};const s=c=>{i();t(this._defineCalls.pop())};const o=c=>{i();n(c)};r.addEventListener("load",s);r.addEventListener("error",o);if(this._amdPolicy){e=this._amdPolicy.createScriptURL(e)}r.setAttribute("src",e);window.document.getElementsByTagName("head")[0].appendChild(r)})}async _workerLoadScript(e){if(this._amdPolicy){e=this._amdPolicy.createScriptURL(e)}await import(e).then(t=>t.default??t);return this._defineCalls.pop()}async _nodeJSLoadScript(e){try{const t=(await M(()=>import(`${"fs"}`),true?[]:void 0,import.meta.url).then(d=>d.default??d)).default;const n=(await M(()=>import(`${"vm"}`),true?[]:void 0,import.meta.url).then(d=>d.default??d)).default;const r=(await M(()=>import(`${"module"}`),true?[]:void 0,import.meta.url).then(d=>d.default??d)).default;const i=ke.parse(e).fsPath;const s=t.readFileSync(i).toString();const o=r.wrap(s.replace(/^#!.*/,""));const c=new n.Script(o);const a=c.runInThisContext();a.apply();return this._defineCalls.pop()}catch(t){throw t}}}function St(u,e){const t=globalThis._VSCODE_PRODUCT_JSON;Boolean((t??globalThis.vscode?.context?.configuration()?.product)?.commit);const n=`${u}/${e}`;const r=ne;const i=`${r}/${n}`;return te.asBrowserUri(i).toString(true)}class bt extends E{constructor(e,t,n,r,i,s,o){super();this._grammar=e;this._initialState=t;this._containsEmbeddedLanguages=n;this._createBackgroundTokenizer=r;this._backgroundTokenizerShouldOnlyVerifyTokens=i;this._reportTokenizationTime=s;this._reportSlowTokenization=o;this._seenLanguages=[];this._onDidEncounterLanguage=this._register(new Ie);this.onDidEncounterLanguage=this._onDidEncounterLanguage.event}get backgroundTokenizerShouldOnlyVerifyTokens(){return this._backgroundTokenizerShouldOnlyVerifyTokens()}getInitialState(){return this._initialState}tokenize(e,t,n){throw new Error("Not supported!")}createBackgroundTokenizer(e,t){if(this._createBackgroundTokenizer){return this._createBackgroundTokenizer(e,t)}return void 0}tokenizeEncoded(e,t,n){const r=Math.random()*1e4<1;const i=this._reportSlowTokenization||r;const s=i?new xe(true):void 0;const o=this._grammar.tokenizeLine2(e,n,500);if(i){const a=s.elapsed();if(r||a>32){this._reportTokenizationTime(a,e.length,r)}}if(o.stoppedEarly){console.warn(`Time limit reached when tokenizing line: ${e.substring(0,100)}`);return new le(o.tokens,n)}if(this._containsEmbeddedLanguages){const a=this._seenLanguages;const d=o.tokens;for(let h=0,k=d.length>>>1;h<k;h++){const b=d[(h<<1)+1];const S=z.getLanguageId(b);if(!a[S]){a[S]=true;this._onDidEncounterLanguage.fire(S)}}}let c;if(n.equals(o.ruleStack)){c=n}else{c=o.ruleStack}return new le(o.tokens,c)}}class wt extends E{get backgroundTokenizerShouldOnlyVerifyTokens(){return this._actual.backgroundTokenizerShouldOnlyVerifyTokens}constructor(e,t,n,r){super();this._encodedLanguageId=e;this._actual=t;this._maxTokenizationLineLength=r;this._register(Te(this._maxTokenizationLineLength));this._register(n)}getInitialState(){return this._actual.getInitialState()}tokenize(e,t,n){throw new Error("Not supported!")}tokenizeEncoded(e,t,n){if(e.length>=this._maxTokenizationLineLength.get()){return ze(this._encodedLanguageId,n)}return this._actual.tokenizeEncoded(e,t,n)}createBackgroundTokenizer(e,t){if(this._actual.createBackgroundTokenizer){return this._actual.createBackgroundTokenizer(e,t)}else{return void 0}}}class W{static{this.CHANNEL_NAME="textMateWorkerHost"}static getChannel(e){return e.getChannel(W.CHANNEL_NAME)}static setChannel(e,t){e.setChannel(W.CHANNEL_NAME,t)}}class vt{constructor(e){this.edits=e.slice().sort(Pe(t=>t.offset,Me))}applyToArray(e){for(let t=this.edits.length-1;t>=0;t--){const n=this.edits[t];e.splice(n.offset,n.length,...new Array(n.newLength))}}}class Lt{constructor(e,t,n){this.offset=e;this.length=t;this.newLength=n}toString(){return`[${this.offset}, +${this.length}) -> +${this.newLength}}`}}class B{static fromMany(e){const t=e.map(n=>new B(n));return new Ct(t)}constructor(e){this.transformation=e;this.idx=0;this.offset=0}transform(e){let t=this.transformation.edits[this.idx];while(t&&t.offset+t.length<=e){this.offset+=t.newLength-t.length;this.idx++;t=this.transformation.edits[this.idx]}if(t&&t.offset<=e){return void 0}return e+this.offset}}class Ct{constructor(e){this.transformers=e}transform(e){for(const t of this.transformers){const n=t.transform(e);if(n===void 0){return void 0}e=n}return e}}class ae extends E{static{this._id=0}constructor(e,t,n,r,i,s){super();this._model=e;this._worker=t;this._languageIdCodec=n;this._backgroundTokenizationStore=r;this._configurationService=i;this._maxTokenizationLineLength=s;this.controllerId=ae._id++;this._pendingChanges=[];this._states=new De;this._loggingEnabled=Ne("editor.experimental.asyncTokenizationLogging",false,this._configurationService);this._register(Te(this._loggingEnabled));this._register(this._model.onDidChangeContent(a=>{if(this._shouldLog){console.log("model change",{fileName:this._model.uri.fsPath.split("\\").pop(),changes:Y(a.changes)})}this._worker.$acceptModelChanged(this.controllerId,a);this._pendingChanges.push(a)}));this._register(this._model.onDidChangeLanguage(a=>{const d=this._model.getLanguageId();const h=this._languageIdCodec.encodeLanguageId(d);this._worker.$acceptModelLanguageChanged(this.controllerId,d,h)}));const o=this._model.getLanguageId();const c=this._languageIdCodec.encodeLanguageId(o);this._worker.$acceptNewModel({uri:this._model.uri,versionId:this._model.getVersionId(),lines:this._model.getLinesContent(),EOL:this._model.getEOL(),languageId:o,encodedLanguageId:c,maxTokenizationLineLength:this._maxTokenizationLineLength.get(),controllerId:this.controllerId});this._register(Ae(a=>{const d=this._maxTokenizationLineLength.read(a);this._worker.$acceptMaxTokenizationLineLength(this.controllerId,d)}))}dispose(){super.dispose();this._worker.$acceptRemovedModel(this.controllerId)}requestTokens(e,t){this._worker.$retokenize(this.controllerId,e,t)}async setTokensAndStates(e,t,n,r){if(this.controllerId!==e){return}let i=ue.deserialize(new Uint8Array(n));if(this._shouldLog){console.log("received background tokenization result",{fileName:this._model.uri.fsPath.split("\\").pop(),updatedTokenLines:i.map(o=>o.getLineRange()).join(" & "),updatedStateLines:r.map(o=>new Re(o.startLineNumber,o.startLineNumber+o.stateDeltas.length).toString()).join(" & ")})}if(this._shouldLog){const o=this._pendingChanges.filter(c=>c.versionId<=t).map(c=>c.changes).map(c=>Y(c)).join(" then ");console.log("Applying changes to local states",o)}while(this._pendingChanges.length>0&&this._pendingChanges[0].versionId<=t){const o=this._pendingChanges.shift();this._states.acceptChanges(o.changes)}if(this._pendingChanges.length>0){if(this._shouldLog){const a=this._pendingChanges.map(d=>d.changes).map(d=>Y(d)).join(" then ");console.log("Considering non-processed changes",a)}const o=B.fromMany(this._pendingChanges.map(a=>me(a.changes)));const c=new ue;for(const a of i){for(let d=a.startLineNumber;d<=a.endLineNumber;d++){const h=o.transform(d-1);if(h!==void 0){c.add(d,a.getLineTokens(d))}}}i=c.finalize();for(const a of this._pendingChanges){for(const d of a.changes){for(let h=0;h<i.length;h++){i[h].applyEdit(d.range,d.text)}}}}const s=B.fromMany(this._pendingChanges.map(o=>me(o.changes)));if(!this._applyStateStackDiffFn||!this._initialState){const{applyStateStackDiff:o,INITIAL:c}=await M(async()=>{const{applyStateStackDiff:a,INITIAL:d}=await import("./main-Cu5NKsWX.js").then(h=>h.m);return{applyStateStackDiff:a,INITIAL:d}},true?__vite__mapDeps([0,1,2]):void 0,import.meta.url).then(a=>a.default??a);this._applyStateStackDiffFn=o;this._initialState=c}for(const o of r){let c=o.startLineNumber<=1?this._initialState:this._states.getEndState(o.startLineNumber-1);for(let a=0;a<o.stateDeltas.length;a++){const d=o.stateDeltas[a];let h;if(d){h=this._applyStateStackDiffFn(c,d);this._states.setEndState(o.startLineNumber+a,h)}else{h=this._states.getEndState(o.startLineNumber+a)}const k=s.transform(o.startLineNumber+a-1);if(k!==void 0){this._backgroundTokenizationStore.setEndState(k+1,h)}if(o.startLineNumber+a>=this._model.getLineCount()-1){this._backgroundTokenizationStore.backgroundTokenizationFinished()}c=h}}this._backgroundTokenizationStore.setTokens(i)}get _shouldLog(){return this._loggingEnabled.get()}}function me(u){return new vt(u.map(e=>new Lt(e.range.startLineNumber-1,e.range.endLineNumber-e.range.startLineNumber+1,Oe(e.text)[0]+1)))}function Y(u){return u.map(e=>X.lift(e.range).toString()+" => "+e.text).join(" & ")}var F;let Z=class Gt{static{F=this}static{this._reportedMismatchingTokens=false}constructor(e,t,n,r,i,s,o,c){this._reportTokenizationTime=e;this._shouldTokenizeAsync=t;this._extensionResourceLoaderService=n;this._configurationService=r;this._languageService=i;this._environmentService=s;this._notificationService=o;this._telemetryService=c;this._workerProxyPromise=null;this._worker=null;this._workerProxy=null;this._workerTokenizerControllers=new Map;this._currentTheme=null;this._currentTokenColorMap=null;this._grammarDefinitions=[]}dispose(){this._disposeWorker()}createBackgroundTokenizer(e,t,n){if(!this._shouldTokenizeAsync()||e.isTooLargeForSyncing()){return void 0}const r=new V;const i=this._getWorkerProxy().then(s=>{if(r.isDisposed||!s){return void 0}const o={controller:void 0,worker:this._worker};r.add(Et(e,()=>{const c=new ae(e,s,this._languageService.languageIdCodec,t,this._configurationService,n);o.controller=c;this._workerTokenizerControllers.set(c.controllerId,c);return $e(()=>{o.controller=void 0;this._workerTokenizerControllers.delete(c.controllerId);c.dispose()})}));return o});return{dispose(){r.dispose()},requestTokens:async(s,o)=>{const c=await i;if(c?.controller&&c.worker===this._worker){c.controller.requestTokens(s,o)}},reportMismatchingTokens:s=>{if(F._reportedMismatchingTokens){return}F._reportedMismatchingTokens=true;this._notificationService.error({message:"Async Tokenization Token Mismatch in line "+s,name:"Async Tokenization Token Mismatch"});this._telemetryService.publicLog2("asyncTokenizationMismatchingTokens",{})}}}setGrammarDefinitions(e){this._grammarDefinitions=e;this._disposeWorker()}acceptTheme(e,t){this._currentTheme=e;this._currentTokenColorMap=t;if(this._currentTheme&&this._currentTokenColorMap&&this._workerProxy){this._workerProxy.$acceptTheme(this._currentTheme,this._currentTokenColorMap)}}_getWorkerProxy(){if(!this._workerProxyPromise){this._workerProxyPromise=this._createWorkerProxy()}return this._workerProxyPromise}async _createWorkerProxy(){const e=`${ne}/vscode-oniguruma`;const t=e;const n=`${t}/release/onig.wasm`;const r={grammarDefinitions:this._grammarDefinitions,onigurumaWASMUri:te.asBrowserUri(n).toString(true)};const i=this._worker=je("vs/workbench/services/textMate/browser/backgroundTokenization/worker/textMateTokenizationWorker.worker","TextMateWorker");W.setChannel(i,{$readFile:async s=>{const o=ke.revive(s);return this._extensionResourceLoaderService.readExtensionResource(o)},$setTokensAndStates:async(s,o,c,a)=>{const d=this._workerTokenizerControllers.get(s);if(d){d.setTokensAndStates(s,o,c,a)}},$reportTokenizationTime:(s,o,c,a,d)=>{this._reportTokenizationTime(s,o,c,a,d)}});await i.proxy.$init(r);if(this._worker!==i){return null}this._workerProxy=i.proxy;if(this._currentTheme&&this._currentTokenColorMap){this._workerProxy.$acceptTheme(this._currentTheme,this._currentTokenColorMap)}return i.proxy}_disposeWorker(){for(const e of this._workerTokenizerControllers.values()){e.dispose()}this._workerTokenizerControllers.clear();if(this._worker){this._worker.dispose();this._worker=null}this._workerProxy=null;this._workerProxyPromise=null}};Z=F=H([m(2,ye),m(3,ie),m(4,re),m(5,Fe),m(6,oe),m(7,Se)],Z);function Et(u,e){const t=new V;const n=t.add(new V);function r(){if(u.isAttachedToEditor()){n.add(e())}else{n.clear()}}r();t.add(u.onDidChangeAttached(()=>{r()}));return t}class It{constructor(){this._scopeNameToLanguageRegistration=Object.create(null)}reset(){this._scopeNameToLanguageRegistration=Object.create(null)}register(e){this._scopeNameToLanguageRegistration[e.scopeName]=e}getGrammarDefinition(e){return this._scopeNameToLanguageRegistration[e]||null}}const $="No TM Grammar registered for this language.";class xt extends E{constructor(e,t,n,r){super();this._host=e;this._initialState=n.INITIAL;this._scopeRegistry=new It;this._injections={};this._injectedEmbeddedLanguages={};this._languageToScope=new Map;this._grammarRegistry=this._register(new n.Registry({onigLib:r,loadGrammar:async i=>{const s=this._scopeRegistry.getGrammarDefinition(i);if(!s){this._host.logTrace(`No grammar found for scope ${i}`);return null}const o=s.location;try{const c=await this._host.readFile(o);return n.parseRawGrammar(c,o.path)}catch(c){this._host.logError(`Unable to load and parse grammar for scope ${i} from ${o}`,c);return null}},getInjections:i=>{const s=i.split(".");let o=[];for(let c=1;c<=s.length;c++){const a=s.slice(0,c).join(".");o=[...o,...this._injections[a]||[]]}return o}}));for(const i of t){this._scopeRegistry.register(i);if(i.injectTo){for(const s of i.injectTo){let o=this._injections[s];if(!o){this._injections[s]=o=[]}o.push(i.scopeName)}if(i.embeddedLanguages){for(const s of i.injectTo){let o=this._injectedEmbeddedLanguages[s];if(!o){this._injectedEmbeddedLanguages[s]=o=[]}o.push(i.embeddedLanguages)}}}if(i.language){this._languageToScope.set(i.language,i.scopeName)}}}has(e){return this._languageToScope.has(e)}setTheme(e,t){this._grammarRegistry.setTheme(e,t)}getColorMap(){return this._grammarRegistry.getColorMap()}async createGrammar(e,t){const n=this._languageToScope.get(e);if(typeof n!=="string"){throw new Error($)}const r=this._scopeRegistry.getGrammarDefinition(n);if(!r){throw new Error($)}const i=r.embeddedLanguages;if(this._injectedEmbeddedLanguages[n]){const c=this._injectedEmbeddedLanguages[n];for(const a of c){for(const d of Object.keys(a)){i[d]=a[d]}}}const s=Object.keys(i).length>0;let o;try{o=await this._grammarRegistry.loadGrammarWithConfiguration(n,t,{embeddedLanguages:i,tokenTypes:r.tokenTypes,balancedBracketSelectors:r.balancedBracketSelectors,unbalancedBracketSelectors:r.unbalancedBracketSelectors})}catch(c){if(c.message&&c.message.startsWith("No grammar provided for")){throw new Error($)}throw c}return{languageId:e,grammar:o,initialState:this._initialState,containsEmbeddedLanguages:s,sourceExtensionId:r.sourceExtensionId}}}const L=q.registerExtensionPoint({extensionPoint:"grammars",deps:[Ve],jsonSchema:{description:g(7073,"Contributes textmate tokenizers."),type:"array",defaultSnippets:[{body:[{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}]}],items:{type:"object",defaultSnippets:[{body:{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}}],properties:{language:{description:g(7074,"Language identifier for which this syntax is contributed to."),type:"string"},scopeName:{description:g(7075,"Textmate scope name used by the tmLanguage file."),type:"string"},path:{description:g(7076,"Path of the tmLanguage file. The path is relative to the extension folder and typically starts with './syntaxes/'."),type:"string"},embeddedLanguages:{description:g(7077,"A map of scope name to language id if this grammar contains embedded languages."),type:"object"},tokenTypes:{description:g(7078,"A map of scope name to token types."),type:"object",additionalProperties:{enum:["string","comment","other"]}},injectTo:{description:g(7079,"List of language scope names to which this grammar is injected to."),type:"array",items:{type:"string"}},balancedBracketScopes:{description:g(7080,"Defines which scope names contain balanced brackets."),type:"array",items:{type:"string"},default:["*"]},unbalancedBracketScopes:{description:g(7081,"Defines which scope names do not contain balanced brackets."),type:"array",items:{type:"string"},default:[]}},required:["scopeName","path"]}}});var P;let Q=class Ut extends E{static{P=this}static{this.reportTokenizationTimeCounter={sync:0,async:0}}constructor(e,t,n,r,i,s,o,c,a,d){super();this._languageService=e;this._themeService=t;this._extensionResourceLoaderService=n;this._notificationService=r;this._logService=i;this._configurationService=s;this._progressService=o;this._environmentService=c;this._instantiationService=a;this._telemetryService=d;this._createdModes=[];this._encounteredLanguages=[];this._debugMode=false;this._debugModePrintFunc=()=>{};this._grammarDefinitions=null;this._grammarFactory=null;this._tokenizersRegistrations=new V;this._currentTheme=null;this._currentTokenColorMap=null;this._threadedBackgroundTokenizerFactory=this._instantiationService.createInstance(Z,(h,k,b,S,y)=>this._reportTokenizationTime(h,k,b,S,true,y),()=>this.getAsyncTokenizationEnabled());this._vscodeOniguruma=null;this._styleElement=We();this._styleElement.className="vscode-tokens-styles";L.setHandler(h=>this._handleGrammarsExtPoint(h));this._updateTheme(this._themeService.getColorTheme(),true);this._register(this._themeService.onDidColorThemeChange(()=>{this._updateTheme(this._themeService.getColorTheme(),false)}));this._register(this._languageService.onDidRequestRichLanguageFeatures(h=>{this._createdModes.push(h)}))}getAsyncTokenizationEnabled(){return!!this._configurationService.getValue("editor.experimental.asyncTokenization")}getAsyncTokenizationVerification(){return!!this._configurationService.getValue("editor.experimental.asyncTokenizationVerification")}_handleGrammarsExtPoint(e){this._grammarDefinitions=null;if(this._grammarFactory){this._grammarFactory.dispose();this._grammarFactory=null}this._tokenizersRegistrations.clear();this._grammarDefinitions=[];for(const t of e){const n=t.value;for(const r of n){const i=this._validateGrammarDefinition(t,r);if(i){this._grammarDefinitions.push(i);if(i.language){const s=new Ze(()=>this._createTokenizationSupport(i.language));this._tokenizersRegistrations.add(s);this._tokenizersRegistrations.add(K.registerFactory(i.language,s))}}}}this._threadedBackgroundTokenizerFactory.setGrammarDefinitions(this._grammarDefinitions);for(const t of this._createdModes){K.getOrCreate(t)}}_validateGrammarDefinition(e,t){if(!Mt(e.description.extensionLocation,t,e.collector,this._languageService)){return null}const n=be(e.description.extensionLocation,t.path);const r=Object.create(null);if(t.embeddedLanguages){const c=Object.keys(t.embeddedLanguages);for(let a=0,d=c.length;a<d;a++){const h=c[a];const k=t.embeddedLanguages[h];if(typeof k!=="string"){continue}if(this._languageService.isRegisteredLanguageId(k)){r[h]=this._languageService.languageIdCodec.encodeLanguageId(k)}}}const i=Object.create(null);if(t.tokenTypes){const c=Object.keys(t.tokenTypes);for(const a of c){const d=t.tokenTypes[a];switch(d){case"string":i[a]=2;break;case"other":i[a]=0;break;case"comment":i[a]=1;break}}}const s=t.language&&this._languageService.isRegisteredLanguageId(t.language)?t.language:void 0;function o(c,a){if(!Array.isArray(c)){return a}if(!c.every(d=>typeof d==="string")){return a}return c}return{location:n,language:s,scopeName:t.scopeName,embeddedLanguages:r,tokenTypes:i,injectTo:t.injectTo,balancedBracketSelectors:o(t.balancedBracketScopes,["*"]),unbalancedBracketSelectors:o(t.unbalancedBracketScopes,[]),sourceExtensionId:e.description.id}}startDebugMode(e,t){if(this._debugMode){this._notificationService.error(g(3084,"Already Logging."));return}this._debugModePrintFunc=e;this._debugMode=true;if(this._debugMode){this._progressService.withProgress({location:15,buttons:[g(3085,"Stop")]},n=>{n.report({message:g(3086,"Preparing to log TM Grammar parsing. Press Stop when finished.")});return this._getVSCodeOniguruma().then(r=>{r.setDefaultDebugCall(true);n.report({message:g(3087,"Now logging TM Grammar parsing. Press Stop when finished.")});return new Promise((i,s)=>{})})},n=>{this._getVSCodeOniguruma().then(r=>{this._debugModePrintFunc=()=>{};this._debugMode=false;r.setDefaultDebugCall(false);t()})})}}_canCreateGrammarFactory(){return!!this._grammarDefinitions}async _getOrCreateGrammarFactory(){if(this._grammarFactory){return this._grammarFactory}const[e,t]=await Promise.all([M(()=>import("./main-Cu5NKsWX.js").then(r=>r.m),true?__vite__mapDeps([0,1,2]):void 0,import.meta.url).then(r=>r.default??r),this._getVSCodeOniguruma()]);const n=Promise.resolve({createOnigScanner:r=>t.createOnigScanner(r),createOnigString:r=>t.createOnigString(r)});if(this._grammarFactory){return this._grammarFactory}this._grammarFactory=new xt({logTrace:r=>this._logService.trace(r),logError:(r,i)=>this._logService.error(r,i),readFile:r=>this._extensionResourceLoaderService.readExtensionResource(r)},this._grammarDefinitions||[],e,n);this._updateTheme(this._themeService.getColorTheme(),true);return this._grammarFactory}async _createTokenizationSupport(e){if(!this._languageService.isRegisteredLanguageId(e)){return null}if(!this._canCreateGrammarFactory()){return null}try{const t=await this._getOrCreateGrammarFactory();if(!t.has(e)){return null}const n=this._languageService.languageIdCodec.encodeLanguageId(e);const r=await t.createGrammar(e,n);if(!r.grammar){return null}const i=Dt("editor.maxTokenizationLineLength",e,-1,this._configurationService);const s=new bt(r.grammar,r.initialState,r.containsEmbeddedLanguages,(c,a)=>this._threadedBackgroundTokenizerFactory.createBackgroundTokenizer(c,a,i),()=>this.getAsyncTokenizationVerification(),(c,a,d)=>{this._reportTokenizationTime(c,e,r.sourceExtensionId,a,false,d)},true);const o=s.onDidEncounterLanguage(c=>{if(!this._encounteredLanguages[c]){const a=this._languageService.languageIdCodec.decodeLanguageId(c);this._encounteredLanguages[c]=true;this._languageService.requestBasicLanguageFeatures(a)}});return new wt(n,s,o,i)}catch(t){if(t.message&&t.message===$){return null}Be(t);return null}}_updateTheme(e,t){if(!t&&this._currentTheme&&this._currentTokenColorMap&&Pt(this._currentTheme.settings,e.tokenColors)&&Ge(this._currentTokenColorMap,e.tokenColorMap)){return}this._currentTheme={name:e.label,settings:e.tokenColors};this._currentTokenColorMap=e.tokenColorMap;this._grammarFactory?.setTheme(this._currentTheme,this._currentTokenColorMap);const n=zt(this._currentTokenColorMap);const r=Ue(n);this._styleElement.textContent=r;K.setColorMap(n);if(this._currentTheme&&this._currentTokenColorMap){this._threadedBackgroundTokenizerFactory.acceptTheme(this._currentTheme,this._currentTokenColorMap)}}async createTokenizer(e){if(!this._languageService.isRegisteredLanguageId(e)){return null}const t=await this._getOrCreateGrammarFactory();if(!t.has(e)){return null}const n=this._languageService.languageIdCodec.encodeLanguageId(e);const{grammar:r}=await t.createGrammar(e,n);return r}_getVSCodeOniguruma(){if(!this._vscodeOniguruma){this._vscodeOniguruma=(async()=>{const[e,t]=await Promise.all([M(()=>import("./main-DwcT7xgt.js").then(n=>n.m),true?__vite__mapDeps([3,1,2]):void 0,import.meta.url).then(n=>n.default??n),this._loadVSCodeOnigurumaWASM()]);await e.loadWASM({data:t,print:n=>{this._debugModePrintFunc(n)}});return e})()}return this._vscodeOniguruma}async _loadVSCodeOnigurumaWASM(){if(He){const e=await fetch(St("vscode-oniguruma","release/onig.wasm"));return await e.arrayBuffer()}else{const e=await fetch(te.asBrowserUri(`${ne}/vscode-oniguruma/release/onig.wasm`).toString(true));return e}}_reportTokenizationTime(e,t,n,r,i,s){const o=i?"async":"sync";if(P.reportTokenizationTimeCounter[o]>50){return}if(P.reportTokenizationTimeCounter[o]===0){setTimeout(()=>{P.reportTokenizationTimeCounter[o]=0},1e3*60*60)}P.reportTokenizationTimeCounter[o]++;this._telemetryService.publicLog2("editor.tokenizedLine",{timeMs:e,languageId:t,lineLength:r,fromWorker:i,sourceExtensionId:n,isRandomSample:s,tokenizationSetting:this.getAsyncTokenizationEnabled()?this.getAsyncTokenizationVerification()?2:1:0})}};Q=P=H([m(0,re),m(1,we),m(2,ye),m(3,oe),m(4,qe),m(5,ie),m(6,Je),m(7,Ke),m(8,ve),m(9,Se)],Q);function zt(u){const e=[null];for(let t=1,n=u.length;t<n;t++){e[t]=j.fromHex(u[t])}return e}function Pt(u,e){if(!e||!u||e.length!==u.length){return false}for(let t=e.length-1;t>=0;t--){const n=e[t];const r=u[t];if(n.scope!==r.scope){return false}const i=n.settings;const s=r.settings;if(i&&s){if(i.fontStyle!==s.fontStyle||i.foreground!==s.foreground||i.background!==s.background){return false}}else if(!i||!s){return false}}return true}function Mt(u,e,t,n){if(e.language&&(typeof e.language!=="string"||!n.isRegisteredLanguageId(e.language))){t.error(g(3088,"Unknown language in `contributes.{0}.language`. Provided value: {1}",L.name,String(e.language)));return false}if(!e.scopeName||typeof e.scopeName!=="string"){t.error(g(3089,"Expected string in `contributes.{0}.scopeName`. Provided value: {1}",L.name,String(e.scopeName)));return false}if(!e.path||typeof e.path!=="string"){t.error(g(3090,"Expected string in `contributes.{0}.path`. Provided value: {1}",L.name,String(e.path)));return false}if(e.injectTo&&(!Array.isArray(e.injectTo)||e.injectTo.some(i=>typeof i!=="string"))){t.error(g(3091,"Invalid value in `contributes.{0}.injectTo`. Must be an array of language scope names. Provided value: {1}",L.name,JSON.stringify(e.injectTo)));return false}if(e.embeddedLanguages&&!ge(e.embeddedLanguages)){t.error(g(3092,"Invalid value in `contributes.{0}.embeddedLanguages`. Must be an object map from scope name to language. Provided value: {1}",L.name,JSON.stringify(e.embeddedLanguages)));return false}if(e.tokenTypes&&!ge(e.tokenTypes)){t.error(g(3093,"Invalid value in `contributes.{0}.tokenTypes`. Must be an object map from scope name to token type. Provided value: {1}",L.name,JSON.stringify(e.tokenTypes)));return false}const r=be(u,e.path);if(!Ye(r,u)){t.warn(g(3094,"Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",L.name,r.path,u.path))}return true}function Dt(u,e,t,n){return Xe(r=>n.onDidChangeConfiguration(i=>{if(i.affectsConfiguration(u,{overrideIdentifier:e})){r(i)}}),()=>n.getValue(u,{overrideIdentifier:e})??t)}const v=kt();const Nt=q.registerExtensionPoint({extensionPoint:"semanticTokenTypes",jsonSchema:{description:g(3095,"Contributes semantic token types."),type:"array",items:{type:"object",properties:{id:{type:"string",description:g(3096,"The identifier of the semantic token type"),pattern:R,patternErrorMessage:g(3097,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},superType:{type:"string",description:g(3098,"The super type of the semantic token type"),pattern:R,patternErrorMessage:g(3099,"Super types should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:g(3100,"The description of the semantic token type")}}}}});const At=q.registerExtensionPoint({extensionPoint:"semanticTokenModifiers",jsonSchema:{description:g(3101,"Contributes semantic token modifiers."),type:"array",items:{type:"object",properties:{id:{type:"string",description:g(3102,"The identifier of the semantic token modifier"),pattern:R,patternErrorMessage:g(3103,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:g(3104,"The description of the semantic token modifier")}}}}});const Rt=q.registerExtensionPoint({extensionPoint:"semanticTokenScopes",jsonSchema:{description:g(3105,"Contributes semantic token scope maps."),type:"array",items:{type:"object",properties:{language:{description:g(3106,"Lists the languge for which the defaults are."),type:"string"},scopes:{description:g(3107,"Maps a semantic token (described by semantic token selector) to one or more textMate scopes used to represent that token."),type:"object",additionalProperties:{type:"array",items:{type:"string"}}}}}}});class Ot{constructor(){function e(t,n,r){if(typeof t.id!=="string"||t.id.length===0){r.error(g(3108,"'configuration.{0}.id' must be defined and can not be empty",n));return false}if(!t.id.match(R)){r.error(g(3109,"'configuration.{0}.id' must follow the pattern letterOrDigit[-_letterOrDigit]*",n));return false}const i=t.superType;if(i&&!i.match(R)){r.error(g(3110,"'configuration.{0}.superType' must follow the pattern letterOrDigit[-_letterOrDigit]*",n));return false}if(typeof t.description!=="string"||t.id.length===0){r.error(g(3111,"'configuration.{0}.description' must be defined and can not be empty",n));return false}return true}Nt.setHandler((t,n)=>{for(const r of n.added){const i=r.value;const s=r.collector;if(!i||!Array.isArray(i)){s.error(g(3112,"'configuration.semanticTokenType' must be an array"));return}for(const o of i){if(e(o,"semanticTokenType",s)){v.registerTokenType(o.id,o.description,o.superType)}}}for(const r of n.removed){const i=r.value;for(const s of i){v.deregisterTokenType(s.id)}}});At.setHandler((t,n)=>{for(const r of n.added){const i=r.value;const s=r.collector;if(!i||!Array.isArray(i)){s.error(g(3113,"'configuration.semanticTokenModifier' must be an array"));return}for(const o of i){if(e(o,"semanticTokenModifier",s)){v.registerTokenModifier(o.id,o.description)}}}for(const r of n.removed){const i=r.value;for(const s of i){v.deregisterTokenModifier(s.id)}}});Rt.setHandler((t,n)=>{for(const r of n.added){const i=r.value;const s=r.collector;if(!i||!Array.isArray(i)){s.error(g(3114,"'configuration.semanticTokenScopes' must be an array"));return}for(const o of i){if(o.language&&typeof o.language!=="string"){s.error(g(3115,"'configuration.semanticTokenScopes.language' must be a string"));continue}if(!o.scopes||typeof o.scopes!=="object"){s.error(g(3116,"'configuration.semanticTokenScopes.scopes' must be defined as an object"));continue}for(const c in o.scopes){const a=o.scopes[c];if(!Array.isArray(a)||a.some(d=>typeof d!=="string")){s.error(g(3117,"'configuration.semanticTokenScopes.scopes' values must be an array of strings"));continue}try{const d=v.parseTokenSelector(c,o.language);v.registerTokenStyleDefault(d,{scopesToProbe:a.map(h=>h.split(" "))})}catch(d){s.error(g(3118,"configuration.semanticTokenScopes.scopes': Problems parsing selector {0}.",c))}}}}for(const r of n.removed){const i=r.value;for(const s of i){for(const o in s.scopes){const c=s.scopes[o];try{const a=v.parseTokenSelector(o,s.language);v.registerTokenStyleDefault(a,{scopesToProbe:c.map(d=>d.split(" "))})}catch(a){}}}}})}}let G=class Ht{static{this.ID="workbench.contrib.tokenClassificationExtensionPoint"}constructor(e){this.instantiationService=e;this.instantiationService.createInstance(Ot)}};G=H([m(0,ve)],G);Qe(G.ID,G,1);var jt=".token-inspect-widget{border:1px solid var(--vscode-editorHoverWidget-border);padding:10px;user-select:text;-webkit-user-select:text;z-index:50}.hc-black .tokens-inspect-widget,.hc-light .tokens-inspect-widget{border-width:2px}.monaco-editor .token-inspect-widget{background-color:var(--vscode-editorHoverWidget-background)}.monaco-editor .token-inspect-widget .tiw-metadata-separator{background-color:var(--vscode-editorHoverWidget-border)}.tiw-token{font-family:var(--monaco-monospace-font)}.tiw-metadata-separator{border:0;height:1px}.tiw-token-length{float:right;font-size:60%;font-weight:400}.tiw-metadata-table{width:100%}.tiw-metadata-value{font-family:var(--monaco-monospace-font);word-break:break-word}.tiw-metadata-values{list-style:none;margin-right:-10px;max-height:300px;overflow-y:auto;padding-left:0}.tiw-metadata-values>.tiw-metadata-value{margin-right:10px}.tiw-metadata-key{min-width:150px;padding-right:10px;vertical-align:top;white-space:nowrap;width:1px}.tiw-metadata-semantic{font-style:italic}.tiw-metadata-scopes{line-height:normal}.tiw-theme-selector{font-family:var(--monaco-monospace-font)}";et(jt,{});function Ft(u,e,t=true){for(let n=e.length-1;n>=0;n--){const r=e.slice(0,n);const i=e[n];const s=$t(u,i,r,t);if(s){return s}}return null}function $t(u,e,t,n){let r=null;for(let i=u.tokenColors.length-1;i>=0;i--){const s=u.tokenColors[i];if(n&&!s.settings.foreground){continue}let o;if(typeof s.scope==="string"){o=s.scope.split(/,/).map(c=>c.trim())}else if(Array.isArray(s.scope)){o=s.scope}else{continue}for(let c=0,a=o.length;c<a;c++){const d=o[c];const h=new U(d,s.settings);if(h.matches(e,t)){if(h.isMoreSpecific(r)){r=h}}}}return r}class U{constructor(e,t){this.rawSelector=e;this.settings=t;const n=this.rawSelector.split(/ /);this.scope=n[n.length-1];this.parentScopes=n.slice(0,n.length-1)}matches(e,t){return U._matches(this.scope,this.parentScopes,e,t)}static _cmp(e,t){if(e===null&&t===null){return 0}if(e===null){return-1}if(t===null){return 1}if(e.scope.length!==t.scope.length){return e.scope.length-t.scope.length}const n=e.parentScopes.length;const r=t.parentScopes.length;if(n!==r){return n-r}for(let i=0;i<n;i++){const s=e.parentScopes[i].length;const o=t.parentScopes[i].length;if(s!==o){return s-o}}return 0}isMoreSpecific(e){return U._cmp(this,e)>0}static _matchesOne(e,t){const n=e+".";if(e===t||t.substring(0,n.length)===n){return true}return false}static _matches(e,t,n,r){if(!this._matchesOne(e,n)){return false}let i=t.length-1;let s=r.length-1;while(i>=0&&s>=0){if(this._matchesOne(t[i],r[s])){i--}s--}if(i===-1){return true}return false}}var ee;const l=lt;let D=class qt extends E{static{ee=this}static{this.ID="editor.contrib.inspectEditorTokens"}static get(e){return e.getContribution(ee.ID)}constructor(e,t,n,r,i,s,o,c){super();this._editor=e;this._textMateService=t;this._treeSitterService=n;this._themeService=i;this._languageService=r;this._notificationService=s;this._configurationService=o;this._languageFeaturesService=c;this._widget=null;this._register(this._editor.onDidChangeModel(a=>this.stop()));this._register(this._editor.onDidChangeModelLanguage(a=>this.stop()));this._register(this._editor.onKeyUp(a=>a.keyCode===9&&this.stop()))}dispose(){this.stop();super.dispose()}launch(){if(this._widget){return}if(!this._editor.hasModel()){return}if(this._editor.getModel().uri.scheme===_e.vscodeNotebookCell){return}this._widget=new ce(this._editor,this._textMateService,this._treeSitterService,this._languageService,this._themeService,this._notificationService,this._configurationService,this._languageFeaturesService)}stop(){if(this._widget){this._widget.dispose();this._widget=null}}toggle(){if(!this._widget){this.launch()}else{this.stop()}}};D=ee=H([m(1,se),m(2,tt),m(3,re),m(4,we),m(5,oe),m(6,ie),m(7,nt)],D);class Vt extends ut{constructor(){super({id:"editor.action.inspectTMScopes",label:g(3119,"Developer: Inspect Editor Tokens and Scopes"),alias:"Developer: Inspect Editor Tokens and Scopes",precondition:void 0})}run(e,t){const n=D.get(t);n?.toggle()}}function fe(u){if(u.length>40){u=u.substr(0,20)+"…"+u.substr(u.length-20)}let e="";for(let t=0,n=u.length;t<n;t++){const r=u.charCodeAt(t);switch(r){case 9:e+="→";break;case 32:e+="·";break;default:e+=String.fromCharCode(r)}}return e}class ce extends E{static{this._ID="editor.contrib.inspectEditorTokensWidget"}constructor(e,t,n,r,i,s,o,c){super();this.allowEditorOverflow=true;this._isDisposed=false;this._editor=e;this._languageService=r;this._themeService=i;this._textMateService=t;this._treeSitterService=n;this._notificationService=s;this._configurationService=o;this._languageFeaturesService=c;this._model=this._editor.getModel();this._domNode=document.createElement("div");this._domNode.className="token-inspect-widget";this._currentRequestCancellationTokenSource=new it;this._beginCompute(this._editor.getPosition());this._register(this._editor.onDidChangeCursorPosition(a=>this._beginCompute(this._editor.getPosition())));this._register(i.onDidColorThemeChange(a=>this._beginCompute(this._editor.getPosition())));this._register(o.onDidChangeConfiguration(a=>a.affectsConfiguration("editor.semanticHighlighting.enabled")&&this._beginCompute(this._editor.getPosition())));this._editor.addContentWidget(this)}dispose(){this._isDisposed=true;this._editor.removeContentWidget(this);this._currentRequestCancellationTokenSource.cancel();super.dispose()}getId(){return ce._ID}_beginCompute(e){const t=this._textMateService.createTokenizer(this._model.getLanguageId());const n=this._computeSemanticTokens(e);const r=this._treeSitterService.getParseResult(this._model);rt(this._domNode);this._domNode.appendChild(document.createTextNode(g(3120,"Loading...")));Promise.all([t,n]).then(([i,s])=>{if(this._isDisposed){return}this._compute(i,s,r?.tree,e);this._domNode.style.maxWidth=`${Math.max(this._editor.getLayoutInfo().width*.66,500)}px`;this._editor.layoutContentWidget(this)},i=>{this._notificationService.warn(i);setTimeout(()=>{D.get(this._editor)?.stop()})})}_isSemanticColoringEnabled(){const e=this._configurationService.getValue(ot,{overrideIdentifier:this._model.getLanguageId(),resource:this._model.uri})?.enabled;if(typeof e==="boolean"){return e}return this._themeService.getColorTheme().semanticHighlighting}_compute(e,t,n,r){const i=e&&this._getTokensAtPosition(e,r);const s=t&&this._getSemanticTokenAtPosition(t,r);const o=n&&this._getTreeSitterTokenAtPosition(n,r);if(!i&&!s&&!o){he(this._domNode,"No grammar or semantic tokens available.");return}const c=i?.metadata;const a=s?.metadata;const d=s&&fe(this._model.getValueInRange(s.range));const h=i&&fe(this._model.getLineContent(r.lineNumber).substring(i.token.startIndex,i.token.endIndex));const k=d||h||"";he(this._domNode,l("h2.tiw-token",void 0,k,l("span.tiw-token-length",void 0,`${k.length} ${k.length===1?"char":"chars"}`)));p(this._domNode,l("hr.tiw-metadata-separator",{"style":"clear:both"}));p(this._domNode,l("table.tiw-metadata-table",void 0,l("tbody",void 0,l("tr",void 0,l("td.tiw-metadata-key",void 0,"language"),l("td.tiw-metadata-value",void 0,c?.languageId||"")),l("tr",void 0,l("td.tiw-metadata-key",void 0,"standard token type"),l("td.tiw-metadata-value",void 0,this._tokenTypeToString(c?.tokenType||0))),...this._formatMetadata(a,c))));if(s){p(this._domNode,l("hr.tiw-metadata-separator"));const b=p(this._domNode,l("table.tiw-metadata-table",void 0));const S=p(b,l("tbody",void 0,l("tr",void 0,l("td.tiw-metadata-key",void 0,"semantic token type"),l("td.tiw-metadata-value",void 0,s.type))));if(s.modifiers.length){p(S,l("tr",void 0,l("td.tiw-metadata-key",void 0,"modifiers"),l("td.tiw-metadata-value",void 0,s.modifiers.join(" "))))}if(s.metadata){const y=["foreground","bold","italic","underline","strikethrough"];const _={};const w=new Array;for(const f of y){if(s.metadata[f]!==void 0){const T=s.definitions[f];const O=this._renderTokenStyleDefinition(T,f);const I=O.map(A=>st(A)?A.outerHTML:A).join();let N=_[I];if(!N){_[I]=N=[];w.push([O,I])}N.push(f)}}for(const[f,T]of w){p(S,l("tr",void 0,l("td.tiw-metadata-key",void 0,_[T].join(", ")),l("td.tiw-metadata-value",void 0,...f)))}}}if(i){const b=this._themeService.getColorTheme();p(this._domNode,l("hr.tiw-metadata-separator"));const S=p(this._domNode,l("table.tiw-metadata-table"));const y=p(S,l("tbody"));if(h&&h!==k){p(y,l("tr",void 0,l("td.tiw-metadata-key",void 0,"textmate token"),l("td.tiw-metadata-value",void 0,`${h} (${h.length})`)))}const _=new Array;for(let T=i.token.scopes.length-1;T>=0;T--){_.push(i.token.scopes[T]);if(T>0){_.push(l("br"))}}p(y,l("tr",void 0,l("td.tiw-metadata-key",void 0,"textmate scopes"),l("td.tiw-metadata-value.tiw-metadata-scopes",void 0,..._)));const w=Ft(b,i.token.scopes,false);const f=s?.metadata?.foreground;if(w){if(f!==i.metadata.foreground){let T=l("code.tiw-theme-selector",void 0,w.rawSelector,l("br"),JSON.stringify(w.settings,null,"	"));if(f){T=l("s",void 0,T)}p(y,l("tr",void 0,l("td.tiw-metadata-key",void 0,"foreground"),l("td.tiw-metadata-value",void 0,T)))}}else if(!f){p(y,l("tr",void 0,l("td.tiw-metadata-key",void 0,"foreground"),l("td.tiw-metadata-value",void 0,"No theme selector")))}}if(o){p(this._domNode,l("hr.tiw-metadata-separator"));const b=p(this._domNode,l("table.tiw-metadata-table"));const S=p(b,l("tbody"));p(S,l("tr",void 0,l("td.tiw-metadata-key",void 0,"tree-sitter token"),l("td.tiw-metadata-value",void 0,`${o.text}`)));const y=new Array;let _=o;while(_.parent){y.push(_.type);_=_.parent;if(_){y.push(l("br"))}}p(S,l("tr",void 0,l("td.tiw-metadata-key",void 0,"tree-sitter scopes"),l("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...y)));const w=at.get(this._model.getLanguageId());const f=w?.captureAtPosition(r.lineNumber,r.column,this._model);if(f&&f.length>0){p(S,l("tr",void 0,l("td.tiw-metadata-key",void 0,"foreground"),l("td.tiw-metadata-value",void 0,f[f.length-1].name)))}}}_formatMetadata(e,t){const n=new Array;function r(a){const d=e?.[a]||t?.[a];if(d!==void 0){const h=e?.[a]?"tiw-metadata-semantic":"";n.push(l("tr",void 0,l("td.tiw-metadata-key",void 0,a),l(`td.tiw-metadata-value.${h}`,void 0,d)))}return d}const i=r("foreground");const s=r("background");if(i&&s){const a=j.fromHex(s),d=j.fromHex(i);if(a.isOpaque()){n.push(l("tr",void 0,l("td.tiw-metadata-key",void 0,"contrast ratio"),l("td.tiw-metadata-value",void 0,a.getContrastRatio(d.makeOpaque(a)).toFixed(2))))}else{n.push(l("tr",void 0,l("td.tiw-metadata-key",void 0,"Contrast ratio cannot be precise for background colors that use transparency"),l("td.tiw-metadata-value")))}}const o=new Array;function c(a){let d;if(e&&e[a]){d=l("span.tiw-metadata-semantic",void 0,a)}else if(t&&t[a]){d=a}if(d){if(o.length){o.push(" ")}o.push(d)}}c("bold");c("italic");c("underline");c("strikethrough");if(o.length){n.push(l("tr",void 0,l("td.tiw-metadata-key",void 0,"font style"),l("td.tiw-metadata-value",void 0,...o)))}return n}_decodeMetadata(e){const t=this._themeService.getColorTheme().tokenColorMap;const n=z.getLanguageId(e);const r=z.getTokenType(e);const i=z.getFontStyle(e);const s=z.getForeground(e);const o=z.getBackground(e);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(n),tokenType:r,bold:i&2?true:void 0,italic:i&1?true:void 0,underline:i&4?true:void 0,strikethrough:i&8?true:void 0,foreground:t[s],background:t[o]}}_tokenTypeToString(e){switch(e){case 0:return"Other";case 1:return"Comment";case 2:return"String";case 3:return"RegEx";default:return"??"}}_getTokensAtPosition(e,t){const n=t.lineNumber;const r=this._getStateBeforeLine(e,n);const i=e.tokenizeLine(this._model.getLineContent(n),r);const s=e.tokenizeLine2(this._model.getLineContent(n),r);let o=0;for(let a=i.tokens.length-1;a>=0;a--){const d=i.tokens[a];if(t.column-1>=d.startIndex){o=a;break}}let c=0;for(let a=s.tokens.length>>>1;a>=0;a--){if(t.column-1>=s.tokens[a<<1]){c=a;break}}return{token:i.tokens[o],metadata:this._decodeMetadata(s.tokens[(c<<1)+1])}}_getStateBeforeLine(e,t){let n=null;for(let r=1;r<t;r++){const i=e.tokenizeLine(this._model.getLineContent(r),n);n=i.ruleStack}return n}isSemanticTokens(e){return e&&e.data}async _computeSemanticTokens(e){if(!this._isSemanticColoringEnabled()){return null}const t=this._languageFeaturesService.documentSemanticTokensProvider.ordered(this._model);if(t.length){const r=t[0];const i=await Promise.resolve(r.provideDocumentSemanticTokens(this._model,null,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(i)){return{tokens:i,legend:r.getLegend()}}}const n=this._languageFeaturesService.documentRangeSemanticTokensProvider.ordered(this._model);if(n.length){const r=n[0];const i=e.lineNumber;const s=new X(i,1,i,this._model.getLineMaxColumn(i));const o=await Promise.resolve(r.provideDocumentRangeSemanticTokens(this._model,s,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(o)){return{tokens:o,legend:r.getLegend()}}}return null}_getSemanticTokenAtPosition(e,t){const n=e.tokens.data;const r=this._model.getLanguageId();let i=0;let s=0;const o=t.lineNumber-1,c=t.column-1;for(let a=0;a<n.length;a+=5){const d=n[a],h=n[a+1],k=n[a+2],b=n[a+3],S=n[a+4];const y=i+d;const _=d===0?s+h:h;if(o===y&&_<=c&&c<_+k){const w=e.legend.tokenTypes[b]||"not in legend (ignored)";const f=[];let T=S;for(let J=0;T>0&&J<e.legend.tokenModifiers.length;J++){if(T&1){f.push(e.legend.tokenModifiers[J])}T=T>>1}if(T>0){f.push("not in legend (ignored)")}const O=new X(y+1,_+1,y+1,_+1+k);const I={};const N=this._themeService.getColorTheme().tokenColorMap;const A=this._themeService.getColorTheme();const x=A.getTokenStyleMetadata(w,f,r,true,I);let de=void 0;if(x){de={languageId:void 0,tokenType:0,bold:x?.bold,italic:x?.italic,underline:x?.underline,strikethrough:x?.strikethrough,foreground:N[x?.foreground||0],background:void 0}}return{type:w,modifiers:f,range:O,metadata:de,definitions:I}}i=y;s=_}return null}_walkTreeforPosition(e,t){const n=this._model.getOffsetAt(t);e.gotoFirstChild();let r=false;let i=null;do{if(e.currentNode.startIndex<=n&&n<e.currentNode.endIndex){r=true;i=e.currentNode}else{r=false}}while(r?e.gotoFirstChild():e.gotoNextSibling());return i}_getTreeSitterTokenAtPosition(e,t){const n=e.walk();return this._walkTreeforPosition(n,t)}_renderTokenStyleDefinition(e,t){const n=new Array;if(e===void 0){return n}const r=this._themeService.getColorTheme();if(Array.isArray(e)){const i={};r.resolveScopes(e,i);const s=i[t];if(s&&i.scope){const o=l("ul.tiw-metadata-values");const c=Array.isArray(s.scope)?s.scope:[String(s.scope)];for(const a of c){o.appendChild(l("li.tiw-metadata-value.tiw-metadata-scopes",void 0,a))}n.push(i.scope.join(" "),o,l("code.tiw-theme-selector",void 0,JSON.stringify(s.settings,null,"	")));return n}return n}else if(Tt.is(e)){const i=r.getTokenStylingRuleScope(e);if(i==="setting"){n.push(`User settings: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`);return n}else if(i==="theme"){n.push(`Color theme: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`);return n}return n}else{const i=r.resolveTokenStyleValue(e);n.push(`Default: ${i?this._renderStyleProperty(i,t):""}`);return n}}_renderStyleProperty(e,t){switch(t){case"foreground":return e.foreground?j.Format.CSS.formatHexA(e.foreground,true):"";default:return e[t]!==void 0?String(e[t]):""}}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[2,1]}}}ct(D.ID,D,4);dt(Vt);const pe=new URL(""+new URL("onig-Du5pRr7Y.wasm",import.meta.url).href,import.meta.url).href;gt({"vscode-oniguruma/../onig.wasm":pe,"vs/../../node_modules/vscode-oniguruma/release/onig.wasm":pe});ft(async u=>{void u.get(pt).when(2).then(()=>{_t.get(se)})});function Jt(){return{...ht(),[se.toString()]:new mt(Q,[],false)}}export{se as ITextMateTokenizationService,Jt as default};
